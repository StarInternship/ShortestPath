/**
 * Ogma
 * @description Graph visualization library
 * @version 2.5.0 (built on Fri Sep 07 2018 13:58:08 GMT+0200 (CEST))
 * @author Linkurious SAS
 * @license (c) Linkurious 2018. All rights reserved.
 * @preserve
 */
(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):e.Ogma=t()})(this,function(){"use strict";if(!Array.prototype.fill){Object.defineProperty(Array.prototype,"fill",{value:function(value){if(this==null){throw new TypeError("this is null or not defined")}var e=Object(this);var t=e.length>>>0;var r=arguments[1];var i=r>>0;var n=i<0?Math.max(t+i,0):Math.min(i,t);var a=arguments[2];var o=a===undefined?t:a>>0;var s=o<0?Math.max(t+o,0):Math.min(o,t);while(n<s){e[n]=value;n++}return e}})}if(!Array.prototype.copyWithin){Array.prototype.copyWithin=function(e,t){if(this==null){throw new TypeError("this is null or not defined")}var r=Object(this);var i=r.length>>>0;var n=e>>0;var a=n<0?Math.max(i+n,0):Math.min(n,i);var o=t>>0;var s=o<0?Math.max(i+o,0):Math.min(o,i);var u=arguments[2];var l=u===undefined?i:u>>0;var d=l<0?Math.max(i+l,0):Math.min(l,i);var h=Math.min(d-s,i-a);var f=1;if(s<a&&a<s+h){f=-1;s+=h-1;a+=h-1}while(h>0){if(s in r){r[a]=r[s]}else{delete r[a]}s+=f;a+=f;h--}return r}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(e){if(this===void 0||this===null){throw new TypeError}var t,r,i=Object(this),n=i.length>>>0;if(n===0){return-1}t=n-1;if(arguments.length>1){t=Number(arguments[1]);if(t!=t){t=0}else if(t!=0&&t!=1/0&&t!=-(1/0)){t=(t>0||-1)*Math.floor(Math.abs(t))}}for(r=t>=0?Math.min(t,n-1):n-Math.abs(t);r>=0;r--){if(r in i&&i[r]===e){return r}}return-1}}if(!Array.from){Array.from=function(){var e=Object.prototype.toString;var t=function(t){return typeof t==="function"||e.call(t)==="[object Function]"};var r=function(value){var e=Number(value);if(isNaN(e)){return 0}if(e===0||!isFinite(e)){return e}return(e>0?1:-1)*Math.floor(Math.abs(e))};var i=Math.pow(2,53)-1;var n=function(value){var e=r(value);return Math.min(Math.max(e,0),i)};return function e(r){var i=this;var a=Object(r);if(r==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var o=arguments.length>1?arguments[1]:void undefined;var s;if(typeof o!=="undefined"){if(!t(o)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){s=arguments[2]}}var u=n(a.length);var l=t(i)?Object(new i(u)):new Array(u);var d=0;var h;while(d<u){h=a[d];if(o){l[d]=typeof s==="undefined"?o(h,d):o.call(s,h,d)}else{l[d]=h}d+=1}l.length=u;return l}}()}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(this==null){throw new TypeError('"this" is null or not defined')}var r=Object(this);var i=r.length>>>0;if(i===0){return false}var n=t|0;var a=Math.max(n>=0?n:i-Math.abs(n),0);function o(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(a<i){if(o(r[a],e)){return true}a++}return false}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var r=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var i=arguments[1];var n=0;while(n<r){var a=t[n];if(e.call(i,a,n,t)){return a}n++}return undefined},configurable:true,writable:true})}var e=[Uint32Array,Uint16Array,Uint8Array,Int32Array,Int16Array,Int8Array,Float32Array,Float64Array];var t=["join","slice","reverse","forEach","map","includes","copyWithin","reduce","indexOf","sort","filter","every","some","fill"];if(!ArrayBuffer.isView){ArrayBuffer.isView=function(t){for(var r=0;r<e.length;++r){if(t instanceof e[r]){return true}}return false}}var r=function(){var e=n[i];for(var r=0,a=t;r<a.length;r+=1){var o=a[r];if(!e.prototype[o]){e.prototype[o]=Array.prototype[o]}}if(!e.from){(function(){e.from=function(t,r,i){var n=e.__proto__;if(typeof this!=="function"){throw new TypeError("# is not a constructor")}if(this.__proto__!==n){throw new TypeError("this is not a typed array.")}r=r||function(e){return e};if(typeof r!=="function"){throw new TypeError("specified argument is not a function")}t=Object(t);if(!t["length"]){return new this(0)}var a=[];for(var o=0;o<t.length;o++){a.push(t[o])}a=a.map(r,i);var s=new this(a.length);for(var o=0;o<s.length;o++){s[o]=a[o]}return s}})()}};for(var i=0,n=e;i<n.length;i+=1)r();if(typeof CanvasRenderingContext2D!=="undefined"&&!CanvasRenderingContext2D.prototype.setLineDash){CanvasRenderingContext2D.prototype.setLineDash=function(){}}if(!Math.log2){Math.log2=function(e){return Math.log(e)*Math.LOG2E}}if(!Math.sign){Math.sign=function(e){return(e>0)-(e<0)||+e}}if(!Number.isNaN){Number.isNaN=function(value){return typeof value==="number"&&isNaN(value)}}if(!Number.MAX_SAFE_INTEGER){Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:false,configurable:false,writable:false,value:Math.pow(2,53)-1})}var a=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function o(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(){var e=setTimeout;function t(){}function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof e!=="function"){throw new TypeError("not a function")}this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];d(e,this)}function n(e,t){while(e._state===3){e=e._value}if(e._state===0){e._deferreds.push(t);return}e._handled=true;i._immediateFn(function(){var r=e._state===1?t.onFulfilled:t.onRejected;if(r===null){(e._state===1?o:s)(t.promise,e._value);return}var i;try{i=r(e._value)}catch(e){s(t.promise,e);return}o(t.promise,i)})}function o(e,t){try{if(t===e){throw new TypeError("A promise cannot be resolved with itself.")}if(t&&(typeof t==="object"||typeof t==="function")){var n=t.then;if(t instanceof i){e._state=3;e._value=t;u(e);return}else if(typeof n==="function"){d(r(n,t),e);return}}e._state=1;e._value=t;u(e)}catch(t){s(e,t)}}function s(e,t){e._state=2;e._value=t;u(e)}function u(e){if(e._state===2&&e._deferreds.length===0){i._immediateFn(function(){if(!e._handled){i._unhandledRejectionFn(e._value)}})}for(var t=0,r=e._deferreds.length;t<r;t++){n(e,e._deferreds[t])}e._deferreds=null}function l(e,t,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.promise=r}function d(e,t){var r=false;try{e(function(value){if(r){return}r=true;o(t,value)},function(e){if(r){return}r=true;s(t,e)})}catch(e){if(r){return}r=true;s(t,e)}}i.prototype.catch=function(e){return this.then(null,e)};i.prototype.then=function(e,r){var i=new this.constructor(t);n(this,new l(e,r,i));return i};i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,r){if(t.length===0){return e([])}var i=t.length;function n(a,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var s=o.then;if(typeof s==="function"){s.call(o,function(e){n(a,e)},r);return}}t[a]=o;if(--i===0){e(t)}}catch(e){r(e)}}for(var a=0;a<t.length;a++){n(a,t[a])}})};i.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===i){return value}return new i(function(e){e(value)})};i.reject=function(value){return new i(function(e,t){t(value)})};i.race=function(e){return new i(function(t,r){for(var i=0,n=e.length;i<n;i++){e[i].then(t,r)}})};i._immediateFn=typeof a.setImmediate==="function"&&function(e){a.setImmediate(e)}||function(t){e(t,0)};i._unhandledRejectionFn=function e(t){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",t)}};i._setImmediateFn=function e(t){i._immediateFn=t};i._setUnhandledRejectionFn=function e(t){i._unhandledRejectionFn=t};if(typeof a==="object"&&!a.Promise){a.exports=i}if(typeof window==="object"&&!window.Promise){window.Promise=i}})(a);if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var r=this.toString();if(typeof t!=="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length){t=r.length}t-=e.length;var i=r.lastIndexOf(e,t);return i!==-1&&i===t}}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){return this.substr(t||0,e.length)===e}}if(!String.prototype.includes){String.prototype.includes=function(e,t){if(typeof t!=="number"){t=0}if(t+e.length>this.length){return false}else{return this.indexOf(e,t)!==-1}}}if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){var r=arguments;if(t==null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(t);for(var n=1;n<arguments.length;n++){var a=r[n];if(a!=null){for(var o in a){if(Object.prototype.hasOwnProperty.call(a,o)){i[o]=a[o]}}}}return i},writable:true,configurable:true})}var s=1;var u=[];var l=[];var d=[];var h=[];var f=false;var Ogma=function Ogma(e){if(e===void 0)e={};if(this===undefined||this===null||this.constructor!==Ogma){return new Ogma(e)}if(!f){f=true;for(var t=0;t<d.length;++t){d[t]()}}this._init(e)};Ogma.prototype._init=function e(t){var r=this;this._initParameters=t;this._debug=!!t.debug;this._token=s++;this.modules={};this.events={};this.view={};this.styles={};this.transformations={};this.parse={};this.export={};this.tools={};this.utils={};this.algorithms={};u.forEach(function(e){return e(r,t)});l.forEach(function(e){return e(r,t)})};Ogma.prototype._destroy=function e(){var t=this;if(!this._token){throw new Error('"destroy" called twice on the same instance of Ogma')}h.forEach(function(e){return e(t)});Object.keys(this).forEach(function(e){t[e]=undefined})};Ogma.prototype.destroy=function e(){this._destroy()};Ogma.prototype.reset=function e(){var t=this._initParameters;this._destroy();this._init(t)};function c(e,t){if(typeof t!=="function"){throw new TypeError("expected function")}e.push(t)}Ogma.extend=function(e){c(u,e)};Ogma.atInit=function(e){c(l,e)};Ogma.beforeFirstInstanceCreated=function(e){c(d,e)};Ogma.onDestroy=function(e){c(h,e)};Ogma.build={version:"2.5.0",commit:"378b827",date:"Fri Sep 07 2018 13:58:08 GMT+0200 (CEST)"};var v=function(){var e=0;return typeof requestAnimationFrame!=="undefined"?requestAnimationFrame:function(t){var r=Date.now();var i=Math.min(16,Math.max(0,16-(r-e)));var n=e=r+i;return setTimeout(function(){return t(n)},i)}}();var g=typeof cancelAnimationFrame!=="undefined"?cancelAnimationFrame:function(e){return clearTimeout(e)};function p(e,t){return v(function(r){e.call(t,r)})}function _(e){if(e){g(e)}}var y=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};Ogma.libraries=Object.create(null);var m={};var x={};var b=function(){return null};if(typeof y==="object"){m=y}if(typeof window==="object"){x=window}if(typeof module==="object"&&typeof module.require==="function"){b=function(e){try{return module.require(e)}catch(e){return null}}}else if(typeof m.require==="function"){b=function(e){try{return m.require(e)}catch(e){return null}}}function S(e,t){if(t===void 0)t={};var r=t.throwOnError;var i=null;if(!i&&e){i=Ogma.libraries[e]}if(!i&&e){i=b(e)}if(!i&&e){i=x[e]}if(!i&&e){i=m[e]}if(!i&&r){var n=['unable to find module "'+e+'"; make sure one of these statements is true:',"- Ogma.libraries['"+e+"'] is set to the right library","- require('"+e+"') returns the right library","- window['"+e+"'] is set to the right library"].join("\n");throw new Error(n)}return i}function A(e,t){for(var r=1,i=e.length;r<i;r++){var n=e[r];var a=r;while(a>0&&t.get(e[a-1])>t.get(n)){e[a]=e[a-1];--a}e[a]=n}return e}function E(e,t){for(var r=1,i=e.length;r<i;r++){var n=e[r];var a=r;while(a>0&&t.get(e[a-1])<t.get(n)){e[a]=e[a-1];--a}e[a]=n}return e}function w(e,t){for(var r=0;r<t.length;++r){e.push(t[r])}}function T(value){return Array.isArray(value)||ArrayBuffer.isView(value)}function k(value){return Array.isArray(value)?value:[value]}function C(e,t,r){for(var i=0;i<t.length;++i){e[i+r]=t[i]}}function I(e){var t=[];for(var r=0;r<e.length;++r){var i=e[r];if(Array.isArray(i)){for(var n=0;n<i.length;++n){t.push(i[n])}}else{t.push(i)}}return t}function M(e,t){var r=e.indexOf(t);if(r!==-1){e.splice(r,1);return true}return false}function L(e){return typeof e==="number"&&e%1===0}function F(e){if(!e){return[]}else if(typeof e==="string"){return e.split(".")}else if(Array.isArray(e)){for(var t=0;t<e.length;++t){if(typeof e[t]!=="string"){throw new TypeError(e[t]+" is not a string")}}return e.slice()}else{throw new TypeError('invalid property path "'+e+'": expected string or array of strings')}}function N(e,t,r){var i,n,a,o;if(t===0){return function(){e.apply(r,arguments)}}o=function(){i=false;if(n){a.apply(r,n);n=false}};a=function(){var a;if(i){n=arguments}else{a=e.apply(r,arguments);setTimeout(o,t);i=true}return a};return a}function z(e,t,r){var i,n,a,o,s;if(t==null){t=100}function u(){var l=Date.now()-o;if(l<t&&l>=0){i=setTimeout(u,t-l)}else{i=null;if(!r){s=e.apply(a,n);a=n=null}}}var l=function(){a=this;n=arguments;o=Date.now();var l=r&&!i;if(!i){i=setTimeout(u,t)}if(l){s=e.apply(a,n);a=n=null}return s};l.clear=function(){if(i){clearTimeout(i);i=null}};l.flush=function(){if(i){s=e.apply(a,n);a=n=null;clearTimeout(i);i=null}};return l}function P(e,t,r,i,n){r(e[t],t,e,i,n).then(function(a){if(t===e.length-1){i(a)}else{P(e,t+1,r,i,n)}}).catch(n)}function O(e,t){return new Promise(function(r,i){P(e,0,t,r,i)})}function D(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function R(e){return e!==null&&typeof e==="object"&&!T(e)&&!(e instanceof RegExp)&&(typeof HTMLElement==="undefined"||!(e instanceof HTMLElement))}function B(e){var t=Object.keys(e);var r=new Array(t.length);for(var i=0;i<t.length;++i){r[i]=e[t[i]]}return r}function j(e,t,r){if(Array.isArray(e)){e.forEach(t,r)}else if(R(e)){var i=Object.keys(e);if(r!==undefined){for(var n=0;n<i.length;++n){var a=i[n];t.call(r,e[a],a)}}else{for(var o=0;o<i.length;++o){var s=i[o];t(e[s],s)}}}else{throw new Error("forEach: invalid argument "+JSON.stringify(e))}}function U(e){if(Array.isArray(e)){var t=new Array(e.length);for(var r=0;r<e.length;++r){t[r]=U(e[r])}return t}else if(J(e)){var i={};var n=Object.keys(e);for(var a=0;a<n.length;++a){var o=n[a];i[o]=U(e[o])}return i}else{return e}}function V(e,t){j(t,function(t,value){if(typeof value==="object"&&value!==null){if(typeof e[t]!=="object"||e[t]===null){e[t]={}}V(e[t],value)}else{e[t]=value}})}function G(e,t){t.forEach(function(t){if(e.indexOf(t)===-1){e.push(t)}})}function W(e,t,value){var r=typeof t==="string"?t.split("."):t;for(var i=0;i<r.length-1;++i){var n=r[i];var a=e[n];if(!a){a={};e[n]=a}e=a}e[r[r.length-1]]=value}function H(e,t){var r=F(t);if(!r.length){return e}if(!e){return undefined}for(var i=0;i<r.length-1;++i){var n=r[i];var a=e[n];if(!a){return undefined}e=a}return e[r[r.length-1]]}function X(e,t,r){if(r===void 0)r=".";if(!t){t=function(e){return!R(e)}}var i={};var n=Object.keys(e);for(var a=0;a<n.length;++a){var o=n[a];var value=e[o];if(!t(value)){var s=X(value,t);var u=Object.keys(s);for(var l=0;l<u.length;l++){var d=u[l];i[""+o+r+d]=s[d]}}else{i[o]=value}}return i}function q(e){var t={};var r=Object.keys(e);for(var i=0;i<r.length;++i){var n=r[i];W(t,n,e[n])}return t}function Y(e,t,r){if(r===void 0)r=[];var i=Object.keys(e);for(var n=0;n<i.length;++n){var a=i[n];var value=e[a];var o=t?t+a:a;if(!J(value)){r.push(o)}else{Y(value,o+".",r)}}return r}function Z(e,t){if(t===void 0)t=[];if(!J(e)){t.push(e)}else{var r=Object.keys(e);for(var i=0,n=r;i<n.length;i+=1){var a=n[i];Z(e[a],t)}}return t}function K(e){if(e===void 0)e={};for(var t in e){if(typeof e[t]==="function"){delete e[t]}}return e}function Q(value,e,t){if(value===undefined){return U(e)}if(!R(value)&&t){value={};value[t]=value}if(R(e)){var r={};var i=Object.keys(e);for(var n=0,a=i;n<a.length;n+=1){var o=a[n];var s=e[o];var u=value[o];if(R(s)){r[o]=Q(u,s)}else if(u===undefined){r[o]=U(s)}else{r[o]=u}}return r}else{return value}}function J(value){return value&&(value.constructor===Object||!value.constructor)}function $(e,t){if(!J(t)||!J(e)){return t}var r=Object.assign({},e);var i=Object.keys(t);for(var n=0;n<i.length;++n){var a=i[n];r[a]=$(r[a],t[a])}return r}var ee=300;var te=150;var re,ie,ne,ae,oe,se,ue;Ogma.beforeFirstInstanceCreated(function(){re=S("xmldom");ie=S("canvas");ue=S("gl");if(typeof XMLSerializer!=="undefined"){ne=XMLSerializer}else if(re){ne=re.XMLSerializer}else{ne=null}if(typeof document!=="undefined"){ae=document}else if(re){ae=(new re.DOMImplementation).createDocument()}else{ae=null}if(typeof XMLHttpRequest!=="undefined"){oe=XMLHttpRequest}else{oe=ve}if(typeof FileReader!=="undefined"){se=FileReader}else{se=ge}});function le(){if(ae){return ae}else{return{createElementNS:function e(){return null},createElement:function e(){return null},implementation:{createDocument:function e(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}}function de(e,t){var value=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!value||value==="auto")&&le().defaultView){var r=document.defaultView.getComputedStyle(e,null);value=r?r[t]:null}return value==="auto"?null:value}function he(){if(typeof XMLSerializer!=="undefined"){return XMLSerializer}else if(re){return re.XMLSerializer}else{return function(){throw new Error('unable to instantiate XMLSerializer; if you use Node JS install the "xmldom" package')}}}function fe(){if(ie){return function(){var e=new ie(300,150);e.style={};return e}}else if(typeof document!=="undefined"){return function(){return document.createElement("canvas")}}else{return function(){return new ye}}}function ce(e,t){var r=e.getContext("webgl",t);if(!r){r=e.getContext("experimental-webgl",t)}if(!r&&ue){r=ue(e.width,e.height,t)}return r||null}var ve=function e(){if(e.onCreate){e.onCreate(this)}};ve.prototype.open=function e(t,r){this.method=t;this.url=r;if(ve.onSend){ve.onSend(this)}};ve.prototype.respond=function e(t,r,i){this.readyState=4;this.status=t;this.headers=r;this.responseText=i;this.response=i;this.onreadystatechange()};ve.prototype.send=function e(){this.readyState=4};var ge=function e(){if(e.onCreate){e.onCreate(this)}};ge.prototype.readAsDataURL=function e(t){this._blob=t;if(ge.onRead){ge.onRead(this)}};ge.prototype.load=function e(t){if(typeof t==="function"){this.result=t(this._blob)}else{this.result=t}if(this.onload){this.onload()}};var pe=function e(){this.__dummy=true;this.style={width:"0px",height:"0px"}};var _e={offsetWidth:{configurable:true},offsetHeight:{configurable:true},firstChild:{configurable:true}};_e.offsetWidth.get=function(){return parseFloat(this.style.width)};_e.offsetHeight.get=function(){return parseFloat(this.style.height)};_e.firstChild.get=function(){return null};pe.prototype.appendChild=function e(){};pe.prototype.removeChild=function e(){};pe.prototype.addEventListener=function e(){};pe.prototype.removeEventListener=function e(){};Object.defineProperties(pe.prototype,_e);var ye=function e(){this.__context=new xe;this.style={};this.width=ee;this.height=te};var me={__dummy:{configurable:true}};me.__dummy.get=function(){return true};ye.prototype.getContext=function e(t){return t==="2d"?this.__context:null};ye.prototype.toDataURL=function e(){return"data:image/png;base64,"};ye.prototype.addEventListener=function e(){};ye.prototype.removeEventListener=function e(){};ye.prototype.getBoundingClientRect=function e(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}};Object.defineProperties(ye.prototype,me);var xe=function e(){this._fontSize=10};var be={font:{configurable:true}};be.font.set=function(e){var t=e.match(/\d+/);if(t){this._fontSize=parseFloat(t[0])}};xe.prototype.fill=function e(){};xe.prototype.stroke=function e(){};xe.prototype.clearRect=function e(){};xe.prototype.fillRect=function e(){};xe.prototype.strokeRect=function e(){};xe.prototype.beginPath=function e(){};xe.prototype.closePath=function e(){};xe.prototype.moveTo=function e(){};xe.prototype.lineTo=function e(){};xe.prototype.rect=function e(){};xe.prototype.arc=function e(){};xe.prototype.save=function e(){};xe.prototype.restore=function e(){};xe.prototype.clip=function e(){};xe.prototype.translate=function e(){};xe.prototype.rotate=function e(){};xe.prototype.fillText=function e(){};xe.prototype.setLineDash=function e(){};xe.prototype.quadraticCurveTo=function e(){};xe.prototype.bezierCurveTo=function e(){};xe.prototype.drawImage=function e(){};xe.prototype.measureText=function e(t){return{width:t.length*Math.ceil(this._fontSize*.625)}};xe.prototype.getImageData=function e(){return{width:0,height:0,data:new Uint8ClampedArray(0)}};Object.defineProperties(xe.prototype,be);function Se(){return new pe}function Ae(e,t){var r=ae.createElement(e)||t&&new pe;if(!r){throw new Error('unable to instantiate new DOM element; if you use Node JS install the "xmldom" package')}return r}function Ee(e,t,r){var i=ae.createElementNS(e,t)||r&&new pe;if(!i){throw new Error('unable to instantiate new DOM element; if you use Node JS install the "xmldom" package')}return i}function we(){return ae.implementation.createDocument("","",null)}function Te(e){return(new ne).serializeToString(e)}function ke(){var e=null;if(typeof document!=="undefined"){e=document.createElement("canvas")}else if(ie){e=new ie(ee,te);e.style={}}else{e=new ye}return e}function Ce(){return typeof window!=="undefined"&&window.devicePixelRatio||1}function Ie(e){var t=";base64,";var r,i,n;if(e.indexOf(t)===-1){r=e.split(",");i=r[0].split(":")[1];n=decodeURIComponent(r[1]);return Le(n,i)}r=e.split(t);i=r[0].split(":")[1];n=window.atob(r[1]);var a=n.length;var o=new Uint8Array(a);for(var s=0;s<a;++s){o[s]=n.charCodeAt(s)}return Le([o],i)}function Me(e,t){this.data=e;this.type=t}function Le(e,t){if(typeof Blob!=="undefined"){return new Blob(e,{type:t})}else{return new Me(e,t)}}function Fe(e){if(typeof Blob!=="undefined"){return e instanceof Blob||e instanceof Me}else{return e instanceof Me}}function Ne(e,t,r){if(typeof window==="undefined"||window["__OGMA_HEADLESS"]){return e}var i=null;var n=null;var a=null;if(window.Blob){if(r==="blob"){i=e}else if(r==="dataURL"){i=Ie(e)}else{i=Le([e],"text/xml")}n=window.URL.createObjectURL(i)}else{a="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(e)}if(navigator.msSaveBlob){navigator.msSaveBlob(i,t)}else if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(i,t)}else{var o=document.createElement("a");o.setAttribute("href",window.Blob?n:a);o.setAttribute("download",t);document.body.appendChild(o);o.click();document.body.removeChild(o)}if(n){setTimeout(function(){window.URL.revokeObjectURL(n)},0)}return e}function ze(e,t,r,i){if(!i){i=Ce()}e.style.width=t+"px";e.style.height=r+"px";e.width=t*i;e.height=r*i}function Pe(e,t){j(t,function(value,t){if(value!==undefined){e.setAttribute(t,value)}})}function Oe(e,t){var r=ae.createElementNS("http://www.w3.org/2000/svg",e);if(!r.style){r.style={}}if(t){Pe(r,t)}return r}function De(e){return ae.createTextNode(e)}function Re(e){if(typeof Image==="undefined"){return Promise.resolve(null)}return new Promise(function(t){var r=new Image;r.src=e;r.onload=function(){return t(r)};r.onerror=function(){return t(null)}})}function Be(e){if(e.indexOf("http://")===0||e.indexOf("https://")===0){return e}var t=window.location.origin;var r=window.location.pathname;var i=r.lastIndexOf("/");if(i===-1){return t+"/"+e}else{return t+r.substr(0,i)+"/"+e}}function je(e){return new Promise(function(t,r){var i=new oe;i.open("GET",Be(e),true);i.onreadystatechange=function(){if(i.readyState===4){var n=i.status;if(n===200){t(i.responseText)}else if(n!==0){r(new Error('cannot retrieve file at url "'+e+'"; the server responded with status code '+n+"."))}else{r(new Error('cannot send XMLHttpRequest to url "'+e+"\"; if you're using the local file protocol this is most likely the cause."))}}};i.onerror=function(){r(new Error('cannot retrieve file at url "'+e+'"; the XMLHttpRequest failed.'))};i.send()})}function Ue(e){return typeof HTMLElement!=="undefined"?e instanceof HTMLElement:false}function Ve(e,t){e.style.cursor=t;if(e.style.cursor!==t){e.style.cursor="-webkit-"+t}}function Ge(e){if(!e.getBoundingClientRect){return null}try{return e.getBoundingClientRect()}catch(e){return null}}function We(e){return new Promise(function(t,r){var i=new oe;i.responseType="blob";i.open("GET",Be(e),true);i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200){t(i.response)}else{r(i.status)}}};i.onerror=function(e){return r(e)};i.send()})}function He(e){return We(e).then(function(e){return new Promise(function(t,r){var i=new se;i.onerror=r;i.onload=function(){return t(i.result)};i.readAsDataURL(e)})})}function Xe(e,t,r){return Array.prototype.forEach.call(e,t,r)}function qe(e,t,r){return Array.prototype.reduce.call(e,t,r)}function Ye(e,t,r,i){if(i===void 0)i="";e.font=i+" "+r+"px "+t}function Ze(e,t){if(t===void 0)t=true;var r=t?"&#13;":"\n";return(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}function Ke(){var e=le();var t=e.styleSheets;if(!t||!e.location){return Promise.resolve([])}var r=e.location.href;var i=[],n=[];for(var a=0;a<t.length;a++){var o=t[a];if(o.href===null){i.push({href:r,content:o.ownerNode.textContent})}else{n.push(o.href)}}var s=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(function(e){return je(e).then(function(t){return{href:e,content:t}}).catch(function(){return null})})).then(function(e){return e.concat(i)}).then(function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i!==null){var n=i.href;var a=i.content;var o=a.match(s);if(o){var u=$e(o,n);t.push.apply(t,u)}}}return t})}function Qe(e,t){return Promise.all(e.map(function(e){var r=e.formats;var i=e.originalRule;return Promise.all(r.map(function(e){var r=e.format;var i=e.url;if(t){return He(i).then(function(e){return{format:r,src:e}}).catch(function(){return null})}else{return{format:r,src:i}}})).then(function(e){var t=[];for(var r=0;r<e.length;r++){var n=e[r];if(n!==null){t.push("url('"+n.src+"') format('"+n.format+"')")}}if(t.length!==0){var a="src: "+t.join(",")+";";return i.replace(/src\s*:[^;]+;/g,a)}return i})}))}var Je={"embedded-opentype":true,svg:true};function $e(e,t){var r=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g;var i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/;var n=[];for(var a=0;a<e.length;a++){var o=e[a];var s=o.match(i)[1];var u=[];var l=void 0;while(l=r.exec(o)){var d=l[1];var h=l[2];if(!Je[h.toLowerCase()]){u.push({format:h,url:et(d,t)})}}n.push({name:s,formats:u,originalRule:o})}return n}function et(e,t){if(/^http(s)?:/.test(e)){return e}if(e[0]==="/"){var r=t.match(/((\w+:\/\/)([^/]+))/);if(r){return r[1]+e}else{return e}}var i=e.split("/");var n=t.split("/");if(t[t.length-1]!=="/"){n.pop()}while(i[0]===".."){i.shift();n.pop()}return n.concat(i).join("/").replace(/[\w](\/{2,})/g,function(e){return e[0]+"/"})}function tt(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function rt(e){var t=0;for(var r=0;r<e.length;++r){t+=e[r]}return t}function it(value,e,t){return Math.max(e,Math.min(t,value))}function nt(e,t,r){return e+(t-e)*r}function at(e){if(!e.length){return-Infinity}var t=e[0];for(var r=1,i=e.length;r<i;++r){var n=e[r];if(n>t){t=n}}return t}function ot(e){if(!e.length){return Infinity}var t=e[0];for(var r=1,i=e.length;r<i;++r){var n=e[r];if(n<t){t=n}}return t}var st=4;var ut=function e(){this._buffer=new Uint32Array(st);this._capacity=st;this._size=0;this._busy=false};ut.prototype.isBusy=function e(){return this._busy};ut.prototype.markBusy=function e(){this._busy=true};ut.prototype.sliceAndReset=function e(){this._busy=false;var t=this.slice();this.reset();return t};ut.prototype.reset=function e(){this._size=0};ut.prototype.reserve=function e(value){if(value>this._capacity){this._setCapacity(tt(value))}};ut.prototype._setCapacity=function e(t){var r=new Uint32Array(t);r.set(this._buffer);this._buffer=r;this._capacity=t};ut.prototype.push=function e(value){if(this._size===this._capacity){this._setCapacity(this._capacity*2)}this._buffer[this._size++]=value};ut.prototype.pushUnchecked=function e(value){this._buffer[this._size++]=value};ut.prototype.slice=function e(t,r){var i=t===undefined?0:t;var n=r===undefined?this._size:r;return this._buffer.slice(i,n)};ut.prototype.getBuffer=function e(){return this._buffer};ut.prototype.getLength=function e(){return this._size};ut.prototype.setLength=function e(value){this._size=value};ut.prototype.isEmpty=function e(){return this._size===0};var lt={};function dt(e){return typeof e==="number"&&isNaN(e)}var ht=function e(){this._keys=[];this._values=[]};ht.prototype.set=function e(t,value){var r=this._getIndex(t);if(r===-1){this._keys.push(t.slice());this._values.push(value);return true}else{this._values[r]=value;return false}};ht.prototype.get=function e(t){var r=this._getIndex(t);return r===-1?undefined:this._values[r]};ht.prototype.has=function e(t){return this._getIndex(t)!==-1};ht.prototype.delete=function e(t){var r=this._getIndex(t);if(r!==-1){this._keys.splice(r,1);this._values.splice(r,1);return true}else{return false}};ht.prototype.keys=function e(){return this._keys.map(function(e){return e.slice()})};ht.prototype.values=function e(){return this._values.slice()};ht.prototype._getIndex=function e(t){var r=this;for(var i=0;i<this._keys.length;++i){var n=r._keys[i];if(n.length===t.length){var a=true;for(var o=0;o<t.length;++o){var s=n[o],u=t[o];if(s!==u&&(!dt(s)||!dt(u))){a=false;break}}if(a){return i}}}return-1};var ft=function e(){this.clear()};var ct={size:{configurable:true}};ft.prototype.clear=function e(){this._keys=[];this._values=[];this._arrays=new ht;this._size=0};ct.size.get=function(){return this._size};ft.prototype.delete=function e(t){if(T(t)){if(this._arrays.delete(t)){this._size-=1;return true}else{return false}}else{var r=vt(this,t);if(r===-1){return false}else{this._keys.splice(r,1);this._values.splice(r,1);this._size-=1;return true}}};ft.prototype.get=function e(t){if(T(t)){return this._arrays.get(t)}else{var r=vt(this,t),value=r===-1?undefined:this._values[r];return value}};ft.prototype.has=function e(t){return T(t)?vt(this,t)!==-1:this._arrays.has(t)};ft.prototype.set=function e(t,value){if(T(t)){if(this._arrays.set(t,value)){this._size+=1}}else{var r=vt(this,t);if(r===-1){this._size+=1;this._keys.push(dt(t)?lt:t);this._values.push(value)}else{this._values[r]=value}}return this};ft.prototype.keys=function e(){var e=this._keys.slice();for(var t=0;t<e.length;++t){if(e[t]===lt){e[t]=NaN}}return e.concat(this._arrays.keys())};ft.prototype.values=function e(){return this._values.slice().concat(this._arrays.values())};Object.defineProperties(ft.prototype,ct);function vt(e,t){if(dt(t)){return e._keys.indexOf(lt)}else{return e._keys.indexOf(t)}}var gt=function e(){this._map=new Map;this._arrays=new ht};var pt={size:{configurable:true}};gt.prototype.clear=function e(){this._arrays=new ht;return this._map.clear()};gt.prototype.delete=function e(t){return T(t)?this._arrays.delete(t):this._map.delete(t)};gt.prototype.get=function e(t){return T(t)?this._arrays.get(t):this._map.get(t)};gt.prototype.set=function e(t,value){if(T(t)){this._arrays.set(t,value)}else{this._map.set(t,value)}return this};gt.prototype.keys=function e(){return Array.from(this._map.keys()).concat(this._arrays.keys())};gt.prototype.values=function e(){return Array.from(this._map.values()).concat(this._arrays.values())};pt.size.get=function(){return this._map.size+this._arrays._keys.length};Object.defineProperties(gt.prototype,pt);var _t=ft;if(typeof Map!=="undefined"&&typeof Map.prototype.keys!=="undefined"&&typeof Map.prototype.values!=="undefined"){try{(new Map).keys().next();(new Map).values().next();_t=gt}catch(e){}}var yt=_t;var mt=8;var xt=function e(t){this._constructor=t;this._array=new t(mt);this._capacity=mt;this.length=0};xt.prototype.reserve=function e(t){if(this._capacity<t){t=Math.pow(2,Math.ceil(Math.log2(t+1)));var r=new this._constructor(t);r.set(this._array);this._capacity=t;this._array=r}};xt.prototype.has=function e(value){var t=bt(this._array,value,0,this.length);return t<this.length&&this._array[t]===value};xt.prototype.add=function e(value){var t=bt(this._array,value,0,this.length),r=t<this.length&&this._array[t]===value;if(!r){if(this.length===this._capacity){this.reserve(this.length+1)}this._array.copyWithin(t+1,t,this.length);this._array[t]=value;this.length+=1}return!r};xt.prototype.remove=function e(value){var t=bt(this._array,value,0,this.length),r=t<this.length&&this._array[t]===value;if(r){this._array.copyWithin(t,t+1,this.length);this.length-=1}return r};xt.prototype.removeByPosition=function e(t){if(t>=this.length){return false}this._array.copyWithin(t,t+1,this.length);this.length-=1;return true};xt.prototype.get=function e(t){return this._array[t]};xt.prototype.clear=function e(){this.length=0};xt.prototype.slice=function e(){return this._array.slice(0,this.length)};function bt(e,t,r,i){if(r===i){return r}else{var n=r+((i-r)/2|0),value=e[n],a=t-value;if(a===0){return n}else if(a<0){return bt(e,t,r,n)}else{return bt(e,t,n+1,i)}}}var St=[];var At=[RegExp,Date];if(typeof HTMLElement!=="undefined"){St.push(HTMLElement)}function Et(e,t){for(var r=0;r<t.length;++r){if(e instanceof t[r]){return true}}return false}var wt=function(e){return typeof e!=="object"||e===null||T(e)||Et(e,At)};function Tt(e,t,r,i){if(t===void 0)t=wt;if(r===void 0)r=[];if(i===void 0)i=[];if(Et(e,St)){return}if(t(e)){r.push({path:i.slice(),value:e})}else{var n=Object.keys(e);for(var a=0;a<n.length;++a){var o=n[a],s=i.slice();s.push(o);Tt(e[o],t,r,s)}}return r}var kt=function e(){this._keys=[];this._values=[];this._size=0;this._cachedPath=[];this._cachedIndex=-1};var Ct={size:{configurable:true}};Ct.size.get=function(){return this._size};kt.prototype.set=function e(t,value){var r=It(this,t);if(r!==-1){this._values=value}else{if(Mt(this._cachedPath,t)){this._cachedIndex=this._keys.length}this._keys.push(t);this._values.push(value);this._size+=1}};kt.prototype.get=function e(t){var r=It(this,t);if(r!==-1){return this._values[r]}else{return undefined}};kt.prototype.has=function e(t){return It(this,t)!==-1};kt.prototype.keys=function e(){return this._keys.slice()};Object.defineProperties(kt.prototype,Ct);function It(e,t){if(Mt(t,e._cachedPath)){return e._cachedIndex}e._cachedPath=t.slice();for(var r=0;r<e._keys.length;++r){if(Mt(e._keys[r],t)){e._cachedIndex=r;return r}}e._cachedIndex=-1;return-1}function Mt(e,t){if(e.length!==t.length){return false}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return false}}return true}var Lt=function e(){this._values=[]};var Ft={size:{configurable:true}};Ft.size.get=function(){return this._values.length};Lt.prototype.clear=function e(){this._values=[]};Lt.prototype.add=function e(value){if(this._getIndex(value)===-1){this._values.push(value);return true}return false};Lt.prototype.addMultiple=function e(t){var r=this;for(var i=0;i<t.length;++i){r.add(t[i])}};Lt.prototype.remove=function e(value){var t=this._getIndex(value);if(t!==-1){this._values.splice(t,1);return true}return false};Lt.prototype.has=function e(value){return this._getIndex(value)!==-1};Lt.prototype.values=function e(){return this._values.slice()};Lt.prototype.keys=function e(){return this._values};Lt.prototype._getIndex=function e(value){return this._values.indexOf(value)};Object.defineProperties(Lt.prototype,Ft);var Nt=function e(){this._set=new Set};var zt={size:{configurable:true}};zt.size.get=function(){return this._set.size};Nt.prototype.clear=function e(){this._set.clear()};Nt.prototype.add=function e(value){var t=this._set.size;this._set.add(value);var r=this._set.size;return r!==t};Nt.prototype.addMultiple=function e(t){var r=this;for(var i=0;i<t.length;++i){r.add(t[i])}};Nt.prototype.remove=function e(value){return this._set.delete(value)};Nt.prototype.has=function e(value){return this._set.has(value)};Nt.prototype.values=function e(){return Array.from(this._set.values())};Nt.prototype.keys=function e(){return Array.from(this._set.keys())};Object.defineProperties(Nt.prototype,zt);var Pt=Lt;if(typeof Set!=="undefined"){Pt=Nt;if(!Set.prototype.values){Pt.prototype.values=function(){var e=new Array(this._set.size);var t=0;this._set.forEach(function(value){return e[t++]=value});return e}}}var Ot=Pt;var Dt={1:Ut(1),2:Ut(2),4:Ut(4),8:Bt(),16:Bt(),32:Bt(),int8:Bt(),int16:Bt(),int32:Bt(),float:Bt(),any:Bt()};var Rt={1:Vt(1),2:Vt(2),4:Vt(4),8:jt(),16:jt(),32:jt(),int8:jt(),int16:jt(),int32:jt(),float:jt(),any:jt()};function Bt(){return new Function("array","index","return array[index];")}function jt(){return new Function("array","index","value","array[index] = value;")}function Ut(e){var t=8/e;var r="return (array[index / "+t+" | 0] >> ((index % "+t+") * "+e+")) & "+((1<<e)-1)+";";return new Function("array","index",r)}function Vt(e){return new Function("array","index","value","\n    var offset = (index % "+8/e+") * "+e+";\n    var finalIndex = index / "+8/e+" | 0;\n    var orMask = value << offset;\n    var andMask = 255 - (("+(Math.pow(2,e)-1)+" - value) << offset);\n\n    array[finalIndex] = (array[finalIndex] & andMask) | orMask;")}function Gt(e,t){if(e===undefined&&t!=="any"&&t!=="resource"){return 0}else{return e}}var Wt=function e(t){var r=t.name;var i=t.storage;var n=t.size||0;var a=Gt(t.default,i);var o=Math.max(8,qt(n+1));var s=i==="resource"?1:i;this._name=r;this._storage=i;this._getArrayElt=Dt[s];this._setArrayElt=Rt[s];this._elementSize=s;this._nbElements=o;this._fallback=null;this._byName=undefined;this._byIndex=undefined;this._nextIndex=undefined;this._defaultValue=a;this._BASE_VALUE=i==="any"?undefined:0;this._methods=Ht;this._initialized=false;this._buffer=null;if(i==="resource"){this._methods=Xt;this._byName={};this._byIndex=[];this._nextIndex=1;this._byName[a]=0;this._byIndex.push(a)}};Wt.prototype.getName=function e(){return this._name};Wt.prototype.get=function e(t){return this._get(t)};Wt.prototype.set=function e(t,value){this._set(t,value)};Wt.prototype._get=function e(){return this._defaultValue};Wt.prototype._set=function e(t,value){if(value===this._defaultValue){return}this._initialize();this._set(t,value)};Wt.prototype.setFallback=function e(t){this._fallback=t;this.get=this._getWithFallback};Wt.prototype._getWithFallback=function e(t){var value=this._get(t);if(value===undefined){return this._fallback.get(t)}return value};Wt.prototype._initialize=function e(){this._initialized=true;this._buffer=Yt(this._nbElements,this._elementSize);this._get=this._methods.get;this._set=this._methods.set;if(this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE){this._reset(0)}};Wt.prototype.increaseNbElements=function e(t){var r=this;var i=qt(t+1);if(i<=this._nbElements){return}if(this._initialized){if(this._elementSize==="any"){for(var n=this._nbElements;n<i;++n){r._buffer.push(r._defaultValue)}}else{var a=Yt(i,this._elementSize);a.set(this._buffer);this._buffer=a;if(this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE){this._reset(this._nbElements)}}}this._nbElements=i};Wt.prototype.increaseElementSize=function e(){var t=this._elementSize;if(typeof t!=="number"||t===32){throw new Error("FlexArray: cannot increase element size")}var r=t*2;var i=Dt[r];var n=Rt[r];if(this._initialized){var a=this._nbElements;var o=this._getArrayElt;var s=this._buffer;var u=Yt(a,r);if(t>=8){u.set(s)}else{for(var l=0;l<a;++l){n(u,l,o(s,l))}}this._buffer=u}this._elementSize=r;this._getArrayElt=i;this._setArrayElt=n};Wt.prototype.buffer=function e(){if(!this._buffer){throw new Error("FlexArray: buffer not instantiated")}return this._buffer};Wt.prototype.elementBitSize=function e(){return this._elementSize};Wt.prototype.capacity=function e(){return this._nbElements};Wt.prototype.byteSize=function e(){return this._nbElements*this._elementSize/8};Wt.prototype.isInitialized=function e(){return this._initialized||this._fallback&&this._fallback.isInitialized()};Wt.prototype.getMultiple=function e(t,r){var i=this;var n=t.length;if(r===undefined){r=new Array(n)}for(var a=0,o=n;a<o;++a){r[a]=i.get(t[a])}return r};Wt.prototype.fill=function e(t,value){var r=this;for(var i=0,n=t.length;i<n;++i){r.set(t[i],value)}};Wt.prototype.setMultiple=function e(t,r,i){var n=this;if(!i&&(Array.isArray(r)||ArrayBuffer.isView(r))){for(var a=0,o=t.length;a<o;++a){n.set(t[a],r[a])}}else{for(var s=0,u=t.length;s<u;++s){n.set(t[s],r)}}};Wt.prototype.reset=function e(){if(this._initialized){this._reset(0)}};Wt.prototype._reset=function e(t){var r=this;var value=this._storage==="resource"?0:this._defaultValue;if(typeof this._elementSize!=="number"||this._elementSize>=8){this._buffer.fill(value,t)}else{var i=8/this._elementSize;var n=0;for(var a=0;a<i;++a){n=n<<r._elementSize;n+=value}if(t===undefined){this._buffer.fill(n)}else{var o=8-t%8;var s=t+o;for(var u=t;u<s;++u){r._setArrayElt(r._buffer,u,value)}this._buffer.fill(n,s/8)}}};Wt.prototype._getElementBitSize=function e(){return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))};var Ht={get:function e(t){return this._getArrayElt(this._buffer,t)},set:function e(t,value){this._setArrayElt(this._buffer,t,value)}};var Xt={get:function e(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set:function e(t,value){var r=this._byName[value];if(r===undefined){r=this._nextIndex++;this._byIndex.push(value);var i=this._getElementBitSize();if(i>this._elementSize){this.increaseElementSize()}this._byName[value]=r}this._setArrayElt(this._buffer,t,r)}};function qt(e){var t=2;while(t<e){t*=2}return t}function Yt(e,t){if(t==="any"){return new Array(e)}else if(t==="float"){return new Float32Array(e)}else if(t==="int8"){return new Int8Array(e)}else if(t==="int16"){return new Int16Array(e)}else if(t==="int32"){return new Int32Array(e)}else if(t===32){return new Uint32Array(e)}else if(t===16){return new Uint16Array(e)}else{return new Uint8Array(Math.ceil(e/8*t))}}var Zt=function e(t){this._name=t?"node":"edge";this._nextIndex=1;this._freeIndexes=[];this._indexesToBeFreed=[];this._idToIndex=Object.create(null);this._indexToId=[undefined];this._flexArrays=[];this._defaultValues=[];this._flexArraysByName={};this._indexLists=[];this._idFlexArray={_self:this,get:function e(t){return this._self._indexToId[t]},getMultiple:function e(t){var r=this;var i=new Array(t.length);for(var n=0;n<t.length;++n){i[n]=r._self._indexToId[t[n]]}return i}}};Zt.prototype.addElements=function e(t){var r=this;var i=[];for(var n=0,a=t.length;n<a;++n){var o=t[n];var s=r._idToIndex[o];if(s===undefined){s=r._getNextIndex();r._idToIndex[o]=s;r._indexToId[s]=o}i.push(s)}for(var u=0,l=r._flexArrays;u<l.length;u+=1){var d=l[u];d.increaseNbElements(r._nextIndex)}for(var h=0,f=r._indexLists;h<f.length;h+=1){var c=f[h];c.reserve(r._nextIndex)}return new Uint32Array(i)};Zt.prototype.removeElements=function e(t){var r=this;for(var i=0,n=t.length;i<n;++i){var a=t[i];var o=r._indexToId[a];if(o!==undefined){delete r._idToIndex[o];r._removeIndex(a)}}};Zt.prototype.clear=function e(){var t=this;this._idToIndex=Object.create(null);this._indexToId=[undefined];this._nextIndex=1;this._freeIndexes=[];for(var r=0,i=t._flexArrays;r<i.length;r+=1){var n=i[r];n.reset()}for(var a=0,o=t._indexLists;a<o.length;a+=1){var s=o[a];s.reset()}};Zt.prototype.has=function e(t){return this._indexToId[t]!==undefined};Zt.prototype.getIndex=function e(t,r){if(r===void 0)r=false;var i=this._idToIndex[t];if(i===undefined&&r){throw new Error(this._name+' id "'+t+'" not found')}return i};Zt.prototype.createFlexArray=function e(t){var r=t.name;if(r&&this._flexArraysByName[r]){throw new Error(this._name+' flexArray "'+r+'" already exists')}var i=t.default;if(i===undefined&&t.storage!=="any"&&t.storage!=="resource"){i=0}var n=this._nextIndex;var a=new Wt({storage:t.storage,size:n,default:i,name:r});this._flexArrays.push(a);this._defaultValues.push(t.default);if(r){this._flexArraysByName[r]=a}return a};Zt.prototype.getFlexArray=function e(t){if(t==="id"){return this._idFlexArray}return this._flexArraysByName[t]||null};Zt.prototype.getAllFlexArrays=function e(){return this._flexArrays.slice()};Zt.prototype.createIndexList=function e(){var t=new ut;t.reserve(this._nextIndex);this._indexLists.push(t);return t};Zt.prototype.getId=function e(t){return this._indexToId[t]};Zt.prototype.getMaxIndex=function e(){return this._nextIndex-1};Zt.prototype._removeIndex=function e(t){this._indexesToBeFreed.push(t)};Zt.prototype._getNextIndex=function e(){var t=this._freeIndexes.pop();if(t===undefined){t=this._nextIndex++}return t};Zt.prototype.freeIndexes=function e(){var t=this;for(var r=0,i=t._indexesToBeFreed;r<i.length;r+=1){var n=i[r];t._indexToId[n]=undefined;t._freeIndexes.push(n)}for(var a=0;a<this._flexArrays.length;++a){var o=t._flexArrays[a];var s=t._defaultValues[a];for(var u=0,l=t._indexesToBeFreed;u<l.length;u+=1){var d=l[u];o.set(d,s)}}this._indexesToBeFreed=[]};var Kt=8;var Qt=function e(){this._BIG_LIST=new Uint8Array([-1])[0];this._MAX_LIST_SIZE=8;this._capacity=Kt;this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE);this._sizes=new Uint8Array(this._capacity);this._bigLists=[];this._nextIndex=0;this._constList=new Array(this._MAX_LIST_SIZE)};Qt.prototype.addEntry=function e(t){if(t===undefined){t=this._nextIndex++}if(t>=this._capacity){this._reserve(t+1)}this._sizes[t]=0;return t};Qt.prototype.get=function e(t){var r=this;var i=this._sizes[t];var n=this._MAX_LIST_SIZE*t;if(i<=this._MAX_LIST_SIZE){this._constList.length=i;for(var a=0,o=i;a<o;++a){r._constList[a]=r._buffer[n+a]}return this._constList}else if(i===this._BIG_LIST){var s=this._buffer[n];return this._bigLists[s]}};Qt.prototype.size=function e(t){var e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length};Qt.prototype.sizes=function e(t){var e=this._sizes;var r=this._bigLists;var i=this._buffer;var n=this._MAX_LIST_SIZE;var a=t.length;var o=new Array(a);for(var s=0;s<a;s++){var u=t[s];var l=e[u];o[s]=l<=n?l:r[i[u*n]].length}return o};Qt.prototype.addTo=function e(t,value){var r=this;var i=this._sizes[t];var n=t*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE){this._buffer[n+i]=value;this._sizes[t]=i+1}else if(i===this._BIG_LIST){var a=this._buffer[n];this._bigLists[a].push(value)}else{var o=new Array(this._MAX_LIST_SIZE);for(var s=0;s<this._MAX_LIST_SIZE;++s){o[s]=r._buffer[n+s]}o.push(value);this._bigLists.push(o);this._sizes[t]=this._BIG_LIST;this._buffer[n]=this._bigLists.length-1}};Qt.prototype.removeFrom=function e(t,value){this.removeFromAndGetSize(t,value)};Qt.prototype.removeFromAndGetSize=function e(t,value){var r=this;var i=this._MAX_LIST_SIZE*t;var n=this._sizes[t];if(n<=this._MAX_LIST_SIZE){for(var a=i,o=i+n;a<o;++a){if(r._buffer[a]===value){n-=1;r._buffer[a]=r._buffer[o-1];r._sizes[t]=n;return n}}}else if(n===this._BIG_LIST){var s=this._buffer[i];var u=this._bigLists[s];var l=u.indexOf(value);if(l!==-1){u.splice(l,1);return u.length}}throw new Error('topology: Table: "removeFrom" failed, should not happen')};Qt.prototype.reserve=function e(t){if(this._capacity<t){this._reserve(t)}};Qt.prototype._reserve=function e(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t)));this._buffer=Jt(this._buffer,this._capacity*this._MAX_LIST_SIZE);this._sizes=Jt(this._sizes,this._capacity)};function Jt(e,t){var r=new e.constructor(t);r.set(e);return r}var $t=typeof performance!=="undefined"&&performance.now?function(){return performance.now()|0}:function(){return Date.now()};var er=$t();function tr(){return $t()-er}function rr(){var e=new Date;var t=e.getDate();var r=e.getMonth()+1;var i=e.getFullYear();if(t<10){t="0"+t}if(r<10){r="0"+r}return i+"-"+r+"-"+t}function ir(){var e=new Date;var t=nr((e.getUTCHours()-(e.getTimezoneOffset()/60|0))%24);var r=nr(e.getUTCMinutes());var i=nr(e.getUTCSeconds());var n=nr(e.getUTCMilliseconds(),3);return"["+t+":"+r+":"+i+":"+n+"]"}function nr(e,t){t=t||2;var r=Math.pow(10,t-1);var i=e;while(r>1){if(e<r){i="0"+i}r/=10}return i}var ar=S("webworker-threads");var or=ar?ar.Worker:null;function sr(e){if(or){return ur(e)}else{return e}}function ur(e){if(ArrayBuffer.isView(e)){return Array.from(e)}else if(Array.isArray(e)){for(var t=0;t<e.length;++t){e[t]=ur(e[t])}return e}else if(J(e)){var r=Object.keys(e);for(var i=0,n=r;i<n.length;i+=1){var a=n[i];e[a]=ur(e[a])}return e}else{return e}}function lr(e){if(or){return fr(e)}else if(typeof URL==="undefined"||navigator.appVersion.indexOf("MSIE 10")!==-1){return hr(e)}else{return dr(e)}}function dr(e){try{var t=new Blob([e],{type:"application/javascript"});var r=URL.createObjectURL(t);var i=new Worker(r);return i}catch(t){return new cr(e)}}function hr(e){return new cr(e)}function fr(e){return new or(new Function(e))}var cr=function e(t){this._f=new Function("self",t);this._main=true;this._listeners=[];this._terminated=false;this._otherSide=new vr(this);this._f(this._otherSide)};cr.prototype.terminate=function e(){this._terminated=false;this._otherSide._terminated=true};cr.prototype.addEventListener=gr;cr.prototype.postMessage=pr;var vr=function e(t){this._main=false;this._listeners=[];this._terminated=false;this._otherSide=t};vr.prototype.addEventListener=gr;vr.prototype.postMessage=pr;function gr(e,t){this._listeners.push(t)}function pr(e){setTimeout(_r,0,this._otherSide,{data:e})}function _r(e,t){if(e._terminated){return}for(var r=0;r<e._listeners.length;++r){e._listeners[r](t)}}var yr=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function mr(e,t){if(t===void 0)t=[];var r=yr.exec(e);if(r){t[0]=parseInt(r[1])/255;t[1]=parseInt(r[2])/255;t[2]=parseInt(r[3])/255;t[3]=r[4]===undefined?1:parseFloat(r[4]);return t}else{return null}}function xr(e){if(e<16){return"0"+e.toString(16)}else{return e.toString(16)}}function br(e){var t=e[0];var r=e[1];var i=e[2];var n=e[3];if(n===void 0)n=1;return"rgba("+(t*256|0)+","+(r*256|0)+","+(i*256|0)+","+n+")"}function Sr(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,r,i){return t+t+r+r+i+i});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(r){return[parseInt(r[1],16)/255,parseInt(r[2],16)/255,parseInt(r[3],16)/255,1]}else{return null}}var Ar=function e(t){this._name=t;this._attributes={};this._children=[]};var Er={tagName:{configurable:true},children:{configurable:true},childNodes:{configurable:true},firstChild:{configurable:true}};Ar.prototype.setAttribute=function e(t,value){this._attributes[t]=value};Ar.prototype.appendChild=function e(t){this._children.push(t)};Er.tagName.get=function(){return this._name};Er.children.get=function(){return this._children};Er.childNodes.get=function(){return this._children};Er.firstChild.get=function(){return this._children[0]||null};Ar.prototype.serialize=function e(){var t=this._name;var r=this._attributes;var i=this._children;var n=Object.keys(r).filter(function(e){return r[e]!==undefined});var a=n.map(function(e){return" "+e+'="'+(""+r[e])+'"'}).join("");var o=i.map(function(e){return e.serialize()}).join("");if(!o.length){return"<"+t+a+"/>"}else{return"<"+t+a+">"+o+"</"+t+">"}};Ar.prototype.cloneNode=function e(t){var r=this;var i=new Ar(this._name);var n=Object.keys(this._attributes);for(var a=0,o=n;a<o.length;a+=1){var s=o[a];i.setAttribute(s,r._attributes[s])}if(t){for(var u=0;u<this._children.length;u++){i.appendChild(r._children[u].cloneNode(t))}}return i};Object.defineProperties(Ar.prototype,Er);var wr=function e(t){this._text=t};wr.prototype.serialize=function e(){return this._text};wr.prototype.cloneNode=function e(){return new wr(this._text)};var Tr=function e(){this._children=[];this._meta=[]};Tr.prototype.appendChild=function e(t){this._children.push(t)};Tr.prototype.serialize=function e(){return this._meta.concat(this._children.map(function(e){return e.serialize()})).join("")};Tr.prototype.createElement=function e(t){return new Ar(t)};Tr.prototype.createTextNode=function e(t){return new wr(t)};function kr(){return new Tr}var Cr=function e(t){this._keyToValue=t;this._keyToIndex=new Int32Array(t.length);this._heap=[];this._size=0;this._keyToIndex.fill(-1)};Cr.prototype.add=function e(t){var r=this._keyToIndex[t];if(r===-1){r=this._size++;this._heap[r]=t}this._keyToIndex[t]=this._bubble(r)};Cr.prototype.removeMin=function e(){if(this._size===0){return NaN}var t=this._heap[0];this._heap[0]=this._heap[--this._size];this._bubble(0);return t};Cr.prototype.isEmpty=function e(){return this._size===0};Cr.prototype.has=function e(t){return this._keyToIndex[t]!==-1};Cr.prototype._bubble=function e(t){var value=this._indexToValue(t);var r=this._getParentIndex(t);var i=this._indexToValue(r);var n=t;if(t!==0&&i>value){n=this._swap(t,r)}else{var a=this._getLeftChildIndex(t);var o=this._getRightChildIndex(t);var s=this._indexToValue(a);var u=this._indexToValue(o);var l=Math.min(value,s,u);if(l===value);else if(l===s){n=this._swap(t,a)}else{n=this._swap(t,o)}}if(n===t){return t}else{return this._bubble(n)}};Cr.prototype._indexToValue=function e(t){if(t>=this._size){return Infinity}else{return this._keyToValue[this._heap[t]]}};Cr.prototype._getParentIndex=function e(t){return(t-1)/2|0};Cr.prototype._getLeftChildIndex=function e(t){return t*2+1};Cr.prototype._getRightChildIndex=function e(t){return t*2+2};Cr.prototype._swap=function e(t,r){var i=this._heap[t];var n=this._heap[r];this._heap[t]=n;this._heap[r]=i;this._keyToIndex[i]=r;this._keyToIndex[n]=t;return r};var Ir=function e(t,r){this._graph=t.modules.graph;this._nodes={ElementList:t.NodeList,flexArray:this._graph.createNodeAttribute({storage:1,name:r}),indexList:this._graph.createIndexList(true)};this._edges={ElementList:t.EdgeList,flexArray:this._graph.createEdgeAttribute({storage:1,name:r}),indexList:this._graph.createIndexList(false)}};Ir.prototype._get=function e(t){return t.isNode?this._nodes:this._edges};Ir.prototype.addOrRemoveElements=function e(t,r){return r?this.addElements(t):this.removeElements(t)};Ir.prototype.addElements=function e(t){var r=this._get(t);var i=r.ElementList;var n=r.flexArray;var a=r.indexList;var o=a.getLength();for(var s=0,u=t._indexes;s<u.length;s+=1){var l=u[s];if(n.get(l)!==1){n.set(l,1);a.pushUnchecked(l)}}var d=a.slice(o);return new i(d)};Ir.prototype.removeElements=function e(t){var r=this._get(t);var i=r.ElementList;var n=r.flexArray;var a=r.indexList;var o=a.getLength();var s=a.getBuffer();var u=0;for(var l=0,d=t._indexes;l<d.length;l+=1){var h=d[l];if(n.get(h)!==0){n.set(h,0);u+=1}}if(u===o){return new i(a.sliceAndReset())}else if(u===0){return new i}else{var f=this._graph.acquireTemporaryIndexList(t);var c=0;for(var v=0;v<o;++v){var g=s[v];if(n.get(g)===0){c+=1;f.pushUnchecked(g)}else{s[v-c]=g}}a.setLength(o-u);return new i(f.sliceAndReset())}};Ir.prototype.hasElement=function e(t){return!!this._get(t).flexArray.get(t._index)};Ir.prototype.clear=function e(){if(!this._nodes.indexList.isEmpty()){this._nodes.indexList.reset();this._nodes.flexArray.reset()}if(!this._edges.indexList.isEmpty()){this._edges.indexList.reset();this._edges.flexArray.reset()}};Ir.prototype.isEmpty=function e(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()};Ir.prototype.getElements=function e(){return{nodes:new this._nodes.ElementList(this._nodes.indexList.slice()),edges:new this._edges.ElementList(this._edges.indexList.slice())}};var Mr=function e(t){if(t===void 0)t={};var r=t.xValues;if(r===void 0)r=[];var i=t.yValues;if(i===void 0)i=[];var n=t.scaledSizeValues;if(n===void 0)n=[];var a=t.fixedSizeValues;if(a===void 0)a=[];this.minX=ot(r);this.minY=ot(i);this.maxX=at(r);this.maxY=at(i);this.minScaledSize=ot(n);this.maxScaledSize=at(n);this.minFixedSize=ot(a);this.maxFixedSize=at(a);this.cx=this.minX+(this.maxX-this.minX)/2;this.cy=this.minY+(this.maxY-this.minY)/2;this.width=this.maxX-this.minX;this.height=this.maxY-this.minY};Mr.prototype.reset=function e(){this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.minScaledSize=Infinity;this.maxScaledSize=-Infinity;this.minFixedSize=Infinity;this.maxFixedSize=-Infinity;this.width=0;this.height=0;this.cx=0;this.cy=0;return this};Mr.prototype.addPoint=function e(t,r,i,n){this.minX=Math.min(this.minX,t);this.minY=Math.min(this.minY,r);this.maxX=Math.max(this.maxX,t);this.maxY=Math.max(this.maxY,r);if(i!==undefined&&n!==undefined){if(n==="scaled"){this.minScaledSize=Math.min(this.minScaledSize,i);this.maxScaledSize=Math.max(this.maxScaledSize,i)}else{this.minFixedSize=Math.min(this.minFixedSize,i);this.maxFixedSize=Math.max(this.maxFixedSize,i)}}this.cx=this.minX+(this.maxX-this.minX)/2;this.cy=this.minY+(this.maxY-this.minY)/2;this.width=this.maxX-this.minX;this.height=this.maxY-this.minY;return this};Mr.prototype.computeForZoom=function e(t){var r=Math.max(this.maxScaledSize,this.maxFixedSize/t);return{minX:this.minX-r,minY:this.minY-r,maxX:this.maxX+r,maxY:this.maxY+r}};Mr.prototype.pad=function e(value){this.minX-=value;this.minY-=value;this.maxX+=value;this.maxY+=value;this.width+=2*value;this.height+=2*value;return this};var Lr=Array.isArray;var Fr=function e(){};Fr.prototype.on=function e(t,r){if(typeof t!=="string"){throw new TypeError("Event name must be string")}if(typeof r!=="function"){throw new TypeError("Event handler must be function")}var i=this._events=this._events||{};var n=i[t]=i[t]||[];n.push(r);return this};Fr.prototype.off=function e(t,r){if(typeof t!=="string"){throw new TypeError("Event name must be string")}var i=this._event=this._events||{};var n=i[t];if(Lr(n)){if(typeof r!=="function"){i[t]=null}else{var a=n.indexOf(r);if(a!==-1){n.splice(a,1)}if(n.length===0){i[t]=null}}}return this};Fr.prototype.fire=function e(t){var r=this;if(typeof t!=="string"){throw new TypeError("Event name must be string")}var i=this._event=this._events||{};var n=i[t],a;if(Lr(n)){var o=Array.prototype.slice.call(arguments,1);for(var s=0;s<n.length;s++){a=n[s];if(a){a.apply(r,o)}}}return this};Fr.prototype.once=function e(t,r){var i=this;var n=function(){r.apply(i,Array.prototype.slice.call(arguments,0));i.off(t,n)};n.handler=r;return this.on(t,n)};Fr.prototype.hasListener=function e(t,r){if(!t||!r){return false}var i=this._events=this._events||{};var n=i[t];if(Lr(n)){var a;for(var o=0,s=n.length;o<s;o++){a=n[o];if(a===r||a.handler===r){return true}}}return false};Fr.prototype.getListeners=function e(t){var r=this._events=this._events||{};return r[t]};Fr.mixin=function(e){var t=typeof e==="function"?e.prototype:e;var r=["addEventListener","removeEventListener","addOneTimeEventListener","dispatch","on","off","once","fire","trigger"];for(var i=0,n=r.length;i<n;i++){var a=r[i];t[a]=Fr.prototype[a]}return e};Fr.prototype.addEventListener=Fr.prototype.on;Fr.prototype.removeEventListener=Fr.prototype.off;Fr.prototype.addOneTimeEventListener=Fr.prototype.once;Fr.prototype.trigger=Fr.prototype.dispatch=Fr.prototype.fire;var Nr=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"];var zr=function e(){var t=this;this._colorByName={};this._colorByName["null"]=[0,0,0,0];this._colorByName["transparent"]=[0,0,0,0];this._temp=[0,0,0,0];for(var r=0;r<Nr.length;r+=2){var i=Nr[r].toLowerCase();var value=Nr[r+1];t._colorByName[i]=Sr(value)}};zr.prototype.parseColor=function e(t){var r=this._colorByName[t];if(r===undefined){var i=t+"";r=i.charAt(0)==="#"?Sr(i):mr(i);this._colorByName[t]=r}return r};zr.prototype.toHexa=function e(t){var r=this.parseColor(t);return"#"+xr(r[0])+xr(r[1])+xr(r[2])};zr.prototype.rgbaToRgb=function e(t){var r=1;var i=t;if(i&&mr(t,this._temp)){i="rgb("+ +this._temp[0]*255+","+ +this._temp[1]*255+","+ +this._temp[2]*255+")";r=parseFloat(this._temp[3])}return{color:i,opacity:r}};var Pr=Object.freeze({BoundingBox:Mr,FlexArray:Wt,EventTarget:Fr,ColorManager:zr,requestAnimFrame:p,cancelAnimFrame:_,getDocument:le,getStyle:de,getXmlSerializerClass:he,getCanvasFactory:fe,getWebglContext:ce,DummyXHR:ve,DummyFileReader:ge,DummyCanvas:ye,createDummyDomElement:Se,createDomElement:Ae,createDomElementNS:Ee,createXmlDocument:we,serializeXMLDocument:Te,createCanvas:ke,getPixelRatio:Ce,dataUrlToBlob:Ie,createBlob:Le,isBlob:Fe,promptDownload:Ne,resizeElement:ze,setAttributes:Pe,createSvgElement:Oe,createTextNode:De,getImage:Re,fetch:je,isHTMLElement:Ue,applyCursorStyle:Ve,getBoundingClientRect:Ge,fetchBinary:We,fetchBinaryAsBase64:He,eachNode:Xe,reduceNodeList:qe,setCtxFont:Ye,escapeDOMAttribute:Ze,getDocumentFontRules:Ke,getEmbeddedFontRules:Qe,resolvePath:et,IndexList:ut,isInteger:L,toPropertyPath:F,throttle:N,debounce:z,processQueue:O,isLittleEndian:D,isRawObject:R,getValues:B,forEach:j,deepCopy:U,updateObject:V,extendList:G,setProperty:W,getProperty:H,flatten:X,unflatten:q,getFlattenedKeys:Y,getLeafValues:Z,ensureTransferable:K,getOptions:Q,isObject:J,mergeValues:$,PathMap:kt,objToValueList:Tt,smartRequire:S,getCurrentTime:tr,getDate:rr,getTime:ir,formatWorkerMessage:sr,createWorker:lr,insertSortAsc:A,insertSortDesc:E,pushMultipleValues:w,isArray:T,toArray:k,writeSequenceAt:C,flattenArray:I,removeFromArray:M,parseColorRgba:mr,toHexa:xr,componentsToRGBA:br,parseColorHex:Sr,createDummyXmlDocument:kr,PrioritySet:Cr,nextPowerOfTwo:tt,computeSum:rt,clamp:it,mix:nt,computeMax:at,computeMin:ot,ElementSet:Ir});function circleCircleIntersection(e,t,r,i,n,a){var o,s,u,l,d,h,f;var c,v;s=i-e;u=n-t;l=Math.sqrt(s*s+u*u);if(l>r+a){return null}if(l<Math.abs(r-a)){return null}o=(r*r-a*a+l*l)/(2*l);c=e+s*o/l;v=t+u*o/l;d=Math.sqrt(r*r-o*o);h=-u*(d/l);f=s*(d/l);return[[c+h,v+f],[c-h,v-f]]}function circleSortCompare(e,t,r,i,n,a){if(e-n>=0&&r-n<0){return 1}if(e-n<0&&r-n>=0){return-1}if(e-n===0&&r-n===0){return t-i>=0||i-a>=0?t-i:i-t}var o=(e-n)*(i-a)-(r-n)*(t-a);if(o<0){return 1}if(o>0){return-1}var s=(e-n)*(e-n)+(t-a)*(t-a);var u=(r-n)*(r-n)+(i-a)*(i-a);return s-u}function Or(e,t,r){var i=e[2];var n=Math.abs(e[0]-t),a=Math.abs(e[1]-r);if(n+a<=i){return true}if(n>i||a>i){return false}return Math.sqrt(n*n+a*a)<i+1e-12}function Dr(e,t,r,i){var n=e[0]-t,a=e[1]-r,o=e[2]-i;return n*n+a*a<o*o+1e-6}function Rr(e,t,r,i,n,a,o){var s=Math.max(i,Math.min(a,e));var u=Math.max(n,Math.min(o,t));var l=e-s;var d=t-u;return l*l+d*d<r*r}function Br(e,t,r,i,n,a,o,s){var u=s||{x:0,y:0};var l,d,h,f;if(r===e){var c=e-n;var v=o*o-c*c;if(v<0){return null}var g=Math.sqrt(v);l=e;h=e;d=a+g;f=a-g}else{var p=(i-t)/(r-e);var _=t-p*e;var y=_-a;var m=p*p+1;var x=2*(p*y-n);var b=n*n+y*y-o*o;var S=x*x-4*m*b;if(S<0){return null}var A=-x;var E=Math.sqrt(S);var w=2*m;l=(A+E)/w;h=(A-E)/w;d=p*l+_;f=p*h+_}var T=e-l;var k=t-d;var C=e-h;var I=t-f;if(T*T+k*k<C*C+I*I){u.x=l;u.y=d}else{u.x=h;u.y=f}return u}function jr(e,t,r,i,n,a){if(a===void 0)a={x:0,y:0};var o=Math.cos(n),s=Math.sin(n),u=e-r,l=t-i;a.x=o*u-s*l+r;a.y=s*u+o*l+i;return a}function Ur(e,t,r,i){if(r===void 0)r=0;if(i===void 0)i={};var n=e.x;var a=e.y;i.x=n+r*Math.sin(t);i.y=a+r*Math.cos(t);return i}function distance(e,t,r,i){return Math.sqrt((e-r)*(e-r)+(t-i)*(t-i))}function Vr(e,t,r,i){var n=e-r;var a=t-i;return n*n+a*a}function Gr(e,t){return(e.y-t.y)/(e.x-t.x)}function Wr(e){return e/180*Math.PI}function Hr(e){return e*180/Math.PI}function Xr(e,t){e.minX-=t;e.minY-=t;e.maxX+=t;e.maxY+=t;e.width+=2*t;e.height+=2*t;return e}function qr(e){var t=0;var r=0;for(var i=0;i<e.length;++i){var n=e[i];t+=n.x;r+=n.y}t/=e.length;r/=e.length;return{x:t,y:r}}function Yr(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i),s=(r-e)/o,u=(i-t)/o,l=.5*n*-u,d=.5*n*s;a.x1=e-l;a.y1=t-d;a.x2=e+l;a.y2=t+d;return a}function Zr(e,t,r,i,n,a,o,s,u){if(s===void 0)s=0;if(u===void 0)u=false;var l=distance(r,i,n,a),d=o/2*(u?distance(e,t,n,a)/l:1),h=(d+s)/l,f=(n-r)*h,c=(a-i)*h,v=r+c,g=i-f,p=r-c,_=i+f,y=n+c,m=a-f;var x=e-v,b=t-g,S=p-v,A=_-g,E=y-v,w=m-g;var T=x*S+b*A,k=S*S+A*A,C=x*E+b*w,I=E*E+w*w;return T>0&&T<k&&C>0&&C<I}function Kr(e,t,r,i,n,a){var o=n-r,s=a-i;return(s*e-o*t+n*i+n*a)/Math.sqrt(o*o+s*s)}function Qr(e,t,r,i,n,a){return Math.abs(Kr(e,t,r,i,n,a))}function Jr(e,t,r,i,n,a){var o=n-r,s=a-i,u=s/o,l=i-u*r,d,h;if(o===0){d=r;h=t}else{d=(o*e+s*t-l*s)/(o+u*s);h=u*d+l}return{x:d-e,y:h-t}}function $r(e,t,r,i,n){if(n&&(ei(e,r)||ei(e,i)||ei(t,r)||ei(t,i))){return false}var a=(e.y-r.y)*(i.x-r.x)-(e.x-r.x)*(i.y-r.y),o=(t.x-e.x)*(i.y-r.y)-(t.y-e.y)*(i.x-r.x);if(o===0){return false}var s=a/o;a=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);var u=a/o;return!(s<=0||s>=1||u<=0||u>=1)}function ei(e,t){return e.x===t.x&&e.y===t.y}function ti(e,t,r,i){return Math.atan2(i-t,r-e)}function ri(e,t,r){var i=ti(e.x,e.y,t.x,t.y)-ti(r.x,r.y,t.x,t.y);if(i<0){i+=2*Math.PI}return i}function ii(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i),s=(r-e)/o,u=(i-t)/o;a.x=n*-u;a.y=n*s;return a}function ni(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i);a.x=(r-e)/o*n;a.y=(i-t)/o*n;return a}function ai(e,t,r,i,n,a){return e>=r&&e<=n&&t>=i&&t<=a}function oi(e,t,r,i,n,a,o,s){var u,l,d;var h=(s-a)*(r-e)-(o-n)*(i-t);if(h===0){return null}u=t-a;l=e-n;d=(o-n)*u-(s-a)*l;u=d/h;return{x:e+u*(r-e),y:t+u*(i-t)}}function si(e,t,r,i,n,a,o,s){var u;var l=[];u=oi(e,t,r,i,n,a,n,s);if(u){l.push(u)}u=oi(e,t,r,i,n,s,o,s);if(u){l.push(u)}u=oi(e,t,r,i,o,s,o,a);if(u){l.push(u)}u=oi(e,t,r,i,o,a,n,a);if(u){l.push(u)}return l}function ui(e,t,r,i,n,a,o,s){var u=((o-n)*(t-a)-(s-a)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));var l=((r-e)*(t-a)-(i-t)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));if(u>=0&&u<=1&&l>=0&&l<=1){return true}return false}function li(e,t,r,i,n,a,o,s){if(e>=n&&t>=a&&e<=o&&t<=s){return true}if(r>=n&&i>=a&&r<=o&&i<=s){return true}if(ui(e,t,r,i,n,a,n,s)){return true}if(ui(e,t,r,i,o,a,o,s)){return true}if(ui(e,t,r,i,n,a,o,a)){return true}if(ui(e,t,r,i,n,s,o,s)){return true}return false}function di(e,t,r,i,n){var a=n[0];var o=n[1];var s=n[2];var u=n[3];var l=0,d=1;var h=r-e,f=i-t;var c,v,g;for(var p=0;p<4;p++){if(p===0){c=-h;v=-(a-e)}if(p===1){c=h;v=o-e}if(p===2){c=-f;v=-(s-t)}if(p===3){c=f;v=u-t}g=v/c;if(c===0&&v<0){return null}if(c<0){if(g>d){return null}else if(g>l){l=g}}else if(c>0){if(g<l){return null}else if(g<d){d=g}}}return[[e+l*h,t+l*f],[e+d*h,t+d*f]]}function hi(e,t,r,i,n,a,o,s){var u,l,d,h,f,c={x:null,y:null,onLine1:false,onLine2:false};u=(s-a)*(r-e)-(o-n)*(i-t);if(u===0){return c}l=t-a;d=e-n;h=(o-n)*l-(s-a)*d;f=(r-e)*l-(i-t)*d;l=h/u;d=f/u;c.x=e+l*(r-e);c.y=t+l*(i-t);if(l>0&&l<1){c.onLine1=true}if(d>0&&d<1){c.onLine2=true}return c}function fi(e,t,r,i,n,a){var o=n-r,s=a-i;if(o===0&&s===0){return{x:r,y:i}}if(o===0){return{x:r,y:t}}if(s===0){return{x:e,y:i}}var u=s/o,l=-(o/s),d=(r*u-e*l+t-i)/(u-l),h=u*d+i-r*u;return{x:d,y:h}}function ci(e,t){var r=t.x-e.x,i=t.y-e.y;return{x:(e.x+t.x)/2,y:(e.y+t.y)/2,length:Math.sqrt(r*r+i*i),angle:Math.atan2(-i,r)}}function vi(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i);if(o===0){a.x=n;a.y=0}else{var s=n/distance(e,t,r,i);a.x=(r-e)*s;a.y=(i-t)*s}return a}function gi(e,t,r,i){return e*r+t*i}function pi(e,t){return Math.sqrt(e*e+t*t)}function _i(e,t,r,i,n,a){return 1/2*(-i*n+t*(-r+n)+e*(i-a)+r*a)}function yi(e,t,r,i,n,a,o,s){var u=_i(r,i,n,a,o,s);var l=1/(2*u)*(i*o-r*s+(s-i)*e+(r-o)*t);var d=1/(2*u)*(r*a-i*n+(i-a)*e+(n-r)*t);return l>0&&d>0&&1-l-d>0}function mi(e,t,r,i,n,a){var o=distance(r,i,n,a),s=distance(e,t,n,a),u=distance(e,t,r,i),l=o+s+u;if(l===0){return{x:e,y:t}}else{return{x:(o*e+s*r+u*n)/l,y:(o*t+s*i+u*a)/l}}}function xi(e,t,r,i,n,a){return{x:(e+r+n)/3,y:(t+i+a)/3}}function bi(e){var t=0,r=0;var i=e.length;for(var n=0;n<i;n++){var a=e[n];t+=a.x;r+=a.y}return{x:t/i,y:r/i}}function Si(e,t,r,i,n,a){return e>=r&&e<=n&&t>=i&&t<=a}function Ai(e,t,r,i){if(i===undefined){i=r.length}var n=i-1,a=false;for(var o=0;o<i;++o){if((r[o].y<t&&r[n].y>=t||r[n].y<t&&r[o].y>=t)&&(r[o].x<=e||r[n].x<=e)){a^=r[o].x+(t-r[o].y)/(r[n].y-r[o].y)*(r[n].x-r[o].x)<e}n=o}return a}function Ei(e,t){if(e<0){e+=t}else if(e>=t){e-=t}return e}function wi(e){for(var t=0;t<e.length;++t){if(Ti(e,t)){return t}}return 0}function Ti(e,t){var r=Ei(t-1,e.length),i=Ei(t+1,e.length),n=ri(e[r],e[t],e[i]);if(n>Math.PI){return false}for(var a=0;a<e.length;++a){if(a===t||a===r||a===i){continue}if(yi(e[a].x,e[a].y,e[r].x,e[r].y,e[i].x,e[i].y,e[t].x,e[t].y)){return false}}return true}function ki(e){if(e.length===3){return[[e[0].index,e[1].index,e[2].index]]}var t=wi(e),r=[e[Ei(t-1,e.length)].index,e[t].index,e[Ei(t+1,e.length)].index];e.splice(t,1);var i=ki(e);i.push(r);return i}function Ci(e){var t=e.length,r=(t-2)*Math.PI,i=0;for(var n=0;n<t;++n){var a=ri(e[Ei(n-1,t)],e[n],e[Ei(n+1,t)]);i+=a}var o=e.slice();for(n=0;n<o.length;++n){o[n].index=n}if(i-1e-4>r){o.reverse()}return ki(o)}function Ii(e){var t=e.x*e.x+e.y*e.y;return{x:e.x/t,y:e.y/t}}function Mi(e,t){var r=Infinity;var i=-Infinity;for(var n=0,a=e.length;n<a;n++){var o=e[n];var s=o.x*t.x+o.y*t.y;if(s<r){r=s}if(s>i){i=s}}return{x:r,y:i}}function Li(e,t){var r=new Array(4);var i,n,a,o;i=e[1],n=e[0];a=Ii({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[0]=a;i=e[2];n=e[1];a=Ii({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[1]=a;i=t[1];n=t[0];a=Ii({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[2]=a;i=t[2];n=t[1];a=Ii({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[3]=a;return r}function Fi(e,t){var r=Li(e,t);for(var i=0,n=r.length;i<n;i++){var a=r[i];var o=Mi(e,a);var s=Mi(t,a);var u=o.x<=s.y&&o.y>=s.x?Math.min(o.y,s.y)-Math.max(o.x,s.x):0;if(u===0){return false}}return true}function Ni(e,t,r,i,n,a,o,s,u){var l=-n;var d=-a;var h=d;var f=-l;var c=r-l*u;var v=i-d*u;var g=o/2+u;var p=s+2*u;var _=c+h*g;var y=v+f*g;var m=c-h*g;var x=v-f*g;var b=c+l*p;var S=v+d*p;return yi(e,t,_,y,m,x,b,S)}var zi=1e-6;var Pi=1e-12;function Oi(){var e=arguments;var t=e.length-1;var r=t;var i=[];for(var n=0;n<=t;n++){if(Math.abs(e[n])<=Pi){t--}else{break}}switch(t){case 1:Di(e[r],e[r-1],i);break;case 2:Ri(e[r],e[r-1],e[r-2],i);break;case 3:Bi(e[r],e[r-1],e[r-2],e[r-3],i);break;default:break}return i}function Di(e,t,r){if(r===void 0)r=[];if(t!==0){r.push(-e/t)}return r}function Ri(e,t,r,i){if(i===void 0)i=[];var n=r;var a=t/n;var o=e/n;var s=a*a-4*o;if(s>0){var u=Math.sqrt(s);i.push(.5*(-a+u));i.push(.5*(-a-u))}else if(s===0){i.push(.5*-a)}return i}function Bi(e,t,r,i,n){if(n===void 0)n=[];var a=i;var o=r/a;var s=t/a;var u=e/a;var l=(3*s-o*o)/3;var d=(2*o*o*o-9*s*o+27*u)/27;var h=o/3;var f=d*d/4+l*l*l/27;var c=d/2;var v,g;if(Math.abs(f)<=zi){f=0}if(f>0){var p=Math.sqrt(f);v=-c+p;if(v>=0){g=Math.pow(v,1/3)}else{g=-Math.pow(-v,1/3)}v=-c-p;if(v>=0){g+=Math.pow(v,1/3)}else{g-=Math.pow(-v,1/3)}n.push(g-h)}else if(f<0){var distance=Math.sqrt(-l/3);var _=Math.atan2(Math.sqrt(-f),-c)/3;var y=Math.cos(_);var m=Math.sin(_);var x=Math.sqrt(3);n.push(2*distance*y-h);n.push(-distance*(y+x*m)-h);n.push(-distance*(y-x*m)-h)}else{if(c>=0){v=-Math.pow(c,1/3)}else{v=Math.pow(-c,1/3)}n.push(2*v-h);n.push(-v-h)}return n}function ji(e,t,r,i,n,a,o,s,u,l,d){var h,f,c,v;var g,p,_,y,m,x;var b;var S,A;var E=Math.min(o,u),w=Math.min(s,l),T=Math.max(o,u),k=Math.max(s,l);h=r*-2;f=i*-2;g=e+h+n;p=t+f+a;h=e*-2;f=t*-2;c=r*2;v=i*2;_=h+c;y=f+v;m=e;x=t;S=s-l;A=u-o;b=o*l-u*s;var C=Oi(S*g+A*p,S*_+A*y,S*m+A*x+b);for(var I=0;I<C.length;I++){var M=C[I];if(0<=M&&M<=1){var L=e+(r-e)*M;var F=t+(i-t)*M;var N=r+(n-r)*M;var z=i+(a-i)*M;var P=L+(N-L)*M;var O=F+(z-F)*M;if(o===u){if(w<=O&&O<=k){if(d){d.push(P,O)}else{return 1}}}else if(s===l){if(E<=P&&P<=T){if(d){d.push(P,O)}else{return 1}}}else if(P>=E&&O>=w&&P<=T&&O<=k){if(d){d.push(P,O)}else{return 1}}}}return d?d.length/2:0}function Ui(e,t,r,i,n,a,o,s,u,l,d){if(d){ji(e,t,r,i,n,a,o,s,u,s,d);ji(e,t,r,i,n,a,u,s,u,l,d);ji(e,t,r,i,n,a,o,l,u,l,d);ji(e,t,r,i,n,a,o,s,o,l,d);return d.length/2}else{if(o<=e&&u>=e&&s<=t&&l>=t){return 1}if(o<=n&&u>=n&&s<=a&&l>=a){return 1}if(ji(e,t,r,i,n,a,o,s,u,s)){return 1}if(ji(e,t,r,i,n,a,u,s,u,l)){return 1}if(ji(e,t,r,i,n,a,o,l,u,l)){return 1}if(ji(e,t,r,i,n,a,o,s,o,l)){return 1}return 0}}function Vi(e,t,r,i,n,a,o,s,u,l,d,h,f){var c,v,g,p,_,y,m,x;var b,S,A,E,w,T,k,C;var I;var M,L;var F=Math.min(u,d),N=Math.min(l,h),z=Math.max(u,d),P=Math.max(l,h);c=e*-1;v=t*-1;g=r*3;p=i*3;_=n*-3;y=a*-3;m=c+g+_+o;x=v+p+y+s;b=m;S=x;c=e*3;v=t*3;g=r*-6;p=i*-6;_=n*3;y=a*3;m=c+g+_;x=v+p+y;A=m;E=x;c=e*-3;v=t*-3;g=r*3;p=i*3;_=c+g;y=v+p;w=_;T=y;k=e;C=t;M=l-h;L=d-u;I=u*h-d*l;var O=Oi(M*b+L*S,M*A+L*E,M*w+L*T,M*k+L*C+I);for(var D=0;D<O.length;D++){var R=O[D];if(0<=R&&R<=1){var B=e+(r-e)*R;var j=t+(i-t)*R;var U=r+(n-r)*R;var V=i+(a-i)*R;var G=n+(o-n)*R;var W=a+(s-a)*R;var H=B+(U-B)*R;var X=j+(V-j)*R;var q=U+(G-U)*R;var Y=V+(W-V)*R;var Z=H+(q-H)*R;var K=X+(Y-X)*R;if(u===d){if(N<=K&&K<=P){if(f){f.push(Z,K)}else{return 1}}}else if(l===h){if(F<=Z&&Z<=z){if(f){f.push(Z,K)}else{return 1}}}else if(Z>=F&&K>=N&&Z<=z&&K<=P){if(f){f.push(Z,K)}else{return 1}}}}return f?f.length/2:0}function Gi(e,t,r,i,n,a,o,s,u,l,d,h,f){if(f){Vi(e,t,r,i,n,a,o,s,u,l,d,l,f);Vi(e,t,r,i,n,a,o,s,d,l,d,h,f);Vi(e,t,r,i,n,a,o,s,u,h,d,h,f);Vi(e,t,r,i,n,a,o,s,u,l,u,h,f);return f.length/2}else{if(u<=e&&d>=e&&l<=t&&h>=t){return 1}if(u<=o&&d>=o&&l<=s&&h>=s){return 1}if(Vi(e,t,r,i,n,a,o,s,u,l,d,l)){return 1}if(Vi(e,t,r,i,n,a,o,s,d,l,d,h)){return 1}if(Vi(e,t,r,i,n,a,o,s,u,h,d,h)){return 1}if(Vi(e,t,r,i,n,a,o,s,u,l,u,h)){return 1}return 0}}var Wi=512;var Hi=128;var Xi=Math.round(Math.log2(Wi));var qi=Math.round(Math.log2(Hi));var Yi=Xi+qi;var Zi=255;var Ki=32767;var Qi=65535;var Ji=15;var $i=3;var en=256;var tn=1/16;var rn=16;var nn=1;var an=256;var on=128;var sn=128;var un=1.5;var ln=1.1;var dn=52;var hn=16;var fn=dn*2+hn;var cn=4;var vn=3;var gn=41;var pn=5;var _n=5;var yn=0;var mn=1;var xn=2;var bn=3;var Sn=4;var An=5;var En=6;var wn=7;var Tn=8;var kn=9;var Cn=10;var In=0;var Mn=1;var Ln=2;var Fn=3;var Nn=0;var zn=1;var Pn=2;var On=3;var Dn=4;var Rn=5;var Bn=6;var jn=1e-5;var Un=Math.PI;var Vn=Math.PI*2;var Gn=Un*(5/4);var Wn=Un*(7/4);var Hn=Un*(3/4);var Xn=Un*(1/4);var qn=1.1;var Yn=.07;var Zn=1;var Kn=1;var Qn=.17;var Jn=1;var $n=-Un/2;var ea=Un/2;var ta=2/3;var ra={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}};var ia={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0};var na={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0};function aa(e,t,r,i,n,a){var o=a||{x:0,y:0};var s=(e+r)/2;var u=(t+i)/2;var l=e-r;var d=t-i;var distance=Math.sqrt(l*l+d*d);var h=d/distance;var f=-l/distance;var c=-distance*n/pn;o.x=s+h*c;o.y=u+f*c;return o}function oa(e,t,r,i,n,a){var o=a||{x1:0,y1:0,x2:0,y2:0};var distance=i+i/_n*r;var s=distance*_n;var u=-n+Un;var l=-n+Un/2;o.x1=e+Math.cos(u)*s;o.y1=t+Math.sin(u)*s;o.x2=e+Math.cos(l)*s;o.y2=t+Math.sin(l)*s;return o}function sa(e,t,r,i,n,a,o,s){s=s||{};s.x=(1-e)*(1-e)*t+2*(1-e)*e*a+e*e*i;s.y=(1-e)*(1-e)*r+2*(1-e)*e*o+e*e*n;return s}function ua(e,t,r,i,n,a,o,s,u,l,d){if(l===void 0)l=0;if(d===void 0)d=false;var h=r-2*o+n;var f=2*o-2*r;var c=r-e;var v=i-2*s+a;var g=2*s-2*i;var p=i-t;var _=-(c*v-p*h)/(f*v-g*h);if(_<0||_>1){return false}var y=u/2;if(d){y*=1-_}y+=l;var m=la(_,r,n,o);var x=la(_,i,a,s);return distance(m,x,e,t)<=y}function la(e,t,r,i){var n=1-e;return n*n*t+2*n*e*i+e*e*r}function da(e,t,r,i,n,a,o,s,u,l){l=l||{};var d=(1-e)*(1-e)*(1-e),h=3*e*(1-e)*(1-e),f=3*e*e*(1-e),c=e*e*e;l.x=d*t+h*a+f*s+c*i;l.y=d*r+h*o+f*u+c*n;return l}function ha(e,t,r,i,n,a,o,s,u,l,d,h){var f=distance(r,i,o,s);if(Math.abs(e-r)>f||Math.abs(t-i)>f){return false}var c=distance(e,t,r,i),v=distance(e,t,n,a),g=.5,p=c<v?-.01:.01,_=.001,y=100,m=da(g,r,i,n,a,o,s,u,l),x=distance(e,t,m.x,m.y),b;var S=d/2+h;while(y-- >0&&g>=0&&g<=1&&x>S&&(p>_||p<-_)){b=x;da(g,r,i,n,a,o,s,u,l,m);x=distance(e,t,m.x,m.y);if(x>b){p=-p/2;g+=p}else if(g+p<0||g+p>1){p=p/2;x=b}else{g+=p}}return x<S}function fa(e,t,r,i,n,a,o){var s=e+2/3*(r-e);var u=t+2/3*(i-t);var l=s+1/3*(n-e);var d=u+1/3*(a-t);return ca(e,t,s,u,l,d,n,a,o)}function ca(e,t,r,i,n,a,o,s,u){if(u===void 0)u={};var l=Math.min;var d=Math.max;var h=Math.sqrt;var f,c,v,g,p;u.minX=l(e,o);u.maxX=d(e,o);u.minY=l(t,s);u.maxY=d(t,s);for(var _=void 0,y=void 0,m=void 0,x=void 0,b=void 0,S=void 0,A=void 0,E=0;E<2;++E){if(E===0){c=e;v=r;g=n;p=o}else{c=t;v=i;g=a;p=s}y=6*c-12*v+6*g;_=-3*c+9*v-9*g+3*p;m=3*v-3*c;y=y|0;_=_|0;m=m|0;if(_===0){if(y===0){continue}x=-m/y;if(x>0&&x<1){f=va(x,c,v,g,p);if(E===0){u.minX=l(u.minX,f);u.maxX=d(u.maxX,f)}else{u.minY=l(u.minY,f);u.maxY=d(u.maxY,f)}}continue}b=y*y-4*m*_;if(b<0){continue}S=(-y+h(b))/(2*_);if(S>0&&S<1){f=va(S,c,v,g,p);if(E===0){u.minX=l(u.minX,f);u.maxX=d(u.maxX,f)}else{u.minY=l(u.minY,f);u.maxY=d(u.maxY,f)}}A=(-y-h(b))/(2*_);if(A>0&&A<1){f=va(A,c,v,g,p);if(E===0){u.minX=l(u.minX,f);u.maxX=d(u.maxX,f)}else{u.minY=l(u.minY,f);u.maxY=d(u.maxY,f)}}}return u}function va(e,t,r,i,n){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*n}function ga(e,t,r,i,n,a,o){var s=1-e;var u=s*a+e*i-(s*t+e*a);var l=s*o+e*n-(s*r+e*o);return Math.atan2(l,u)}function pa(e,t,r,i,n,a,o,s){if(n===void 0)n=0;if(a===void 0)a=Math.sin(n);if(o===void 0)o=Math.cos(n);if(s===void 0)s=[];var u=r/2,l=i/2;var d=e+u,h=t+l;if(n===0){s[0]=e;s[1]=t;s[2]=e+r;s[3]=t+i;return s}var f,c,v,g;var p,_,y,m;v=-u;g=-l;f=d+v*o-g*a,c=h+v*a+g*o;p=y=f;_=m=c;v=-u;g=l;f=d+v*o-g*a;c=h+v*a+g*o;if(f<p){p=f}else if(f>y){y=f}if(c<_){_=c}else if(c>m){m=c}v=u;g=l;f=d+v*o-g*a;c=h+v*a+g*o;if(f<p){p=f}else if(f>y){y=f}if(c<_){_=c}else if(c>m){m=c}v=u;g=-l;f=d+v*o-g*a;c=h+v*a+g*o;if(f<p){p=f}else if(f>y){y=f}if(c<_){_=c}else if(c>m){m=c}s[0]=p;s[1]=_;s[2]=y;s[3]=m;return s}function _a(e,t,r,i,n){if(n===void 0)n=0;var a=r/2,o=i/2;var s=e+a,u=t+o;if(n===0){return[{x:e,y:t},{x:e+r,y:t},{x:e+r,y:t+i},{x:e,y:t+i}]}var l=Math.sin(n);var d=Math.cos(n);var h,f,c,v;var g=new Array(4);c=-a;v=-o;h=s+c*d-v*l,f=u+c*l+v*d;g[0]={x:h,y:f};c=-a;v=o;h=s+c*d-v*l;f=u+c*l+v*d;g[1]={x:h,y:f};c=a;v=o;h=s+c*d-v*l;f=u+c*l+v*d;g[2]={x:h,y:f};c=a;v=-o;h=s+c*d-v*l;f=u+c*l+v*d;g[3]={x:h,y:f};return g}function ya(e,t,r,i){if(t===void 0)t=0;if(r===void 0)r=1;if(i===void 0)i=[];var n=r*Math.sin(t);var a=r*Math.cos(t);i[0]=e[0]+n;i[1]=e[1]+a;i[2]=e[2]+n;i[3]=e[3]+a;return i}function ma(e,t,r,i,n){if(n===void 0)n=[];var a=Math.sin(t),o=Math.cos(t);var s=(e[0]+e[2])/2;var u=(e[1]+e[3])/2;var l=(e[2]-e[0])/2;var d=(e[3]-e[1])/2;var h=l,f=-d;var c=l,v=d;var g=h*o-f*a;var p=h*a+f*o;var _=c*o-v*a;var y=c*a+v*o;var m=Math.max(Math.abs(g),Math.abs(_));var x=Math.max(Math.abs(p),Math.abs(y));n[0]=s-m;n[2]=s+m;n[1]=u-x;n[3]=u+x;return n}function xa(e,t){e.minX-=t;e.minY-=t;e.maxX+=t;e.maxY+=t;e.width+=2*t;e.height+=2*t;return e}function ba(e,t){return e[3]>=t[1]&&e[1]<=t[3]&&(e[2]>=t[0]&&e[0]<=t[2])}var Sa=Object.freeze({circleCircleIntersection:circleCircleIntersection,circleSortCompare:circleSortCompare,circleContainsPoint:Or,circleContainsCircle:Dr,circleIntersectsBox:Rr,circleLineIntersection:Br,lineFromPoint:Yr,isPointInLine:Zr,signedDistanceToLine:Kr,distanceToLine:Qr,vectorToLine:Jr,twoSegmentsIntersect:$r,lineAngle:ti,angle:ri,orthogonal:ii,normalize:ni,isPointInsideRectangle:ai,segmentIntersection:oi,lineRectangleIntersection:si,lineLine:ui,lineAABB:li,clipLine:di,lineIntersection:hi,findClosestPointOnLine:fi,computeLineInfo:ci,unitVector:vi,scalarProduct:gi,vectorLength:pi,rotate:jr,move:Ur,distance:distance,squaredDistance:Vr,slope:Gr,degreeToRadians:Wr,radiansToDegrees:Hr,extendBounds:Xr,computeCentroid:qr,isPointInTriangle:yi,incenter:mi,triangleCentroid:xi,centroid:bi,isPointInRectangle:Si,isPointInPolygon:Ai,triangulatePolygon:Ci,polygonsIntersect:Fi,isPointInArrow:Ni,getPointOnQuadraticCurve:sa,isPointOnQuadraticCurve:ua,quadraticEquation:la,getPointOnBezierCurve:da,isPointOnBezierCurve:ha,getQuadraticCurveBoundingBox:fa,getBezierCurveBoundingBox:ca,getAngleOnQuadraticCurve:ga,quadBezierAABB:Ui,cubicBezierAABB:Gi,getSelfLoopControlPoints:oa,getQuadraticCurveControlPoint:aa,getAABB:pa,getOBBPoints:_a,moveAABB:ya,rotateAABB:ma,padBounds:xa,overlaps:ba});function weightedStress(e,t,r,i,n,a){var o=0,s,u,l,d,h,f;for(l=0;l<i;l++){for(d=0;d<i;d++){var c=a[l],v=a[d];if(c!==v){u=e[c][v];u*=n;s=1/(u*u);if(s){h=t[c]-t[v];f=r[c]-r[v];o+=s*Math.pow(u-Math.sqrt(h*h+f*f),2)}}}}return o}function distanceStress(e,t,r,i,n,a,o){var s=0,u,l,d,h,f,c;if(n===-1){return 0}for(u=0;u<i;u++){for(l=0;l<i;l++){var v=o[u],g=o[l];if(v!==g&&(v===n||g===n)){d=e[v][g];d*=a;h=1/(d*d);if(h){f=t[v]-t[g];c=r[v]-r[g];s+=h*Math.pow(d-Math.sqrt(f*f+c*c),2)}}}}return s}function constrainedStress(e,t,r,i,n,a,o,s){o=o||0;var weightedStress=0;var distanceStress=0;var u,l,d,h,f,c,v;for(u=0;u<i;u++){for(l=0;l<i;l++){var g=s[u],p=s[l];if(g!==p){d=e[g][p];d*=a;h=1/(d*d);if(h){f=t[g]-t[p];c=r[g]-r[p];v=h*Math.pow(d-Math.sqrt(f*f+c*c),2);weightedStress+=v;if(g===n||p===n){distanceStress+=v}}}}}return(1-o)*weightedStress+o*distanceStress}function stressMinimizationStep(e,t,r,i,n,a,o,s,u){var l=t,d=r;var h=1e-6;o=o||0;n=typeof n==="undefined"?-1:n;if(n===-1){o=0}var f,c,v,g,p;var _=t[n],y=r[n];for(var m=0;m<i;m++){var x=s[m];var b=u(e[n][m]);var S=o/(b*b);if(b===0){continue}var A=0,E=0,w=0,T;var k=t[x],C=r[x];for(T=0;T<i;T++){var I=s[T],M,L,F,N,z;if(I!==x){M=e[x][I]*a;L=1/(M*M);F=t[I];N=r[I];if(L!==0){c=k-F;v=C-N;g=c*c+v*v;z=g<h?0:1/Math.sqrt(g);E+=(1-o)*L*(F+M*(k-F)*z);w+=(1-o)*L*(N+M*(C-N)*z)}A+=L}}f=(1-o)*A+S;if(f!==0){c=k-_;v=C-y;g=c*c+v*v;g=g<h?0:1/Math.sqrt(g);p=b===0?0:S*(b*g);l[x]=(E+p*t[x])/f;d[x]=(w+p*r[x])/f}}return{X:l,Y:d}}function stressMinimizationStepGeneral(e,t,r,i,n,a,o,s){var u=t,l=r;var d=1e-6;o=o||0;n=typeof n==="undefined"?-1:n;if(n===-1){o=0}var h;for(var f=0;f<i;f++){var c=s[f];var v=0,g=0,p=0,_,y;var m=t[c],x=r[c];var b,S,A;for(_=0;_<i;_++){var E=s[_],w,T,k,C,I;var M=0;if(E!==c){y=e[c][E]*a;w=1/(y*y);if(c===n||E===n){M=w}I=(1-o)*w+o*M;v+=I;if(w!==0){T=t[E];k=r[E];b=m-T;S=x-k;A=b*b+S*S;if(A>d){C=1/Math.sqrt(A)}g+=I*(T+y*(m-T)*C);p+=I*(k+y*(x-k)*C)}}}h=v;if(h!==0){u[c]=g/h;l[c]=p/h}}return{X:u,Y:l}}function minHeap(e,t,r,i){if(e===void 0)e=function(e,t){return e-t};if(t===void 0)t=[];if(r===void 0)r={};if(i===void 0)i=function(e){return e};var n=t.length;function a(a){while(true){var o=2*a+1;var s=o+1;var u=a;if(o<n&&e(t[o],t[u])<0){u=o}if(s<n&&e(t[s],t[u])<0){u=s}if(u===a){return a}var l=t[u];t[u]=t[a];t[a]=l;r[i(t[u])]=u;r[i(l)]=a;a=u}}var o={heapify:a,pop:function e(){if(n<=0){return undefined}if(n===1){n--;return t[0]}var r=t[0];t[0]=t[n-1];n--;a(0);return r},decreaseKey:function n(a,value){if(value!==undefined){t[a]=value;r[i(value)]=a}while(a>0){var o=a-1>>1;if(e(t[o],t[a])>0){var s=t[a];t[a]=t[o];t[o]=s;r[i(t[a])]=a;r[i(s)]=o;a=o}else{break}}return a},min:function e(){return t[0]},remove:function e(t){this.decreaseKey(t,Number.NEGATIVE_INFINITY);return this.pop()},push:function a(o){n++;var s=n-1;t[s]=o;while(s>0){var u=s-1>>1;if(e(t[u],t[s])>0){var l=t[s];t[s]=t[u];t[u]=l;r[i(t[s])]=s;r[i(l)]=u;s=u}else{break}}return s},empty:function e(){return n<=0},toArray:function e(){return t.slice(0,n)}};Object.defineProperty(o,"keys",{get:function(){return r},enumerable:true});Object.defineProperty(o,"size",{get:function(){return n},enumerable:true});return o}function bellmanFord(e){var t=e.sources;var r=e.targets;var i=e.weights;var n=e.source;var a=e.target;var o=e.undirected;if(o===void 0)o=false;var s=e.indexes;var u=e.N;u=s?s.length:u;if(!isFinite(u)||u===0){throw new Error("Invalid number of nodes "+u)}var l=new Float32Array(u);var d=new Int32Array(u);var h={};var f=Number.POSITIVE_INFINITY;var c,v,g,p,_,y,m;var x,b,S,A;if(!i){for(c=0,i=new Uint8Array(u);c<u;c++){i[c]=1}}if(!s){for(c=0,s=new Uint32Array(u);c<u;c++){s[c]=c+1}}for(c=0;c<u;c++){l[c]=f;d[c]=-1;h[s[c]]=c}l[h[n]]=0;for(c=1,v=u;c<=v;c++){A=false;for(g=0,p=i.length;g<p;g++){x=t[g];b=r[g];y=h[x];m=h[b];if(y!==undefined&&m!==undefined){S=i[g];_=l[y]+S;if(l[y]!==f&&_<l[m]){l[m]=_;d[m]=x;A=true}if(o){_=l[m]+S;if(l[m]!==f&&_<l[y]){l[y]=_;d[y]=b;A=true}}}}if(!A){break}}if(A){for(c=0,v=i.length;c<v;c++){x=t[c];b=r[c];y=h[x];m=h[b];if(y!==undefined&&m!==undefined){S=i[c];if(l[y]+S<l[m]){return null}}}}var E=null;var w=null;if(a!==undefined){var T=h[a];if(T!==undefined&&l[T]!==f){for(c=a,E=[];c!==-1;c=d[h[c]]){E.push(c)}E=E.reverse();w=l[T]}}return{distances:l,path:E,pathLength:w}}function dijkstra(e,t,r,i,n,a,o){var s=i?i.length:e.length;var u=new Float32Array(s);var l=new Int32Array(s);var d=new Uint32Array(s);var h=Number.POSITIVE_INFINITY;var f={};var c,v;if(s===0){return{distances:u,path:null,pathLength:null}}if(!i){for(c=0,i=new Uint32Array(s);c<s;c++){i[c]=c+1}}if(!n){for(c=0,n={};c<s;c++){n[i[c]]=c}}for(c=0;c<s;c++){u[c]=h;l[c]=-1;d[c]=f[c]=c}var g=minHeap(function(e,t){return u[e]-u[t]},d,f);u[n[t]]=0;g.decreaseKey(f[n[t]]);while(g.size!==0){var p=g.pop();var _=u[p];var y=e[p];if(_===h){break}for(c=0,v=y.nodes.length;c<v;c++){var m=y.nodes[c];var x=a?1:o?o(i[p],m):y.weights[c];var b=n[m];if(b===undefined){continue}var S=_+x;if(S<u[b]){u[b]=S;l[b]=p;g.decreaseKey(f[b])}}}var A=null;var E=null;if(r!==undefined){var w=n[r];if(u[w]!==h){for(c=w,A=[];c!==-1;c=l[c]){A.push(i[c])}A=A.reverse();E=u[r]}}return{distances:u,path:A,pathLength:E}}function johnson(e){var t=e.sources;var r=e.targets;var i=e.weights;var n=e.indexes;var a=e.adjacency;var o=e.undirected;var s=e.ignoreWeights;var u=Number.POSITIVE_INFINITY;var l=n?n.length:a.length;var d,h,f,c,v,g;if(!n){for(d=0,n=new Uint32Array(l);d<l;d++){n[d]=d+1}}var p=new Array(l);var _={};for(d=0;d<l;d++){p[d]=new Float32Array(l);for(f=0;f<l;f++){p[d][f]=d===f?0:u}_[n[d]]=d}var y=l;var m=i.length;t=t.slice();r=r.slice();i=i.slice();for(d=0;d<l;d++){t[m+d]=y;r[m+d]=n[d];i[m+d]=0;if(s){i[d]=1}}var x=bellmanFord({sources:t,targets:r,weights:i,undirected:o,N:l+1,source:y});if(x===null){throw new Error("Graph has negative weight loops")}c=x.distances;for(d=0,h=i.length;d<h;d++){v=_[t[d]];g=_[r[d]];if(v!==undefined&&g!==undefined){i[d]=i[d]+c[v]-c[g]}}t=t.slice(0,m);r=r.slice(0,m);i=i.slice(0,m);for(d=0;d<l;d++){var b=n[d];v=_[b];c=dijkstra(a,b,undefined,n,_,s).distances;for(f=0;f<l;f++){p[d][f]=d===f?0:c[f]}}return p}var Aa=o(function(e){(function(){function t(e){if(!(this instanceof t)){return new t(e)}this.points=e||[]}t.prototype={triangulate:function(){var e=this.points;e.sort(function(e,t){if(e[0]===t[0]){return e[1]-t[1]}return e[0]-t[0]});for(var t=e.length-1;t>=1;t--){if(e[t][0]===e[t-1][0]&&e[t][1]===e[t-1][1]){e.splice(t,1)}}if(e.length<2){return{}}var r=f(e).le;var i=[];var a=0;var o=[r];while(n(r.onext.dest,r)){r=r.onext}var s=r;do{o.push(s.sym);s.mark=true;s=s.lnext}while(s!==r);do{var u=o[a++];if(!u.mark){s=u;do{i.push(s.orig);if(!s.sym.mark){o.push(s.sym)}s.mark=true;s=s.lnext}while(s!=u)}}while(a<o.length);return i}};function r(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])>0}function i(e,t){return r(e,t.dest,t.orig)}function n(e,t){return r(e,t.orig,t.dest)}function a(e,t){return i(e.dest,t)}function o(e,t,r,i){if(e[0]===i[0]&&e[1]===i[1]||t[0]===i[0]&&t[1]===i[1]||r[0]===i[0]&&r[1]===i[1]){return false}var n=e[0]*e[0]+e[1]*e[1],a=t[0]*t[0]+t[1]*t[1],o=r[0]*r[0]+r[1]*r[1],s=i[0]*i[0]+i[1]*i[1];var u=o-s,l=r[1]-i[1],d=r[1]*s-o*i[1],h=r[0]-i[0],f=r[0]*s-o*i[0],c=r[0]*i[1]-r[1]*i[0];return e[0]*(t[1]*u-a*l+d)-e[1]*(t[0]*u-a*h+f)+n*(t[0]*l-t[1]*h+c)-t[0]*d+t[1]*f-a*c>1}function s(e,t,r){this.onext=e;this.rot=t;this.orig=r;this.mark=false}s.prototype={get sym(){return this.rot.rot},get dest(){return this.sym.orig},get rotSym(){return this.rot.sym},get oprev(){return this.rot.onext.rot},get dprev(){return this.rotSym.onext.rotSym},get lnext(){return this.rotSym.onext.rot},get lprev(){return this.onext.sym},get rprev(){return this.sym.onext}};function u(e,t){var r=new s(null,null,e),i=new s(null,null,null),n=new s(null,null,t),a=new s(null,null,null);r.onext=r;n.onext=n;i.onext=a;a.onext=i;r.rot=i;i.rot=n;n.rot=a;a.rot=r;return r}function l(e,t){var r=e.onext.rot,i=t.onext.rot;var n=e.onext,a=i.onext,o=r.onext;e.onext=t.onext;t.onext=n;r.onext=a;i.onext=o}function d(e,t){var r=u(e.dest,t.orig);l(r,e.lnext);l(r.sym,t);return r}function h(e){l(e,e.oprev);l(e.sym,e.sym.oprev)}function f(e){var t,s,c,v;if(e.length===2){t=u(e[0],e[1]);return{le:t,re:t.sym}}else if(e.length===3){t=u(e[0],e[1]);s=u(e[1],e[2]);l(t.sym,s);if(r(e[0],e[1],e[2])){c=d(s,t);return{le:t,re:s.sym}}else if(r(e[0],e[2],e[1])){c=d(s,t);return{le:c.sym,re:c}}else{return{le:t,re:s.sym}}}else{var g=Math.ceil(e.length/2);var p=f(e.slice(0,g));var _=f(e.slice(g));var y=p.le,m=p.re,x=_.le,b=_.re;do{if(n(x.orig,m)){m=m.lnext}else if(i(m.orig,x)){x=x.rprev}else{break}}while(true);var S=d(x.sym,m);if(m.orig===y.orig){y=S.sym}if(x.orig===b.orig){b=S}do{var A=S.sym.onext;if(a(A,S)){while(o(S.dest,S.orig,A.dest,A.onext.dest)){v=A.onext;h(A);A=v}}var E=S.oprev;if(a(E,S)){while(o(S.dest,S.orig,E.dest,E.oprev.dest)){v=E.oprev;h(E);E=v}}if(!a(A,S)&&!a(E,S)){break}if(!a(A,S)||a(E,S)&&o(A.dest,A.orig,E.orig,E.dest)){S=d(E,S.sym)}else{S=d(S.sym,A.sym)}}while(true);return{le:y,re:b}}}t.prototype.ccw=r;t.prototype.rightOf=i;t.prototype.leftOf=n;t.prototype.inCircle=o;if(typeof undefined==="function"&&undefined.amd){undefined("Delaunay",function(){return t})}else{e.exports=t}})()});function Ea(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}function wa(e){var t=e.length,r=[0,1],i=2;for(var n=2;n<t;n++){while(i>1&&Ea(e[r[i-2]],e[r[i-1]],e[n])<=0){--i}r[i++]=n}return r.slice(0,i)}function Ta(e){var t=e.length,r;if(t<3){return null}var i=new Array(t);var n=new Array(t);for(r=0;r<t;r++){i[r]=[+e[r][0],+e[r][1],r]}i.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]});for(r=0;r<t;r++){n[r]=[i[r][0],-i[r][1]]}var a=wa(i),o=wa(n);var s=o[0]===a[0],u=o[o.length-1]===a[a.length-1],l=[];for(r=a.length-1;r>=0;--r){l.push(e[i[a[r]][2]])}for(r=+s;r<o.length-u;r++){l.push(e[i[o[r]][2]])}return l}function ka(e,t,r,i,convexhull){if(t===void 0)t=1;if(r===void 0)r=0;if(!i||!convexhull){e=e.map(function(e){return[e.x,e.y]});i=new Aa(e.slice()).triangulate();convexhull=Ta(e)}var n=r*r;var a=[],o={},s,u,l,d,h;for(l=0,d=i.length;l<d;l+=3){u=La(i[l],i[l+1],i[l+2]);if(Ca(convexhull,u)){h=Ma(i[l],i[l+1],i[l+2]);if(h>n){a.push(l);o[l]=h}}}if(a.length===0){return a}a.sort(function(e,t){return o[e]-o[t]});var f=a[0];var c=o[f];var v=[];for(l=0,d=a.length;l<d;l++){s=a[l];h=o[s];if(h>c&&h>n){f=s;c=h;v.push(f);if(v.length>t){v.shift()}}}return v.map(function(e){return Ia(i[e],i[e+1],i[e+2])})}function Ca(e,t){var r=e.length;var i=e[r-1];var n=t[0];var a=t[1];var o=i[0];var s=i[1];var u,l;var d=false;for(var h=0;h<r;h++){i=e[h],u=i[0],l=i[1];if(l>a!==s>a&&n<(o-u)*(a-l)/(s-l)+u){d=!d}o=u,s=l}return d}function Ia(e,t,r){var i=arguments;var n=La(e,t,r);var a=0;for(var o=0;o<3;o++){var s=i[o];var u=s[0]-n[0];var l=s[1]-n[1];var d=Math.sqrt(u*u+l*l);if(d>a){a=d}}return n.concat(a)}function Ma(e,t,r){var i=La(e,t,r);var n=i[0];var a=i[1];var o=e[0];var s=e[1];var u=n-o;var l=a-s;return u*u+l*l}function La(e,t,r){var i=[(e[0]+t[0])/2,(e[1]+t[1])/2];var n=[(t[0]+r[0])/2,(t[1]+r[1])/2];var a=-1/((t[1]-e[1])/(t[0]-e[0]));var o=-1/((r[1]-t[1])/(r[0]-t[0]));var s=i[1]-a*i[0];var u=n[1]-o*n[0];var l=(s-u)/(o-a);return[l,a*l+s]}function minDisk(e,t,r,i){if(!i){i=new Uint32Array(e.length);for(var n=0,a=e.length;n<a;n++){i[n]=n}}function o(e){for(var t=e.length-1;t>=0;t--){var r=Math.floor(Math.random()*(t+1));r=Math.max(Math.min(r,t),0);var i=e[t];e[t]=e[r];e[r]=i}return e}function s(e,t,r,i,n,a,o){var s=null;var u=t.length;var l,d,h;if(u===1){l=t[0];s=[r[l],i[l],n[l]||0]}else if(u===2){l=t[0];d=t[1];s=a(r[l],i[l],r[d],i[d],n[l],n[d])}else if(u===3){l=t[0];d=t[1];h=t[2];s=o(r[l],i[l],r[d],i[d],r[h],i[h],n[l],n[d],n[h])}return s}function u(e,t,r,i,n,a,o,l,d){var h=null;if(r===0||t.length===3){h=s(e,t,i,n,a,l,d)}else{var f=e[r-1];h=u(e,t,r-1,i,n,a,o,l,d);if(h===null||!o(h,i[f],n[f],a[f])){t.push(f);h=u(e,t,r-1,i,n,a,o,l,d);t.pop()}}return h}function l(e,t,r,i){var n=e-r,a=t-i;return[(e+r)/2,(t+i)/2,Math.sqrt(n*n+a*a)/2]}function d(e,t,r,i,n,a){var o=r-e;var s=i-t;var u=a-n;var l=Math.sqrt(o*o+s*s);return[(e+r+o/l*u)/2,(t+i+s/l*u)/2,(l+n+a)/2]}function h(e,t,r,i,n,a,o,s,u){var l=2*(e-r),d=2*(t-i),h=2*(s-o);var f=e*e+t*t-o*o-r*r-i*i+s*s;var c=2*(e-n),v=2*(t-a),g=2*(u-o);var p=e*e+t*t-o*o-n*n-a*a+u*u;var _=c*d-l*v,y=(d*p-v*f)/_-e,m=(v*h-d*g)/_,x=(c*f-l*p)/_-t,b=(l*g-c*h)/_;var S=m*m+b*b-1,A=2*(y*m+x*b+o),E=y*y+x*x-o*o,w=(-A-Math.sqrt(A*A-4*S*E))/(2*S);return[y+m*w+e,x+b*w+t,w]}function f(e,t,r,i,n,a){var o=(e*(i-a)+r*(a-t)+n*(t-i))*2;if(o===0){return null}var s=((e*e+t*t)*(i-a)+(r*r+i*i)*(a-t)+(n*n+a*a)*(t-i))/o;var u=((e*e+t*t)*(n-r)+(r*r+i*i)*(e-n)+(n*n+a*a)*(r-e))/o;var l=s-e,d=u-t;return[s,u,Math.sqrt(l*l+d*d)]}i=o(i);var c=r?d:l;var v=r?h:f;var g=r?Dr:Or;r=r||[];return u(i,[],i.length,e,t,r,g,c,v)}function removeRadialOverlap(e){var t=e.X;var r=e.Y;var i=e.sizes;var n=e.indexes;var a=e.R;var o=e.center;var s=e.gap;if(s===void 0)s=0;var u=e.epsilon;if(u===void 0)u=.001;var l=e.maxLoops;if(l===void 0)l=5;var d=e.inPlace;if(d===void 0)d=true;var h=n.length;var f=h;var c=o[0],v=o[1];if(!d){t=t.slice();r=r.slice()}var g=circleCircleIntersection;var p=circleSortCompare;var _=n.slice().sort(function(e,i){return p(t[e],r[e],t[i],r[i],c,v)});var y=_[h-1];var m=t[y],x=r[y];var b,S,A,E,w,T;for(var k=0,C=false;k<f-1;k++){var I=k%h,M=(k+1)%h;if(k===-1){I=h-1;M=0}I=_[I];M=_[M];b=t[I];S=r[I];A=t[M];E=r[M];var L=i[I],F=i[M];var N=L+F+s;var z=p(b,S,A,E,c,v);if(z===-1&&C){z=1}if(N>a){continue}if(z===1||N-distance(b,S,A,E)>u){var P=g(c,v,a,b,S,N);if(P){P=P[0];C=A>c&&P[0]<c;A=t[M]=P[0];E=r[M]=P[1]}}else{C=false}if(k%h===h-2){var O=_[h-1],D=_[0];if(r[O]>v&&r[D]>v&&t[O]-i[O]<t[D]+i[O]){w=0;f=Math.min(h*l,f+h);while(r[_[O]]>v&&r[_[0]]>v&&t[_[O]]<t[_[0]]&&++w<h){_.unshift(_.pop())}}}}b=m-c;S=x-v,A=t[y]-c;E=r[y]-v;var R=b===A?0:Math.abs(Math.acos((b*A+S*E)/(Math.sqrt(b*b+S*S)*Math.sqrt(A*A+E*E))));if(R!==0){var B=Math.sin(-R);var j=Math.cos(-R);var U;for(k=0;k<h;k++){U=_[k];w=t[U]-c;T=r[U]-v;t[U]=w*j-T*B+c;r[U]=w*B+T*j+v}}return{X:t,Y:r}}function circlePack(e){var t=e.X;var r=e.Y;var i=e.R;var n=e.center;var a=e.maxSteps;if(a===void 0)a=1e3;var o=e.padding;if(o===void 0)o=5;var s=e.epsilon;if(s===void 0)s=1e-5;var u=e.damping;if(u===void 0)u=2;var l=e.pinned;var d=e.indexes;var h=e.onUpdate;var f=e.pushSmallerOut;if(f===void 0)f=true;var c=d?d.length:t.length;var v=d;var g;if(!isFinite(l)){l=-1}if(v===undefined){v=new Uint32Array(c);for(g=0;g<c;g++){v[g]=g}}else{v=d}if(l!==-1){n=[t[l],r[l]]}else if(!n){var p=0,_=0;for(g=0;g<c;g++){p+=t[v[g]];_+=r[v[g]]}n=[p/c,_/c]}var y=function(e){return--e*e*e+1};var m=function(e,t){var r=e-n[0];var i=t-n[1];return r*r+i*i};var x=-Infinity,b=Infinity;v.sort(function(e,n){var a=i[e],o=i[n];x=Math.max(x,a,o);b=Math.min(b,a,o);return o*m(t[n],r[n])-a*m(t[e],r[e])});function S(e,a){var s=0;var d,h,g,p,_,y;for(d=0;d<c-1;d++){for(h=d+1;h<c;h++){if(d===h){continue}g=v[d];p=v[h];var m=t[g],S=r[g],A=i[g];var E=t[p],w=r[p],T=i[p];var k=E-m;var C=w-S;var I=A+T+o;var M=k*k+C*C;if(M<I*I-e){var L=(I-Math.sqrt(M))*a;var F=1/M;var N=k*F*L;var z=C*F*L;y=N*N+z*z;if(p!==l){_=A/b;s+=y*_;t[p]+=N*_;r[p]+=z*_}if(g!==l){_=T/b;s+=y*_;t[g]-=N*_;r[g]-=z*_}}}}var P=e*u*(1-a);var O=n[0],D=n[1],R,B;for(d=0;d<c;d++){g=v[d];if(g!==l){R=t[g];B=r[g];I=i[g];_=I/x;var j=f?P*_:P;N=(R-O)*j;z=(B-D)*j;y=N*N+z*z;s+=y;t[g]-=N;r[g]-=z}}return s}var A=0,E=0;var w=y(1/c);for(g=0;g<a;g++){A=S(w,y((g+1)/a));if(h){setTimeout(function(){return h(t,r)})}if(Math.abs(A-E)<s){break}E=A}return{X:t,Y:r}}var Fa=3;var Na=function e(t,r,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0];r=a[1];i=a[2];this.d=r+2*i;for(var o=0;o<this.d*this.d;o++){var s=a[Fa+o];var u=a[Fa+o+1];n.push(s===u?null:a.subarray(s,u))}var l=a[Fa+n.length];var d=a[Fa+n.length+1];this.keys=a.subarray(l,d);this.bboxes=a.subarray(d);this.insert=this._insertReadonly}else{this.d=r+2*i;for(var h=0;h<this.d*this.d;h++){n.push([])}this.keys=[];this.bboxes=[]}this.n=r;this.extent=t;this.padding=i;this.scale=r/t;this.uid=0;this.freeIndexes=[];this.freeIndexMap={};var f=i/r*t;this.min=-f;this.max=t+f};Na.prototype.clear=function e(){var t=this.cells=[];for(var r=0;r<this.d*this.d;r++){t.push([])}this.keys=[];this.bboxes=[];this.freeIndexMap={};this.freeIndexes=[];this.uid=0};Na.prototype.insert=function e(t,r,i,n,a){var o;if(this.freeIndexes.length===0){o=this.uid++}else{o=this.freeIndexes.pop();delete this.freeIndexMap[o]}var s=o*4;var u=this.bboxes;this._forEachCell(r,i,n,a,this._insertCell,o);this.keys[o]=t;u[s+0]=r;u[s+1]=i;u[s+2]=n;u[s+3]=a;return this};Na.prototype.remove=function e(t){var r=this.keys.indexOf(t);if(r!==-1&&!this.freeIndexMap[r]){var i=r*4;var n=this.bboxes;var a=n[i+0];var o=n[i+1];var s=n[i+2];var u=n[i+3];this._forEachCell(a,o,s,u,this._removeCell,r);this.freeIndexes.push(r);this.freeIndexMap[r]=true}return this};Na.prototype._removeCell=function e(t,r,i,n,a,o){var s=this.cells[a];for(var u=0,l=s.length;u<l;u++){if(s[u]===o){s.splice(u,1);u--;l--}}};Na.prototype._insertReadonly=function e(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."};Na.prototype._insertCell=function e(t,r,i,n,a,o){this.cells[a].push(o)};Na.prototype.query=function e(t,r,i,n){var a=this;var o=this.min;var s=this.max;var u,l;var d={};var h=[];for(u=0,l=this.freeIndexes.length;u<l;u++){d[a.freeIndexes[u]]=true}if(t<=o&&r<=o&&s<=i&&s<=n){var f=this.keys;for(u=0,l=f.length;u<l;u++){if(!d[u]){h.push(f[u])}}return h}else{this._forEachCell(t,r,i,n,this._queryCell,h,d);return h}};Na.prototype._queryCell=function e(t,r,i,n,a,o,s){var u=this.cells[a];if(u!==null){var l=this.keys;var d=this.bboxes;for(var h=0;h<u.length;h++){var f=u[h];if(s[f]===undefined){var c=f*4;if(t<=d[c+2]&&r<=d[c+3]&&i>=d[c+0]&&n>=d[c+1]){s[f]=true;o.push(l[f])}else{s[f]=false}}}}};Na.prototype._forEachCell=function e(t,r,i,n,a,o,s){var u=this;var l=this.scale;var d=this.padding;var h=this.d;var f=Math.max(0,Math.min(h-1,Math.floor(t*l)+d));var c=Math.max(0,Math.min(h-1,Math.floor(r*l)+d));var v=Math.max(0,Math.min(h-1,Math.floor(i*l)+d));var g=Math.max(0,Math.min(h-1,Math.floor(n*l)+d));for(var p=f;p<=v;p++){for(var _=c;_<=g;_++){var y=h*_+p;if(a.call(u,t,r,i,n,y,o,s)){return}}}};Na.prototype.toArrayBuffer=function e(){var t=this;if(this.arrayBuffer){return this.arrayBuffer}var r=this.cells;var i=Fa+this.cells.length+1+1;var n=0;for(var a=0;a<this.cells.length;a++){n+=t.cells[a].length}var o=new Int32Array(i+n+this.keys.length+this.bboxes.length);o[0]=this.extent;o[1]=this.n;o[2]=this.padding;var s=i;for(var u=0;u<r.length;u++){var l=r[u];o[Fa+u]=s;o.set(l,s);s+=l.length}o[Fa+r.length]=s;o.set(this.keys,s);s+=this.keys.length;o[Fa+r.length+1]=s;o.set(this.bboxes,s);s+=this.bboxes.length;return o.buffer};function za(e,t){return e[3]>t[1]&&e[1]<t[3]&&(e[2]>t[0]&&e[0]<t[2])}var Pa=function e(t,r,i){if(i===void 0)i=16;if(i<2||i>16||i%2!==0){throw new Error("Wrong grid resolution '"+i+"' - it must be 2, 4, 8 or 16")}this._getBBox=r;this._bbox=t;this._res=i;this._inX=Math.pow(2,i)-1;this._inY=this._inX<<i;this.clear()};Pa.prototype._updateResolution=function e(){var t=this;this._xres=(this._bbox[2]-this._bbox[0])/this._res;this._yres=(this._bbox[3]-this._bbox[1])/this._res;this._clear();var r=Object.keys(this._codes);for(var i=0,n=r.len;i<n;i++){var a=r[i];t._codes[a]=0;t.insert(a)}return this};Pa.prototype.insert=function e(t){var r=this._getBBox(t);var i=this._res;var n=this._bbox[0],a=this._bbox[1];var o=(r[0]-n)/this._xres|0;var s=(r[1]-a)/this._yres|0;var u=(r[2]-n)/this._xres|0;var l=(r[3]-a)/this._yres|0;var d=o,h=s;var f=this._x,c=this._y;var v=this._codes;while(d<=u&&d<i){f[d][t]=true;v[t]|=1<<d;d++}while(h<=l&&h<i){c[h][t]=true;v[t]|=1<<i+h;h++}return this};Pa.prototype.updateBBox=function e(t){var r=this._bbox;var i=this._res;this._bbox=t;var n=(r[0]-t[0])/this._xres|0;var a=(r[1]-t[1])/this._yres|0;if(Math.abs(n)>=i||Math.abs(a)>=i){this.clear()}else{var o=this._updateDim(this._x,0,n);var s=this._updateDim(this._y,i,a);var u=this._inX,l=this._inY;var d=Object.keys(this._codes);var h=this._x,f=this._y,c=this._codes;for(var v=0,g=d.length;v<g;v++){var p=d[v];var _=c[p];if((_&u)===0||(_&l)===0){for(var y=0;y<i;y++){if(_&1<<y){delete h[y][p]}if(_&1<<i+y){delete f[y][p]}}delete c[p]}}if(n<0){this._x=this._x.slice(-n).concat(o)}else if(n>0){this._x=o.concat(this._x.slice(0,i-n))}if(a<0){this._y=this._y.slice(-a).concat(s)}else if(a>0){this._y=s.concat(this._y.slice(0,i-a))}}return this};Pa.prototype._updateDim=function e(t,r,i){var n,a,o,s,u;var l=this._codes;var d=[];if(i<0){for(n=0;n<-i;n++){s=1<<r+n;u=Object.keys(t[n]);for(a=0,o=u.length;a<o;a++){l[u[a]]^=s}d.push({})}}else if(i>0){for(n=this._res-i;n<this._res;n++){s=1<<r+n;u=Object.keys(t[n]);for(a=0,o=u.length;a<o;a++){l[u[a]]^=s}d.push({})}}return d};Pa.prototype.resize=function e(t){var r=this;this._bbox=t;for(var i=0;i<this._res;i++){r._x[i]={};r._y[i]={}}this._updateResolution()};Pa.prototype.removeMultiple=function e(t){var r=this;var i=t.length,n,a,o;for(var s=0;s<this._res;s++){a=r._x[s],o=r._y[s];for(var u=0;u<i;u++){n=t[u];if(r._codes[n]){if(a[n]){delete a[n]}if(o[n]){delete o[n]}delete r._codes[n]}}}return this};Pa.prototype.remove=function e(t){var r=this._codes[t];var i=this._x,n=this._y,a=this._res;for(var o=0;o<a;o++){var s=1<<o,u=1<<a+o;if(r&s){delete i[o][t]}if(r&u){delete n[o][t]}}delete this._codes[t];return this};Pa.prototype.point=function e(t){return this.query([t[0],t[1],t[0],t[1]])};Pa.prototype.query=function e(t){var r=this;var i=this._bbox[0],n=this._bbox[1],a=this._res;var o=Math.max(0,(t[0]-i)/this._xres|0);var s=Math.max(0,(t[1]-n)/this._yres|0);var u=Math.min(a-1,(t[2]-i)/this._xres|0);var l=Math.min(a-1,(t[3]-n)/this._yres|0);var d=this._getBBox;var h=[];var f=o,c=s,v={},g=[],p,_,y;while(f<=u){g=g.concat(Object.keys(r._x[f++]))}while(c<=l){g=g.concat(Object.keys(r._y[c++]))}for(p=0,_=g.length;p<_;p++){y=g[p];if(!v[y]){if(za(d(y),t)){h.push(y)}v[y]=true}}return h};Pa.prototype.getAll=function e(){var t=this;return Object.keys(this._codes).map(function(e){return t._getBBox(e)})};Pa.prototype.getOverlaps=function e(){var t=this;var r=this._res,i={};var n=this._getBBox;var a=[];var o=this._ycode;for(var s=0;s<r;s++){var u=Object.keys(t._x[s]);for(var l=0;l<r;l++){var d=[],h=1<<l;for(var f=0,c=u.length;f<c;f++){if(o[u[f]]&h){d.push(u[f])}}var v=d.length;for(var g=0;g<v;g++){for(var p=0;p<v;p++){var _=d[g],y=d[p];if(p!==g&&!i[_+":"+y]&&!i[y+":"+_]){i[_+":"+y]=true;if(za(n(_),n(y))){a.push(_,y)}}}}}}return a};Pa.prototype.clear=function e(){var t=this;var r=this._bbox;var i=this._res;this._x=new Array(i);this._y=new Array(i);for(var n=0;n<i;n++){t._x[n]={};t._y[n]={}}this._xres=(r[2]-r[0])/i;this._yres=(r[3]-r[1])/i;this._codes={}};function Oa(e,t,r,i,n,a){return{minX:e,minY:t,maxX:r,maxY:i,leaf:true,level:a,parent:n,objects:[],final:false}}function Da(e){var t=e.minX;var r=e.minY;var i=e.maxX;var n=e.maxY;return[t,r,i,n]}function Ra(e,t,r,i,n,a,o,s){var u=(e+r)/2;var l=(t+i)/2;return u>=n&&u<=o&&(l>=a&&l<=s)}function Ba(e,t,r,i,n,a,o,s){return e>n&&e<o&&(t>a&&t<s)||r>n&&r<o&&(i>a&&i<s)}function ja(e,t,r,i,n,a,o,s){return i>=a&&t<=s&&(r>=n&&e<=o)}var Ua=0;var Va=1;var Ga=2;var Wa=3;function Ha(e,t,r,i,n,a,o,s){var u=(n+o)/2;var l=(a+s)/2;var d=(e+r)/2;var h=(t+i)/2;if(d<=u){return h<=l?Ua:Va}else{return h<=l?Wa:Ga}}var Xa=function(e){return e};var qa=function e(t,r,i,n){if(t===void 0)t=Xa;if(r===void 0)r=10;if(n===void 0)n=0;this._nodeCapacity=r;this._root=null;this._getBBox=t;this._upScale=4;this._objects={};this._size=0;this._rootLevel=n;this._maxLevel=n+30;this._idToCell={};if(i){this._root=Oa(i[0],i[1],i[2],i[3],null,n)}};var Ya={size:{configurable:true},root:{configurable:true}};Ya.size.get=function(){return this._size};Ya.root.get=function(){return this._root};qa.prototype.clear=function e(){this._root=null;this._objects={};this._size=0;this._idToCell={};this._rootLevel=0;this._maxLevel=this._rootLevel+30;return this};qa.prototype.insert=function e(t,r,i){var n=this;if(i===void 0)i=this._root;r=r||this._getBBox(t);if(this._objects[t]){return}this._objects[t]=true;this._size++;if(!this._root){var a=Math.max(Math.abs(r[2]-r[0]),Math.abs(r[3]-r[1]));this._root=Oa(r[0],r[1],r[0]+a,r[1]+a,null,this._rootLevel);this._root.objects.push(t);return t}var o=[i];var s,u=false;var l=this._nodeCapacity,d=this._idToCell;var h=this._maxLevel;while(s=o.pop()){var f=s.minX;var c=s.minY;var v=s.maxX;var g=s.maxY;if(ja(r[0],r[1],r[2],r[3],f,c,v,g)){if(s.leaf){if(s.objects.length<l||s.final){s.objects.push(t);if(d[t]){d[t].push(s)}else{d[t]=[s]}u=true;if(s.level>=h||Math.abs(v-f)<=Math.abs(r[2]-r[0])||Math.abs(g-c)<=Math.abs(r[3]-r[1])){s.final=true}}else{n.splitNode(s);o.push(s)}}else{o.push.apply(o,s.children)}}}if(u){return t}i=this._root;if(!Ra(r[0],r[1],r[2],r[3],i.minX,i.minY,i.maxX,i.maxY)){var p=this._rootLevel;var _=(r[0]+r[2])/2;var y=(r[1]+r[3])/2;while(!Ra(r[0],r[1],r[2],r[3],this._root.minX,this._root.minY,this._root.maxX,this._root.maxY)){i=n._root;var m=i.minX;var x=i.minY;var b=i.maxX;var S=i.maxY;var A=m,E=x,w=b,T=S;var k=Math.abs(b-m);var C=Math.abs(S-x);if(C===0&&k===0){break}var I=Math.max(k,C);if(_<=m){A-=I}if(y<=x){E-=I}if(_>m){w+=I}if(y>x){T+=I}var M=Oa(A,E,w,T,null,--p);n.splitNode(M);M.children[Ha(m,x,b,S,A,E,w,T)]=i;n._root=i.parent=M}o=[this._root];this._root.level=this._rootLevel;while(s=o.shift()){if(!s.leaf){for(var L=0;L<4;L++){var F=s.children[L];F.level=s.level+1;o.push(F)}}}}i=this._root;s=i.children[Ha(r[0],r[1],r[2],r[3],i.minX,i.minY,i.maxX,i.maxY)];if(s.leaf){s.objects.push(t);if(d[t]){d[t].push(s)}else{d[t]=[s]}}return t};qa.prototype.removeById=function e(t){if(!this._objects[t]){return t}this._size--;var r=this._idToCell[t];for(var i=0;i<r.length;i++){var n=r[i];var a=n.objects;for(var o=0,s=a.length;o<s;o++){if(a[o]===t){a.splice(o,1);break}}}delete this._objects[t];delete this._idToCell[t];return t};qa.prototype.remove=function e(t){var r=this._getBBox(t);var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=[this._root];var u,l,d;while(u=s.pop()){if(ja(i,n,a,o,u.minX,u.minY,u.maxX,u.maxY)){if(u.leaf){var h=u.objects;for(var f=0,c=h.length;f<c;f++){if(h[f]===t){h.splice(f,1);if(c===1){d=d||[];d.push(u)}break}}}else{s.push.apply(s,u.children)}}}delete this._idToCell[t];delete this._objects[t];this._size--;if(d){while(l=d.pop()){var v=l.parent;var g=true;while(v&&g){if(!v.leaf){for(var p=0;p<4;p++){u=v.children[p];if(!u.leaf||u.objects.length!==0){g=false;break}}if(g){v.leaf=true;v.children=null;v.objects=[]}}v=v.parent}}}return t};qa.prototype.splitNode=function e(t){var r=t.minX;var i=t.minY;var n=t.maxX;var a=t.maxY;var o=(r+n)/2,s=(i+a)/2;var u=t.level+1;var l=this._idToCell;var d=this._maxLevel;var h=[Oa(r,i,o,s,t,u),Oa(r,s,o,a,t,u),Oa(o,s,n,a,t,u),Oa(o,i,n,s,t,u)];if(t.objects){var f=t.objects;var c=this._getBBox;for(var v=0,g=f.length;v<g;v++){var p=f[v];var _=c(p);var y=l[p];for(var m=0;m<4;m++){var x=h[m];var b=x.minX;var S=x.minY;var A=x.maxX;var E=x.maxY;if(ja(_[0],_[1],_[2],_[3],b,S,A,E)){x.objects.push(p);if(x.level>=d||Math.abs(A-b)<=Math.abs(_[2]-_[0])||Math.abs(E-S)<=Math.abs(_[3]-_[1])){x.final=true}if(y){y.push(x)}else{y=[x]}}}y.splice(y.indexOf(t),1)}}t.children=h;t.objects=null;t.leaf=false};qa.prototype.point=function e(t,r){var i=[];var n=[this._root];var a,o,s;var u=t[0];var l=t[1];var d=this._getBBox;while(a=n.pop()){if(u>=a.minX&&u<=a.maxX&&l>=a.minY&&l<=a.maxY){if(a.leaf){if(r){i=a.objects}var h=a.objects;for(var f=0,c=h.length;f<c;f++){s=h[f];o=d(s);if(u>=o[0]&&u<=o[2]&&l>=o[1]&&l<=o[3]){i.push(s)}}break}else{n.push.apply(n,a.children)}}}return i};qa.prototype.neigbours=function e(t){var r=[],i;var n=[this._root];var a=t[0];var o=t[1];while(i=n.pop()){if(a>=i.minX&&a<=i.maxX&&o>=i.minY&&o<=i.maxY){if(i.leaf){r=i.objects;break}else{n.push.apply(n,i.children)}}}return r};qa.prototype.query=function e(t,r,i,n){var a=[];var o=[this._root];var s,u,l;var d=this._getBBox;var h={};while(s=o.pop()){if(ja(t,r,i,n,s.minX,s.minY,s.maxX,s.maxY)){if(s.leaf){var f=s.objects;for(var c=0,v=f.length;c<v;c++){l=f[c];if(!h[l]){u=d(l);if(ja(t,r,i,n,u[0],u[1],u[2],u[3])){a.push(l)}h[l]=true}}}else{o.push.apply(o,s.children)}}}return a};qa.prototype.getOverlaps=function e(){var t=[this._root];var r,i,n;var a=[];var o=this._getBBox;var s={},u=this._objects;while(r=t.pop()){if(r.leaf){var l=r.objects,d=l.length;for(var h=0;h<d;h++){for(var f=0;f<d;f++){i=l[h];n=l[f];if(h!==f&&!s[i+":"+n]&&!s[n+":"+i]){var c=u[i],v=u[n];s[i+":"+n]=true;if(ja(o(c),o(v))){a.push(c,v)}}}}}else{t.push.apply(t,r.children)}}return a};qa.prototype.getAll=function e(){return Object.keys(this._objects)};qa.prototype.forEach=function e(t,r){var i=[this._root];var n;while(n=i.pop()){if(n.leaf){for(var a=0,o=n.objects.length;a<o;a++){t.call(r,n.objects[a])}}else{i.push.apply(i,n.children)}}return this};qa.prototype.getLeafs=function e(){var t=[this._root],r=[];var i;while(i=t.pop()){if(i.leaf){r.push(i)}else{t.push.apply(t,i.children)}}return r};qa.prototype.traverse=function e(t,r){var i=[this._root];var n;while(n=i.pop()){if(!t.call(r,n,n.objects)&&!n.leaf){i.push.apply(i,n.children)}}return this};qa.prototype.update=function e(t){this.remove(t);this.insert(t);return this};qa.prototype.getNodeBounds=function e(t){return Da(t)};Object.defineProperties(qa.prototype,Ya);qa.flatAccessor=function(e,t){return function(r){var i=t*r;return e.slice(i,i+t)}};qa.inside=Ra;qa.intersects=Ba;qa.overlaps=ja;qa.getNodeBBox=Da;var Za=Object.freeze({minHeap:minHeap,bellmanFord:bellmanFord,dijkstra:dijkstra,johnson:johnson,largestEmptyCircle:ka,minDisk:minDisk,removeRadialOverlap:removeRadialOverlap,convexhull:Ta,circlePack:circlePack,GridIndex:Na,Grid:Pa,Quadtree:qa,weightedStress:weightedStress,distanceStress:distanceStress,constrainedStress:constrainedStress,stressMinimizationStep:stressMinimizationStep,stressMinimizationStepGeneral:stressMinimizationStepGeneral});var Ka=typeof y==="object"&&y!==null&&typeof y.it!=="undefined";function Qa(e){if(!Ka){console.info(ir()+" "+e)}}function Ja(e){if(!Ka){console.warn(ir()+" "+e)}}function $a(e,t){return e===undefined?t:e}function eo(e,t){if(!t){return{nodes:e?new e:Object.create(null),edges:e?new e:Object.create(null),fetch:function(e){return e?this.nodes:this.edges}}}else{return{nodes:e,edges:t,fetch:function(e){return e?this.nodes:this.edges}}}}function to(value,e,t){return Q(value,e,t)}function ro(e,t,value,r){if(t in e){throw new Error(r+" "+t+" already exists")}e[t]=value}function io(e,t,r){if(Array.isArray(e)){var i=e.indexOf(t);if(i===-1){throw new Error(r+" "+t+" does not exist")}return i}else{if(!(t in e)){throw new Error(r+" "+t+" does not exist")}return e[t]}}function no(e,t){return H(e,t)}Ogma.extend(function(e){var t=new ao;e.modules.events=t;e.events.removeListener=function(e){t.removeListener(e)}});var ao=function e(){this._events={};this._onAnyEvents=[]};ao.prototype.register=function e(t,r){var i=this;if(r===void 0)r=[];t.forEach(function(e){if(i._events[e]){throw new Error('event "'+e+'" already exists')}i._events[e]=new oo(false,e)});r.forEach(function(e){if(i._events[e]){throw new Error('event "'+e+'" already exists')}i._events[e]=new oo(true,e)})};ao.prototype.onAnyEvent=function e(t){this._onAnyEvents.push(t)};ao.prototype.on=function e(t,r){var i=this;if(R(t)){j(t,function(e,t){return i.on(t,e)})}else{var n=t.split(" ").filter(function(e){return!!e});n.forEach(function(e){return io(i._events,e,"event").on(r)})}return r};ao.prototype.removeListener=function e(t){j(this._events,function(e){e.off(t)})};ao.prototype.fire=function e(t,r){var i=io(this._events,t,"event");this._onAnyEvents.forEach(function(e){return e(t,r)});return i.trigger(r)};ao.prototype.once=function e(t,r){var i=this;var n=function(){r.apply(null,arguments);i.removeListener(n)};return this.on(t,n)};var oo=function e(t,r){this._name=r;this._reverseOrder=t;this._subscribers=[];this._handlers=[]};oo.prototype.trigger=function e(t){var r=this;for(var i=0,n=r._handlers;i<n.length;i+=1){var a=n[i];a(t,r._name)}};oo.prototype.on=function e(t){if(typeof t!=="function"){throw new Error("handler is not a function")}var r=this._reverseOrder?0:this._subscribers.length;this._handlers.splice(r,0,t);this._subscribers.splice(r,0,t)};oo.prototype.off=function e(t){var r=this;var i;while((i=this._subscribers.indexOf(t))!==-1){r._subscribers.splice(i,1);r._handlers.splice(i,1)}};Ogma.atInit(function(e,t){if(t.options){e.setOptions(t.options)}});Ogma.extend(function(e){var t=new so(e);e.modules.settings=t;e.setOptions=function(e){return t.update(e)};e.getOptions=function(){return t.get()}});var so=function e(){this._currentValue={};this._onChange={};this._defaultValues={};this._keys=[]};so.prototype.register=function e(t,r,i,n){if(n===void 0)n=true;this._keys.push(t);this._currentValue[t]=r;this._defaultValues[t]=r;this._onChange[t]=i||function(){};if(i&&n){i(r)}};so.prototype.update=function e(t){var r=this;t=X(t);var i=this._keys,n={};for(var a=0;a<i.length;++a){var o=i[a];if(o in t){var value=t[o];if(value===undefined){value=r._defaultValues[o]}n[o]=r._currentValue[o];r._currentValue[o]=value}}var s=Object.keys(n);for(var u=0;u<s.length;++u){var l=s[u],d=r._currentValue[l],h=n[l];if(d!==h){r._onChange[l](d,h)}}return q(n)};so.prototype.get=function e(t){if(t===undefined){return q(this._currentValue)}else{return this._currentValue[t]}};so.prototype.set=function e(t,value){var r=this._currentValue[t];var i=this._onChange[t];this._currentValue[t]=value;if(i){i(value,r)}};var uo=["geo","graphics","legend","brand","tooltip"];var lo=300;var ho=300;Ogma.atInit(function(e,t){if(t.container){e.setContainer(t.container)}});Ogma.extend(function(e,t){var r=new fo(e,t.dimensions);e.modules.dom=r;e.setContainer=function(e){return r.setContainer(e)};e.getContainer=function(){return r.getContainer()};e.view.beforeNextFrame=function(){return r.beforeNextFrame()};e.view.afterNextFrame=function(){return r.afterNextFrame()};e.view.setFullScreen=function(value){return r.setFullScreen(value)};e.view.isFullScreen=function(){return r.isFullScreen()};e.view.forceResize=function(){return r.forceResize()};e.view.getSize=function(){return r.getDimensions()};e.view.setSize=function(e){r.setDimensions(e);return Promise.resolve()}});Ogma.onDestroy(function(e){e.modules.dom.detachFromDom();e.modules.dom.clearAllTimeouts();e.modules.dom.stopFrames()});var fo=function e(t,r){var i=this;if(r===void 0)r={};var n=r.width;if(n===void 0)n=80;var a=r.height;if(a===void 0)a=60;this._events=t.modules.events;this._settings=t.modules.settings;this._width=n;this._height=a;this._layers={};this._container=null;this._isFullScreen=false;this._beforeNextFramePromises=[];this._afterNextFramePromises=[];this._refreshUntil=0;this._currentTime=tr();this._timeouts=[];this._framesStopped=false;this._settings.register("minimumWidth",lo,function(){return i._resize()},false);this._settings.register("minimumHeight",ho,function(){return i._resize()},false);this._events.register(["beforeNewFrame","newFrame","afterNewFrame","setContainer","resize"]);this._onDetachDom=[];this._onWindowResize=function(){return i._resize()};this._onWindowFocus=function(){return i.refresh()};this.addWindowEventListener("resize",this._onWindowResize);this.addWindowEventListener("focus",this._onWindowFocus)};fo.prototype.addWindowEventListener=function e(t,r,i){if(typeof window!=="undefined"&&!window.__OGMA_HEADLESS){this.addElementEventListener(window,t,r,i)}};fo.prototype.addDocumentEventListener=function e(t,r,i){if(typeof document!=="undefined"&&!window.__OGMA_HEADLESS){this.addElementEventListener(document,t,r,i)}};fo.prototype.addMediaListener=function e(t,r){if(typeof window!=="undefined"&&!window.__OGMA_HEADLESS){var i=window.matchMedia(t);i.addListener(r);this._onDetachDom.push(function(){return i.removeListener(r)})}};fo.prototype.addElementEventListener=function e(t,r,i,n){t.addEventListener(r,i,n);this._onDetachDom.push(function(){return t.removeEventListener(r,i,n)})};fo.prototype.detachFromDom=function e(){this._onDetachDom.forEach(function(e){return e()});this._onDetachDom=null;this._emptyContainer()};fo.prototype.setTimeout=function e(t,r){var i=this;if(r===void 0)r=0;var n=setTimeout(function(){i._timeouts.splice(i._timeouts.indexOf(n),1);t()},r);this._timeouts.push(n);return n};fo.prototype.clearTimeout=function e(t){if(t){clearTimeout(t);this._timeouts.splice(this._timeouts.indexOf(t),1)}return null};fo.prototype.clearAllTimeouts=function e(){this._timeouts.forEach(clearTimeout);this._timeouts=[]};fo.prototype.stopFrames=function e(){this._framesStopped=true;if(this._nextFrame){_(this._nextFrame);this._nextFrame=null}};fo.prototype.isDestroyed=function e(){return this._framesStopped};fo.prototype.getDimensions=function e(){return{width:this._width,height:this._height}};fo.prototype.setDimensions=function e(t){this._resize(t)};fo.prototype.setLayer=function e(t,r,i){if(i===void 0)i={};var n=i.automaticResize;if(n===void 0)n=false;if(r){r._ogmaLayer=t;if(n){r.style.position="absolute";r.style.top="0px";r.style.left="0px";ze(r,this._width,this._height,Ce())}}this._layers[t]={element:r,automaticResize:n};this._updateContainerContent()};fo.prototype.setContainer=function e(t){if(typeof t==="string"){var r=t;t=document.getElementById(r);if(!t){throw new Error('unable to find DOM element with id "'+r+'"')}}if(t===this._container){return}var i=this._container;this._isFullScreen=false;this._container=t;this._resize();this._updateContainerContent();this._events.fire("setContainer",{element:t,prevElement:i})};fo.prototype.getContainer=function e(){return this._container};fo.prototype.forceResize=function e(){this._resize()};fo.prototype._beforeOrAfterNextFrame=function e(t){var r=t?this._afterNextFramePromises:this._beforeNextFramePromises;var i=new Promise(function(e){r.push(function(){e();return i})});this._refresh();return i};fo.prototype.beforeNextFrame=function e(){return this._beforeOrAfterNextFrame(false)};fo.prototype.afterNextFrame=function e(){return this._beforeOrAfterNextFrame(true)};fo.prototype.refresh=function e(t){if(t){this._refreshUntil=Math.max(this._refreshUntil,t)}this._refresh()};fo.prototype._emptyContainer=function e(){var t=this;if(this._container){var r=[];for(var i=0;i<this._container.childNodes.length;++i){var n=t._container.childNodes[i];if(n._ogmaLayer){r.push(n)}}for(var a=0;a<r.length;++a){t._container.removeChild(r[a])}}};fo.prototype._fillContainer=function e(){var t=this;if(this._container){var r=de(this._container,"position");if(r!=="absolute"&&r!=="relative"&&r!=="fixed"){this._container.style.position="relative"}var i=this._container.firstChild;uo.forEach(function(e){var r=t._layers[e];if(r&&r.element){t._container.insertBefore(r.element,i)}})}};fo.prototype._updateContainerContent=function e(){this._emptyContainer();this._fillContainer()};fo.prototype._resize=function e(t){if(!this._container&&!t){return}var r=this._width;var i=this._height;var n;var a;if(this._container){var o=this._settings.get("minimumWidth");var s=this._settings.get("minimumHeight");var u=this._container.clientWidth||1;var l=this._container.clientHeight||1;n=Math.max(o,u);a=Math.max(s,l)}else{n=t.width;a=t.height}if(n!==r||a!==i){this._width=n;this._height=a;j(this._layers,function(e){var t=e.element;var r=e.automaticResize;if(r){ze(t,n,a)}});this._events.fire("resize",{prevWidth:r,prevHeight:i,width:n,height:a,difWidth:n-r,difHeight:a-i})}};fo.prototype._refresh=function e(){var t=this;if(this._inFrame){this._mustRefresh=true}else if(!this._nextFrame&&!this._framesStopped){this._nextFrame=p(function(){return t._playFrame()})}};fo.prototype._playFrame=function e(){var t=this;var r=tr();var i=r-this._currentTime;var n=I([this._beforeNextFramePromises,function(){return t._events.fire("beforeNewFrame",{elapsed:i})},function(){return t._events.fire("newFrame",{elapsed:i})},function(){return t._events.fire("afterNewFrame",{elapsed:i})},this._afterNextFramePromises,function(){t._inFrame=false;if(t._mustRefresh||r<t._refreshUntil+17){t._mustRefresh=false;t._refresh()}}]);this._inFrame=true;this._nextFrame=null;this._mustRefresh=false;this._currentTime=r;this._beforeNextFramePromises=[];this._afterNextFramePromises=[];n.reduce(function(e,r){return e.then(function(){if(!t._framesStopped){return r()}})},Promise.resolve())};fo.prototype.isPlayingFrame=function e(){return this._inFrame||!!this._nextFrame};fo.prototype.setFullScreen=function e(value){if(this._container){if(value&&!this._isFullScreen){co(this._container)}else if(!value&&this._isFullScreen){vo()}}this._isFullScreen=value};fo.prototype.isFullScreen=function e(){return this._isFullScreen};fo.prototype.debounceBeforeFrame=function e(t){var r=this;var i=false;var n=[];var a=function(){var e=n;i=false;n=[];t();e.forEach(function(e){return e()})};return function(){return new Promise(function(e){n.push(e);if(!i){i=true;r.beforeNextFrame().then(a)}})}};function co(e){if(e.requestFullScreen){e.requestFullScreen()}else if(e.webkitRequestFullScreen){e.webkitRequestFullScreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}}function vo(){if(typeof document==="undefined"){return}if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}function go(e,t){var r=t.directed;var i=t.ids;var n=t.weight;var a=t.nodes;var o=r?"out":"both";a=a||e.getNodes()._indexes;var s=new Array(a.length);for(var u=0;u<a.length;++u){s[u]=e._collectAdjacentEdges([a[u]],o,"all")}var l=e._nodeIdList;var d=e.getAttributes(false,["source","target","width"]);var h=d[0];var f=d[1];var c=d[2];var v=e.getNodeAttribute("id");var g=[],p;var _=1,y=false,m=false;if(typeof n==="number"){y=true;_=n}else if(typeof n==="function"){m=true}else if(typeof n!=="string"){n=n?"width":null}for(var x=0;x<s.length;x++){var b=s[x];var S=a[x];var A=void 0,E=void 0,w=void 0,T=void 0;var k=b.length;var C=i?new Array(k):new Uint32Array(k);var I=new Array(k);for(var M=0;M<k;M++){A=b[M];E=h.get(A);w=f.get(A);T=r?w:S===E?w:E;if(i){T=v.get(T)}C[M]=T;if(n){if(y){I[M]=_}else if(m){I[M]=n(l.get(E),l.get(w))}else{I[M]=c.get(A)||_}}}p=Object.create(null);p.nodes=C;p.id=i?v.get(S):S;if(n){p.weights=I}g.push(p)}return g}Ogma.atInit(function(e,t){if(t.graph){var r=t.graph;var i=r.nodes;var n=r.edges;if(i){e.addNodes(i)}if(n){e.addEdges(n)}}});Ogma.extend(function(e){var t=new po(e);var r=t.Node;var i=t.Edge;var n=t.NodeList;var a=t.EdgeList;e.modules.graph=t;e.Node=r;e.Edge=i;e.NodeList=n;e.EdgeList=a;e.events.onNodesAdded=function(t){e.modules.events.on("addNodes",t);return e.events};e.events.onBeforeNodesRemoved=function(t){e.modules.events.on("beforeRemoveNodes",t);return e};e.events.onNodesRemoved=function(t){e.modules.events.on("removeNodes",t);return e.events};e.events.onEdgesAdded=function(t){e.modules.events.on("addEdges",t);return e.events};e.events.onBeforeEdgesRemoved=function(t){e.modules.events.on("beforeRemoveEdges",t);return e};e.events.onEdgesRemoved=function(t){e.modules.events.on("removeEdges",t);return e.events};e.addNodes=function(e,r){return t.addElements(true,e,r)};e.addEdges=function(e,r){if(r===void 0)r={};return t.addElements(false,e,r)};e.addNode=function(e,r){return t.addElement(true,e,r)};e.addEdge=function(e,r){return t.addElement(false,e,r)};e.removeNodes=function(e,r){return t.removeElements(true,e,r)};e.removeEdges=function(e,r){return t.removeElements(false,e,r)};e.removeNode=function(e,r){return t.removeElements(true,[e],r)};e.removeEdge=function(e,r){return t.removeElements(false,[e],r)};e.getNodes=function(e){return t.getNodes(e)};e.getEdges=function(e){return t.getEdges(e)};e.getNode=function(e){return t.getNode(e)};e.getEdge=function(e){return t.getEdge(e)};e.clearGraph=function(){return t.clear()};e.setGraph=function(r,i){t.clear();return e.addGraph(r,i)};e.addGraph=function(e,r){return t.addGraph(e,r)};e.createNodeList=function(){return e.getNodes([])};e.createEdgeList=function(){return e.getEdges([])};r.prototype.getAdjacentNodes=function(e){return t.getAdjacentNodes(this,e)};n.prototype.getAdjacentNodes=function(e){return t.getAdjacentNodes(this,e)};r.prototype.getAdjacentEdges=function(e){return t.getAdjacentEdges(this,e)};n.prototype.getAdjacentEdges=function(e){return t.getAdjacentEdges(this,e)};r.prototype.getDegree=function(e){return t.getDegree(this,e)[0]};n.prototype.getDegree=function(e){return t.getDegree(this,e)};n.prototype.getConnectedComponents=function(e){return t.getConnectedComponents(this,e)};i.prototype.getParallelEdges=function(e){return t.getParallelEdges(this,e)};a.prototype.getParallelEdges=function(e){return t.getParallelEdges(this,e)};r.prototype.fastGetAdjacentElements=function(){return t.fastGetNodesAdjacentElements(this)};n.prototype.fastGetAdjacentElements=function(){return t.fastGetNodesAdjacentElements(this)};i.prototype.fastGetAdjacentElements=function(){return t.fastGetEdgesAdjacentElements(this)};a.prototype.fastGetAdjacentElements=function(){return t.fastGetEdgesAdjacentElements(this)};e.getConnectedComponents=function(e){if(e===void 0)e={};return t.getConnectedComponents(t.getNodes(e.filter),e)};e.getConnectedComponentByNode=function(e,r){var i=t.getNode(e);if(i===undefined){throw new Error("getComponentByNode: cannot find node "+e)}return t.getConnectedComponentByNode(i,r)[0]};r.prototype.getConnectedComponent=function(e){return t.getConnectedComponentByNode(this,e)[0]};r.prototype.isVisible=function(){return!this.isExcluded()};n.prototype.isVisible=function(){return this.isExcluded().map(function(value){return!value})};i.prototype.isVisible=function(){return!this.isExcluded()};a.prototype.isVisible=function(){return this.isExcluded().map(function(value){return!value})};r.prototype.isExcluded=function(){return t.isExcluded(this)[0]};n.prototype.isExcluded=function(){return t.isExcluded(this)};r.prototype.setExcluded=function(value){return t.setExcluded(this,value)};n.prototype.setExcluded=function(value){return t.setExcluded(this,value)};i.prototype.isExcluded=function(){return t.isExcluded(this)[0]};a.prototype.isExcluded=function(){return t.isExcluded(this)};i.prototype.setExcluded=function(value){return t.setExcluded(this,value)};a.prototype.setExcluded=function(value){return t.setExcluded(this,value)};r.prototype.setVisible=function(value){return this.setExcluded(!value)};n.prototype.setVisible=function(value){return this.setExcluded(!value)};i.prototype.setVisible=function(value){return this.setExcluded(!value)};a.prototype.setVisible=function(value){return this.setExcluded(!value)}});var po=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._dom=t.modules.dom;this._storage=eo(new Zt(true),new Zt(false));this._events.register(["addNodes","addEdges","excludedStateChange"],["clear","beforeRemoveNodes","removeNodes","beforeRemoveEdges","removeEdges"]);this._promisesToResolve=[];this._indexFreeStep=0;this._sourceList=this.createEdgeAttribute({name:"source",storage:32});this._targetList=this.createEdgeAttribute({name:"target",storage:32});this._nodeDeduper=this.createNodeAttribute({storage:1});this._edgeDeduper=this.createEdgeAttribute({storage:1});this._fakeDeduper={get:function(){return 0},set:function(){}};this.createAttributes([{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}]);this.Node=function e(t){this._index=t};Object.defineProperty(this.Node.prototype,"_ogma",{value:t});Object.defineProperty(this.Node.prototype,"isNode",{value:true});Object.defineProperty(this.Node.prototype,"size",{value:1});Object.defineProperty(this.Node.prototype,"__indexes",{value:new Uint32Array(1)});Object.defineProperty(this.Node.prototype,"_indexes",{get:function(){this.__indexes[0]=this._index;return this.__indexes}});this.Edge=function e(t){this._index=t};Object.defineProperty(this.Edge.prototype,"_ogma",{value:t});Object.defineProperty(this.Edge.prototype,"isNode",{value:false});Object.defineProperty(this.Edge.prototype,"size",{value:1});Object.defineProperty(this.Edge.prototype,"__indexes",{value:new Uint32Array(1)});Object.defineProperty(this.Edge.prototype,"_indexes",{get:function(){this.__indexes[0]=this._index;return this.__indexes}});this.NodeList=function e(t){this._indexes=t||new Uint32Array(0)};Object.defineProperty(this.NodeList.prototype,"_ogma",{value:t});Object.defineProperty(this.NodeList.prototype,"_isList",{value:true});Object.defineProperty(this.NodeList.prototype,"size",{get:function(){return this._indexes.length}});Object.defineProperty(this.NodeList.prototype,"isNode",{value:true});this.EdgeList=function e(t){this._indexes=t||new Uint32Array(0)};Object.defineProperty(this.EdgeList.prototype,"_ogma",{value:t});Object.defineProperty(this.EdgeList.prototype,"_isList",{value:true});Object.defineProperty(this.EdgeList.prototype,"size",{get:function(){return this._indexes.length}});Object.defineProperty(this.EdgeList.prototype,"isNode",{value:false});this._nodes=this.createAttribute(true,{name:"object",storage:"any"});this._edges=this.createAttribute(false,{name:"object",storage:"any"});this._nodeIndexLists=[];this._edgeIndexLists=[];this._nodeFilters=this._makeFilters(true);this._edgeFilters=this._makeFilters(false);this._init_();this._events.on({newFrame:function(){if(r._indexFreeStep===1){r._indexFreeStep=2}else if(r._indexFreeStep===2){r._storage.nodes.freeIndexes();r._storage.edges.freeIndexes();r._indexFreeStep=0}}})};po.prototype.createIndexList=function e(t){return this._storage.fetch(t).createIndexList()};po.prototype._isNode=function e(t){return typeof t==="boolean"?t:t.isNode};po.prototype.acquireTemporaryIndexList=function e(t){return this._acquireIndexList(t)};po.prototype._acquireIndexList=function e(t){var r=this._isNode(t);var i=r?this._nodeIndexLists:this._edgeIndexLists;var n=i.find(function(e){return!e.isBusy()});if(!n){n=this.createIndexList(r);i.push(n)}n.markBusy();return n};po.prototype._getObjectList=function e(t){return this._isNode(t)?this._nodes:this._edges};po.prototype._getListClass=function e(t){return this._isNode(t)?this.NodeList:this.EdgeList};po.prototype._getElementClass=function e(t){return this._isNode(t)?this.Node:this.Edge};po.prototype._getDeduper=function e(t){var r=this._isNode(t)?this._nodeDeduper:this._edgeDeduper;r.reset();return r};po.prototype._getStorage=function e(t){return this._isNode(t)?this._storage.nodes:this._storage.edges};po.prototype._getFilter=function e(t,r){var i=this._isNode(t)?this._nodeFilters:this._edgeFilters;var n=i[r];return n||i.visible};po.prototype._getCacheLists=function e(t){return this._isNode(t)?this._nodeCacheLists:this._edgeCacheLists};po.prototype._resolvePromises=function e(){var t=this._promisesToResolve;this._promisesToResolve=[];t.forEach(function(e){return e()})};po.prototype._init_=function e(){this._nodeCacheLists=this._makeCacheListsForFilters(true);this._edgeCacheLists=this._makeCacheListsForFilters(false);this._neighborTable=new Qt;this._parallelTable=new Qt;this._parallelEdgesIndex=[];this._resolvePromises()};po.prototype.getNodeMaxIndex=function e(){return this._storage.nodes.getMaxIndex()};po.prototype.getEdgeMaxIndex=function e(){return this._storage.edges.getMaxIndex()};po.prototype.isExcluded=function e(t){var r=this._storage.fetch(t.isNode).getFlexArray("excluded");return r.getMultiple(t._indexes)};po.prototype.setExcluded=function e(t,value){var r=+value;var i=this._storage.fetch(t.isNode);var n=i.getFlexArray("excluded");var a=i.getFlexArray("removed");var o=this._acquireIndexList(t);var s=this._getListClass(t);for(var u=0,l=t._indexes;u<l.length;u+=1){var d=l[u];var h=n.get(d);var f=a.get(d);if(r!==h&&f===0){o.push(d)}}var c=o.sliceAndReset();if(c.length){this._getCacheLists(t).visible.invalidList();var v=new s(c);n.setMultiple(c,r);this._events.fire("excludedStateChange",{elements:v,value:value})}};po.prototype.addElement=function e(t,r,i){if(r===void 0)r={};if(i===void 0)i={};return this._addElements(t,[r],i).get(0)};po.prototype.addGraph=function e(t,r){var i=this;var n=t.nodes;if(n===void 0)n=[];var a=t.edges;if(a===void 0)a=[];if(r===void 0)r={};if(!r.batchSize){return Promise.resolve({nodes:this._addElements(true,n,r),edges:this._addElements(false,a,r)})}else{var o;return this.addElements(true,n,r).then(function(e){o=e;return i.addElements(false,a,r)}).then(function(e){return{nodes:o,edges:e}})}};po.prototype.addElements=function e(t,r,i){var n=this;if(i===void 0)i={};if(!i.batchSize){return Promise.resolve(this._addElements(t,r,i))}else{var a=[];for(var o=0;o<r.length;o+=i.batchSize){a.push(r.slice(o,o+i.batchSize))}return a.reduce(function(e,r){var a=null;return e.then(function(e){a=e;return n._dom.afterNextFrame()}).then(function(){return n._addElements(t,r,i)}).then(function(e){return a.concat(e)})},Promise.resolve(this.getEmptyList(t)))}};po.prototype.getEmptyList=function e(t){return t?new this.NodeList:new this.EdgeList};po.prototype._addElements=function e(t,r,i){var n=this;var a=this._storage.fetch(t);var o=[];var s=[];var u=[];var l=[];var d=new Ot;var h=i.virtual;if(h===void 0)h=false;for(var f=0;f<r.length;++f){var c=r[f];if(typeof c!=="object"||c===null||Array.isArray(c)){throw new Error(c+" is not a valid "+(t?"node":"edge"))}var v=yo(c.id);if(!a.getIndex(v,false)&&!d.has(v)){s.push(v);o.push(c);d.add(v);if(!t){var g=n._getExtremityIndex(v,c.source,"source");var p=n._getExtremityIndex(v,c.target,"target");u.push(g);l.push(p)}}}var _=a.addElements(s);if(t){this._neighborTable.reserve(_.length);for(var y=0;y<_.length;++y){n._neighborTable.addEntry(_[y])}}else{this._parallelTable.reserve(_.length/2|0);for(var m=0;m<_.length;++m){var x=_[m];var b=u[m];var S=l[m];n._sourceList.set(x,b);n._targetList.set(x,S);mo(n,x)}}var A=a.getFlexArray("object");var E=a.getFlexArray("excluded");var w=a.getFlexArray("removed");var T=a.getFlexArray("virtual");var k=this._getElementClass(t);var C=this._getListClass(t);var I=this._getCacheLists(t);var M=new C(_);for(var L=0,F=_;L<F.length;L+=1){var N=F[L];A.set(N,new k(N))}E.setMultiple(_,0);w.setMultiple(_,0);T.setMultiple(_,h);I.visible.invalidList();I.all.invalidList();I._all.invalidList();if(!h){I.raw.invalidList()}var z={virtual:h,objects:o};z[t?"nodes":"edges"]=M;if(M.size){this._events.fire(t?"addNodes":"addEdges",z)}return M};po.prototype._getExtremityIndex=function e(t,r,i){if(r instanceof this.Node){return r._index}else{var n=this._storage.nodes.getIndex(r);if(!n){throw new Error("addEdge(s): invalid "+i+' for edge "'+t+'"; node "'+r+'" does not exist')}return n}};po.prototype.removeElements=function e(t,r,i,n){var a=this;if(i===void 0)i={};if(n===void 0)n=false;if(!Array.isArray(r)&&!(r instanceof(t?this.NodeList:this.EdgeList))){r=[r]}var o=this._getElements(t,r);if(!n){o=o.dedupe()}if(!o.size){return Promise.resolve()}if(t){var s=o.getAdjacentEdges({filter:"all"});this.removeElements(false,s,i,true)}var u=i.virtual;if(u===void 0)u=false;var l=o._indexes;var d=this._getStorage(t);var h=this._getCacheLists(t);var f=d.getFlexArray("removed");var c=d.getFlexArray("virtual");var v=rt(c.getMultiple(l));h.visible.invalidList();h.all.invalidList();if(!u){h.raw.invalidList()}var g={virtual:u};g[t?"nodes":"edges"]=o;this._events.fire(t?"beforeRemoveNodes":"beforeRemoveEdges",g);this.setExcluded(o,true);f.setMultiple(l,1);if(!t){for(var p=0;p<l.length;++p){xo(a,l[p])}}d.removeElements(l);this._indexFreeStep=1;this._events.fire(t?"removeNodes":"removeEdges",g);return Promise.resolve()};po.prototype.getNodes=function e(t){return this._getElements(true,t)};po.prototype.getEdges=function e(t){return this._getElements(false,t)};po.prototype._getElements=function e(t,r){var i=this._getListClass(t);if(!r||typeof r==="string"){var n=r||"visible";var a=this._getCacheLists(t);var o=a[n];if(!o){throw new Error('getNodes/getEdges: unexpected argument "'+n+'"')}return new i(o.getList())}else{var s=this._acquireIndexList(t);var u=this._getStorage(t);var l=this._getElementClass(t);if(r instanceof l){s.push(r._index)}else if(T(r)){for(var d=0,h=r;d<h.length;d+=1){var f=h[d];if(f instanceof l){s.push(f._index)}else{var c=u.getIndex(f);if(c){s.push(c)}}}}else if(r instanceof i){var v=this._getFilter(t,"all");for(var g=0,p=r._indexes;g<p.length;g+=1){var _=p[g];if(v.match(_)){s.push(_)}}}return new i(s.sliceAndReset())}};po.prototype.getNode=function e(t){return this._getElement(true,t)};po.prototype.getEdge=function e(t){return this._getElement(false,t)};po.prototype._getElement=function e(t,r){var i=this._getElementClass(t);if(r instanceof i){return r}else{var n=this._getStorage(t);var a=this._getObjectList(t);var o=n.getIndex(r);return o?a.get(o):undefined}};po.prototype.createNodeList=function e(t){return new this.NodeList(t)};po.prototype.createEdgeList=function e(t){return new this.EdgeList(t)};po.prototype.clear=function e(){this._events.fire("clear");this._storage.nodes.clear();this._storage.edges.clear();this._init_()};po.prototype.forEachElement=function e(t,r){var i=this._getObjectList(t);for(var n=0;n<t._indexes.length;++n){var a=t._indexes[n];var o=i.get(a);r(o,n)}};po.prototype.mapElements=function e(t,r){var i=new Array(t.size);var n=this._getObjectList(t);for(var a=0;a<t._indexes.length;++a){var o=t._indexes[a];var s=n.get(o);i[a]=r(s,a)}return i};po.prototype.filterElements=function e(t,r){r=r||function(){return true};var i=this._acquireIndexList(t);var n=this._getObjectList(t);var a=this._getListClass(t);for(var o=0;o<t._indexes.length;++o){var s=t._indexes[o];var u=n.get(s);if(u){var l=r(u,o);if(l){i.push(s)}}}return new a(i.sliceAndReset())};po.prototype.splitElements=function e(t,r,i){var n=this._getListClass(t);if(!r){return{valid:t,invalid:new n}}var a=this._acquireIndexList(t);var o=this._acquireIndexList(t);var s=this._getObjectList(t);for(var u=0,l=t._indexes;u<l.length;u+=1){var d=l[u];var h=s.get(d);var f=r(h,i);var c=f?a:o;c.pushUnchecked(d)}return{valid:new n(a.sliceAndReset()),invalid:new n(o.sliceAndReset())}};po.prototype.reduceElements=function e(t,r,i){var n=this._getObjectList(t);var a=i;for(var o=0;o<t._indexes.length;++o){var s=t._indexes[o];var u=n.get(s);a=r(a,u,o)}return a};po.prototype.dedupeElements=function e(t){var r=this._getDeduper(t);var i=this._acquireIndexList(t);var n=this._getListClass(t);for(var a=0,o=t._indexes;a<o.length;a+=1){var s=o[a];if(r.get(s)===0){r.set(s,1);i.push(s)}}return new n(i.sliceAndReset())};po.prototype.inverseElements=function e(t){var r=this._getStorage(t);var i=r.getFlexArray("excluded");var n=r.getMaxIndex();var a=this._getDeduper(t);var o=this._acquireIndexList(t);var s=this._getListClass(t);for(var u=0,l=t._indexes;u<l.length;u+=1){var d=l[u];a.set(d,1)}for(var h=1;h<=n;++h){if(a.get(h)===0&&i.get(h)===0){o.push(h)}}return new s(o.sliceAndReset())};po.prototype.partitionElements=function e(t,r){var i=this._getObjectList(t);var n=this._getListClass(t);var a={};for(var o=0;o<t._indexes.length;++o){var s=t._indexes[o];var u=i.get(s);var l=r(u,o);var d=a[l]||(a[l]=[]);d.push(s)}var h=Object.keys(a);for(var f=0,c=h;f<c.length;f+=1){var v=c[f];a[v]=new n(Uint32Array.from(a[v]))}return a};po.prototype.concatElements=function e(t,r){var i=this._getListClass(t);var n=new Uint32Array(t._indexes.length+r._indexes.length);n.set(t._indexes);n.set(r._indexes,t._indexes.length);return new i(n)};po.prototype.elementsToArray=function e(t){var r=this._getObjectList(t);var i=new Array(t.size);for(var n=0;n<t._indexes.length;++n){i[n]=r.get(t._indexes[n])}return i};po.prototype.getElementsId=function e(t){var r=this._getStorage(t);if(t._isList){var i=new Array(t.size);for(var n=0;n<t._indexes.length;++n){i[n]=r.getId(t._indexes[n])}return i}else{return r.getId(t._index)}};po.prototype._getExtremity=function e(t,r){if(r._isList){var i=this._acquireIndexList(true);for(var n=0,a=r._indexes;n<a.length;n+=1){var o=a[n];i.push(t.get(o))}return new this.NodeList(i.sliceAndReset())}else{return this._nodes.get(t.get(r._index))}};po.prototype.getEdgesSource=function e(t){return this._getExtremity(this._sourceList,t)};po.prototype.getEdgesTarget=function e(t){return this._getExtremity(this._targetList,t)};po.prototype.getElementAt=function e(t,r){var i=this._getObjectList(t);return i.get(t._indexes[r])};po.prototype.sortElements=function e(t,r){var i=this._getListClass(t);var n=this._getObjectList(t);var a=t._indexes.slice();a.sort(function(e,t){var i=n.get(e);var a=n.get(t);return r(i,a)});return new i(a)};po.prototype.createAttribute=function e(t,r){return this._storage.fetch(t).createFlexArray(r)};po.prototype.createNodeAttribute=function e(t){return this.createAttribute(true,t)};po.prototype.createEdgeAttribute=function e(t){return this.createAttribute(false,t)};po.prototype.createAttributes=function e(t){var r=this;t.forEach(function(e){if(e.for!=="edges"){r.createNodeAttribute(e)}if(e.for!=="nodes"){r.createEdgeAttribute(e)}})};po.prototype.getAllAttributes=function e(){return this._storage.nodes.getAllFlexArrays().concat(this._storage.nodes.getAllFlexArrays())};po.prototype.getAttribute=function e(t,r){return this._storage.fetch(t).getFlexArray(r)};po.prototype.getAttributes=function e(t,r){var i=this;return r.map(function(e){return i.getAttribute(t,e)})};po.prototype.getNodeAttribute=function e(t){return this.getAttribute(true,t)};po.prototype.getEdgeAttribute=function e(t){return this.getAttribute(false,t)};po.prototype.getAttributesArrays=function e(t,r,i){if(i===void 0)i={};var n=i.destArrays;var a=i.ids;if(!r){throw new Error("You must provide array of attributes to retrieve the values")}if(!a){a=this._getElements(t,"all")._indexes}return this.getAttributes(t,r).map(function(e,t){return e.getMultiple(a,n?n[t]:undefined)})};po.prototype.getNodeAttributesArrays=function e(t,r){return this.getAttributesArrays(true,t,r)};po.prototype.getEdgeAttributesArrays=function e(t,r){return this.getAttributesArrays(false,t,r)};po.prototype._setExtremities=function e(t,r,i){var n=this;for(var a=0;a<t.length;++a){xo(n,t[a])}if(r){this._sourceList.setMultiple(t,r)}if(i){this._targetList.setMultiple(t,i)}for(var o=0;o<t.length;++o){mo(n,t[o])}};po.prototype.setSource=function e(t,r){if(typeof r!=="object"){r=[r]}var i=this.getNodes(r);this._setExtremities(t._indexes,i._indexes,undefined)};po.prototype.setTarget=function e(t,r){if(typeof sources!=="object"){r=[r]}var i=this.getNodes(r);this._setExtremities(t._indexes,undefined,i._indexes)};po.prototype.getParallelEdges=function e(t,r){var i=this;if(r===void 0)r={};var n=r.filter||"visible";var a=this._acquireIndexList(t);var o=this._getFilter(t,n);for(var s=0,u=t._indexes;s<u.length;s+=1){var l=u[s];var d=i._sourceList.get(l);var h=i._targetList.get(l);var f=So(d,h);var c=i._parallelEdgesIndex[f];var v=i._parallelTable.get(+c);if(v){for(var g=0,p=v;g<p.length;g+=1){var _=p[g];if(o.match(_)){a.push(_)}}}}return new this.EdgeList(a.sliceAndReset())};po.prototype.getEdgesBetweenTwoNodes=function e(t,r){var i=So(t._index,r._index);var n=this._parallelEdgesIndex[i];var a=this._parallelTable.get(+n);return new this.EdgeList(Uint32Array.from(a))};po.prototype.getAdjacentDirections=function e(t){return this._neighborTable.get(t)};po.prototype.getEdgeIndexesInDirection=function e(t){return this._parallelTable.get(t)};po.prototype._collectAdjacentEdges=function e(t,r,i,n){var a=this;var o=r==="out";var s=r==="in";var u=!(o||s);var l=this._acquireIndexList(false);var d=this._getFilter(false,i);var h=n?this._getDeduper(false):this._fakeDeduper;for(var f=0,c=t;f<c.length;f+=1){var v=c[f];var g=a._neighborTable.get(v);for(var p=0,_=g;p<_.length;p+=1){var y=_[p];var m=a._parallelTable.get(y);if(u){for(var x=0,b=m;x<b.length;x+=1){var S=b[x];if(d.match(S)&&h.get(S)===0){l.push(S);h.set(S,1)}}}else{for(var A=0,E=m;A<E.length;A+=1){var w=E[A];var T=a._sourceList.get(w);var k=a._targetList.get(w);var C=k===v;var I=s===C||T===k;if(I&&d.match(w)&&h.get(w)===0){l.push(w);h.set(w,1)}}}}}return l.sliceAndReset()};po.prototype._collectAdjacentNodes=function e(t,r,i,n,a,o){var s=this;var u=r!=="in";var l=r!=="out";var d=this._acquireIndexList(true);var h=this._getFilter(false,i);var f=n?this._getDeduper(true):this._fakeDeduper;if(a){for(var c=0,v=a;c<v.length;c+=1){var g=v[c];d.push(g);f.set(g,1)}}if(o){for(var p=0,_=o;p<_.length;p+=1){var y=_[p];f.set(y,1)}}for(var m=0,x=t;m<x.length;m+=1){var b=x[m];var S=s._neighborTable.get(b);for(var A=0,E=S;A<E.length;A+=1){var w=E[A];var T=s._parallelTable.get(w);for(var k=0,C=T;k<C.length;k+=1){var I=C[k];if(h.match(I)){var M=s._sourceList.get(I);var L=s._targetList.get(I);var F=l&&b===L||u&&b===M;var N=M+L-b;if(F&&f.get(N)===0){d.push(N);f.set(N,1);break}}}}}return d.sliceAndReset()};po.prototype.fastGetNodesAdjacentElements=function e(t){var r=this;var i=this._acquireIndexList(true);var n=this._acquireIndexList(false);for(var a=0,o=t._indexes;a<o.length;a+=1){var s=o[a];var u=r._neighborTable.get(s);for(var l=0,d=u;l<d.length;l+=1){var h=d[l];var f=r._parallelTable.get(h);var c=f[0];var v=r._sourceList.get(c);var g=r._targetList.get(c);i.push(v+g-s);for(var p=0,_=f;p<_.length;p+=1){var y=_[p];n.push(y)}}}return{nodes:new this.NodeList(i.sliceAndReset()),edges:new this.EdgeList(n.sliceAndReset())}};po.prototype.fastGetEdgesAdjacentElements=function e(t){var r=this;var i=this._acquireIndexList(true);var n=this._acquireIndexList(false);for(var a=0,o=t._indexes;a<o.length;a+=1){var s=o[a];var u=r._sourceList.get(s);var l=r._targetList.get(s);var d=So(u,l);var h=r._parallelEdgesIndex[d];var f=r._parallelTable.get(+h);if(f){for(var c=0,v=f;c<v.length;c+=1){var g=v[c];n.push(g)}}i.push(u);i.push(l)}return{nodes:new this.NodeList(i.sliceAndReset()),edges:new this.EdgeList(n.sliceAndReset())}};po.prototype.getAdjacentNodes=function e(t,r){return new this.NodeList(this._getAdjacentElements(true,t._indexes,r))};po.prototype.getAdjacentEdges=function e(t,r){return new this.EdgeList(this._getAdjacentElements(false,t._indexes,r))};po.prototype._getAdjacentElements=function e(t,r,i){if(i===void 0)i={};var n=i.direction;if(n===void 0)n="both";var a=i.filter;if(a===void 0)a="visible";var o=i.policy;if(o===void 0)o="union";var s=i.includeSources;if(s===true){o="include-sources"}else if(s===false){o="exclude-sources"}if(!t){return this._collectAdjacentEdges(r,n,a,true)}else{var u=o==="include-sources"?r:null;var l=o==="exclude-sources"?r:null;return this._collectAdjacentNodes(r,n,a,true,u,l)}};po.prototype.getDegree=function e(t,r){var i=this;var n=this._getDegreeOptions(r);var a=n.direction;var o=n.filter;var s=new Array(t.size);var u=new Array(1);for(var l=0;l<t.size;++l){u[0]=t._indexes[l];s[l]=i._collectAdjacentNodes(u,a,o).length}return s};po.prototype._getDegreeOptions=function e(t){var r={direction:"both",filter:"visible"};if(typeof t==="string"){r.direction=t}else if(t){if(typeof t.direction==="string"){r.direction=t.direction}if(typeof t.filter==="string"){r.filter=t.filter}}return r};po.prototype._degrees=function e(t,r){var i=this;if(r!=="in"&&r!=="out"){return this._neighborTable.sizes(t)}else{var n=new Array(t.length);var a=a==="in";for(var o=0,s=t.length;o<s;o++){n[o]=bo(i,t[o],a)}return n}};po.prototype.getAdjacencyList=function e(t){if(t===void 0)t={};var r=t.directed;if(r===void 0)r=false;var i=t.internalIndexes;if(i===void 0)i=false;var n=t.weight;if(n===void 0)n=1;var a=t.nodes;var o=t.indexes;return go(this,{directed:r,weight:n,ids:!i,nodes:o||this.getNodes(a)._indexes})};po.prototype.getConnectedComponents=function e(t,r){return Ao(this,t._indexes,r)};po.prototype.getConnectedComponentByNode=function e(t,r){return Ao(this,[t._index],r)};po.prototype.generateUnusedNodeId=function e(){return _o()};po.prototype.generateUnusedEdgeId=function e(){return _o()};po.prototype._makeFilters=function e(t){var r=this._getStorage(t);var i=r.getFlexArray("removed");var n=r.getFlexArray("excluded");var a=r.getFlexArray("virtual");return{all:{_removed:i,match:function(e){return this._removed.get(e)===0}},visible:{_excluded:n,match:function(e){return this._excluded.get(e)===0}},raw:{_removed:i,_virtual:a,match:function(e){return this._virtual.get(e)===0&&this._removed.get(e)===0}},_all:{match:function(){return true}}}};po.prototype._makeCacheListsForFilters=function e(t){return{all:this._makeCacheList(t,"all"),visible:this._makeCacheList(t,"visible"),raw:this._makeCacheList(t,"raw"),_all:this._makeCacheList(t,"_all")}};po.prototype._makeCacheList=function e(t,r){var i=(t?this._nodeFilters:this._edgeFilters)[r];var n=this._getStorage(t);return{_self:this,_isNode:t,_storage:n,_filter:i,_list:null,getList:function e(){var t=this;if(!this._list){var r=this._storage.getMaxIndex();var i=this._self._acquireIndexList(this._isNode);i.reset();for(var n=1;n<=r;++n){if(t._filter.match(n)){i.push(n)}}this._list=i.sliceAndReset()}return this._list},invalidList:function e(){this._list=null}}};function _o(){return Math.round(Math.random()*Number.MAX_SAFE_INTEGER)}function yo(e){if(e===undefined){return _o()}else if(typeof e!=="string"&&(typeof e!=="number"||!isFinite(e))){throw new Error(e+" is not a valid id, expected string or number")}return e}function mo(e,t){var r=e._sourceList.get(t);var i=e._targetList.get(t);var n=So(r,i);var a=e._parallelEdgesIndex[n];if(a===undefined){a=e._parallelTable.addEntry();e._parallelEdgesIndex[n]=a;e._neighborTable.addTo(r,a);if(r!==i){e._neighborTable.addTo(i,a)}}e._parallelTable.addTo(a,t)}function xo(e,t){var r=e._sourceList.get(t);var i=e._targetList.get(t);var n=So(r,i);var a=e._parallelEdgesIndex[n];if(e._parallelTable.removeFromAndGetSize(a,t)===0){e._neighborTable.removeFrom(r,a);if(r!==i){e._neighborTable.removeFrom(i,a)}e._parallelEdgesIndex[n]=undefined}}function bo(e,t,r){var i=e._neighborTable.get(t);var n=0;for(var a=0;a<i.length;++a){var o=e._parallelTable.get(i[a]);for(var s=0;s<o.length;++s){var u=o[s],l=e._sourceList.get(u),d=e._targetList.get(u);if(r&&d===t||!r&&l===t){n+=1;break}}}return n}function So(e,t){var r=e<t?e:t;var i=e+t-r;return r*67108864+i}function Ao(e,t,r){if(r===void 0)r={};var i=r.filter;if(i===void 0)i="visible";var n=r.returnIds;if(n===void 0)n=false;var a=r.internalIndexes;if(a===void 0)a=false;var o=[];var s={};var u=e._acquireIndexList(true);var l=e._getFilter(true,i);for(var d=0,h=t;d<h.length;d+=1){var f=h[d];if(l.match(f)){u.push(f)}}var c=u.sliceAndReset();var v={filter:i};for(var g=0;g<c.length;g++){var p=c[g];if(!s[p]){var _=[p];var y=[];while(_.length!==0){var m=_.pop();if(!s[m]){_.push.apply(_,e._getAdjacentElements(true,[m],v));s[m]=1;y.push(m)}}if(y.length>0){o.push(y)}}}if(n){var x=e.getNodeAttribute("id");for(var b=0;b<o.length;b++){o[b]=x.getMultiple(o[b])}}else if(!a){for(var S=0;S<o.length;S++){o[S]=new e.NodeList(o[S])}}return o}Ogma.extend(function(e){var t=e.modules.graph;var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;r.prototype.toList=function(){return new n(new Uint32Array([this._index]))};i.prototype.toList=function(){return new a(new Uint32Array([this._index]))};n.prototype.toList=function(){return this};a.prototype.toList=function(){return this};n.prototype.toArray=function(){return t.elementsToArray(this)};n.prototype.clone=function(){return new n(this._indexes.slice())};a.prototype.toArray=function(){return t.elementsToArray(this)};a.prototype.clone=function(){return new a(this._indexes.slice())};r.prototype.getId=function(){return t.getElementsId(this)};n.prototype.getId=function(){return t.getElementsId(this)};i.prototype.getId=function(){return t.getElementsId(this)};a.prototype.getId=function(){return t.getElementsId(this)};i.prototype.getSource=function(){return t.getEdgesSource(this)};a.prototype.getSource=function(){return t.getEdgesSource(this)};i.prototype.getTarget=function(){return t.getEdgesTarget(this)};a.prototype.getTarget=function(){return t.getEdgesTarget(this)};i.prototype.getExtremities=function(){return new n(Uint32Array.from([this.getSource()._index,this.getTarget()._index]))};a.prototype.getExtremities=function(){return this.getSource().concat(this.getTarget())};i.prototype.setSource=function(e){t.setSource(this,e)};i.prototype.setTarget=function(e){t.setTarget(this,e)};n.prototype.get=function(e){return t.getElementAt(this,e)};n.prototype.forEach=function(e){return t.forEachElement(this,e)};n.prototype.map=function(e){return t.mapElements(this,e)};n.prototype.filter=function(e){return t.filterElements(this,e)};n.prototype.reduce=function(e,r){return t.reduceElements(this,e,r)};n.prototype.concat=function(e){return t.concatElements(this,e)};n.prototype.dedupe=function(){return t.dedupeElements(this)};r.prototype.slice=function(){return this.toList()};i.prototype.slice=function(){return this.toList()};n.prototype.slice=function(e,t){return new n(this._indexes.slice(e,t))};a.prototype.get=function(e){return t.getElementAt(this,e)};a.prototype.forEach=function(e){t.forEachElement(this,e)};a.prototype.map=function(e){return t.mapElements(this,e)};a.prototype.filter=function(e){return t.filterElements(this,e)};a.prototype.reduce=function(e,r){return t.reduceElements(this,e,r)};a.prototype.concat=function(e){return t.concatElements(this,e)};a.prototype.dedupe=function(){return t.dedupeElements(this)};n.prototype.partition=function(e){return t.partitionElements(this,e)};a.prototype.partition=function(e){return t.partitionElements(this,e)};a.prototype.slice=function(e,t){return new a(this._indexes.slice(e,t))};n.prototype.indexOf=function(e){if(!(e instanceof r)){return-1}return this._indexes.indexOf(e._index)};a.prototype.indexOf=function(e){if(!(e instanceof i)){return-1}return this._indexes.indexOf(e._index)};n.prototype.includes=function(e){return this.indexOf(e)!==-1};a.prototype.includes=function(e){return this.indexOf(e)!==-1};n.prototype.sort=function(e){return t.sortElements(this,e)};a.prototype.sort=function(e){return t.sortElements(this,e)};n.prototype.inverse=function(){return t.inverseElements(this)};a.prototype.inverse=function(){return t.inverseElements(this)};function o(e){if(typeof e!=="object"||e===null){e={}}var t=typeof e.data==="function"?e.data:function(e){return e};var r=Array.isArray(e.attributes)?e.attributes:undefined;return{attributes:r,data:t}}r.prototype.toJSON=function(e){var t=o(e);var r=t.attributes;var i=t.data;return{id:this.getId(),attributes:this.getAttributes(r),data:i(U(this.getData()))}};n.prototype.toJSON=function(e){if(e===void 0)e={};return this.map(function(t){return t.toJSON(e)})};i.prototype.toJSON=function(e){if(e===void 0)e={};var t=o(e);var r=t.attributes;var i=t.data;return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(r),data:i(U(this.getData()))}};a.prototype.toJSON=function(e){if(e===void 0)e={};return this.map(function(t){return t.toJSON(e)})};r.prototype.get=function(e){return e===0?this:undefined};i.prototype.get=function(e){return e===0?this:undefined}});Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new wo(e);e.modules.data=a;e.events.onNodeDataChange=function(t){e.modules.events.on("updateNodeData",t);return e.events};e.events.onEdgeDataChange=function(t){e.modules.events.on("updateEdgeData",t);return e.events};t.prototype.setData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value);return this};t.prototype.getData=function(e){Eo(arguments.length);return a.getProperty(this,e)[0]};r.prototype.setData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value);return this};r.prototype.getData=function(e){Eo(arguments.length);return a.getProperty(this,e)[0]};i.prototype.setData=function(e,t){if(arguments.length<2){t=e;e=null}if(typeof t!=="function"&&!T(t)){throw new Error("invalid argument "+t+"; expected array or function")}a.setProperty(this,e,t,{dispatch:true});return this};i.prototype.fillData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value,{dispatch:false});return this};i.prototype.getData=function(e){Eo(arguments.length);return a.getProperty(this,e)};n.prototype.setData=function(e,t){if(arguments.length<2){t=e;e=null}if(typeof t!=="function"&&!T(t)){throw new Error("invalid argument "+t+"; expected array or function")}a.setProperty(this,e,t,{dispatch:true});return this};n.prototype.fillData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value,{dispatch:false});return this};n.prototype.getData=function(e){Eo(arguments.length);return a.getProperty(this,e)}});function Eo(e){if(e>1){Ja("getData: more than one argument were specified, you probably want to "+"use a single array argument instead of multiple arguments")}}var wo=function e(t){var r=this;this._dom=t.modules.dom;this._graph=t.modules.graph;this._events=t.modules.events;this._nodeChanges=[];this._edgeChanges=[];this._nodeDataList=this._graph.createAttribute(true,{name:"data",storage:"any"});this._edgeDataList=this._graph.createAttribute(false,{name:"data",storage:"any"});this._nodeList=this._graph.getAttribute(true,"object");this._edgeList=this._graph.getAttribute(false,"object");this._events.register(["setData","updateNodeData","updateEdgeData"]);this._tmp=new Array(2);this._triggerEvents=false;this._events.on({"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=e.objects;var a=t||i;var o=a.isNode;var s=a.size;var u=a._indexes;var l=r[o?"_nodeDataList":"_edgeDataList"];for(var d=0;d<s;++d){l.set(u[d],n[d].data)}},beforeNewFrame:function(){if(r._triggerEvents){r._triggerEvents=false;ko(r)}}})};wo.prototype.setProperty=function e(t,r,value,i){if(i===void 0)i={};var n=i.dispatch;if(n===void 0)n=false;Lo(this,t.isNode,t._indexes,r,value,n);this._events.fire("setData",{elements:t})};wo.prototype.getProperty=function e(t,r){return No(this,t.isNode,t._indexes,r)};function To(e){e._triggerEvents=true;e._dom.refresh()}function ko(e){var t=Co(e,true);var r=Co(e,false);e._events.fire("updateNodeData",t);e._events.fire("updateEdgeData",r)}function Co(e,t){var r;var i=t?e._graph.NodeList:e._graph.EdgeList;var n=t?"_nodeChanges":"_edgeChanges";var a=[];var o=e[n];e[n]=[];for(var s=0;s<o.length;++s){var u=o[s];a.push.apply(a,u.indexes);u[t?"nodes":"edges"]=new i(u.indexes);delete u.indexes}return r={},r[t?"nodes":"edges"]=new i(a).dedupe(),r.isNode=t,r.changes=o,r}function Io(e,t){for(var r=0;r<e.length;++r){var i=e[r],n=i.property;if(t===null&&n===null){return i}else if(t&&n&&n.length===t.length){var a=true;for(var o=0;o<n.length;++o){if(n[o]!==t[o]){a=false;break}}if(a){return i}}}var s={property:t&&t.slice(),indexes:[],previousValues:[],newValues:[]};e.push(s);return s}function Mo(e){if(typeof e==="string"){return e.split(".")}else if(T(e)){return e}else if(e===undefined||e===null){return null}else{return[e.toString()]}}function Lo(e,t,r,i,value,n){if(n&&typeof value==="function"){n=false}i=Mo(i);var a=typeof value==="function",o=t?e._nodeList:e._edgeList,s=t?e._nodeDataList:e._edgeDataList,u=t?e._nodeChanges:e._edgeChanges,l=Io(u,i);for(var d=0;d<r.length;++d){var h=r[d],f=s.get(h),c=o.get(h),v=n?value[d]:value,g=void 0,p=void 0;if(i===null){g=f;p=a?v(c):v;s.set(h,p)}else{if(f===null||f===undefined){f={};s.set(h,f)}Fo(f,i,v,a,c,e._tmp);g=e._tmp[0];p=e._tmp[1]}l.indexes.push(h);l.previousValues.push(g);l.newValues.push(p)}To(e)}function Fo(e,t,value,r,i,n){var a=t.length-1;for(var o=0;o<a;++o){var s=t[o],u=e[s];if(u===null||u===undefined){u={};e[s]=u}e=u}var l=t[a],d=e[l],h=r?value(i):value;e[l]=h;n[0]=d;n[1]=h}function No(e,t,r,i,n){i=Mo(i);if(!n){n=new Array(r.length)}var a=t?e._nodeDataList:e._edgeDataList;for(var o=0;o<r.length;++o){var s=r[o],u=a.get(s);n[o]=zo(u,i)}return n}function zo(e,t){if(t===null||!t.length){return e}else if(e===undefined||e===null){return undefined}var r=t.length-1;for(var i=0;i<r;++i){var n=t[i];e=e[n];if(e===null||e===undefined){return undefined}}return e[t[r]]}var Po={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){if((e*=2)<1){return.5*e*e*e}return.5*((e-=2)*e*e+2)}};var Oo={duration:0,easing:"linear",callback:function(){},startAfter:0};Ogma.extend(function(e){return e.modules.animations=new Do(e)});var Do=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._animationList=[];this._events.on("beforeNewFrame",function(){return r._updateAnimations()})};Do.prototype._updateAnimations=function e(){var t=this;if(this._animationList.length===0){return true}var r=tr();var i=[];for(var n=0;n<this._animationList.length;++n){var a=t._animationList[n],o=(r-a.creationDate)/a.duration,s=a.startAfter,u=a.easing(o);if(o>=1){a.func(1);a.done=true;t._animationList.splice(n,1);n-=1;i.push(a.callback)}else if(u>=s){var l=1/(1-s);u=(u-s)*l;a.func(u)}}for(var d=0;d<i.length;++d){i[d](false)}this._dom.refresh()};Do.prototype.play=function e(t,r){var i=to(r,Oo);var n=i.duration;var a=i.easing;var o=i.callback;var s=i.startAfter;var u=null;if(n<=0){t(1);o()}else{u={func:t,easing:typeof a==="function"?a:Po[a],duration:n,callback:o,startAfter:s,creationDate:tr(),done:false};this._animationList.push(u);this._dom.refresh()}return u};Do.prototype.end=function e(t,r){if(r===void 0)r=true;var i=this._animationList.indexOf(t);if(i!==-1){t.func(1);this._animationList.splice(i,1);t.done=true;if(r){t.callback(true)}}};var Ro=1e-8;var Bo=1e8;var jo={duration:0,easing:"linear",startAfter:0,ignoreZoomLimits:false};function Uo(e){return Math.abs(e)<1e-9}Ogma.extend(function(e){var t=new Go(e);var r=e.modules;var i=e.view;var n=e.Node;var a=e.Edge;r.camera=t;i.setZoom=function(e,r){return t.setZoom(e,r)};i.zoomIn=function(e,r){return t.zoomIn(e,r)};i.zoomOut=function(e,r){return t.zoomOut(e,r)};i.getZoom=function(){return t.getZoom()};i.setCenter=function(e,r){return t.setCenter(e,r)};i.move=function(e,r){return t.move(e,r)};i.getCenter=function(){return t.getCenter()};i.setAngle=function(e,r){return t.setAngle(e,r)};i.rotate=function(e,r){return t.rotate(e,r)};i.getAngle=function(){return t.getAngle()};i.set=function(e,r){return t.setView(e,r)};i.get=function(){return t.getView()};i.graphToScreenCoordinates=function(e){return t.graphToScreenCoordinates(e)};i.screenToGraphCoordinates=function(e){return t.screenToGraphCoordinates(e)};i.getSize=function(){return{width:t.width,height:t.height}};e.events.onZoomProgress=function(t){r.events.on("cameraZoom",t);return e.events};e.events.onViewChanged=function(t){r.events.on("viewChanged",t);return e.events};n.prototype.isInView=function(e){return t.isElementInView(this,e)};a.prototype.isInView=function(e){return t.isElementInView(this,e)}});var Vo=50;var Go=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._dom=t.modules.dom;this._animations=t.modules.animations;this._settings=t.modules.settings;this._zoomAnimation=null;this._moveAnimation=null;this._reset();this._minZoom=Ro;this._maxZoom=Bo;this._events.register(["cameraMove","cameraPan","cameraZoom","cameraRotate","viewChanged","startZoom"]);this._settings.register("minZoom",Ro,function(e){r._minZoom=e;if(r._zoom<e){r._zoom=e;r._events.fire("cameraMove")}});this._settings.register("maxZoom",Bo,function(e){r._maxZoom=e;if(r._zoom>e){r._zoom=e;r._events.fire("cameraMove")}});this._timeout=null;this._moveEnd=function(e){if(r._timeout){r._dom.clearTimeout(r._timeout)}r._timeout=r._dom.setTimeout(function(){r._timeout=null;r._events.fire("viewChanged",{type:e})},Vo)};this._events.on({setContainer:function(){r._reset();r._events.fire("cameraMove")},resize:function(){r.reloadDimensions();r._events.fire("cameraMove")}})};var Wo={x:{configurable:true},y:{configurable:true},zoom:{configurable:true},angle:{configurable:true},width:{configurable:true},height:{configurable:true}};Wo.x.get=function(){return this._x};Wo.y.get=function(){return this._y};Wo.zoom.get=function(){return this._zoom};Wo.angle.get=function(){return this._angle};Wo.width.get=function(){return this._dimensions.width};Wo.height.get=function(){return this._dimensions.height};Go.prototype.getCenter=function e(){return{x:this._x,y:this._y}};Go.prototype.setCenter=function e(t,r){var i=this;var n=t.x;var a=t.y;r=to(r,jo);var o=this._x;var s=this._y;var u=n-this._x;var l=a-this._y;if(Uo(u)&&Uo(l)){return Promise.resolve()}return new Promise(function(e){var t=function(e){i._x=o+u*e;i._y=s+l*e;i._events.fire("cameraMove");i._events.fire("cameraPan")};r.callback=Ho(i,e,"pan");if(i._moveAnimation){i._animations.end(i._moveAnimation)}i._moveAnimation=i._animations.play(t,r)})};Go.prototype.move=function e(t,r){var i=t.x;var n=t.y;var a=Xo(this,{x:i,y:n});return this.setCenter({x:this._x+a.x,y:this._y+a.y},r)};Go.prototype.getZoom=function e(){return this._zoom};Go.prototype.setZoom=function e(t,r,i){var n=this;if(i===void 0)i={};var a=i.refX;var o=i.refY;r=to(r,jo);var s=this._minZoom;var u=this._maxZoom;var l=it(t,s,u);if(!r.ignoreZoomLimits){l=this._applyZoomLimits(l)}if(Uo(this._zoom-l)){return Promise.resolve()}return new Promise(function(e){var t=n._dimensions.width/2;var i=n._dimensions.height/2;var s=n._zoom;var u=t/s-t/l;var d=function(e){n._zoom=t/(t/s-u*e);n._events.fire("cameraMove");n._events.fire("cameraZoom")};r.callback=Ho(n,e,"zoom");if(a!==undefined&&o!==undefined){var h=(a-t)/s-(a-t)/l;var f=(o-i)/s-(o-i)/l;var c=n._cosAngle;var v=n._sinAngle;var g=c*h-v*f;var p=v*h+c*f;n.setCenter({x:n._x+g,y:n._y+p},r)}if(n._zoomAnimation){n._animations.end(n._zoomAnimation)}n._dom.setTimeout(function(){n._events.fire("startZoom",{duration:r.duration,easing:r.easing,startZoom:s,endZoom:l})});n._zoomAnimation=n._animations.play(d,r)})};Go.prototype._applyZoomLimits=function e(t){var r=this._settings.get("interactions.zoom.minValue");var i=this._settings.get("interactions.zoom.maxValue");var n=this._ogma.view.getGraphBoundingBox();var a=this._ogma.view.getZoom();var o=this._ogma.view.getSize();var s=t;if(!isNaN(n.cx)){var u={smallestNodeSize:n.minScaledSize,biggestNodeSize:n.maxScaledSize,graphWidth:n.width,graphHeight:n.height,viewWidth:o.width,viewHeight:o.height};var l=r&&r(u);var d=i&&i(u);if(qo(l)&&s<l){if(s<a){s=Math.min(a,l)}}else if(qo(d)&&s>d){if(s>a){s=Math.max(a,d)}}}return s};Go.prototype.zoomIn=function e(t,r,i){if(typeof t!=="number"){i=r;r=t;t=this._settings.get("interactions.zoom.modifier")}return this.setZoom(this._zoom*t,r,i)};Go.prototype.zoomOut=function e(t,r,i){if(typeof t!=="number"){i=r;r=t;t=this._settings.get("interactions.zoom.modifier")}return this.setZoom(this._zoom/t,r,i)};Go.prototype.getAngle=function e(){return this._angle};Go.prototype.setAngle=function e(t,r){var i=this;r=to(r,jo);var n=this._angle;var a=t-n;if(Uo(a)){return Promise.resolve()}return new Promise(function(e){var t=function(e){i._angle=n+a*e;while(i._angle>Math.PI){i._angle-=2*Math.PI}while(i._angle<-Math.PI){i._angle+=2*Math.PI}i._sinAngle=Math.sin(i._angle);i._cosAngle=Math.cos(i._angle);i._events.fire("cameraMove");i._events.fire("cameraRotate")};r.callback=Ho(i,e,"rotate");if(i._rotateAnimation){i._animations.end(i._rotateAnimation)}i._rotateAnimation=i._animations.play(t,r)})};Go.prototype.rotate=function e(t,r){return this.setAngle(this._angle+t,r)};Go.prototype.getScreenCenter=function e(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}};Go.prototype.graphToScreenCoordinates=function e(t,r){var i=t.x;var n=t.y;if(r===void 0)r={};var a=this._dimensions.width/2;var o=this._dimensions.height/2;var s=(i-this._x)*this._zoom+a;var u=(n-this._y)*this._zoom+o;return jr(s,u,a,o,-this._angle,r)};Go.prototype.screenToGraphCoordinates=function e(t,r){var i=t.x;var n=t.y;if(r===void 0)r={};var a=this._x+(i-this._dimensions.width/2)/this._zoom;var o=this._y+(n-this._dimensions.height/2)/this._zoom;return jr(a,o,this._x,this._y,this._angle,r)};Go.prototype.projectBounds=function e(t,r){if(r===void 0)r=t;var i=t[0];var n=t[1];var a=t[2];var o=t[3];var s=this._x,u=this._y;var l=this._dimensions.width/2;var d=this._dimensions.height/2;var h=this._sinAngle,f=this._cosAngle,c=1/this._zoom;var v=Infinity;var g=Infinity;var p=-Infinity;var _=-Infinity;var y=[i,n,i,o,a,o,a,n];for(var m=0;m<y.length;m+=2){var x=y[m];var b=y[m+1];x=s+(x-l)*c;b=u+(b-d)*c;var S=x-s;var A=b-u;x=f*S-h*A+s;b=h*S+f*A+u;if(x<v){v=x}if(x>p){p=x}if(b<g){g=b}if(b>_){_=b}}r[0]=v;r[1]=g;r[2]=p;r[3]=_;return r};Go.prototype.screenToGraphVector=function e(t){var r=t.x;var i=t.y;return Xo(this,{x:r,y:i})};Go.prototype.getView=function e(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}};Go.prototype.setView=function e(t,r){var i=to(t,{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle});var n=i.x;var a=i.y;var o=i.zoom;var s=i.angle;this.setCenter({x:n,y:a},r);this.setZoom(o,r);return this.setAngle(s,r)};Go.prototype.reloadDimensions=function e(){this._dimensions=this._dom.getDimensions()};Go.prototype.animationInProgress=function e(){var t=this._moveAnimation;var r=this._zoomAnimation;return t&&!t.done||r&&!r.done};Go.prototype.getProjectedScreenBounds=function e(t){if(t===void 0)t=0;var r=this._dimensions;var i=r.width;var n=r.height;var a=Math.max(i,n)*t;return this.projectBounds([0-a,0-a,i+a,n+a])};Go.prototype.isElementInView=function e(t,r){if(r===void 0)r={};var i=r.margin;if(i===void 0)i=0;var n={minX:-i,minY:-i,maxX:this._dimensions.width+i,maxY:this._dimensions.height+i};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)};Go.prototype.isNodeInRectangle=function e(t,r){var i=t.getPositionOnScreen();var n=t.getAttribute("radius")*this._zoom;var a=i.x-n;var o=i.y-n;var s=i.x+n;var u=i.y+n;return s>=r.minX&&a<=r.maxX&&u>=r.minY&&o<=r.maxY};Go.prototype.isEdgeInRectangle=function e(t,r){var i=t.getAttribute("curvature");var n=t.getSource();var a=t.getTarget();var o=n.getPositionOnScreen();var s=[];if(n===a){var u=(i+n.getAttribute("radius"))*_n*this._zoom;var l=o.x;var d=o.y;var h=l-u;var f=d;var c=l;var v=d+u;s.push(o,da(.2,l,d,l,d,h,f,c,v),da(.4,l,d,l,d,h,f,c,v),da(.6,l,d,l,d,h,f,c,v),da(.8,l,d,l,d,h,f,c,v),o)}else{var g=a.getPositionOnScreen();var p=g.x-o.x;var _=g.y-o.y;var y=Math.sqrt(p*p+_*_);var m=(o.x+g.x)/2;var x=(o.y+g.y)/2;var b=_/y;var S=-p/y;var A=i*(y/pn)*2;var E=m+b*A;var w=x+S*A;s.push(o,sa(.25,o.x,o.y,g.x,g.y,E,w),sa(.5,o.x,o.y,g.x,g.y,E,w),sa(.75,o.x,o.y,g.x,g.y,E,w),g)}for(var T=0;T<s.length-1;++T){var k=s[T],C=s[T+1];if(li(k.x,k.y,C.x,C.y,r.minX,r.minY,r.maxX,r.maxY)){return true}}return false};Go.prototype._reset=function e(){this._zoom=1;this._x=0;this._y=0;this._angle=0;this._sinAngle=0;this._cosAngle=1;this._dimensions=this._dom.getDimensions()};Object.defineProperties(Go.prototype,Wo);function Ho(e,t,r){return function(){e._moveEnd(r);t(r)}}function Xo(e,t){var r=t.x;var i=t.y;r/=e._zoom;i/=e._zoom;var n=e._sinAngle;var a=e._cosAngle;return{x:a*r-n*i,y:n*r+a*i}}function qo(value){return typeof value==="number"&&isFinite(value)}function Yo(e){var t=e.filter(function(e){return isFinite(e)&&e>0});var r=t.length?ot(t):1;return r}var Zo=1;var Ko=2;var Qo=3;var Jo=1;var $o=2;var es=3;var ts=4;var rs=5;var is=6;var ns=1;var as=2;var os=3;var ss=4;var us=5;var ls=1;var ds=2;var hs=3;var fs={};fs[$o]="image";fs[ts]="pieChart";fs[es]="text";fs[rs]="icon";var cs=function e(){this._version=0;this._init_()};cs.prototype.reset=function e(){this._init_()};cs.prototype._init_=function e(){this._mustUpdate=true;this._nextPatternId=1;this._patterns=[null];this._patternsByHash={};this._pixelRatio=1;this._nullPattern={type:Jo,attributes:{}}};cs.prototype._increaseNextId=function e(){var t=this;var r=this._nextPatternId++;if(r%256===255){r=this._nextPatternId++}while(this._patterns.length<=r){t._patterns.push(undefined)}return r};cs.prototype._createPattern=function e(t){var r=t.type;var i=t.attributes;var n={id:this._increaseNextId(),type:r,attributes:this._cloneAttributes(r,i)};this._patterns[n.id]=n;this._mustUpdate=true;return n};cs.prototype._cloneAttributes=function e(t,r){if(t===$o){return{image:r.image,scaled:r.scaled,duplicated:r.duplicated}}else if(t===es||t===rs){return{font:r.font,size:r.size,style:r.style,text:r.text,align:r.align||"center",offset:r.offset||0}}else if(t===ts){return{colors:r.colors,colorArray:r.colors.split(";").map(function(e){return e.trim()})}}};cs.prototype.getPatternList=function e(){return this._patterns.filter(function(e){return e})};cs.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};cs.prototype.setPixelRatio=function e(value){if(value!==this._pixelRatio){this._pixelRatio=value;this._mustUpdate=true}};cs.prototype.getPixelRatio=function e(){return this._pixelRatio};cs.prototype.notifyUpdate=function e(){this._mustUpdate=true};cs.prototype.getIdFromDefinition=function e(t){var r=t.type;var i=t.attributes;var n=r===es||r===rs;var a=r&&r!==Jo&&r!==is&&(r!==$o||i.image)&&(!n||i.text&&i.font);var o=0;if(a){o=this._addPattern(t);if(n&&i.style==="normal"){i.style="bold";this._addPattern(t)}}return o};cs.prototype._addPattern=function e(t){var r=this._getPatternHash(t);var i=this._patternsByHash[r];if(!i){if(this._nextPatternId>65500){Ja("maximum number of pattern exceeded")}else{i=this._createPattern(t).id;this._patternsByHash[r]=i}}return i};cs.prototype._getPatternHash=function e(t){var r=t.type;var i=t.attributes;var n=[fs[r]];if(r===$o){n.push(i.scaled?"scaled":"non-scaled",i.duplicated?"duplicated":"non-duplicated",i.image.src||i.image.toDataURL())}else if(r===es){n.push(i.text,i.font,i.style,i.size,i.align||"center",i.offset||0)}else if(r===rs){n.push(i.text,i.font,i.style,i.size)}else{n.push(i.colors)}return n.join("+")};cs.prototype.getDefinitionFromId=function e(t){return t?this._patterns[t]:this._nullPattern};cs.prototype.getVersion=function e(){return this._version};var vs=function e(){var t=this;this._version=0;this._mustUpdate=true;this._byName={};this._byId=[null];Object.keys(As).forEach(function(e){t.register(e,As[e])})};vs.prototype.register=function e(t,r){var i=r.getDistanceFromStrokeVertically;var n=r.getDistanceFromStrokeHorizontally;var a=r.points;var o={id:this._byId.length,name:t,getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n,points:a.slice()};this._mustUpdate=true;this._byId.push(o);this._byName[t]=o;return o};vs.prototype.getIdFromName=function e(t){return this._byName[t].id};vs.prototype.getNameFromId=function e(t){return t?this._byId[t].name:null};vs.prototype.getDefinitionFromName=function e(t){return this._byName[t]||null};vs.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};vs.prototype.getVersion=function e(){return this._version};vs.prototype.getShapeList=function e(){return this._byId};function gs(e,t){return Math.sqrt(e*e+t*t)}var ps=1e-5;function _s(e,t,r){var i=Infinity;var n=0;var a=0;for(var o=0;o<r.length;++o){var s=r[o];var u=r[(o+1)%r.length];var l=s.x;var d=s.y;var h=u.x;var f=u.y;var c=h-l;var v=f-d;var g=l;var p=d;if(c===0){p=t}else if(v===0){g=e}else{var _=v/c;var y=-(c/v);g=(l*_-e*y+t-d)/(_-y);p=_*g+d-l*_}var m=gs(g-e,p-t);var x=gs(l-h,d-f);var b=gs(l-g,d-p);var S=gs(h-g,f-p);var A=b+S<=x+ps;if(!A){if(b<S){m=gs(l-e,d-t);g=l;p=d}else{m=gs(h-e,f-t);g=h;p=f}}if(m<i){i=m;n=g;a=p}}var E=gs(e,t);var w=gs(n,a);return i*(E<=w?1:-1)}function ys(e,t){if(t===void 0)t=1;var r=-Math.PI/2+ps;var i=[];var n=Math.PI*2/e;var a=r;for(var o=0;o<e;++o){var s=o%2===1?t:1;i.push({x:Math.cos(a)*s,y:Math.sin(a)*s});a+=n}return i}var ms=ys(4);var xs=ys(5);var bs=ys(10,.4);function Ss(e){return{getDistanceFromStrokeVertically:function(){return 1},getDistanceFromStrokeHorizontally:function(t,r){return _s(t,r,e)},points:e}}var As={circle:{getDistanceFromStrokeVertically:function(e,t){return 1},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.sqrt(e*e+t*t)},points:[{x:0,y:0}]},square:{getDistanceFromStrokeVertically:function(e,t){return 1-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}]},line:{getDistanceFromStrokeVertically:function(e,t){return 1-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1},points:[{x:-1,y:0},{x:1,y:0}]},triangle:{getDistanceFromStrokeVertically:function(e,t){return(1-e)/2-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}]},arrow:{getDistanceFromStrokeVertically:function(e,t){return(1-e)/2-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}]},cross:{getDistanceFromStrokeVertically:function(e,t){return 1},getDistanceFromStrokeHorizontally:function(e,t){var r=Math.abs(e);var i=Math.abs(t);var n=.31-Math.min(r,i);var a=1-Math.max(Math.abs(e),Math.abs(t));return Math.min(n,a)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}]},diamond:Ss(ms),pentagon:Ss(xs),star:Ss(bs)};var Es=function e(t){var r=t.elementSize;var i=t.sideElementSize;var n=t.nbSideElementsPerMainElement;var a=t.id;var o=t.depth;var s=t.elementType;var u=t.animated;var l=t.stencilUsage;this._id=a;this._depth=o;this._elementType=s;this._animated=u;this._stencilUsage=l;this._version=0;this._elementSize=r;this._sideElementSize=i;this._nbSideElementsPerMainElement=n;this._totalSideElementsSize=n*i;this._capacity=Wi;this._byteCapacity=this._capacity*this._elementSize;this._byteArray=new Uint8Array(this._byteCapacity);this._dataView=new DataView(this._byteArray.buffer);this._sideByteCapacity=this._capacity*this._totalSideElementsSize;this._sideByteArray=new Uint8Array(this._sideByteCapacity);this._sideDataView=new DataView(this._sideByteArray.buffer);this._nbCellsAllocated=0;this._nbCellsFreed=0;this._isFullyAllocated=false;this._isFullyFreed=false;this._mustUpdate=true};Es.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false;if(this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated){this._isFullyFreed=true}}};Es.prototype.allocate=function e(t){var r=-1;if(!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity){r=this._nbCellsAllocated;this._nbCellsAllocated+=t;this._mustUpdate=true}else{this._isFullyAllocated=true}return r};Es.prototype.free=function e(t,r){var i=this;for(var n=0;n<r;++n){var a=(t+n)*i._elementSize;if(i._dataView.getUint16(a)===0){throw new Error('"free": invalid address provided')}i._dataView.setUint16(a,0)}this._mustUpdate=true;this._nbCellsFreed+=r};Es.prototype.triggerUpdate=function e(){this._mustUpdate=true};Es.prototype.isEmpty=function e(){return this._nbCellsFreed===this._nbCellsAllocated};Es.prototype.isFullyFreed=function e(){return this._isFullyFreed};Es.prototype.getId=function e(){return this._id};Es.prototype.getDepth=function e(){return this._depth};Es.prototype.getElementType=function e(){return this._elementType};Es.prototype.getDataView=function e(){return this._dataView};Es.prototype.getByteArray=function e(){return this._byteArray};Es.prototype.getElementSize=function e(){return this._elementSize};Es.prototype.isAnimated=function e(){return this._animated};Es.prototype.getCapacity=function e(){return this._capacity};Es.prototype.getSize=function e(){return this._nbCellsAllocated};Es.prototype.getNbSideElementsPerMainElement=function e(){return this._nbSideElementsPerMainElement};Es.prototype.hasSideData=function e(){return this._nbSideElementsPerMainElement>0};Es.prototype.getSideDataView=function e(){return this._sideDataView};Es.prototype.getSideByteArray=function e(){return this._sideByteArray};Es.prototype.getTotalSideElementsSize=function e(){return this._totalSideElementsSize};Es.prototype.getVersion=function e(){return this._version};Es.prototype.getStencilUsage=function e(){return this._stencilUsage};var ws=8;var Ts=function e(){this._version=0;this._blockInfo={buffer:null,offset:0,size:0,address:0};this._init_()};Ts.prototype.reset=function e(){this._init_()};Ts.prototype._init_=function e(){this._buffersByDepth=new Array(100);this._buffersById=[];this._buffersByAscendingDepth=[];this._buffersByDescendingDepth=[];this._mustUpdate=true};Ts.prototype._fillBlockInfo=function e(t,r,i,n){this._blockInfo.buffer=t;this._blockInfo.offset=r;this._blockInfo.size=i;this._blockInfo.address=n;return this._blockInfo};Ts.prototype._createBuffer=function e(t,r,i,n,a){var o=r?fn:dn;var s=this._buffersById.length;var u=new Es({elementSize:o,sideElementSize:cn,nbSideElementsPerMainElement:n,id:s,depth:i,elementType:t,animated:r,stencilUsage:a});this._buffersById.push(u);return u};Ts.prototype.getBlockInfo=function e(t){return this._getBlockInfo(t)};Ts.prototype._getBlockInfo=function e(t){return this._fillBlockInfo(this._buffersById[t>>Yi],(t>>qi)%Wi,t%Hi,t)};Ts.prototype.allocateBlock=function e(t,r,i,n,a,o,s){var u=Cs(o,ws);this._mustUpdate=true;var l=null;var d=-1;if(t){var h=this._getBlockInfo(t);var f=h.buffer;var c=h.offset;var v=h.size;var g=h.size===a;var p=f.getDepth()===n;var _=f.getElementType()===r;var y=f.isAnimated()===i;var m=f.getNbSideElementsPerMainElement()===u;var x=f.getStencilUsage()===s;if(g&&p&&_&&y&&m&&x){f.triggerUpdate();l=f;d=c}else{f.free(c,v)}}if(d===-1){var b=u/ws;var S=this._buffersByDepth[n]||(this._buffersByDepth[n]=new Array(2));var A=S[+i]||(S[+i]=[]);var E=A[r]||(A[r]=new Array(16));var w=E[b]||(E[b]=new Array(4));var T=w[s]||(w[s]=[]);var k=T[T.length-1];if(k){l=k;d=k.allocate(a)}if(d===-1){l=this._createBuffer(r,i,n,u,s);d=l.allocate(a);T.push(l)}}var C=ks(l.getId(),d,a);return this._fillBlockInfo(l,d,a,C)};Ts.prototype.freeBlock=function e(t){if(t){this._mustUpdate=true;var r=this._getBlockInfo(t);r.buffer.free(r.offset,r.size)}return 0};Ts.prototype._sortBuffersByDepth=function e(){var t=this;var r=[];for(var i=0;i<this._buffersByDepth.length;++i){var n=t._buffersByDepth[i];if(!n){continue}for(var a=0;a<n.length;++a){var o=n[a];if(!o){continue}for(var s=0;s<o.length;++s){var u=o[s];if(!u){continue}for(var l=0;l<u.length;++l){var d=u[l];if(!d){continue}for(var h=0;h<d.length;++h){var f=d[h];if(!f){continue}for(var c=0;c<f.length;++c){var v=f[c];v.update();if(v.isFullyFreed()){t._buffersById[v.getId()]=undefined;f.splice(c,1);c-=1}else{r.push(v)}}}}}}}this._buffersByAscendingDepth=r;this._buffersByDescendingDepth=r.slice().reverse()};Ts.prototype.update=function e(){if(this._mustUpdate){this._sortBuffersByDepth();this._version+=1;this._mustUpdate=false}};Ts.prototype.getBuffers=function e(){return this._buffersById};Ts.prototype.getBuffersByAscendingDepth=function e(){return this._buffersByAscendingDepth};Ts.prototype.getBuffersByDescendingDepth=function e(){return this._buffersByDescendingDepth};Ts.prototype.getVersion=function e(){return this._version};function ks(e,t,r){return((e<<Xi)+t<<qi)+r}function Cs(e,t){var value=0;while(value<e){value+=t}return value}function Is(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightTargetRadiusScaled:0,rectHeightTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:false,hasTail:false,isSelfLoop:false,isText:false,adjustTextAngle:false,unusedFlag1:false,unusedFlag2:false}}function Ms(e){e.pieceId=0;e.shape="";e.x1=0;e.y1=0;e.x2=0;e.y2=0;e.rectWidthOrSourceRadiusScaled=0;e.rectWidthOrSourceRadiusFixed=0;e.rectHeightTargetRadiusScaled=0;e.rectHeightTargetRadiusFixed=0;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=0;e.offsetFixed=0;e.pattern.type=0;e.opacity=1;e.fillColor=null;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=0;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=0;e.patternScale=0;e.symbolicSize=0;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false;e.adjustTextAngle=false;e.unusedFlag1=false;e.unusedFlag2=false;return e}function Ls(e){e.duration=0;e.beginTime=-1;e.easing="linear"}function Fs(){return{valid:false,id:undefined,end:Is(),start:Is(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function Ns(e,t,r,i){e.width=t*i;e.height=r*i;e.style.width=t+"px";e.style.height=r+"px"}var zs=function e(t){this._bufferList=t.bufferList;this._shapeManager=t.shapeManager;this._patternManager=t.patternManager;this._boundariesManager=t.boundariesManager;this._textManager=t.textManager;this._colorManager=t.colorManager;this._easingManager=t.easingManager;this._idRecorder=t.idRecorder;this._width=0;this._height=0;this._pixelRatio=0;this._viewX=0;this._viewY=0;this._viewZoom=0;this._viewAngle=0;this._viewAngleCos=0;this._viewAngleSin=0;this._currentTime=0;this._bytesToActualCoord=0;this._bytesToActualScaledSize=0;this._bytesToActualMinVisibleSize=0;this._bytesToActualSymbolicSize=0;this._bytesToActualDashLength=0;this._bytesToActualGapLength=0;this._bytesToActualPatternScale=0;this._shapesVersion=0;this._patternsVersion=0;this._boundariesVersion=0;this._textsVersion=0;this._backgroundColor=null;this._backgroundRgba=[0,0,0,0];this._isBufferDisplayable=null;this._hideImages=false;this._rgbaToString=new Array(65535);this._genericObject=Fs();this._littleEndian=D()};zs.getName=function e(){return null};zs.prototype.getDomElement=function e(){return null};zs.prototype.export=function e(){return Promise.resolve()};zs.prototype._bytesToColor=function e(value){var t=this._rgbaToString[value];if(!t){var r=Ps(value,0,4)/15;var i=Ps(value,4,8)/15;var n=Ps(value,8,12)/15;var a=Ps(value,12,16)/15;t="rgba("+(r*255|0)+", "+(i*255|0)+", "+(n*255|0)+", "+a+")";if(r+i+n+a===0){t=null}this._rgbaToString[value]=t}return t};zs.prototype._unsignedToSignedByte=function e(value){return value-128};zs.prototype._bytesToCoord=function e(value){return value*this._bytesToActualCoord};zs.prototype._bytesToScaledSize=function e(value){return value*this._bytesToActualScaledSize};zs.prototype._bytesToFixedSize=function e(value){return value};zs.prototype._bytesToMinVisibleSize=function e(value){return value*this._bytesToActualMinVisibleSize};zs.prototype._extractGenericObject=function e(t,r,i){var n=r;var a=i;var o=this._littleEndian;var s=n.getUint16(a,o);var u=Ps(s,0,4);var l=Ps(s,4,6);var d=Ps(s,6,8);var h=Ps(s,8,9);var f=Ps(s,9,10);var c=Ps(s,10,16);var v=n.getUint16(a+2,o);var g=Ps(v,0,8);var p=Ps(v,8,11);var _=Ps(v,11,12);var y=Ps(v,12,13);var m=Ps(v,13,14);var x=Ps(v,14,15);var b=Ps(v,15,16);var S=n.getUint16(a+4,o);var A=Ps(S,0,4);var E=Ps(S,4,8);var w=Ps(S,8,12);var T=Ps(S,12,16);var k=n.getUint16(a+6,o);var C=Ps(k,0,8);var I=Ps(k,8,16);var M=n.getUint16(a+8,o);var L=n.getUint16(a+10,o);var F=n.getUint16(a+12,o);var N=n.getUint16(a+14,o);var z=n.getFloat32(a+16,o);var P=n.getFloat32(a+20,o);var O=n.getFloat32(a+24,o);var D=n.getFloat32(a+28,o);var R=n.getUint16(a+32,o);var B=n.getUint16(a+34,o);var j=n.getUint16(a+36,o);var U=n.getUint16(a+38,o);var V=n.getUint16(a+40,o);var G=n.getUint16(a+42,o);var W=n.getUint16(a+44,o);var H=n.getUint16(a+46,o);var X=n.getUint16(a+48,o);var q=n.getUint16(a+50,o);t.pieceId=c;t.shape=this._shapeManager.getNameFromId(u);t.x1=this._bytesToCoord(z);t.y1=this._bytesToCoord(P);t.x2=this._bytesToCoord(O);t.y2=this._bytesToCoord(D);t.rectWidthOrSourceRadiusScaled=this._bytesToScaledSize(R);t.rectWidthOrSourceRadiusFixed=this._bytesToFixedSize(B);t.rectHeightOrTargetRadiusScaled=this._bytesToScaledSize(j);t.rectHeightOrTargetRadiusFixed=this._bytesToFixedSize(U);t.thicknessOrFontSizeScaled=this._bytesToScaledSize(V);t.thicknessOrFontSizeFixed=this._bytesToFixedSize(G);t.strokeWidthScaled=this._bytesToScaledSize(W);t.strokeWidthFixed=this._bytesToFixedSize(H);t.offsetScaled=this._bytesToScaledSize(X);t.offsetFixed=this._bytesToFixedSize(q);t.pattern=this._patternManager.getDefinitionFromId(M);t.opacity=A/15;t.fillColor=this._bytesToColor(L);t.strokeColor=this._bytesToColor(F);t.patternColor=this._bytesToColor(N);t.globalMinVisibleSize=this._bytesToMinVisibleSize(E);t.strokeMinVisibleSize=this._bytesToMinVisibleSize(w);t.patternMinVisibleSize=this._bytesToMinVisibleSize(T);t.offsetAngle=p*(Math.PI*2/8);t.patternScale=g*this._bytesToActualPatternScale;t.symbolicSize=C*this._bytesToActualSymbolicSize;t.curvature=this._unsignedToSignedByte(I);t.dashLength=l*this._bytesToActualDashLength;t.gapLength=d*this._bytesToActualGapLength;t.hasHead=!!h;t.hasTail=!!f;t.isSelfLoop=!!_;t.unusedFlag2=!!y;t.isText=!!m;t.adjustTextAngle=!!x;t.unusedFlag1=!!b};zs.prototype._extractAnimationInformation=function e(t,r,i){var n=r;var a=i;var o=this._littleEndian;var s=n.getFloat32(a,o);var u=n.getFloat32(a+4,o);var l=n.getUint16(a+8,o);var d=n.getUint16(a+10,o);var h=n.getUint16(a+12,o);var f=n.getUint16(a+14,o);var c=(l>>8)-128;var v=(d>>8)-128;var g=(h>>8)-128;var p=(f>>8)-128;var _=l%256-128;var y=d%256-128;var m=h%256-128;var x=f%256-128;t.beginTime=s;t.duration=u;t.easing=this._easingManager.getNameFromPolygon(c,v,g,p,_,y,m,x)};zs.prototype._extractTextCharacters=function e(t,r,i,n){t.pattern=this._textManager.extractTextFromDataView(r,i,n)};zs.prototype.extractElement=function e(t,r){var i=t.getElementType();var n=t.isAnimated();var a=t.getDataView();var o=t.getElementSize();var s=r*o;var u=this._genericObject;u.valid=false;if(a.getUint16(s)){u.valid=true;this._extractGenericObject(u.end,a,s);if(n){this._extractGenericObject(u.start,a,s+dn);this._extractAnimationInformation(u.animation,a,s+dn*2)}u.id=this._idRecorder.get(t,r);if(i===Ko){var l=t.getSideDataView();var d=r*t.getTotalSideElementsSize();var h=d+t.getTotalSideElementsSize();var f=u.end;this._extractTextCharacters(f,l,d,h)}}return u};zs.prototype._compareDimensions=function e(t,r,i){if(t!==this._width||r!==this._height||i!==this._pixelRatio){this._width=t;this._height=r;this._pixelRatio=i;return true}return false};zs.prototype._compareView=function e(t,r,i,n){if(t!==this._viewX||r!==this._viewY||i!==this._viewZoom||n!==this._viewAngle){this._viewX=t;this._viewY=r;this._viewZoom=i;this._viewAngle=n;this._viewAngleCos=Math.cos(n);this._viewAngleSin=Math.sin(n);return true}return false};zs.prototype._compareCurrentTime=function e(t){if(t!==this._currentTime){this._currentTime=t;return true}return false};zs.prototype._compareBackgroundColor=function e(t){if(t!==this._backgroundColor){this._backgroundColor=t;this._backgroundRgba=this._colorManager.parseColor(this._backgroundColor);return true}return false};zs.prototype._compareShapes=function e(){if(this._shapesVersion!==this._shapeManager.getVersion()){this._shapesVersion=this._shapeManager.getVersion();return true}return false};zs.prototype._comparePatterns=function e(){if(this._patternsVersion!==this._patternManager.getVersion()){this._patternsVersion=this._patternManager.getVersion();return true}return false};zs.prototype._compareBoundaries=function e(){if(this._boundariesVersion!==this._boundariesManager.getVersion()){this._boundariesVersion=this._boundariesManager.getVersion();return true}return false};zs.prototype._compareTexts=function e(){if(this._textsVersion!==this._textManager.getVersion()){this._textsVersion=this._textManager.getVersion();return true}return false};zs.prototype._compareIsDisplayableBuffer=function e(t){if(this._isBufferDisplayable!==t){this._isBufferDisplayable=t;return true}return false};zs.prototype._compareHideImages=function e(t){if(this._hideImages!==t){this._hideImages=t;return true}return false};zs.prototype.renderFrame=function e(t){var r=t.x;var i=t.y;var n=t.zoom;var a=t.angle;var o=t.width;var s=t.height;var u=t.pixelRatio;var l=t.backgroundColor;var d=t.currentTime;var h=t.isBufferDisplayable;var f=t.hideImages;var c=this._compareShapes();var v=this._comparePatterns();var g=this._compareBoundaries();var p=this._compareTexts();var _=this._compareDimensions(o,s,u);var y=this._compareView(r,i,n,a);var m=this._compareCurrentTime(d);var x=this._compareBackgroundColor(l);var b=this._compareIsDisplayableBuffer(h);var S=this._compareHideImages(f);if(g){var A=this._boundariesManager;this._bytesToActualCoord=1;this._bytesToActualScaledSize=A.maxScaledSize/Qi;this._bytesToActualMinVisibleSize=A.maxMinVisibleSize/Ji;this._bytesToActualSymbolicSize=A.maxSymbolicSize/Zi;this._bytesToActualDashLength=A.maxDashLength/$i;this._bytesToActualGapLength=A.maxGapLength/$i;this._bytesToActualPatternScale=A.maxPatternScale/Zi}this._render({shapesChanged:c,patternsChanged:v,boundariesChanged:g,textsChanged:p,dimensionsChanged:_,viewChanged:y,currentTimeChanged:m,backgroundColorChanged:x,isBufferDisplayableChanged:b,isHideImagesChanged:S})};zs.prototype._render=function e(){};zs.prototype.destroy=function e(){};zs.prototype.getImageData=function e(){return null};function Ps(value,e,t){return value%(1<<t)>>e}var Os="#define D3D9_FIX 0\n#define ANIMATED 0\nprecision highp float;\nprecision mediump int;\nattribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_final_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec2 a_final_offsetScaled_offsetFixed;\nattribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_prev_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec2 a_prev_offsetScaled_offsetFixed;\nattribute /*float*/ vec2 a_animationBeginTime_animationDuration; \nattribute /*ushort*/ vec4 a_animationEasing; \nattribute /*ushort*/ vec2 a_text_charId_charOffsetXY; \nattribute vec3 a_vertexInfo;\nuniform float u_viewWidth;\nuniform float u_viewHeight;\nuniform float u_viewX;\nuniform float u_viewY;\nuniform float u_viewAngle;\nuniform float u_viewZoom;\nuniform float u_currentTime;\nuniform float u_pixelRatio;\nuniform sampler2D u_patternInfoTexture;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec4 dr;\nvarying vec2 ds;\nvarying vec2 dt;\n#if D3D9_FIX\nvarying vec4 du;\nvarying vec3 dv;\nvarying vec4 dw;\nvarying vec4 dx;\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nconst float EPSILON = 0.000001;\nconst float INFINITY = 10000000.0;\nconst float PI = 3.14159265359;\nconst float P2_12 = 4096.0;\nconst float P2_8 = 256.0;\nconst float P2_7 = 128.0;\nconst float P2_6 = 64.0;\nconst float P2_5 = 32.0;\nconst float P2_4 = 16.0;\nconst float P2_3 = 8.0;\nconst float P2_2 = 4.0;\nconst float P2_1 = 2.0;\nuniform float BYTES_TO_COORD;\nuniform float BYTES_TO_SCALED_SIZE;\nuniform float BYTES_TO_MIN_VISIBLE_SIZE;\nuniform float BYTES_TO_SYMBOLIC_SIZE;\nuniform float BYTES_TO_CURVATURE;\nuniform float BYTES_TO_DASH_LENGTH;\nuniform float BYTES_TO_GAP_LENGTH;\nuniform float BYTES_TO_PATTERN_SCALE;\nuniform float SHAPE_TEXTURE_SIZE;\nuniform float SHAPE_SAMPLING_SIZE;\nuniform float SHAPE_SAMPLING_BUFFER_RATIO;\nuniform float PATTERN_POSITION_GRANULARITY;\nuniform float PATTERN_INFO_TEXTURE_SIZE;\nuniform float PATTERN_NEAREST_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nuniform float PATTERN_MIPMAP_TEXTURE_SIZE;\nuniform float SHAPE_LINE_ID;\nuniform float SHAPE_TRIANGLE_ID;\nuniform float NB_SHAPES_BY_SIDE;\nuniform float SHAPE_DIMENSIONS;\nuniform float SHAPE_ACTUAL_RATIO;\nconst float BYTES_TO_OFFSET_ANGLE = 0.0;\nconst float BYTES_TO_COLOR = 0.0;\nconst float SDF_FONT_SIZE = 0.0;\nconst float CURVATURE_RATIO = 0.0;\nconst float PATTERN_MARGIN = 0.0;\nconst float TEXT_WIDTH_MULTIPLIER = 0.0;\nconst float TEXT_HEIGHT_MULTIPLIER = 0.0;\nconst float SELF_LOOP_CURVATURE_MULTIPLIER = 0.0;\nconst float EDGE_ARROW_SIZE_RATIO = 0.0;\nconst float NB_PIECES_PER_CURVE = 0.0;\nconst float PIECE_NODE_COMPONENT = 0.0;\nconst float PIECE_EDGE_BODY = 0.0;\nconst float PIECE_EDGE_HEAD = 0.0;\nconst float PIECE_EDGE_TAIL = 0.0;\nconst float PIECE_EDGE_TEXT = 0.0;\nconst float MAX_TEXT_SIZE = 0.0;\nconst float BYTES_TO_TEXT_OFFSET = 0.0;\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float T_STEP_PER_CURVE_PIECE = 1.0 / NB_PIECES_PER_CURVE;\nconst float HEAD_TAIL_PX_ADJUST = 1.5;\nstruct fv {\nfloat fw;\nfloat fx;\nfloat fy;\nfloat fz;\nfloat ga;\nfloat gb;\n};\nstruct gc {\nfloat gd;\nfloat ge;\nfloat gf;\nfloat gg;\nfloat gh;\nfloat gi;\nfloat gj;\n};\nstruct gk {\nfloat fw;\nfloat fx;\nfloat fy;\nfloat fz;\nfloat ga;\nfloat gb;\nfloat gd;\nfloat gh;\nfloat gi;\nfloat gj;\nfloat gg;\nfloat gf;\nfloat ge;\nfloat gl;\nfloat gm;\nfloat gn;\nfloat go;\nfloat gp;\nfloat gq;\nfloat gr;\nvec4 gs;\nvec4 gt;\nvec4 gu;\nfloat gv;\nfloat gw;\nfloat gx;\nfloat gy;\nfloat gz;\nfloat ha;\nfloat hb;\nfloat hc;\nfloat hd;\nfloat he;\nfloat hf;\nfloat hg;\nfloat hh;\nfloat hi;\nfloat hj;\nfloat hk;\nfloat hl;\n};\nstruct hm {\nfloat hn;\nvec2 ho;\nvec4 gs;\nvec4 gt;\nfloat gl;\nfloat hp;\nfloat hq;\nfloat fx;\nfloat hr;\nvec2 hs;\nfloat ht;\nvec2 hu;\nvec2 hv;\nvec2 hw;\nfloat hx;\nfloat hy;\nvec4 gu;\nvec2 hz;\nfloat ia;\nfloat ib;\nvec2 ic;\nvec2 id;\nvec2 ie;\n};\nfloat ig(float cg, float ih, float ii) {\nfloat ij = mod(cg, pow(2.0, ii));\nreturn floor(ij / pow(2.0, ih));\n}\nfv ik(float cg) {\nfv il;\nil.fw = ig(cg, 0.0, 4.0);\nil.fx = ig(cg, 4.0, 6.0);\nil.fy = ig(cg, 6.0, 8.0);\nil.fz = ig(cg, 8.0, 9.0);\nil.ga = ig(cg, 9.0, 10.0);\nil.gb = ig(cg, 10.0, 16.0);\nreturn il;\n}\ngc im(float cg) {\ngc il;\nil.gd = ig(cg, 0.0, 8.0);\nil.ge = ig(cg, 8.0, 11.0);\nil.gf = ig(cg, 11.0, 12.0);\nil.gg = ig(cg, 12.0, 13.0);\nil.gh = ig(cg, 13.0, 14.0);\nil.gi = ig(cg, 14.0, 15.0);\nil.gj = ig(cg, 15.0, 16.0);\nreturn il;\n}\nvec4 io(in float cg) {\nreturn vec4(\nig(cg, 0.0, 4.0),\nig(cg, 4.0, 8.0),\nig(cg, 8.0, 12.0),\nig(cg, 12.0, 16.0)\n);\n}\nvec2 ip(in float cg) {\nreturn vec2(mod(cg, 256.0), floor(cg / 256.0));\n}\nvec2 iq(in float cg) {\nfloat ir = floor(cg / P2_6);\nfloat is = cg - (ir * P2_6);\nreturn vec2(ir, is);\n}\nvec2 it(in float cg) {\nfloat iu = floor(cg / P2_7);\nfloat iv = cg - (iu * P2_7);\nreturn vec2(iu, iv);\n}\nvec2 iw(in vec2 ix, in float iy) {\nfloat iz = cos(iy);\nfloat ja = sin(iy);\nreturn vec2(iz * ix.x + ja * ix.y, -ja * ix.x + iz * ix.y);\n}\nvec4 jb(in vec4 jc) {\nreturn floor(jc / 256.0) - 128.0;\n}\nvec4 jd(in vec4 jc) {\nreturn mod(jc, 256.0) - 128.0;\n}\nfloat je(float cg) {\nreturn cg - 128.0;\n}\nvec2 je(vec2 cg) {\nreturn cg - 128.0;\n}\nvec2 jf(vec2 jg) {\nreturn vec2(-jg.y, jg.x);\n}\nvec2 jh(vec2 ji, vec2 jj, vec2 jk, float t) {\nfloat jl = 1.0 - t;\nreturn (jl * jl * ji) + (2.0 * jl * t * jj) + (t * t * jk);\n}\nvec2 jm(vec2 ji, vec2 jn, vec2 jo, vec2 jk, float t) {\nfloat jl = 1.0 - t;\nfloat jp = jl * jl;\nfloat jq = jp * jl;\nfloat jr = t * t;\nfloat js = jr * t;\nreturn (jq * ji) + (3.0 * jp * t * jn) + (3.0 * jl * jr * jo) + (js * jk);\n}\nvec2 jt(vec2 ji, vec2 jj, vec2 jk, float t) {\nfloat jl = (1.0 - t);\nvec2 ix = (jl * jj + t * jk) - (jl * ji + t * jj);\nreturn normalize(ix);\n}\nvec2 ju(vec2 ji, vec2 jj, vec2 jk, float t) {\nreturn jf(jt(ji, jj, jk, t));\n}\nvec2 jv(vec2 ji, vec2 jn, vec2 jo, vec2 jk, float t) {\nfloat jl = 1.0 - t;\nfloat jp = jl * jl;\nfloat jr = t * t;\nvec2 ix = jp * (jn - ji) + 2.0 * jl * t * (jo - jn) + jr * (jk - jo);\nreturn normalize(ix);\n}\nvec2 jw(vec2 ji, vec2 jn, vec2 jo, vec2 jk, float t) {\nreturn jf(jv(ji, jn, jo, jk, t));\n}\nfloat km(float gq, float kn, float t) {\nfloat y = abs(gq) / CURVATURE_RATIO + EPSILON;\nfloat gy = y * y;\nfloat jl = t - 0.5;\nfloat jp = jl * jl;\nfloat ko = 1.0 / (16.0 * gy);\nfloat kp = sqrt(jp + ko);\nfloat kq = (0.5 / y) * sqrt(gy + 0.25);\nfloat kr = (abs(2.0 * y)) * ((jl * kp) + (0.5 * kq) + (ko * log(abs((jl + kp) / (-0.5 + kq)))));\nreturn kr * kn;\n}\nfloat ks(vec2 ji, vec2 kt, vec2 ku, vec2 jk, float kv) {\nfloat kw = 0.0;\nvec2 kx = ji;\nfloat ky = -T_STEP_PER_CURVE_PIECE;\nfor (float t = 0.0; t < 1.0; t += T_STEP_PER_CURVE_PIECE) {\nvec2 kz = jm(ji, kt, ku, jk, t);\nfloat la = distance(kx, kz);\nkw += step(t, kv) * la * clamp((kv - ky) / T_STEP_PER_CURVE_PIECE, 0.0, 1.0);\nkx = kz;\nky = t;\n}\nreturn kw;\n}\nfloat lb(float cg) {\nreturn cg - 32.0;\n}\nfloat lc(float cg) {\nreturn cg - 512.0;\n}\nfloat ld(float cg) {\nreturn cg - 32768.0;\n}\nvoid le() {\ngl_Position = vec4(-10.0, -10.0, 1.0, 1.0);\n}\nvec4 lf(vec2 lg) {\nreturn vec4(((vec2(lg.x, u_viewHeight - lg.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);\n}\nfloat ll(float lm, float ln) {\nreturn step(lm - EPSILON, ln) * step(ln, lm + EPSILON);\n}\nbool lo(float lm, float ln) {\nreturn abs(lm - ln) < EPSILON;\n}\nbool lp(float cg) {\nreturn cg > 0.5;\n}\nvec2 lq(vec2 lr) {\nreturn iw((lr - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;\n}\nfloat ls(float ib) {\nreturn ib * EDGE_ARROW_SIZE_RATIO;\n}\nfloat lt(float lu, float lv) {\nreturn lu * BYTES_TO_SCALED_SIZE * u_viewZoom + lv;\n}\nfloat mc(float hp, float ma, float mb) {\nfloat md = mb - ma;\nfloat a = 1.0 / md;\nfloat b = -ma / md;\nreturn hp * a + b;\n}\nstruct me {\nvec2 mf;\nvec2 mg;\n};\nme mh(vec2 mi, float mj, float gq) {\nme ck;\nfloat mk = (mj + mj / SELF_LOOP_CURVATURE_MULTIPLIER * gq) * SELF_LOOP_CURVATURE_MULTIPLIER;\nfloat ml = -u_viewAngle + PI;\nfloat mm = -u_viewAngle + PI / 2.0;\nck.mf = mi + vec2(cos(ml), sin(ml)) * mk;\nck.mg = mi + vec2(cos(mm), sin(mm)) * mk;\nreturn ck;\n}\nfloat mu(vec2 mv, vec2 kt, vec2 ku, vec2 mw, float mx) {\nvec2 kx = mv;\nfloat t = 0.0;\nfloat kw = 0.0;\nfor (float my = 0.0; my < NB_PIECES_PER_CURVE - EPSILON; my += 1.0) {\nt += T_STEP_PER_CURVE_PIECE;\nvec2 kz = jm(mv, kt, ku, mw, t);\nfloat la = distance(kx, kz);\nfloat mz = kw + la;\nif (mz > mx) {\nfloat na = (mz - mx) / la;\nreturn t - T_STEP_PER_CURVE_PIECE * na;\n}\nkw = mz;\nkx = kz;\n}\nreturn 1.0;\n}\ngk nb(\nvec4 nc,\nvec4 nd,\nvec4 ne,\nvec4 nf,\nvec4 ng,\nvec2 nh,\nvec2 ni\n) {\ngk a;\nfv nj = ik(nc.x);\ngc nk = im(nc.y);\nvec4 nl = io(nc.z);\nvec2 nm = ip(nc.w);\nvec2 nn = iq(ni.y);\na.fw = nj.fw;\na.fx = nj.fx;\na.fy = nj.fy;\na.fz = nj.fz;\na.ga = nj.ga;\na.gb = nj.gb;\na.gd = nk.gd;\na.gh = nk.gh;\na.gi = nk.gi;\na.gj = nk.gj;\na.gg = nk.gg;\na.gf = nk.gf;\na.ge = nk.ge;\na.gl = nl.x;\na.gm = nl.y;\na.gn = nl.z;\na.go = nl.w;\na.gp = nm.x;\na.gq = nm.y;\na.gr = nd.x;\na.gs = io(nd.y);\na.gt = io(nd.z);\na.gu = io(nd.w);\na.gv = ne.x;\na.gw = ne.y;\na.gx = ne.z;\na.gy = ne.w;\na.gz = nf.x;\na.ha = nf.y;\na.hb = nf.z;\na.hc = nf.w;\na.hd = ng.x;\na.he = ng.y;\na.hf = ng.z;\na.hg = ng.w;\na.hh = nh.x;\na.hi = nh.y;\na.hj = ni.x;\na.hk = lc(nn.x);\na.hl = lb(nn.y);\nreturn a;\n}\nbool oa(const in gk a, out hm ck) {\nfloat fw = a.fw;\nfloat fx = a.fx * BYTES_TO_DASH_LENGTH;\nfloat fy = a.fy * BYTES_TO_GAP_LENGTH;\nfloat fz = a.fz;\nfloat ga = a.ga;\nfloat gb = a.gb;\nfloat gd = a.gd * BYTES_TO_PATTERN_SCALE;\nfloat ge = a.ge * BYTES_TO_OFFSET_ANGLE;\nfloat gf = a.gf;\nfloat gh = a.gh;\nfloat gi = a.gi;\nfloat gj = a.gj;\nfloat gl = a.gl * BYTES_TO_COLOR;\nfloat gm = a.gm * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat gn = a.gn * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat go = a.go * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat gp = a.gp * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.gp, EPSILON) * INFINITY;\nfloat gq = je(a.gq);\nfloat gr = a.gr;\nvec4 gs = a.gs * BYTES_TO_COLOR;\nvec4 gt = a.gt * BYTES_TO_COLOR;\nvec4 gu = a.gu * BYTES_TO_COLOR;\nvec2 ob = vec2(a.gv, a.gw) * BYTES_TO_COORD;\nvec2 oc = vec2(a.gx, a.gy) * BYTES_TO_COORD;\nvec2 mv = lq(ob);\nvec2 mw = lq(oc);\nfloat od = lt(a.gz, a.ha);\nfloat oe = lt(a.hb, a.hc);\nfloat of = lt(a.hd, a.he);\nfloat hn = lt(a.hf, a.hg);\nfloat og = lt(a.hh, a.hi);\nvec2 oh = a_vertexInfo.xy;\nvec2 oi = vec2(0.0, 0.0);\nfloat oj = od;\nfloat ok = oe;\nfloat ol = oe * gd;\nif (gh > EPSILON) {\nif (a.hj < EPSILON) {\nreturn false;\n}\nol = of;\nfloat om = ol / 2.0;\ngr = a.hj;\noi.y = a.hl * om - 1.0;\nif (ll(gb, PIECE_EDGE_TEXT) > EPSILON) { \noi.x = a.hk * BYTES_TO_TEXT_OFFSET * ol;\n} else {\noi.x = floor(a.hk);\n}\noi += vec2(1.0);\nod = ol * TEXT_WIDTH_MULTIPLIER;\noe = ol * TEXT_HEIGHT_MULTIPLIER;\n}\nbool pn = abs(gq) > EPSILON && ll(gb, PIECE_EDGE_BODY) < EPSILON;\nbool po = pn && a_vertexInfo.z > EPSILON;\nif (fw < EPSILON || gb < EPSILON || gp < gm || po) {\nreturn false;\n}\nhn *= step(gn, gp);\nfloat qe = 0.0;\nfloat qf = 1.0;\nfloat qb = 0.0;\nfloat qd = 1.0;\nfloat qg = 0.0;\nfloat qq = 1.0;\nfloat qs = 1.0;\nfloat rd = 0.0;\nfloat re = 0.0;\nvec2 hz;\nvec2 ic;\nvec2 id;\nvec2 ie;\nfloat ib;\nfloat ia;\nif (ll(gb, PIECE_NODE_COMPONENT) > EPSILON) {\nhz = ceil((mv + mw) / 2.0);\nic = normalize(vec2(oc.x - ob.x + 0.001, ob.y - oc.y));\nid = jf(ic);\nie = id;\nib = od;\nia = oe;\n} else {\nqs = 0.0;\nfloat sp = distance(mv, mw);\nvec2 sq = normalize(mw - mv);\nvec2 sr = (mv + mw) / 2.0;\nvec2 ss = jf(sq);\nvec2 st = sr + (ss * sp * -gq / CURVATURE_RATIO);\nif (ll(gb, PIECE_EDGE_TEXT) > 0.0) {\nfloat sx;\nfloat sy = hn;\nhn = 0.0;\nif (gf > EPSILON) {\nme jj = mh(mv, sy / 2.0, gq);\nhz = jm(mv, jj.mf, jj.mg, mw, 0.5);\nic = jv(mv, jj.mf, jj.mg, mw, 0.5);\nid = jf(ic);\nie = id;\nsx = ks(mv, jj.mf, jj.mg, mw, 0.5);\n} else if (abs(gq) > EPSILON) {\nhz = jh(mv, st, mw, 0.5);\nic = jt(mv, st, mw, 0.5);\nid = jf(ic);\nie = id;\nsx = km(gq, sp, 1.0);\n} else {\nhz = sr;\nic = sq;\nid = ss;\nie = ss;\nsx = sp;\n}\nib = od;\nia = oe;\nif (gi > EPSILON && gf < EPSILON && oj > sx - sy) {\nic = vec2(1.0, 0.0);\nid = vec2(0.0, 1.0);\nie = vec2(0.0, 1.0);\n} else {\nfloat iy = -atan(ic.y, ic.x);\noi = iw(oi, iy);\nge -= iy;\nif ((iy > PI / 2.0 || iy < -PI / 2.0)) {\nge += (1.0 - gf) * PI;\noi *= -1.0;\nic *= -1.0;\nid *= -1.0;\nie *= -1.0;\n}\n}\n} else {\nfloat th = ll(fw, SHAPE_LINE_ID);\nfloat ti = ll(fw, SHAPE_TRIANGLE_ID);\nfloat tj = 1.0 - th;\nfloat qw = of;\nfloat tk = od;\nfloat tl = oe;\nfloat tm = fz + ga;\nfloat tn = ls(qw);\nfloat to = fz * tn;\nfloat tp = ga * tn;\nfloat tq = ll(gb, PIECE_EDGE_HEAD);\nfloat tr = ll(gb, PIECE_EDGE_TAIL);\nfloat ts = INFINITY * gf + sp - tk - tl;\nfloat tt = min(ts / tm, tn);\nfloat ue =\nga * (tn + max(tk + tt - tp, 0.0))\n+ (1.0 - ga) * ti * tk;\nfloat uf =\nfz * (tn + max(tl + tt - to, 0.0))\n+ (1.0 - fz) * ti * tl;\nif (tq > EPSILON || tr > EPSILON) {\nfw = SHAPE_TRIANGLE_ID;\nvec2 uu = tq * mw + tr * mv;\nfloat og = tq * uf + tr * ue + (HEAD_TAIL_PX_ADJUST - 0.5);\nfloat uv = tq * to + tr * tp;\nvec2 uw;\nif (gf > EPSILON) {\nme jj = mh(mv, tk, gq);\nfloat sx = ks(mv, jj.mf, jj.mg, mw, 1.0);\nfloat mx = tq * (sx - uf) + tr * ue;\nfloat t = mu(mv, jj.mf, jj.mg, mw, mx);\nuw = jm(mv, jj.mf, jj.mg, mw, t);\n} else {\nfloat sx = km(gq, sp, 1.0);\nfloat t = (tq * (sx - uf) + tr * ue) / sx;\nuw = jh(mv, st, mw, t);\n}\nic = normalize(uu - uw);\nid = jf(ic);\nie = id;\nhz = uu - ic * (og - uv / 2.0);\nib = uv;\nia = uv;\nfx = 0.0;\nfy = 0.0;\n} else {\nfloat va;\nfloat vb;\nfloat vc;\nif (abs(gq) < EPSILON) {\nhz = sr;\nic = sq;\nid = ss;\nie = id;\nib = sp;\nva = sp;\nvb = 0.0;\nvc = sp;\n} else {\nfloat ve = a_vertexInfo.z;\nfloat vf = ve * T_STEP_PER_CURVE_PIECE;\nfloat jr = vf + T_STEP_PER_CURVE_PIECE;\nif (gf < EPSILON) {\nvec2 vg = jh(mv, st, mw, vf);\nvec2 vh = jh(mv, st, mw, jr);\nhz = (vg + vh) / 2.0;\nic = normalize(vh - vg);\nid = ju(mv, st, mw, vf);\nie = ju(mv, st, mw, jr);\nib = distance(vg, vh);\nva = km(gq, sp, 1.0);\nvb = km(gq, sp, vf);\nvc = km(gq, sp, jr);\n} else {\nme jj = mh(mv, tk, gq);\nvec2 kt = jj.mf;\nvec2 ku = jj.mg;\nvec2 vg = jm(mv, kt, ku, mw, vf);\nvec2 vh = jm(mv, kt, ku, mw, jr);\nhz = (vg + vh) / 2.0;\nic = normalize(vh - vg);\nid = jw(mv, kt, ku, mw, vf);\nie = jw(mv, kt, ku, mw, jr);\nib = distance(vg, vh);\nva = ks(mv, kt, ku, mw, 1.0);\nvb = ks(mv, kt, ku, mw, vf);\nvc = ks(mv, kt, ku, mw, jr);\n}\n}\nia = of;\nqb = (ue - 1.0) / va;\nqd = 1.0 - (uf - HEAD_TAIL_PX_ADJUST) / va;\nqe = vb / va;\nqf = vc / va;\nqg = va;\nif (ti > 0.0 && ts > 5.0) {\nfloat vn = (va * ia) / (va - ue);\nfloat vo = va;\nfloat gv = ue;\nfloat gx = va - uf;\nfloat a = -vn / vo;\nfloat b = vn;\nfloat gw = a * gv + b;\nfloat gy = a * gx + b;\nfloat vp = gw / (gv - gx);\nfloat vq = -vp * gx;\nia = vq;\nre = vp * vo + vq + 1.0;\n}\n}\n}\n}\nvec2 vr = vec2(cos(ge), sin(ge)) * og;\nvec2 vs = hz + vr + oi;\nif (gh > EPSILON && ll(gb, PIECE_NODE_COMPONENT) > EPSILON) {\nvs = ceil(vs);\n}\nfloat vt = hn * 2.0;\nfloat vu = ib + qs * (vt + 1.0);\nfloat vv = ia + qq * (vt + 1.0);\nvec2 vw = ic * vu / 2.0;\nvec2 vx = id * vv / 2.0;\nvec2 vy = ie * vv / 2.0;\nfloat vz = (qf - qe);\nfloat wa = oh.x / 2.0 + 0.5;\nfloat hp = qe + vz * wa;\nfloat ht = rd + (re - rd) * hp / 2.0;\nvec2 hu = vec2(0.0, 0.0);\nvec2 hv = vec2(EPSILON, EPSILON);\nvec2 hw = vec2(-EPSILON, -EPSILON);\nfloat hx = -1.0;\nfloat hy = 0.0;\nif (gr > EPSILON && gp > go) {\nfloat wb = floor(gr / PATTERN_INFO_TEXTURE_SIZE);\nfloat wc = gr - (wb * PATTERN_INFO_TEXTURE_SIZE);\nvec4 wd = texture2D(u_patternInfoTexture, vec2(wc, wb) / 255.0) * 255.0;\nvec2 we = it(wd.z);\nvec2 wf = it(wd.w);\nhx = we.x * 2.0 + wf.x;\nfloat wg = 0.0;\nbool wh = false;\nif (lo(hx, FILTER_NEAREST)) {\nwg = PATTERN_NEAREST_TEXTURE_SIZE;\n} else if (lo(hx, FILTER_LINEAR)) {\nwg = PATTERN_LINEAR_TEXTURE_SIZE;\n} else if (lo(hx, FILTER_LINEAR_SDF)) {\nwg = PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nwh = true;\n} else if (lo(hx, FILTER_MIPMAP)) {\nwg = PATTERN_MIPMAP_TEXTURE_SIZE;\n}\nfloat wi = 1.0 / wg;\nvec2 wj = (vec2(we.y, wf.y) * PATTERN_POSITION_GRANULARITY) * wi / 2.0;\nvec2 wk = (wd.xy * PATTERN_POSITION_GRANULARITY * wi) + wj;\nwk += PATTERN_MARGIN * wi;\nwj -= PATTERN_MARGIN * wi * 2.0;\nvec2 wl = vec2(ib / 2.0, ia / 2.0) * wi;\nvec2 wm = vec2(hn, hn) * wi;\nfloat wn = 1.0 * u_pixelRatio;\nif (gd > EPSILON) {\nif (wh) {\nhy = 2.0 / ol;\nwn = SDF_FONT_SIZE / ol;\n} else {\nwn = (wj.y / wl.y) / gd;\n}\n}\nvec2 wo = (wl + wm) * wn;\nwj += PATTERN_MARGIN * wi;\nhu = wk + wo * oh;\nhv = wk - wj;\nhw = wk + wj;\n}\nvec2 wv = (vec2(mod(fw, NB_SHAPES_BY_SIDE), floor(fw / NB_SHAPES_BY_SIDE)) + vec2(qe, 0.0) * SHAPE_ACTUAL_RATIO + vec2(SHAPE_SAMPLING_BUFFER_RATIO / 2.0)) / NB_SHAPES_BY_SIDE;\nvec2 wx = vec2(vz, 1.0) * SHAPE_ACTUAL_RATIO / NB_SHAPES_BY_SIDE;\nvec2 ho = wv + wx * (oh / 2.0 + 0.5);\nvec2 hs = vec2(vu / vz, vv) / 2.0;\nfloat xe = fx * of;\nfloat xf = fy * of;\nfloat hq = xe + xf;\nfloat hr = (hp * qg) / hq;\nck.ho = ho;\nck.hs = hs;\nck.hn = hn;\nck.gs = gs;\nck.gt = gt;\nck.gl = gl;\nck.hp = mc(hp, qb, qd);\nck.hq = hq;\nck.fx = xe;\nck.hr = hr;\nck.ht = ht;\nck.hu = hu;\nck.hv = hv;\nck.hw = hw;\nck.hx = hx;\nck.hy = hy;\nck.gu = gu;\nck.hz = vs;\nck.ib = vu;\nck.ia = vv;\nck.ic = ic;\nck.id = id;\nck.ie = ie;\nreturn true;\n}\nfloat xg(float xh, float xi, vec4 xj) {\nfloat xk = clamp(((u_currentTime - xh) / xi), 0.0, 1.0);\nfloat r = xk;\nfloat xl = r * r;\nfloat xm = xl * r;\nvec4 xn = xk < 0.5 ? jb(xj) : jd(xj);\nfloat xo = xn.x;\nfloat xp = xn.y;\nfloat xq = xn.z;\nfloat xr = xn.w;\nfloat xs = xo + xp * r + xq * xl + xr * xm;\nreturn xs;\n}\nvoid main() {\ngk a_final = nb(\na_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_final_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_final_x1_y1_x2_y2,\na_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_final_offsetScaled_offsetFixed,\na_text_charId_charOffsetXY\n);\n#if ANIMATED\nfloat xh = a_animationBeginTime_animationDuration.x;\nfloat xi = a_animationBeginTime_animationDuration.y;\nvec4 xj = a_animationEasing;\nfloat nz = xg(xh, xi, xj);\ngk a_prev = nb(\na_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_prev_x1_y1_x2_y2,\na_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_prev_offsetScaled_offsetFixed,\na_text_charId_charOffsetXY\n);\nconst float ONE = 1.0;\na_final.fw = mix(a_prev.fw, a_final.fw, ONE);\na_final.fx = mix(a_prev.fx, a_final.fx, nz);\na_final.fy = mix(a_prev.fy, a_final.fy, nz);\na_final.fz = mix(a_prev.fz, a_final.fz, ONE);\na_final.ga = mix(a_prev.ga, a_final.ga, ONE);\na_final.gb = mix(a_prev.gb, a_final.gb, ONE);\na_final.gd = mix(a_prev.gd, a_final.gd, ONE);\na_final.gh = mix(a_prev.gh, a_final.gh, ONE);\na_final.gi = mix(a_prev.gi, a_final.gi, ONE);\na_final.gj = mix(a_prev.gj, a_final.gj, ONE);\na_final.gg = mix(a_prev.gg, a_final.gg, ONE);\na_final.gf = mix(a_prev.gf, a_final.gf, ONE);\na_final.ge = mix(a_prev.ge, a_final.ge, nz);\na_final.gl = mix(a_prev.gl, a_final.gl, nz);\na_final.gm = mix(a_prev.gm, a_final.gm, nz);\na_final.gn = mix(a_prev.gn, a_final.gn, nz);\na_final.go = mix(a_prev.go, a_final.go, nz);\na_final.gp = mix(a_prev.gp, a_final.gp, nz);\na_final.gq = mix(a_prev.gq, a_final.gq, nz);\na_final.gr = mix(a_prev.gr, a_final.gr, ONE);\na_final.gs = mix(a_prev.gs, a_final.gs, nz);\na_final.gt = mix(a_prev.gt, a_final.gt, nz);\na_final.gu = mix(a_prev.gu, a_final.gu, nz);\na_final.gv = mix(a_prev.gv, a_final.gv, nz);\na_final.gw = mix(a_prev.gw, a_final.gw, nz);\na_final.gx = mix(a_prev.gx, a_final.gx, nz);\na_final.gy = mix(a_prev.gy, a_final.gy, nz);\na_final.gz = mix(a_prev.gz, a_final.gz, nz);\na_final.ha = mix(a_prev.ha, a_final.ha, nz);\na_final.hb = mix(a_prev.hb, a_final.hb, nz);\na_final.hc = mix(a_prev.hc, a_final.hc, nz);\na_final.hd = mix(a_prev.hd, a_final.hd, nz);\na_final.he = mix(a_prev.he, a_final.he, nz);\na_final.hf = mix(a_prev.hf, a_final.hf, nz);\na_final.hg = mix(a_prev.hg, a_final.hg, nz);\na_final.hh = mix(a_prev.hh, a_final.hh, nz);\na_final.hi = mix(a_prev.hi, a_final.hi, nz);\na_final.hj = mix(a_prev.hj, a_final.hj, ONE);\na_final.hk = mix(a_prev.hk, a_final.hk, ONE);\na_final.hl = mix(a_prev.hl, a_final.hl, ONE);\n#endif\nhm ck;\nbool xt = oa(a_final, ck);\nif (!xt) {\nle();\nreturn;\n}\nvec2 oh = a_vertexInfo.xy;\ndp = ck.gs;\ndq = ck.gt;\ndr = ck.gu;\nds = ck.ho;\ndt = ck.hu;\n#if D3D9_FIX\ndu = vec4(ck.hv, ck.hw);\ndv = vec3(ck.hn, ck.gl, ck.ht);\ndw = vec4(ck.hp, ck.hq, ck.fx, ck.hr);\ndx = vec4(ck.hs, ck.hy, ck.hx);\n#else\ndy = ck.hn;\ndz = ck.hv;\nea = ck.hw;\neb = vec2(ck.gl, ck.ht);\nec = ck.hp;\ned = ck.hq;\nee = vec2(ck.fx, ck.hr);\nef = ck.hs;\neg = ck.hy;\neh = ck.hx;\n#endif\nfloat xu = step(oh.x, 0.0);\nfloat xv = 1.0 - xu;\nvec2 lg = ck.hz\n+ (ck.ic * (ck.ib / 2.0) * oh.x)\n+ ((xu * ck.id + xv * ck.ie) * (ck.ia / 2.0) * oh.y);\ngl_Position = lf(lg);\n}\n";var Ds="#define D3D9_FIX 0\nprecision highp float;\nprecision mediump int;\nuniform vec3 u_backgroundColor;\nuniform sampler2D u_patternNearestTexture;\nuniform sampler2D u_patternLinearTexture;\nuniform sampler2D u_patternLinearSdfTexture;\nuniform sampler2D u_patternMipmapTexture;\nuniform sampler2D u_shapeTexture;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec4 dr;\nvarying vec2 ds;\nvarying vec2 dt;\n#if D3D9_FIX\nvarying vec4 du;\nvarying vec3 dv;\nvarying vec4 dw;\nvarying vec4 dx;\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float EPSILON = 0.000000001;\nconst float SDF_BUFFER = (256.0 - 64.0) / 256.0; \nvec4 xy(in vec4 sw, in vec4 xz) {\nfloat ya = xz.a;\nfloat yb = sw.a + EPSILON;\nfloat yc = min(ya + yb, 1.0);\nfloat r = ya / yc;\nreturn vec4(mix(sw.rgb, xz.rgb, r), yc);\n}\nfloat yd(in float ye, in float fb) {\nfloat yf = (ye * 256.0 + fb) * 256.0;\nfloat yg = yf / 60000.0;\nreturn yg * 2.0 - 1.0;\n}\nbool lo(float lm, float ln) {\nreturn abs(lm - ln) < EPSILON;\n}\nvoid main() {\n#if D3D9_FIX\nfloat dy = dv.x;\nfloat yh = dv.y;\nfloat yi = dv.z;\nvec2 dz = du.xy;\nvec2 ea = du.zw;\nfloat ec = dw.x;\nfloat ed = dw.y;\nfloat yj = dw.z;\nfloat yk = dw.w;\nvec2 ef = dx.xy;\nfloat eg = dx.z;\nfloat eh = dx.w;\n#else\nfloat yh = eb.x;\nfloat yi = eb.y;\nfloat yj = ee.x;\nfloat yk = ee.y;\n#endif\nvec4 nj = texture2D(u_shapeTexture, ds);\nfloat yl = yd(nj.b, nj.a) * ef.x;\nfloat ym = yd(nj.r, nj.g) * ef.y;\nym += yi;\nfloat yn = min(yl, ym);\nvec4 gs = dp;\nvec4 gt = dq;\nif (eh > -EPSILON) {\nvec2 hu = dt;\nfloat yp =\nstep(dz.x, hu.x) *\nstep(hu.x, ea.x) *\nstep(dz.y, hu.y) *\nstep(hu.y, ea.y);\nfloat yq = yp;\nvec4 gu;\nif (lo(eh, FILTER_NEAREST)) {\ngu = texture2D(u_patternNearestTexture, hu);\n} else if (lo(eh, FILTER_LINEAR)) {\ngu = texture2D(u_patternLinearTexture, hu);\n} else if (lo(eh, FILTER_LINEAR_SDF)) {\ngu = texture2D(u_patternLinearSdfTexture, hu);\ngu.a = smoothstep(SDF_BUFFER - eg, SDF_BUFFER + eg, gu.a);\n} else if (lo(eh, FILTER_MIPMAP)) {\ngu = texture2D(u_patternMipmapTexture, hu);\n}\ngu.rgb += dr.rgb;\ngu.a *= yq;\ngs = xy(gs, gu);\n}\nfloat yr = clamp(yn, 0.0, 1.0);\nfloat ys = clamp(yn - dy, 0.0, 1.0);\nfloat yt = yr - ys;\nyt = 1.0 - clamp(yn - dy, 0.0, 1.0);\ngs.a *= ys;\ngt.a *= yt;\nvec4 yu = xy(gs, gt);\nfloat yv = yr;\nyu.rgb = mix(u_backgroundColor, yu.rgb, yh);\nif (ed > EPSILON) {\nfloat zg = fract(yk) * ed;\nfloat zh = clamp(min(zg, yj - zg), 0.0, 1.0);\nyv *= zh;\n}\nif (ec < 0.0 || ec > 1.0 || yv < EPSILON) {\ndiscard;\n}\nyu.a *= yv;\nyu.rgb *= yu.a;\ngl_FragColor = yu;\n}\n";var Rs=en*(1-tn)/2;var Bs=(en-1)/2;var js=function e(t,r){this._gl=t;this._glTextureUnit=r;this._textureSize=-1};js.prototype.refresh=function e(t){var r=this;var i=this._gl;var n=t.getShapeList();var a=tt(Math.sqrt(n.length));var o=a*en;var s=new Uint8Array(o*o*4);var u=i.createTexture();for(var l=0;l<n.length;++l){var d=n[l];if(d){var h=d.getDistanceFromStrokeVertically;var f=d.getDistanceFromStrokeHorizontally;var c=l%a*en;var v=Math.floor(l/a)*en;for(var g=0;g<en;++g){for(var p=0;p<en;++p){var _=g+c;var y=p+v;var m=(y*o+_)*4;var x=(g-Bs)/Rs;var b=(p-Bs)/Rs;var S=h(x,b);var A=f(x,b);var E=r._formatShapeDistance(S);var w=r._formatShapeDistance(A);r._writeDistanceToPixel(s,m,E,w)}}}}i.activeTexture(i.TEXTURE0+this._glTextureUnit);i.bindTexture(i.TEXTURE_2D,u);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o,o,0,i.RGBA,i.UNSIGNED_BYTE,s);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR);this._textureSize=o};js.prototype._writeDistanceToPixel=function e(t,r,i,n){t[r]=i>>8;t[r+1]=i%256;t[r+2]=n>>8;t[r+3]=n%256};js.prototype._formatShapeDistance=function e(value){var t=(value+1)/2;return t*6e4};js.prototype.getTextureSize=function e(){return this._textureSize};js.prototype.getSamplingSize=function e(){return en};js.prototype.getBufferRatio=function e(){return tn};js.prototype.getTextureUnit=function e(){return this._glTextureUnit};var Us=1e20;var Vs=24;var Gs=6;var Ws=8;var Hs=.25;var Xs=(Vs+2*Gs)/Vs;var qs=24;var Ys=function e(){this._fontSize=Vs;this._buffer=Gs;this._radius=Ws;this._cutoff=Hs;this._height=Math.ceil(this._fontSize+this._buffer*2*un);this._maxDimension=1;this._gridSize=1;this._canvas=ke();this._canvas.height=this._height;this._canvas.width=1;this._ctx=this._canvas.getContext("2d");this._ctx.textBaseline="middle";this._ctx.textAlign="center";this._ctx.fillStyle="black";this._gridOuter=null;this._gridInner=null;this._f=null;this._d=null;this._z=null;this._v=null};var Zs={SDF_DIV:{configurable:true}};Zs.SDF_DIV.get=function(){return Xs};Ys.prototype.getFontToImageSizeRatio=function e(){return 1+this._buffer*2/this._fontSize};Ys.prototype.draw=function e(t,r,i){var n=this;Ye(this._ctx,r,this._fontSize,i);var a=this._ctx.measureText(t).width+this._buffer*2,o=Js(a)-nn*2,s=o,u=this._height,l=s*u,d=Math.max(s,u);if(this._canvas.width<s){this._canvas.width=s;Ye(this._ctx,r,this._fontSize,i);this._ctx.textAlign="center";this._ctx.textBaseline="middle";this._ctx.fillStyle="black"}if(l>this._gridSize){this._gridOuter=new Float64Array(l);this._gridInner=new Float64Array(l);this._gridSize=l}if(d>this._maxDimension){this._f=new Float64Array(d);this._d=new Float64Array(d);this._z=new Float64Array(d+1);this._v=new Int16Array(d);this._maxDimension=d}this._ctx.clearRect(0,0,s,u);this._ctx.fillText(t,s/2,u/2);var h=this._ctx.getImageData(0,0,s,u),f=new Uint8ClampedArray(l);for(var c=0;c<l;c++){var v=h.data[c*4+3]/255;n._gridOuter[c]=v===1?0:v===0?Us:Math.pow(Math.max(0,.5-v),2);n._gridInner[c]=v===1?Us:v===0?0:Math.pow(Math.max(0,v-.5),2)}Ks(this._gridOuter,s,u,this._f,this._d,this._v,this._z);Ks(this._gridInner,s,u,this._f,this._d,this._v,this._z);for(var g=0;g<l;g++){var p=n._gridOuter[g]-n._gridInner[g];f[g]=Math.max(0,Math.min(255,Math.round(255-255*(p/n._radius+n._cutoff))))}return{height:u,width:s,distance:f}};Object.defineProperties(Ys,Zs);function Ks(e,t,r,i,n,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++){i[u]=e[u*t+s]}Qs(i,n,a,o,r);for(var l=0;l<r;l++){e[l*t+s]=n[l]}}for(var d=0;d<r;d++){for(var h=0;h<t;h++){i[h]=e[d*t+h]}Qs(i,n,a,o,t);for(var f=0;f<t;f++){e[d*t+f]=Math.sqrt(n[f])}}}function Qs(e,t,r,i,n){r[0]=0;i[0]=-Us;i[1]=+Us;for(var a=1,o=0;a<n;a++){var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);while(s<=i[o]){o--;s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o])}o++;r[o]=a;i[o]=s;i[o+1]=+Us}for(var u=0,l=0;u<n;u++){while(i[l+1]<u){l++}t[u]=(u-r[l])*(u-r[l])+e[r[l]]}}function Js(value){return Math.ceil((value+nn*2)/rn)*rn}var $s=256;var eu=0;var tu=1;var ru=2;var iu=3;var nu=4;var au=0;var ou=1;var su={};su[eu]={min:"NEAREST",mag:"NEAREST",mipmap:false};su[tu]={min:"LINEAR",mag:"LINEAR",mipmap:false};su[ru]={min:"LINEAR",mag:"LINEAR",mipmap:false};su[iu]={min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:true};var uu={};uu[au]="ALPHA";uu[ou]="RGBA";var lu=sn-nn*2;var du=on-nn*2;var hu=function e(t,r){this._gl=t;this._glUnit=r;this._colorManager=new zr;this._patternIdToInfoTexture=new Uint8Array($s*$s*4);this._glTextureInfo=null;this._glTextures=[];this._textureSizes=[];this._pixelRatio=1;this._imageCanvas=ke();this._imageCanvas.width=an;this._imageCanvas.height=an;this._imageCanvasContext=this._imageCanvas.getContext("2d");this._canvasForDuplicatedImage=null;this._sdfGenerator=new Ys;this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE));this._warned=false};hu.prototype._warn=function e(){if(!this._warned){Ja("exceeded max WebGL texture size of "+this._maxTextureSize+"; some texts/icons/images won't be displayed");this._warned=true}};hu.prototype.refresh=function e(t){var r=this;this._pixelRatio=t.getPixelRatio();var i=this._gl;var n=this._getPatternsByFilter(t.getPatternList());for(var a=0;a<n.length;++a){var o=a;var s=n[a];var u=r._getApproximateRequestedTextureSize(s);var l=r._fillAtlas(o,s,u);var d=l.texture;var h=l.size;var f=r._glTextures[o]||(r._glTextures[o]=i.createTexture());var c=o===eu?au:ou;r._setupTexture(f,r._glUnit+1+o,d,h,o,c);r._textureSizes[o]=h}var v=this._glTextureInfo||(this._glTextureInfo=i.createTexture());var g=this._patternIdToInfoTexture;this._setupTexture(v,this._glUnit,g,$s,eu,ou)};hu.prototype._setupTexture=function e(t,r,i,n,a,o){var s=this._gl;var u=su[a];var l=u.min;var d=u.mag;var h=u.mipmap;var f=s[uu[o]];if(o===au){var c=new Uint8Array(n*n);for(var v=0;v<c.length;++v){c[v]=i[v*4+3]}i=c}s.activeTexture(s.TEXTURE0+r);s.bindTexture(s.TEXTURE_2D,t);s.texImage2D(s.TEXTURE_2D,0,f,n,n,0,f,s.UNSIGNED_BYTE,i);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s[d]);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s[l]);if(h){s.generateMipmap(s.TEXTURE_2D)}};hu.prototype.getGranularity=function e(){return rn};hu.prototype.getInfoTextureUnit=function e(){return this._glUnit};hu.prototype.getNearestTextureUnit=function e(){return this._glUnit+1+eu};hu.prototype.getLinearTextureUnit=function e(){return this._glUnit+1+tu};hu.prototype.getLinearSdfTextureUnit=function e(){return this._glUnit+1+ru};hu.prototype.getMipmapTextureUnit=function e(){return this._glUnit+1+iu};hu.prototype.getInfoTextureSize=function e(){return $s};hu.prototype.getNearestTextureSize=function e(){return this._textureSizes[eu]};hu.prototype.getLinearTextureSize=function e(){return this._textureSizes[tu]};hu.prototype.getLinearSdfTextureSize=function e(){return this._textureSizes[ru]};hu.prototype.getMipmapTextureSize=function e(){return this._textureSizes[iu]};hu.prototype._getPatternsByFilter=function e(t){var r=this;var i=new Array(nu);for(var n=0;n<nu;++n){i[n]=[]}for(var a=0;a<t.length;++a){var o=r._getPatternPixels(t[a]);i[o.filter].push(o)}return i};hu.prototype._getApproximateRequestedTextureSize=function e(t){var r=0;var i=4;for(var n=0;n<t.length;++n){var a=t[n];var o=a.width;var s=a.height;var u=fu(o);var l=fu(s);r+=u*l;i=Math.max(i,Math.max(u,l))}var d=tt(Math.max(i,Math.sqrt(r)));return Math.min(d,this._maxTextureSize)};hu.prototype._adjustDimension=function e(t,r){return Math.floor((r-t)/2)};hu.prototype._fillAtlas=function e(t,r,i){var n=this;var a=new Uint8Array(i*i*4);var o=Math.ceil(i/rn);var s=new Uint8Array(o*o);var u=[{x:0,y:0}];for(var l=0;l<r.length;++l){var d=r[l];var h=d.id;var f=fu(d.width)/rn;var c=fu(d.height)/rn;var v=n._setPositionOnCanvas(u,s,o,f,c);if(v){var g=d.width;var p=d.height;var _=d.pixels;var y=f*rn;var m=c*rn;var x=v.x*rn+n._adjustDimension(g,y);var b=v.y*rn+n._adjustDimension(p,m);n._copyPixelsOnTexture(a,i,_,x,b,g,p);n._writePatternMetaData(h,t,x,b,y,m)}else if(i<n._maxTextureSize){return n._fillAtlas(t,r,i*2)}else{n._warn();n._writePatternMetaData(h,t,0,0,0,0)}}return{texture:a,size:i}};hu.prototype._copyPixelsOnTexture=function e(t,r,i,n,a,o,s){n=n|0;a=a|0;o=o|0;s=s|0;r=r|0;for(var u=0;u<o;++u){for(var l=0;l<s;++l){var d=(n+u+(a+l)*r)*4;var h=(u+l*o)*4;t[d]=i[h];t[d+1]=i[h+1];t[d+2]=i[h+2];t[d+3]=i[h+3]}}};hu.prototype._writePatternMetaData=function e(t,r,i,n,a,o){var s=t*4;var u=r>>1<<7;var l=r%2<<7;this._patternIdToInfoTexture[s]=i/rn;this._patternIdToInfoTexture[s+1]=n/rn;this._patternIdToInfoTexture[s+2]=u+a/rn;this._patternIdToInfoTexture[s+3]=l+o/rn};hu.prototype._setPositionOnCanvas=function e(t,r,i,n,a){for(var o=0,s=t.length;o<s;++o){var u=t[o];var l=u.x;var d=u.y;var h=u.x+n;var f=u.y+a;var c=h<i&&f<i;if(c){for(var v=l;v<h;++v){if(r[v+d*i]===1){c=false;break}}}if(c){for(var g=d;g<f;++g){if(r[l+g*i]===1){c=false;break}}}if(c){for(var p=l;p<h;++p){for(var _=d;_<f;++_){r[p+_*i]=1}}t.splice(o,1);t.push({x:l,y:f},{x:h,y:d});return u}}return null};hu.prototype._getPatternPixels=function e(t){var r=t.id;var i=t.type;var n=t.attributes;var a=null;if(i===$o){if(n.duplicated){a=this._getDuplicatedImagePixels(n.image)}else if(n.scaled){a=this._getScaledImagePixels(n.image)}else{a=this._getNonScaledImagePixels(n.image)}}else if(i===es){var o=n.text;var s=n.font;var u=n.style;var l=n.size;var d=n.offset;if(n.size==="sdf"){a=this._getSdfTextPixels(o,s,u)}else{a=this._getRegularTextPixels(o,s,u,l,d)}}else if(i===rs){a=this._getIconPixels(n.text,n.font,n.style)}else if(i===ts){a=this._getPieChartPixels(n.colorArray)}else{throw new Error('pattern type "'+i+'" does not exist')}a.id=r;return a};hu.prototype._getScaledImagePixels=function e(t){var r=t.width;var i=t.height;if(r>an||i>an){var n=an/Math.max(t.width,t.height);r*=n;i*=n}if(r&&i){r=fu(r);i=fu(i)}r-=nn*2;i-=nn*2;return this._getImagePixels(t,r,i)};hu.prototype._getNonScaledImagePixels=function e(t){return this._getImagePixels(t,t.width,t.height)};hu.prototype._getDuplicatedImagePixels=function e(t){if(t.width===0||t.height===0){return this._getImagePixels(t,0,0)}if(!this._canvasForDuplicatedImage){this._canvasForDuplicatedImage=ke();this._canvasForDuplicatedImage.width=an;this._canvasForDuplicatedImage.height=an}var r=this._canvasForDuplicatedImage;var i=r.getContext("2d");var n=t.width;var a=t.height;var o=(an-n)/2;var s=(an-a)/2;while(o>0){o-=n}while(s>0){s-=a}for(var u=o;u<an;u+=n){for(var l=s;l<an;l+=a){i.drawImage(t,u,l)}}return this._getImagePixels(r,an,an)};hu.prototype._getImagePixels=function e(t,r,i){var n;if(r===0||i===0){n=new Uint8Array(0)}else{if(this._imageCanvas.width<r||this._imageCanvas.height<i){this._imageCanvas.width=r;this._imageCanvas.height=i}var a=this._imageCanvasContext;cu(a,0,0,r,i);try{a.drawImage(t,0,0,r,i)}catch(e){}n=a.getImageData(0,0,r,i).data}return{width:r,height:i,pixels:n,filter:iu}};hu.prototype._getPieChartPixels=function e(t){var r=du;var i=this._imageCanvasContext;var n=r/2;var a=r/2;var o=0;var s=Math.PI*2/t.length;cu(i,0,0,r,r);i.save();i.rect(0,0,r,r);i.clip();for(var u=0;u<t.length;++u){var l=o+s;i.beginPath();i.moveTo(n,a);i.arc(n,a,r,o,l);i.fillStyle=t[u];i.fill();o=l}i.restore();return{width:r,height:r,pixels:i.getImageData(0,0,r,r).data,filter:tu}};hu.prototype._getTextPixels=function e(t,r,i,n,a,o){var s=this._imageCanvasContext;var u=a*this._pixelRatio;Ye(s,i,u,n);var l=s.measureText(r).width;if(l===0){l=u}var d=0;var h=0;var f=t===iu;if(!f){d=Math.ceil(u*un/2)*2;h=Math.ceil(l*ln/2)*2}var c=Math.ceil(l+h);var v=Math.ceil(u+d);if(this._imageCanvas.width<c){this._imageCanvas.width=c;Ye(s,i,u,n)}s.clearRect(0,0,c,v);s.fillStyle="black";s.textBaseline="middle";s.textAlign="left";s.fillText(r,o+h/2,v/2);return{width:c,height:v,pixels:s.getImageData(0,0,c,v).data,filter:t}};hu.prototype._getRegularTextPixels=function e(t,r,i,n,a){return this._getTextPixels(eu,t,r,i,n,a)};hu.prototype._getIconPixels=function e(t,r,i){return this._getTextPixels(iu,t,r,i,lu,0)};hu.prototype._getSdfTextPixels=function e(t,r,i){var n=this._sdfGenerator.draw(t,r,i,this._pixelRatio);var a=n.width;var o=n.height;var distance=n.distance;var s=new Uint8Array(a*o*4);for(var u=0;u<distance.length;++u){s[u*4+3]=distance[u]}return{width:a,height:o,pixels:s,filter:ru}};function fu(value){return Math.ceil((value+nn*2)/rn)*rn}function cu(e,t,r,i,n){e.clearRect(t,r,i,n)}var vu=false;var gu={byte:1,ubyte:1,short:2,ushort:2,float:4};var pu={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",float:"FLOAT"};var _u=function e(t,r,i){var n=i.metaData;var a=i.vertexSource;var o=i.fragmentSource;var s=i.constants;var u=i.macros;var l=i.glBuffers;this._gl=t;this._ext=r;this._vertexSource=a;this._fragmentSource=o;this._metaData=U(n);this._constants=s;this._macros=u;this._specialGlBuffers=l;this._program=null;this._setupUniforms=null;this._specialAttributes=null;this._baseAttributes=null;this._textAttributes=null;this._stencilUsage=ls;this._compile()};_u.prototype._compile=function e(){var t=this;var r=this._gl;var i=yu(this._vertexSource,this._macros,this._constants);var n=yu(this._fragmentSource,this._macros,this._constants);this._program=mu(r,i,n);this._metaData.attributes.forEach(function(e){e.location=r.getAttribLocation(t._program,e.name);e.byteSize=e.size*gu[e.type];e.glType=pu[e.type]});r.useProgram(this._program);this._specialAttributes=this._createSpecialAttributesFunctions();this._baseAttributes=this._createAttributesFunctions(function(e){return!e.name.startsWith("a_text")});this._textAttributes=this._createAttributesFunctions(function(e){return e.name.startsWith("a_text")});this._setupUniforms=this._createSetupUniformFunction()};_u.prototype._createSetupUniformFunction=function e(){var t=this;var r={int:function(e){return"gl.uniform1i(l."+e+", u."+e+");"},sampler2D:function(e){return"gl.uniform1i(l."+e+", u."+e+");"},float:function(e){return"gl.uniform1f(l."+e+", u."+e+");"},vec2:function(e){return"gl.uniform2f(l."+e+", u."+e+"[0], u."+e+"[1]);"},vec3:function(e){return"gl.uniform3f(l."+e+", u."+e+"[0], u."+e+"[1], u."+e+"[2]);"},vec4:function(e){return"gl.uniform4f(l."+e+", u."+e+"[0], u."+e+"[1], u."+e+"[2], u."+e+"[3]);"}};var i=this._gl;var n={};var a=[];for(var o=0;o<this._metaData.uniforms.length;++o){var s=t._metaData.uniforms[o];var u=s.id;var l=s.name;var d=s.type;var h=i.getUniformLocation(t._program,l);var f=r[d](u);n[u]=h;a.push(f)}var c=new Function("gl","l","u",a.join("\n"));return function(e){return c(i,n,e)}};_u.prototype._createEnableAttributesFunction=function e(t){var r=this;var i=t.map(function(e){var t=e.location;return"gl.enableVertexAttribArray("+t+");"}).join("\n");var n=new Function("gl",i);return function(){return n(r._gl)}};_u.prototype._createDisableAttributesFunction=function e(t){var r=this;var i=t.map(function(e){var t=e.location;return"gl.disableVertexAttribArray("+t+");"}).join("\n");var n=new Function("gl",i);return function(){return n(r._gl)}};_u.prototype._createSetupAttributesFunction=function e(t){var r=this;var i=t.reduce(function(e,t){var r=t.byteSize;return e+r},0);var n=0;var a=["gl.bindBuffer(gl.ARRAY_BUFFER, glBuffer);","if (dataBuffer) { gl.bufferData(gl.ARRAY_BUFFER, dataBuffer, gl.STATIC_DRAW); }"].concat(t.map(function(e){var t=e.location;var r=e.size;var a=e.glType;var o=e.byteSize;var s="gl.vertexAttribPointer("+t+", "+r+", gl."+a+", false, "+i+", "+n+");";n+=o;return s})).concat(t.map(function(e){var t=e.location;return"ext.vertexAttribDivisorANGLE("+t+", divisor);"})).join("\n");var o=new Function("gl","ext","glBuffer","dataBuffer","divisor",a);return function(e,t,i){o(r._gl,r._ext,e,t,i)}};_u.prototype._createAttributesFunctions=function e(t){if(typeof t==="function"){t=this._metaData.attributes.filter(function(e){return e.location!==-1}).filter(t)}var r=this._createEnableAttributesFunction(t);var i=this._createDisableAttributesFunction(t);return{enable:function(){r();this.enabled=true},disable:function(){i();this.enabled=false},setup:this._createSetupAttributesFunction(t),enabled:false}};_u.prototype._createSpecialAttributesFunctions=function e(){return this._createAttributesFunctions([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3}])};_u.prototype.startPass=function e(t){this._gl.useProgram(this._program);this._resetStencil();this._setupUniforms(t);this._specialAttributes.enable();this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)};_u.prototype._setupAttributes=function e(t,r){var i=r.glBuffer;var n=r.dataBuffer;var a=r.divisor;if(t.enabled&&!i){t.disable()}else if(!t.enabled&&i){t.enable()}if(i){t.setup(i,n,a)}};_u.prototype.setupBaseAttributes=function e(t){this._setupAttributes(this._baseAttributes,t)};_u.prototype.setupTextAttributes=function e(t){this._setupAttributes(this._textAttributes,t)};_u.prototype._resetStencil=function e(){var t=this._gl;this._stencilUsage=ls;t.disable(t.STENCIL_TEST)};_u.prototype.setupStencil=function e(t){if(t!==this._stencilUsage){var r=this._gl;if(t!==ls){r.enable(r.STENCIL_TEST);if(t===ds){r.stencilOp(r.KEEP,r.KEEP,r.REPLACE);r.stencilFunc(r.ALWAYS,1,1)}else if(t===hs){r.stencilOp(r.KEEP,r.KEEP,r.KEEP);r.stencilFunc(r.EQUAL,0,1)}}else{r.disable(r.STENCIL_TEST)}this._stencilUsage=t}};_u.prototype.endPass=function e(){this._specialAttributes.disable();this._baseAttributes.disable();this._textAttributes.disable()};function yu(e,t,r){var i=Object.keys(t);var n=Object.keys(r);for(var a=0;a<i.length;++a){var o=i[a];var s=t[o];e=e.replace("#define "+o+" 0","#define "+o+" "+s)}for(var u=0;u<n.length;++u){var l=n[u];var value=r[l];var d=value+(value%1===0?".0":"");e=e.replace("const float "+l+" = 0.0;","const float "+l+" = "+d+";")}return e}function mu(e,t,r){if(vu){t=t.replace("#define D3D9_FIX 0","#define D3D9_FIX 1");r=r.replace("#define D3D9_FIX 0","#define D3D9_FIX 1")}var i=e.createProgram();var n=e.createShader(e.VERTEX_SHADER);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t);e.shaderSource(a,r);e.compileShader(n);e.compileShader(a);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){throw new Error("Vertex shader compilation error:\n"+e.getShaderInfoLog(n))}if(!e.getShaderParameter(a,e.COMPILE_STATUS)){throw new Error("Fragment shader compilation error:\n"+e.getShaderInfoLog(a))}e.attachShader(i,n);e.attachShader(i,a);e.linkProgram(i);if(!e.getProgramParameter(i,e.LINK_STATUS)){var o=e.getProgramInfoLog(i);if(!vu&&o.indexOf("D3D9")!==-1){Qa("Direct3D 9 detected, will use workaround to compile shaders.");vu=true;return mu(e,t,r)}else{throw new Error("Unable to initialize WebGL program:\n"+o)}}return i}var xu=function e(t,r,i){this._gl=t;this._ext=r;this._program=i;this._dataBuffer=null;this._version=0;this._glBuffer=this._gl.createBuffer();this._sideGlBuffer=null;this._used=false;this._dataBufferChanged=false};xu.prototype.setDataBuffer=function e(t){if(this._dataBuffer!==t){this._dataBuffer=t;this._dataBufferChanged=true;if(t.hasSideData()&&!this._sideGlBuffer){this._sideGlBuffer=this._gl.createBuffer()}else if(!t.hasSideData()&&this._sideGlBuffer){this._gl.deleteBuffer(this._sideGlBuffer);this._sideGlBuffer=null}}};xu.prototype.markAsUnused=function e(){this._used=false;return this};xu.prototype.getProgram=function e(){return this._program};xu.prototype.markAsUsed=function e(){this._used=true;return this};xu.prototype.isUsed=function e(){return this._used};xu.prototype.draw=function e(){var t=this._gl;var r=this._dataBuffer.getElementType();var i=r===Ko;var n=i?this._dataBuffer.getNbSideElementsPerMainElement():1;var a=r===Qo?gn:1;var o=this._dataBuffer.getSize();var s=this._dataBuffer.getStencilUsage();var u=this._dataBuffer.getVersion();var l=this._version!==u||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:n});this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&i?this._dataBuffer.getSideByteArray():null,divisor:1});this._program.setupStencil(s);if(l){this._version=u;this._dataBufferChanged=false}this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,6*a,o*n)};xu.prototype.destroy=function e(){this._gl.deleteBuffer(this._glBuffer);if(this._sideGlBuffer){this._gl.deleteBuffer(this._sideGlBuffer)}};var bu=D();var Su="\n".charCodeAt(0);var Au=4;var Eu=12;var wu=25;var Tu=511/wu;var ku=3;function Cu(){var e=S("mapbox-gl-rtl-text");if(e){var t=e.processBidirectionalText;return function(e){return t(e,[]).join("")}}else{return function(e){return e}}}var Iu=function e(t){this._patternManager=t;this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._processBidirectionalText=Cu();this._textPattern={type:is,attributes:{text:"",font:"",size:0,style:"",align:""},dimensions:{width:0,height:0}};this._textDimensions={width:0,height:0};this._lineWidthList=new Array(64);this._init_()};Iu.prototype._init_=function e(){this._mustClear=false;this._byFont={};this._widthAtlases={normal:{},bold:{},italic:{}}};Iu.prototype.reset=function e(){this._init_()};Iu.prototype.clear=function e(){this._mustClear=true};Iu.prototype._measureChar=function e(t,r,i){Ye(this._ctx,r,Eu,i);return this._ctx.measureText(t).width/Eu};Iu.prototype._getAtlas=function e(t,r,i){var n=i==="sdf"?0:i;var a=this._byFont[t]||(this._byFont[t]={});var o=a[r]||(a[r]=new Array(50));var s=o[n]||(o[n]=new Array(256));return s};Iu.prototype._getMeasurementAtlas=function e(t,r){var i=this._widthAtlases[r];var n=i[t]||(i[t]=new Array(256));return n};Iu.prototype.measureText=function e(t,r,i,n){var a=this;if(n===void 0)n=1;if(!r){this._textDimensions.width=0;this._textDimensions.height=0;return this._textDimensions}var o=this._getMeasurementAtlas(r,i);var s=0,u=0;var l=1;for(var d=0;d<t.length;++d){var h=t.charCodeAt(d);if(h===Su){if(u>s){s=u}u=0;l+=1}else{var f=o[h];if(f===undefined){f=a._measureChar(t[d],r,i);o[h]=f}u+=f}}if(u>s){s=u}this._textDimensions.width=s*n;this._textDimensions.height=l*n;return this._textDimensions};Iu.prototype._getCharInfo=function e(t,r,i,n,a,o){var s=this;var u=t[r];if(!u){var l=String.fromCharCode(r);var d=a==="sdf"?1:ku;u={ratio:this._measureChar(l,i,n),patternId:new Array(d)};for(var h=0;h<d;++h){var f=h/d;u.patternId[h]=s._patternManager.getIdFromDefinition({type:es,attributes:{text:l,font:i,style:n,size:a,align:o,offset:f}})}t[r]=u}return u};Iu.prototype.storeTextInDataView=function e(t,r,i,n){var a=this;var o=r;if(n&&n.type===is){var s=n.attributes;var u=s.text;var l=s.font;var d=s.style;var h=s.size;var f=s.align;var c=f==="center";var v=this._getAtlas(l,d,h);var g=0;var p=1;var _=0;var y=0;var m=this._lineWidthList;u=this._processBidirectionalText(u);for(var x=0;x<u.length;++x){var b=u.charCodeAt(x);if(b===Su){if(_>g){g=_}m[y]=_;y+=1;_=0;p+=1}else{var S=a._getCharInfo(v,b,l,d,h,f);_+=S.ratio}}m[y]=_;if(_>g){g=_}if(h==="sdf"){var A=0;var E=-(c?m[A]:g)/2;var w=(-p+1)/2;var T=0;for(var k=0;k<u.length;++k){var C=u.charCodeAt(k);var I=v[C];if(C===Su){A+=1;E=-(c?m[A]:g)/2;w+=1;T=0}else{var M=I.ratio;var L=I.patternId[0];E+=(M+T)/2;T=M;var F=Lu(E*Tu);var N=Mu(w*2);t.setUint16(o,L,bu);t.setUint16(o+2,(F<<6)+N,bu);o+=Au}}}else{var z=0;var P=Math.ceil(-(c?m[z]:g)*h/2);var O=(-p+1)/2;for(var D=0;D<u.length;++D){var R=u.charCodeAt(D);var B=v[R];if(R===Su){z+=1;P=Math.ceil(-(c?m[z]:g)*h/2);O+=1}else{var j=B.ratio*h;var U=Math.floor(P);var V=P-U;var G=Math.round(V*ku);if(G===ku){G=0;U+=1}U+=Math.ceil(j/2);P+=j;var W=B.patternId[G];var H=Lu(U);var X=Mu(O*2);t.setUint16(o,W,bu);t.setUint16(o+2,(H<<6)+X,bu);o+=Au}}}}this._fillWithZeros(t,o,i)};Iu.prototype.extractTextFromDataView=function e(t,r,i){var n=this;var a=t;var o=bu;var s=a.getUint16(r,o);var u=this._textPattern;var l=this._patternManager.getDefinitionFromId(s);var d=l.attributes;var h=d.font;var f=d.style;var c=d.size;var v=d.align;var g=this._getAtlas(h,f,c);var p=[];var _=0;var y=0;var m=0;var x=null;for(var b=r;b<i;b+=Au){var S=a.getUint16(b,o);if(!S){break}var A=Fu(a.getUint16(b+2,o)%64);var E=n._patternManager.getDefinitionFromId(S);if(!E){break}var w=E.attributes.text.charCodeAt(0);var T=g[w];if(x===null){x=A}else if(A>x){if(_>y){y=_}_=0;m+=1;p.push(Su);x=A}p.push(w);if(T){_+=T.ratio}}if(_>y){y=_}var k=String.fromCharCode.apply(null,p);u.attributes.style=f;u.attributes.font=h;u.attributes.size=c;u.attributes.align=v;u.attributes.text=this._processBidirectionalText(k);u.dimensions.width=y;u.dimensions.height=m;return u};Iu.prototype._fillWithZeros=function e(t,r,i){for(var n=r;n<i;n+=Au){t.setUint16(n,0)}};Iu.prototype._clear=function e(){this._byFont={};this._widthAtlases={normal:{},bold:{},italic:{}}};Iu.prototype.update=function e(){if(this._mustClear){this._clear();this._mustClear=false}};Iu.prototype.getVersion=function e(){};function Mu(value){return it(value+32,0,63)}function Lu(value){return it(value+512,0,1023)}function Fu(value){return value-32}var Nu={stencil:true,antialias:false,alpha:true,premultipliedAlpha:true};var zu=0;var Pu=1;var Ou={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'};function Du(value,e){if(!value){var t=new Error(Ou[e]);t.code=e;throw t}}var Ru=function(e){function t(t){e.call(this,t);this._glCanvas=ke();this._gl=ce(this._glCanvas,Nu);Du(this._gl,"NO_WEBGL");this._ext=this._gl.getExtension("ANGLE_instanced_arrays");Du(this._ext,"NO_ANGLE_INSTANCED_ARRAYS");this._shapeTexture=new js(this._gl,zu);this._patternTexture=new hu(this._gl,Pu);this._2dcanvas=ke();this._ctx=this._2dcanvas.getContext("2d");this._glCanvas.style.imageRendering="pixelated";this._glBuffers=[];this._staticProgram=null;this._animatedProgram=null;this._currentProgram=null;this._specialGlBuffers=null;this._initSpecialGlBuffers();this._initPrograms();this._initGl()}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"WebGL"};t.prototype.getDomElement=function e(){return this._glCanvas};t.prototype._initGl=function e(){var t=this._gl;t.clearColor(0,0,0,0);t.enable(t.BLEND);t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)};t.prototype._initPrograms=function e(){var t=Vu();var r=Bu(Os,Ds);this._staticProgram=new _u(this._gl,this._ext,{metaData:r,vertexSource:Os,fragmentSource:Ds,constants:t,macros:{ANIMATED:0},glBuffers:this._specialGlBuffers});this._animatedProgram=new _u(this._gl,this._ext,{metaData:r,vertexSource:Os,fragmentSource:Ds,constants:t,macros:{ANIMATED:1},glBuffers:this._specialGlBuffers})};t.prototype._initSpecialGlBuffers=function e(){var t=this._gl;var r=t.createBuffer();var i=new Int8Array(18*gn);for(var n=0;n<gn;++n){var a=n;var o=[-1,-1,a,1,-1,a,1,1,a,-1,-1,a,-1,1,a,1,1,a];C(i,o,n*18)}t.bindBuffer(t.ARRAY_BUFFER,r);t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW);this._specialGlBuffers={vertexInfo:r}};t.prototype._computeUniforms=function e(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_GRANULARITY:this._patternTexture.getGranularity(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),SHAPE_LINE_ID:this._shapeManager.getIdFromName("line"),SHAPE_TRIANGLE_ID:this._shapeManager.getIdFromName("triangle"),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}};t.prototype._render=function e(t){var r=this;var i=t.shapesChanged;var n=t.patternsChanged;var a=t.dimensionsChanged;var o=t.backgroundColorChanged;var s=this._gl;if(n){this._patternTexture.refresh(this._patternManager)}if(i){this._shapeTexture.refresh(this._shapeManager)}if(a){ze(this._glCanvas,this._width,this._height,this._pixelRatio);s.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio)}if(o){var u=this._backgroundRgba;var l=u[0];var d=u[1];var h=u[2];var f=u[3];s.clearColor(l*f,d*f,h*f,f)}var c=this._computeUniforms();var v=this._startFrame();s.clear(s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT);for(var g=0;g<v.length;++g){r._displayBuffer(v[g],c)}this._endFrame()};t.prototype._displayBuffer=function e(t,r){var i=t.getProgram();if(i!==this._currentProgram){if(this._currentProgram){this._currentProgram.endPass()}this._currentProgram=i;this._currentProgram.startPass(r)}t.markAsUsed();t.draw()};t.prototype._startFrame=function e(){var t=this;var r=this._bufferList.getBuffersByAscendingDepth();var i=[];for(var n=0;n<this._glBuffers.length;++n){var a=t._glBuffers[n];if(a){a.markAsUnused()}}for(var o=0;o<r.length;++o){var s=r[o];var u=t._getAssociatedGlBuffer(s);u.markAsUsed();if(!s.isEmpty()&&t._isBufferDisplayable(s)){i.push(u)}}for(var l=0;l<this._glBuffers.length;++l){var d=t._glBuffers[l];if(d&&!d.isUsed()){d.destroy();t._glBuffers[l]=undefined}}return i};t.prototype._endFrame=function e(){if(this._currentProgram){this._currentProgram.endPass();this._currentProgram=null}};t.prototype._getAssociatedGlBuffer=function e(t){var r=this;var i=t.getId();var n=t.isAnimated()?this._animatedProgram:this._staticProgram;var a=this._glBuffers[i];if(!a){while(this._glBuffers.length<=i){r._glBuffers.push(undefined)}a=new xu(this._gl,this._ext,n);this._glBuffers[i]=a}a.setDataBuffer(t);return a};t.prototype.destroy=function e(){var t=this._gl.getExtension("WEBGL_lose_context");if(t){t.loseContext()}};t.prototype.getImageData=function e(){var t=this._glCanvas.width;var r=this._glCanvas.height;if(this._2dcanvas.width<t||this._2dcanvas.height<r){this._2dcanvas.width=t;this._2dcanvas.height=r}this._ctx.drawImage(this._glCanvas,0,0);return this._ctx.getImageData(0,0,t,r)};t.prototype._getImageDataFlippedYAxis=function e(){var t=this._gl;var r=this._glCanvas.width;var i=this._glCanvas.height;var n=this._ctx.createImageData(r,i);var a=new Uint8Array(n.data.buffer);t.readPixels(0,0,r,i,t.RGBA,t.UNSIGNED_BYTE,a);return n};return t}(zs);function Bu(e,t){var r={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};Uu(r,e);Uu(r,t);return r}var ju={float:1,vec2:2,vec3:3,vec4:4};function Uu(e,t){var r=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g;var i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g;var n=[];var a=r.exec(t);while(a){var o=a[0];if(o==="#endif"){n.pop()}else if(o.startsWith("#if")){n.push(a[4])}else{e.attributes.push({name:a[3],size:ju[a[2]],type:a[1],tags:n.slice()})}a=r.exec(t)}a=i.exec(t);while(a){if(!e.uniforms.some(function(e){var t=e.id;return t===a[1]})){var s=a[1];var u=a[2];var l=u.replace("u_","");e.uniforms.push({id:l,name:u,type:s})}a=i.exec(t)}}function Vu(){return{BYTES_TO_OFFSET_ANGLE:Math.PI*2/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:qs,CURVATURE_RATIO:pn,PATTERN_MARGIN:nn,TEXT_WIDTH_MULTIPLIER:ln,TEXT_HEIGHT_MULTIPLIER:un,SELF_LOOP_CURVATURE_MULTIPLIER:_n,EDGE_ARROW_SIZE_RATIO:vn,NB_PIECES_PER_CURVE:gn,PIECE_NODE_COMPONENT:ns,PIECE_EDGE_BODY:as,PIECE_EDGE_HEAD:os,PIECE_EDGE_TAIL:ss,PIECE_EDGE_TEXT:us,MAX_TEXT_SIZE:wu,BYTES_TO_TEXT_OFFSET:1/Tu,FILTER_NEAREST:eu,FILTER_LINEAR:tu,FILTER_LINEAR_SDF:ru,FILTER_MIPMAP:iu}}var Gu=1/gn;var Wu=function(e){function t(t){e.call(this,t);this._cachePoints=[];this._nextCachePoint=0;this._tmp={x1:0,y1:0,x2:0,y2:0};this._pointCopies=new Array(128);this._renderInfo={bounds:[]};this._clipViewport=true}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype._resetCachePoints=function e(){this._nextCachePoint=0};t.prototype._point=function e(t,r){var i=this._cachePoints[this._nextCachePoint++];if(!i){i={x:0,y:0};this._cachePoints.push(i)}i.x=t;i.y=r;return i};t.prototype.setViewportClipping=function e(t){this._clipViewport=t};t.prototype._getShapePoints=function e(t){return this._shapeManager.getDefinitionFromName(t).points};t.prototype._formatAngle=function e(t){if(t<-Math.PI){return t+Math.PI*2}else if(t>Math.PI){return t-Math.PI*2}else{return t}};t.prototype._computeSymbolicSize=function e(t){return t===0?Infinity:t*this._viewZoom};t.prototype._computeAnimationRatio=function e(t){var r=t.beginTime;var i=t.duration;var n=t.easing;var a=(this._currentTime-r)/i;var o=a*a;var s=o*a;var u=this._easingManager.getPolygonFromName(n);var l=a<.5?0:4;var d=u[l];var h=u[l+1];var f=u[l+2];var c=u[l+3];return it(d+h*a+f*o+c*s,0,1)};t.prototype._mix=function e(t,r,i){return t*(1-i)+r*i};t.prototype._mixColor=function e(t,r,i,n){if(t===r){return t}var a=this._colorManager.parseColor(t);var o=this._colorManager.parseColor(r);var s=Math.round(this._mix(a[0],o[0],i)*255);var u=Math.round(this._mix(a[1],o[1],i)*255);var l=Math.round(this._mix(a[2],o[2],i)*255);var d=this._mix(a[3],o[3],n);return"rgba("+s+","+u+","+l+","+d+")"};t.prototype._displayBuffer=function e(t){var r=this;var i=t.getSize();var n=t.isAnimated();for(var a=0;a<i;++a){var o=r.extractElement(t,a);if(!o.valid){continue}r._displayElement(o,n)}};t.prototype._mixAttributes=function e(t,r,i){var n=this._computeAnimationRatio(i);t.dashLength=this._mix(r.dashLength,t.dashLength,n);t.gapLength=this._mix(r.gapLength,t.gapLength,n);t.offsetAngle=this._mix(r.offsetAngle,t.offsetAngle,n);t.opacity=this._mix(r.opacity,t.opacity,n);t.globalMinVisibleSize=this._mix(r.globalMinVisibleSize,t.globalMinVisibleSize,n);t.strokeMinVisibleSize=this._mix(r.strokeMinVisibleSize,t.strokeMinVisibleSize,n);t.patternMinVisibleSize=this._mix(r.patternMinVisibleSize,t.patternMinVisibleSize,n);t.symbolicSize=this._mix(r.symbolicSize,t.symbolicSize,n);t.curvature=this._mix(r.curvature,t.curvature,n);t.fillColor=this._mixColor(r.fillColor,t.fillColor,n,n);t.strokeColor=this._mixColor(r.strokeColor,t.strokeColor,n,n);t.patternColor=this._mixColor(r.patternColor,t.patternColor,n,n);t.x1=this._mix(r.x1,t.x1,n);t.y1=this._mix(r.y1,t.y1,n);t.x2=this._mix(r.x2,t.x2,n);t.y2=this._mix(r.y2,t.y2,n);t.rectWidthOrSourceRadiusScaled=this._mix(r.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,n);t.rectWidthOrSourceRadiusFixed=this._mix(r.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,n);t.rectHeightOrTargetRadiusScaled=this._mix(r.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,n);t.rectHeightOrTargetRadiusFixed=this._mix(r.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,n);t.thicknessOrFontSizeScaled=this._mix(r.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,n);t.thicknessOrFontSizeFixed=this._mix(r.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,n);t.strokeWidthScaled=this._mix(r.strokeWidthScaled,t.strokeWidthScaled,n);t.strokeWidthFixed=this._mix(r.strokeWidthFixed,t.strokeWidthFixed,n);t.offsetScaled=this._mix(r.offsetScaled,t.offsetScaled,n);t.offsetFixed=this._mix(r.offsetFixed,t.offsetFixed,n);return t};t.prototype._computeRenderInfo=function e(t){var r=this._renderInfo;var i=this._viewZoom;r.shape=this._shapeManager.getDefinitionFromName(t.shape);r.dashLength=t.dashLength;r.gapLength=t.gapLength;r.hasHead=t.hasHead;r.hasTail=t.hasTail;r.pieceId=t.pieceId;r.patternScale=t.patternScale;r.offsetAngle=this._formatAngle(t.offsetAngle);r.isSelfLoop=t.isSelfLoop;r.unusedFlag2=t.unusedFlag2;r.isText=t.isText;r.adjustTextAngle=t.adjustTextAngle;r.unusedFlag1=t.unusedFlag1;r.opacity=t.opacity;r.globalMinVisibleSize=t.globalMinVisibleSize;r.strokeMinVisibleSize=t.strokeMinVisibleSize;r.patternMinVisibleSize=t.patternMinVisibleSize;r.symbolicSize=t.symbolicSize===0?Infinity:t.symbolicSize*i;r.curvature=t.curvature;r.pattern=t.pattern;r.fillColor=t.fillColor;r.strokeColor=t.strokeColor;r.patternColor=t.patternColor;r.pos1OnGraph=this._point(t.x1,t.y1);r.pos2OnGraph=this._point(t.x2,t.y2);r.pos1=this._graphToScreenCoordinates(r.pos1OnGraph);r.pos2=this._graphToScreenCoordinates(r.pos2OnGraph);r.rectWidthOrSourceRadius=t.rectWidthOrSourceRadiusScaled*i+t.rectWidthOrSourceRadiusFixed;r.rectHeightOrTargetRadius=t.rectHeightOrTargetRadiusScaled*i+t.rectHeightOrTargetRadiusFixed;r.thicknessOrFontSize=t.thicknessOrFontSizeScaled*i+t.thicknessOrFontSizeFixed;r.strokeWidth=t.strokeWidthScaled*i+t.strokeWidthFixed;r.offset=t.offsetScaled*i+t.offsetFixed;return r};t.prototype._applyBackgroundBlending=function e(t){if(t.opacity!==1){t.fillColor=this._blendColor(t.fillColor,t.opacity);t.strokeColor=this._blendColor(t.strokeColor,t.opacity);t.textColor=this._blendColor(t.textColor,t.opacity)}};t.prototype._pointArray=function e(t){var r=this._pointCopies[t];if(!r){r=new Array(t);this._pointCopies[t]=r;for(var i=0;i<t;++i){r[i]={x:0,y:0,r:0}}}return r};t.prototype._scalePoints=function e(t,r,i,n){var a=t.shape.points.length;var o=this._pointArray(a);for(var s=0;s<a;++s){var u=t.shape.points[s];var l=o[s];l.x=r.x+u.x*i;l.y=r.y+u.y*n;l.r=i}var d=t.pos2OnGraph.x-t.pos1OnGraph.x;var h=t.pos2OnGraph.y-t.pos1OnGraph.y;if(d!==0||h!==0){var f=Math.sqrt(d*d+h*h);var c=d/f;var v=h/f;for(var g=0,p=o;g<p.length;g+=1){var _=p[g];var y=_.x-r.x;var m=_.y-r.y;_.x=r.x+c*y+v*m;_.y=r.y-v*y+c*m}}return o};t.prototype._drawPoints=function e(t){if(t.length===1){this._drawCircle(t[0],t[0].r)}else{this._drawPolygon(t)}};t.prototype._computeCenter=function e(t){var r=Math.cos(t.offsetAngle);var i=Math.sin(t.offsetAngle);var n=(t.pos1.x+t.pos2.x)/2+r*t.offset;var a=(t.pos1.y+t.pos2.y)/2+i*t.offset;return this._point(n,a)};t.prototype._displayNodeComponent=function e(t,r,i,n){var a=this;var o=this._computeCenter(t);if(t.pattern.type!==is){var s=t.rectWidthOrSourceRadius/2;var u=t.rectHeightOrTargetRadius/2;var l=this._scalePoints(t,o,s,u);if(r||n){this._drawPoints(l)}if(r){this._fill(t.fillColor)}if(n){this._startClip();if(t.pattern.type===ts){var d=t.pattern.attributes.colorArray;if(t.opacity!==1){d=d.map(function(e){return a._blendColor(e,t.opacity)})}this._displayPieChart(o,s,d)}else if(t.pattern.type===rs){var h=0;var f=Math.round(t.rectHeightOrTargetRadius*t.patternScale);var c=t.pattern.attributes.text;var v=t.patternColor;var g=t.pattern.attributes.font;var p=t.pattern.attributes.style;var _=t.pattern.attributes.align;var y=t.rectWidthOrSourceRadius;this._displayText(o,h,c,v,g,f,p,_,y)}else if(t.pattern.type===$o){var m=t.pattern.attributes.image;if(m.isDummy||m.width&&m.height){var x=t.pattern.attributes.duplicated;var b=x?1:t.patternScale;var S=t.rectWidthOrSourceRadius*b;var A=t.rectHeightOrTargetRadius*b;var E=t.pattern.attributes.scaled;var w=t.opacity;this._displayImage(o,S,A,m,E,x,w)}}this._endClip()}if(i){var T=t.strokeWidth/2;var k=this._scalePoints(t,o,s+T,u+T);this._drawPoints(k);this._stroke(t.strokeColor,t.strokeWidth)}}else if(n){var C=0;var I=t.thicknessOrFontSize;var M=t.pattern.attributes.text;var L=t.patternColor;var F=t.pattern.attributes.font;var N=t.pattern.attributes.style;var z=t.pattern.attributes.align;var P=t.rectWidthOrSourceRadius;this._displayText(o,C,M,L,F,I,N,z,P)}};t.prototype._displayElement=function e(t,r){if(!t.end.shape||!t.end.pieceId){return}this._resetCachePoints();var i=r?this._mixAttributes(t.end,t.start,t.animation):t.end;var n=this._computeRenderInfo(i);if(n.symbolicSize<n.globalMinVisibleSize||n.opacity===0){return}this._applyBackgroundBlending(n);var a=n.strokeColor&&n.strokeWidth>0&&n.symbolicSize>=n.strokeMinVisibleSize;var o=n.pattern.type!==Jo&&n.symbolicSize>=n.patternMinVisibleSize;var s=!!n.fillColor;if(n.pieceId===ns){this._displayNodeComponent(n,s,a,o)}else{var u=n.pos2.x-n.pos1.x;var l=n.pos2.y-n.pos1.y;var d=Math.sqrt(u*u+l*l);var h=null;var f=null;var c=null;if(n.isSelfLoop){var v=n.pieceId===us?n.strokeWidth/2:n.rectWidthOrSourceRadius;var g=this._getSelfLoopControlPoints(n.pos1,n.curvature,v);var p=g.x1;var _=g.y1;var y=g.x2;var m=g.y2;h=this._point(p,_);f=this._point(y,m);c=Yu(n.pos1,h,f,n.pos2,1)}else if(n.curvature){h=this._getQuadraticCurveControlPoint(n);c=Hu(n.curvature,d,1)}else{c=d}if(n.pieceId===us){var x=n.strokeWidth;var b=this._getPointOnLine(n.pos1,h,f,n.pos2,.5);var S=this._getTangentOnLine(n.pos1,h,f,n.pos2,.5);if(n.adjustTextAngle&&!n.isSelfLoop&&n.rectWidthOrSourceRadius>=c-x){S.x=1;S.y=0;n.offset=0}var A=-Math.atan2(S.y,S.x);var E=this._formatAngle(n.offsetAngle-A);if(!n.isSelfLoop&&E<0||n.isSelfLoop&&n.offsetAngle<0){S.x*=-1;S.y*=-1}if(A>Math.PI/2||A<-Math.PI/2){A+=Math.PI}var w=this._getOrthogonal(S);var T=b.x+w.x*n.offset;var k=b.y+w.y*n.offset;if(n.fillColor){var C=this._pointArray(4);var I=n.rectWidthOrSourceRadius/2;var M=n.rectHeightOrTargetRadius/2;var L=S.x*I;var F=S.y*I;var N=w.x*M;var z=w.y*M;var P=C[0];var O=C[1];var D=C[2];var R=C[3];P.x=T+L+N;P.y=k+F+z;O.x=T+L-N;O.y=k+F-z;D.x=T-L-N;D.y=k-F-z;R.x=T-L+N;R.y=k-F+z;this._drawPoints(C);this._fill(n.fillColor)}else{var B=this._point(T,k);var j=A;var U=n.thicknessOrFontSize;var V=n.pattern.attributes.text;var G=n.patternColor;var W=n.pattern.attributes.font;var H=n.pattern.attributes.style;var X=n.pattern.attributes.align;var q=n.rectWidthOrSourceRadius;this._displayText(B,j,V,G,W,U,H,X,q)}}else{var Y=n.pieceId===os;var Z=n.pieceId===ss;var K=Math.cos(n.offsetAngle);var Q=Math.sin(n.offsetAngle);n.pos1.x+=K*n.offset;n.pos1.y+=Q*n.offset;n.pos2.x+=K*n.offset;n.pos2.y+=Q*n.offset;var J=n.shape.name==="line";var $=n.thicknessOrFontSize;var ee=n.rectWidthOrSourceRadius;var te=n.rectHeightOrTargetRadius;var re=+n.hasHead;var ie=+n.hasTail;var ne=+(n.shape.points.length!==2);var ae=re+ie;var oe=Zu($);var se=re*oe;var ue=ie*oe;var le=n.isSelfLoop?Infinity:d-ee-te;var de=Math.min(le/ae,oe);var he=oe+Math.max(ee+de-ue,0);var fe=ie*he+(1-ie)*ne*ee;var ce=oe+Math.max(te+de-se,0);var ve=re*ce+(1-re)*ne*te;if(Y||Z){var ge=Z?-1:1;var pe=(Y?c-ve:fe)-ge;var _e=null;var ye=null;if(n.isSelfLoop){var me=this._getTFromLengthOnCubicCurve(n.pos1,h,f,n.pos2,pe-n.strokeWidth/2*ge);_e=this._getPointOnCubicCurve(n.pos1,h,f,n.pos2,me);ye=this._getTangentOnCubicCurve(n.pos1,h,f,n.pos2,me)}else if(n.curvature){var xe=this._getTFromLengthOnQuadraticCurve(n.pos1,h,n.pos2,pe-n.strokeWidth/2*ge);_e=this._getPointOnQuadraticCurve(n.pos1,h,n.pos2,xe);ye=this._getTangentOnQuadraticCurve(n.pos1,h,n.pos2,xe)}else{var be=pe/c;_e=this._mixPoints(n.pos1,n.pos2,be);ye=this._point(u/d,l/d)}ye.x*=ge;ye.y*=ge;if(s){var Se=this._makeTrianglePoints(_e,ye,oe);this._drawPoints(Se);this._fill(n.fillColor)}if(a){var Ae=this._makeTrianglePoints(_e,ye,oe+n.strokeWidth/2);this._drawPoints(Ae);this._stroke(n.strokeColor,n.strokeWidth)}}else{var Ee=c-fe-ve;if(Ee<=0){return}if(J){var we=this._computeLineDash(c,$,fe,ve,n.dashLength,n.gapLength);if(a){this._drawLine(n.pos1,h,f,n.pos2);this._stroke(n.strokeColor,$+n.strokeWidth*2,we)}if(s){this._drawLine(n.pos1,h,f,n.pos2);this._stroke(n.fillColor,$,we)}}else{var Te=fe;var ke=c-ve;if(a){var Ce=this._makeTriangleEdgeBody(n.pos1,h,f,n.pos2,Te,ke,$+n.strokeWidth/2,n.strokeWidth/2);this._drawPoints(Ce);this._stroke(n.strokeColor,n.strokeWidth)}if(s){var Ie=this._makeTriangleEdgeBody(n.pos1,h,f,n.pos2,Te,ke,$,0);this._drawPoints(Ie);this._fill(n.fillColor)}}}}}};t.prototype._makeTriangleEdgeBody=function e(t,r,i,n,a,o,s,u){if(!r){return this._makeStraightTriangleEdge(t,n,a,o,s,u)}else if(!i){return this._makeCurveTriangleEdge(t,r,n,a,o,s,u)}else{return this._makeSelfLoopTriangleEdge(t,r,i,n,a,o,s,u)}};t.prototype._makeCurveTriangleEdge=function e(t,r,i,n,a,o,s){var u=this;var l=gn*2+2;var d=this._pointArray(l);var h=this._getTFromLengthOnQuadraticCurve(t,r,i,n);var f=this._getTFromLengthOnQuadraticCurve(t,r,i,a);var c=(f-h)/gn;var v=(s-o)/gn/2;var g=o/2;var p=h;for(var _=0;_<=gn;++_){var y=u._getPointOnQuadraticCurve(t,r,i,p);var m=u._getTangentOnQuadraticCurve(t,r,i,p);var x=u._getOrthogonal(m);var b=x.x*g;var S=x.y*g;var A=d[_];var E=d[l-1-_];A.x=y.x+b;A.y=y.y+S;E.x=y.x-b;E.y=y.y-S;p+=c;g+=v}return d};t.prototype._makeSelfLoopTriangleEdge=function e(t,r,i,n,a,o,s,u){var l=this;var d=gn*2+2;var h=this._pointArray(d);var f=this._getTFromLengthOnCubicCurve(t,r,i,n,a);var c=this._getTFromLengthOnCubicCurve(t,r,i,n,o);var v=(c-f)/gn;var g=(u-s)/gn/2;var p=s/2;var _=f;for(var y=0;y<=gn;++y){var m=l._getPointOnCubicCurve(t,r,i,n,_);var x=l._getTangentOnCubicCurve(t,r,i,n,_);var b=l._getOrthogonal(x);var S=b.x*p;var A=b.y*p;var E=h[y];var w=h[d-1-y];E.x=m.x+S;E.y=m.y+A;w.x=m.x-S;w.y=m.y-A;_+=v;p+=g}return h};t.prototype._makeStraightTriangleEdge=function e(t,r,i,n,a,o){var s=r.x-t.x;var u=r.y-t.y;var l=Math.sqrt(s*s+u*u);var d=this._point(s/l,u/l);var h=this._getOrthogonal(d);var f=a/2;var c=o/2;var v=this._pointArray(4);var g=v[0];var p=v[1];var _=v[2];var y=v[3];var m=t.x+d.x*i;var x=t.y+d.y*i;var b=t.x+d.x*n;var S=t.y+d.y*n;var A=h.x*f;var E=h.y*f;var w=h.x*c;var T=h.y*c;g.x=m+A;g.y=x+E;p.x=m-A;p.y=x-E;_.x=b-w;_.y=S-T;y.x=b+w;y.y=S+T;return v};t.prototype._makeTrianglePoints=function e(t,r,i){var n=this._pointArray(3);var a=n[0];var o=n[1];var s=n[2];var u=this._getOrthogonal(r);u.x*=i/2;u.y*=i/2;a.x=t.x+u.x;a.y=t.y+u.y;o.x=t.x-u.x;o.y=t.y-u.y;s.x=t.x+r.x*i;s.y=t.y+r.y*i;return n};t.prototype._computeLineDash=function e(t,r,i,n,a,o){var s=[];if(i){s.push(0,i)}if(a&&o){var u=a*r;var l=o*r;var d=u+l;var h=t-n-i-d;var f=0;while(f<h){s.push(u,l);f+=d}var c=t-n-i-f;var v=Math.min(u,c);var g=Math.max(c-v,0);s.push(v,g)}else{s.push(t-n-i,0)}if(n){s.push(0,n)}return s};t.prototype._drawLine=function e(t,r,i,n){if(!r){this._drawStraightLine(t,n)}else if(!i){this._drawQuadraticCurve(t,r,n)}else{this._drawCubicCurve(t,r,i,n)}};t.prototype._getSelfLoopControlPoints=function e(t,r,i){return oa(t.x,t.y,r,i,this._viewAngle,this._tmp)};t.prototype._getQuadraticCurveControlPoint=function e(t){return aa(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))};t.prototype._graphToScreenCoordinates=function e(t){var r=this._width/2;var i=this._height/2;var n=(t.x-this._viewX)*this._viewZoom;var a=(t.y-this._viewY)*this._viewZoom;var o=this._viewAngleCos;var s=this._viewAngleSin;var u=o*n+s*a+r;var l=-s*n+o*a+i;return this._point(u,l)};t.prototype._parseRenderInfo=function e(t,r,i,n){var a=this._renderInfo;var o=t.pattern.type;var s=o===is;var u=this._computeSymbolicSize(t.symbolicSize);var l=t.minVisibleSize;a.skip=u<l;if(a.skip){return a}this._formatEdgeTextData(t);this._formatEdgeTextData(n);var d=t.strokeMinVisibleSize;var h=t.patternMinVisibleSize;var f=t.opacity;var c=t.fillColor;var v=t.strokeColor;var g=t.patternMask;var p=this._graphToScreenSize(t.thicknessScaled,t.thicknessAbsolute);var _=this._graphToScreenSize(t.strokeWidthScaled,t.strokeWidthAbsolute);var y=this._graphToScreenSize(t.offsetScaled,t.offsetAbsolute);var m=this._graphToScreen(t.x,t.y);var x=m.x;var b=m.y;var S,A;var E=this._computeAngle(t.angle,t.unusedFlag3,t.adjustTextAngle);var w=this._computeOffsetAngle(t.offsetAngle,E,t.unusedFlag1);var T=this._graphToScreenSize(t.lengthScaled,t.lengthAbsolute);S=x+Math.cos(w)*y;A=b+Math.sin(w)*y;if(r){var k=this._computeAnimationRatio(i.beginTime,i.duration,i.easing);f=this._mix(f,n.opacity,k);c=this._mixColor(c,n.fillColor,k,k);v=this._mixColor(v,n.strokeColor,k,k);g=this._mixColor(g,n.patternMask,k,k);var C=this._graphToScreen(n.x,n.y);var I=C.x;var M=C.y;var L=this._graphToScreenSize(n.lengthScaled,n.lengthAbsolute);var F=this._graphToScreenSize(n.thicknessScaled,n.thicknessAbsolute);var N=this._graphToScreenSize(n.strokeWidthScaled,n.strokeWidthAbsolute);var z=this._graphToScreenSize(n.offsetScaled,n.offsetAbsolute);var P=this._computeAngle(n.angle,n.unusedFlag3,n.adjustTextAngle);var O=this._computeOffsetAngle(n.offsetAngle,P,n.unusedFlag1);var D=I+Math.cos(O)*z;var R=M+Math.sin(O)*z;if(S===D&&A===R&&E===P){T=this._mix(T,L,k)}else{var B=this._mixPosLengthAngle(S,A,T,E,D,R,L,P,k);S=B.x;A=B.y;T=B.length;E=B.angle}p=this._mix(p,F,k);_=this._mix(_,N,k)}a.thickness=p;a.length=T;a.angle=E;a.strokeWidth=_;a.strokeColor=v;a.fillColor=c;a.opacity=f;a.centerX=S;a.centerY=A;a.pattern=t.pattern;a.patternType=o;a.patternScale=t.patternScale;a.unusedFlag2=t.unusedFlag2;a.textColor=g;a.patternAttributes=t.pattern.attributes;a.isPatternTextOpt=s;a.patternDisplayed=o!==0&&o!==Jo&&u>=h;a.strokeDisplayed=!s&&v&&_>0&&u>=d;a.fillDisplayed=!s;a.sinAngle=Math.sin(E);a.cosAngle=Math.cos(E);this._applyBackgroundBlending(a);this._calculateBounds(a,t);if(this._clipViewport){var j=a.bounds;var U=0,V=0,G=this._width,W=this._height;if(j[0]>G||j[2]<U||j[1]>W||j[3]<V){a.skip=true}}return a};t.prototype._blendColor=function e(t,r){return t?this._mixColor(this._backgroundColor,t,r,1):null};t.prototype._calculateBounds=function e(t,r){var i=t.length;var n=t.thickness;var a=t.angle;var o=t.centerX;var s=t.centerY;var u=t.patternType;var l=t.bounds;if(t.strokeDisplayed||t.fillDisplayed){if(r.shape==="line"){if(r.curvature===0){if(a===0){l[0]=o-i/2-n;l[1]=s-n;l[2]=l[0]+i+n*2;l[3]=l[1]+n*2}else{pa(o-i/2-n,s-n,i+n*2,n*2,a,t.sinAngle,t.cosAngle,l)}}else{if(Math.abs(r.curvature)===1){l[0]=o-i/2-n;l[1]=s-i/2-n;l[2]=l[0]+i+n*2;l[3]=l[1]+i+n*2}else{var d=n*r.curvature*4;l[0]=o-d;l[1]=s-d;l[2]=l[0]+d*2;l[3]=l[1]+d*2}}}else{var h=1.25;l[0]=o-i*h/2;l[1]=s-i*h/2;l[2]=l[0]+i*h;l[3]=l[1]+i*h}}if(t.patternDisplayed){switch(u){case es:case is:case rs:var f=t.pattern.attributes.text;var c=u===rs||t.pattern.attributes.size==="sdf";var v=c?n*t.patternScale:t.pattern.attributes.size;t.isFontSizeScaled=c;t.fontSize=v;l[0]=o-f.length*v/2;l[1]=s-f.length*v/2;l[2]=l[0]+f.length*v;l[3]=l[1]+f.length*v;break;case $o:var g=i*t.patternScale;var p=n*t.patternScale;l[0]=o-g/2;l[1]=s-p/2;l[2]=l[0]+g;l[3]=l[1]+p;break;case ts:l[0]=o-i;l[1]=s-i;l[2]=o+i;l[3]=s+i;break;default:break}}};t.prototype._getTangentOnLine=function e(t,r,i,n,a){if(!r){return this._getTangentOnStraightLine(t,n)}else if(!i){return this._getTangentOnQuadraticCurve(t,r,n,a)}else{return this._getTangentOnCubicCurve(t,r,i,n,a)}};t.prototype._getTangentOnStraightLine=function e(t,r){var i=r.x-t.x;var n=r.y-t.y;var a=Math.sqrt(i*i+n*n);return this._point(i/a,n/a)};t.prototype._getTangentOnQuadraticCurve=function e(t,r,i,n){var a=1-n;var o=a*r.x+n*i.x-(a*t.x+n*r.x);var s=a*r.y+n*i.y-(a*t.y+n*r.y);var u=Math.sqrt(o*o+s*s);return this._point(o/u,s/u)};t.prototype._getTangentOnCubicCurve=function e(t,r,i,n,a){var o=1-a;var s=o*o;var u=a*a;var l=s*(r.x-t.x)+2*o*a*(i.x-r.x)+u*(n.x-i.x);var d=s*(r.y-t.y)+2*o*a*(i.y-r.y)+u*(n.y-i.y);var h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)};t.prototype._mixPoints=function e(t,r,i){var n=this._mix(t.x,r.x,i);var a=this._mix(t.y,r.y,i);return this._point(n,a)};t.prototype._getOrthogonal=function e(t){return this._point(-t.y,t.x)};t.prototype._getPointOnLine=function e(t,r,i,n,a){if(!r){return this._mixPoints(t,n,a)}else if(!i){return this._getPointOnQuadraticCurve(t,r,n,a)}else{return this._getPointOnCubicCurve(t,r,i,n,a)}};t.prototype._getPointOnQuadraticCurve=function e(t,r,i,n){var a=Xu(t.x,r.x,i.x,n);var o=Xu(t.y,r.y,i.y,n);return this._point(a,o)};t.prototype._getPointOnCubicCurve=function e(t,r,i,n,a){var o=qu(t.x,r.x,i.x,n.x,a);var s=qu(t.y,r.y,i.y,n.y,a);return this._point(o,s)};t.prototype._getTFromLengthOnCubicCurve=function e(t,r,i,n,a){var o=t.x;var s=t.y;var u=0;var l=0;for(var d=0;d<gn;++d){u+=Gu;var h=qu(t.x,r.x,i.x,n.x,u);var f=qu(t.y,r.y,i.y,n.y,u);var c=h-o;var v=f-s;var g=Math.sqrt(c*c+v*v);var p=l+g;if(p>a){var _=(p-a)/g;return u-Gu*_}l=p;o=h;s=f}return 1};t.prototype._getTFromLengthOnQuadraticCurve=function e(t,r,i,n){var a=t.x;var o=t.y;var s=0;var u=0;for(var l=0;l<gn;++l){s+=Gu;var d=Xu(t.x,r.x,i.x,s);var h=Xu(t.y,r.y,i.y,s);var f=d-a;var c=h-o;var v=Math.sqrt(f*f+c*c);var g=u+v;if(g>n){var p=(g-n)/v;return s-Gu*p}u=g;a=d;o=h}return 1};return t}(zs);function Hu(e,t,r){var i=Math.abs(e)/pn+jn;var n=i*i;var a=r-.5;var o=a*a;var s=1/(16*n);var u=Math.sqrt(o+s);var l=.5/i*Math.sqrt(n+.25);var d=Math.abs(2*i)*(a*u+.5*l+s*Math.log(Math.abs((a+u)/(-.5+l))));return d*t}function Xu(e,t,r,i){var n=1-i;return n*n*e+2*n*i*t+i*i*r}function qu(e,t,r,i,n){var a=1-n;var o=a*a*a;var s=3*n*a*a;var u=3*n*n*a;var l=n*n*n;return o*e+s*t+u*r+l*i}function Yu(e,t,r,i,n){n+=1e-4;var a=0;var o=e.x;var s=e.y;var u=0;var l=0;for(var d=0;d<gn;++d){l+=Gu;var h=qu(e.x,t.x,r.x,i.x,l);var f=qu(e.y,t.y,r.y,i.y,l);var c=h-o;var v=f-s;var g=Math.sqrt(c*c+v*v);if(l<n){a+=g}else if(u<n){a+=g*((n-u)/Gu)}else{break}o=h;s=f;u=l}return a}function Zu(e){return e*vn}var Ku=!ke().__dummy;var Qu=function(e){function t(t){e.call(this,t);this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._imgCanvas=ke("2d");this._imgCtx=this._imgCanvas.getContext("2d")}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"Canvas"};t.isAvailable=function e(){return Ku};t.prototype.getDomElement=function e(){return this._canvas};t.prototype._render=function e(t){var r=this;var i=t.dimensionsChanged;if(i){Ns(this._canvas,this._width,this._height,this._pixelRatio)}var n=this._ctx;var a=this._width*this._pixelRatio;var o=this._height*this._pixelRatio;n.clearRect(0,0,a,o);if(this._backgroundColor){n.fillStyle=this._backgroundColor;n.fillRect(0,0,a,o)}var s=this._bufferList.getBuffersByAscendingDepth();for(var u=0;u<s.length;++u){var l=s[u];if(r._isBufferDisplayable(l)){r._displayBuffer(l)}}};t.prototype._drawCircle=function e(t,r){var i=this._ctx;var n=this._pixelRatio;var a=t.x*n;var o=t.y*n;var s=r*n;i.beginPath();i.arc(a,o,s,0,Math.PI*2)};t.prototype._drawPolygon=function e(t){var r=this._ctx;var i=this._pixelRatio;r.beginPath();var n=t[0];r.moveTo(n.x*i,n.y*i);for(var a=1;a<t.length;++a){var o=t[a];r.lineTo(o.x*i,o.y*i)}r.closePath()};t.prototype._drawStraightLine=function e(t,r){var i=this._ctx;var n=this._pixelRatio;i.beginPath();i.moveTo(t.x*n,t.y*n);i.lineTo(r.x*n,r.y*n)};t.prototype._drawQuadraticCurve=function e(t,r,i){var n=this._ctx;var a=this._pixelRatio;n.beginPath();n.moveTo(t.x*a,t.y*a);n.quadraticCurveTo(r.x*a,r.y*a,i.x*a,i.y*a)};t.prototype._drawCubicCurve=function e(t,r,i,n){var a=this._ctx;var o=this._pixelRatio;a.beginPath();a.moveTo(t.x*o,t.y*o);a.bezierCurveTo(r.x*o,r.y*o,i.x*o,i.y*o,n.x*o,n.y*o)};t.prototype._fill=function e(t){var r=this._ctx;r.fillStyle=t;r.fill()};t.prototype._stroke=function e(t,r,i){if(i===void 0)i=[];var n=this._ctx;var a=this._pixelRatio;if(a!==1){for(var o=0;o<i.length;++o){i[o]*=a}}n.setLineDash(i);n.lineWidth=r;n.strokeStyle=t;n.stroke()};t.prototype._startClip=function e(){this._ctx.save();this._ctx.clip()};t.prototype._endClip=function e(){this._ctx.restore()};t.prototype._displayText=function e(t,r,i,n,a,o,s,u,l){var d=this._ctx;var h=this._pixelRatio;var f=t.x*h;var c=t.y*h;var v=o*h;var g=u==="center"?0:-l/2;d.save();d.translate(f,c);d.rotate(-r);d.textAlign=u;d.textBaseline="middle";Ye(d,a,v,s);d.fillStyle=n;if(i.indexOf("\n")!==-1){var p=i.split("\n");var _=p.length;var y=(1-_)/2*v;for(var m=0;m<_;++m){d.fillText(p[m],g,y);y+=v}}else{d.fillText(i,g,-1)}d.restore()};t.prototype._displayImage=function e(t,r,i,n,a,o,s){if(this._hideImages){return}if(s!==1){n=this._blendImageOnBackground(n,s)}var u=this._ctx;var l=this._pixelRatio;var d=t.x*l;var h=t.y*l;var f=r*l;var c=i*l;var v=n.width*l;var g=n.height*l;if(a){u.drawImage(n,d-f/2,h-c/2,f,c)}else if(o){var p=d-f/2;var _=h-c/2;var y=d+f/2;var m=h+c/2;var x=d-v/2;var b=h-g/2;while(x>p){x-=v}while(b>_){b-=g}var S=b;while(x<y){while(b<m){u.drawImage(n,x,b,v,g);b+=g}x+=v;b=S}}else{u.drawImage(n,d-v/2,h-g/2,v,g)}};t.prototype._displayPieChart=function e(t,r,i){var n=this._ctx;var a=this._pixelRatio;var o=t.x*a;var s=t.y*a;var u=r*a*2;var l=u*2;if(i.length===1){n.fillStyle=i[0];n.fillRect(o-u,s-u,l,l)}else if(i.length===2){n.fillStyle=i[0];n.fillRect(o-u,s,l,u);n.fillStyle=i[1];n.fillRect(o-u,s-u,l,u)}else{var d=Math.PI*2/i.length;var h=0;for(var f=0;f<i.length;++f){var c=i[f];var v=h+d;n.beginPath();n.moveTo(o,s);n.arc(o,s,u,h,v);n.fillStyle=c;n.fill();h=v}}};t.prototype._blendImageOnBackground=function e(t,r){var i=this._backgroundRgba;var n=Math.round(i[0]*255);var a=Math.round(i[1]*255);var o=Math.round(i[2]*255);var s="rgb("+n+","+a+","+o+")";this._imgCanvas.width=t.width;this._imgCanvas.height=t.height;this._imgCtx.clearRect(0,0,t.width,t.height);this._imgCtx.globalAlpha=1;this._imgCtx.fillStyle=s;this._imgCtx.fillRect(0,0,t.width,t.height);this._imgCtx.globalAlpha=r;this._imgCtx.drawImage(t,0,0);return this._imgCanvas};t.prototype.getImageData=function e(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)};return t}(Wu);var Ju=false;Ogma.beforeFirstInstanceCreated(function(){try{Ju=!!Oe("svg")}catch(e){}});var $u="none";var el={left:"start",center:"middle",right:"end"};var tl="data-element-id";function rl(e,t,r,i,n,a){var o=Oe("image");o.setAttribute("width",nl(i));o.setAttribute("height",nl(n));o.setAttribute("x",nl(t));o.setAttribute("y",nl(r));o.setAttribute("href",e);if(a){a.appendChild(o)}return o}function il(e,t,r,i,n,a,o){if(a===void 0)a=1;var s=Oe("rect");s.setAttribute("x",e);s.setAttribute("y",t);s.setAttribute("width",r);s.setAttribute("height",i);s.setAttribute("fill",n);s.setAttribute("fill-opacity",a);if(o){o.appendChild(s)}return s}function nl(e){return Math.round(e*1e3)/1e3}var al=function(e){function t(t){e.call(this,t);this._svg=Oe("svg");this._defs=Oe("defs");this._background=Oe("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"});this._styles=Oe("g",{class:"styles"});this._defs.appendChild(this._styles);this._svg.setAttribute("pointer-events","none");this._svg.style.userSelect="none";this._svg.appendChild(this._defs);this._svg.appendChild(this._background);this._clear();this._currentElementId=0;this._currentClipPathId=null;this._clipPathCounter=1}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"SVG"};t.isAvailable=function e(){return Ju};t.prototype.getDomElement=function e(){return this._svg};t.prototype._render=function e(t){var r=this;var i=t.dimensionsChanged;if(i){Pe(this._svg,{width:this._width,height:this._height})}if(this._backgroundColor){var n=this._colorManager.rgbaToRgb(this._backgroundColor);this._background.setAttribute("fill",n.color);this._background.setAttribute("fill-opacity",n.opacity)}var a=this._bufferList.getBuffersByAscendingDepth();this._clear();this._svg.removeChild(this._container);for(var o=0;o<a.length;++o){var s=a[o];if(r._isBufferDisplayable(s)){r._displayBuffer(s)}}this._svg.appendChild(this._container)};t.prototype._clear=function e(){if(this._container){this._svg.removeChild(this._container)}this._container=Oe("g");this._svg.appendChild(this._container);if(this._clipPaths){this._defs.removeChild(this._clipPaths)}this._clipPaths=Oe("g");this._defs.appendChild(this._clipPaths);if(this._filters){this._defs.removeChild(this._filters)}this._filters=Oe("g");this._defs.appendChild(this._filters)};t.prototype._displayElement=function t(r,i){this._currentElementId=r.id;e.prototype._displayElement.call(this,r,i)};t.prototype._addBackgroundBlendingFilter=function e(t){var r=this._colorManager.parseColor(this._backgroundColor);var i=t;var n=1-t;var a=r[0]*n;var o=r[1]*n;var s=r[2]*n;var u=[i,0,0,0,a,0,i,0,0,o,0,0,i,0,s,0,0,0,1,0].join(" ");var l="filter-"+this._currentElementId;var d=Oe("filter",{id:l});var h=Oe("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:u});d.appendChild(h);this._filters.appendChild(d);return l};t.prototype._drawCircle=function e(t,r){var i=t.x;var n=t.y;var a="M "+(i-r)+", "+n+" a "+r+","+r+" 0 1,0 "+2*r+",0 a "+r+","+r+" 0 1,0 -"+2*r+",0";var o=Oe("path");o.setAttribute("d",a);o.setAttribute("fill",$u);o.setAttribute(tl,this._currentElementId);this._container.appendChild(o);this._element=o};t.prototype._drawPolygon=function e(t){var r=Oe("path");var i="";for(var n=0;n<t.length;n++){var a=t[n];var o=a.x;var s=a.y;i+=""+(n===0?"M":"L")+o+","+s+" "}i+="Z";r.setAttribute("d",i);r.setAttribute(tl,this._currentElementId);r.setAttribute("fill",$u);this._container.appendChild(r);this._element=r};t.prototype._drawStraightLine=function e(t,r){var i=Oe("path");var n=t.x,a=t.y,o=r.x,s=r.y;var u="M "+n+","+a+" L"+o+","+s;i.setAttribute("d",u);i.setAttribute(tl,this._currentElementId);this._container.appendChild(i);this._element=i};t.prototype._drawQuadraticCurve=function e(t,r,i){var n=Oe("path");var a=t.x,o=t.y;var s=r.x,u=r.y;var l=i.x,d=i.y;var h="M "+a+","+o+" Q"+s+","+u+" "+l+","+d;n.setAttribute("d",h);n.setAttribute("fill",$u);n.setAttribute(tl,this._currentElementId);this._container.appendChild(n);this._element=n};t.prototype._drawCubicCurve=function e(t,r,i,n){var a=Oe("path");var o=t.x,s=t.y;var u=r.x,l=r.y;var d=i.x,h=i.y;var f=n.x,c=n.y;var v="M "+o+","+s+" C"+u+","+l+" "+d+","+h+" "+f+","+c;a.setAttribute("d",v);a.setAttribute("fill",$u);a.setAttribute(tl,this._currentElementId);this._container.appendChild(a);this._element=a};t.prototype._fill=function e(t){t=this._colorManager.rgbaToRgb(t);this._element.setAttribute("fill",t.color);this._element.setAttribute("fill-opacity",t.opacity)};t.prototype._stroke=function e(t,r,i){if(i===void 0)i=[];var n=this._element;n.setAttribute("stroke-width",r);t=this._colorManager.rgbaToRgb(t);n.setAttribute("stroke",t.color);n.setAttribute("stroke-opacity",t.opacity);if(i.length>0){n.setAttribute("stroke-dasharray",i.map(nl))}};t.prototype._startClip=function e(){var t=Oe("clipPath");var r=this._element.cloneNode(false);this._currentClipPathId="clip-path-"+this._clipPathCounter++;t.appendChild(r);this._clipPaths.appendChild(t);t.setAttribute("id",this._currentClipPathId)};t.prototype._endClip=function e(){this._currentClipPathId=null};t.prototype._displayText=function e(t,r,i,n,a,o,s,u){var l=Oe("text");l.setAttribute(tl,this._currentElementId);var d=this._colorManager.rgbaToRgb(n);var h=d.opacity;var f=this._colorManager.rgbaToRgb(d.color);var c=t.x;var v=t.y;s=s||"normal";var g=nl(c);l.setAttribute("x",g);l.setAttribute("font-family",a);l.setAttribute("font-size",o);if(s==="bold"){l.setAttribute("font-weight",s)}else{l.setAttribute("font-style",s)}l.setAttribute("fill",f.color);l.setAttribute("fill-opacity",h);if(r){l.setAttribute("transform","rotate("+Hr(-r)+" "+c+", "+v+")")}l.setAttribute("text-anchor",el[u]||"middle");var p=i.split("\n");var _=p.length;var y=(_+1)/2-1/3;l.setAttribute("y",nl(v-y*o));for(var m=0;m<_;m++){var x=Oe("tspan");x.appendChild(De(p[m]));x.setAttribute("x",g);x.setAttribute("dy",o);l.appendChild(x)}if(this._currentClipPathId){l.setAttribute("clip-path","url(#"+this._currentClipPathId+")")}this._container.appendChild(l)};t.prototype._displayImage=function e(t,r,i,n,a,o,s){var u=t.x;var l=t.y;if(this._hideImages||!n.isDummy&&(!n.width||!n.height)){return}var d=r;var h=i;var f=n.width;var c=n.height;var v;if(a){f=d;c=h}if(o){var g=u-d/2;var p=l-h/2;var _=u+d/2;var y=l+h/2;var m=u-f/2;var x=l-c/2;v=Oe("g");v.setAttribute(tl,this._currentElementId);while(m>g){m-=f}while(x>p){x-=c}var b=x;while(m<_){while(x<y){rl(n.src,m,x,f,c,v);x+=c}x=b;m+=f}}else{v=rl(n.src,u-f/2,l-c/2,f,c);v.setAttribute(tl,this._currentElementId)}if(this._currentClipPathId){v.setAttribute("clip-path","url(#"+this._currentClipPathId+")")}if(s!==1){var S=this._addBackgroundBlendingFilter(s);v.setAttribute("filter","url(#"+S+")")}this._container.appendChild(v)};t.prototype._displayPieChart=function e(t,r,i){var n=r*2;var a=n*2;var o=t.x,s=t.y;var u;var l=Oe("g");l.setAttribute(tl,this._currentElementId);if(i.length===1){u=il(o-n,s-n,a,a,i[0],1,l)}else if(i.length===2){u=il(o-n,s,a,n,i[0],1,l);u=il(o-n,s-n,a,n,i[1],1,l)}else{var d=Math.PI*2/i.length;var h=0;for(var f=0;f<i.length;++f){var c=h+d;var v=o+r*Math.cos(c);var g=s+r*Math.sin(c);var p=o+r*Math.cos(h);var _=s+r*Math.sin(h);var y=c-h<=Math.PI?0:1;var m="M "+v+","+g+" A "+r+","+r+" 0 "+y+" 0 "+p+","+_+" L "+o+","+s+" L "+v+","+g;u=Oe("path");u.setAttribute("d",m);u.setAttribute("fill",i[f]);u.setAttribute("stroke-width",0);h=c;l.appendChild(u)}}if(this._currentClipPathId){l.setAttribute("clip-path","url(#"+this._currentClipPathId+")")}this._container.appendChild(l)};return t}(Wu);var ol=function e(){this._version=0;this._init_()};ol.prototype.reset=function e(){this._init_()};ol.prototype._init_=function e(){this._mustUpdate=true;this.maxCoord=0;this.maxScaledSize=0;this.maxMinVisibleSize=0;this.maxSymbolicSize=0;this.maxDashLength=0;this.maxGapLength=0;this.maxPatternScale=0};ol.prototype._mustUpdateBoundary=function e(t,r){return r>t};ol.prototype.set=function e(t){var r=t.maxCoord;var i=t.maxScaledSize;var n=t.maxMinVisibleSize;var a=t.maxSymbolicSize;var o=t.maxDashLength;var s=t.maxGapLength;var u=t.maxPatternScale;var l=this._mustUpdateBoundary(this.maxCoord,r)||this._mustUpdateBoundary(this.maxScaledSize,i)||this._mustUpdateBoundary(this.maxMinVisibleSize,n)||this._mustUpdateBoundary(this.maxSymbolicSize,a)||this._mustUpdateBoundary(this.maxDashLength,o)||this._mustUpdateBoundary(this.maxGapLength,s)||this._mustUpdateBoundary(this.maxPatternScale,u);if(l){this.maxCoord=r;this.maxScaledSize=i;this.maxMinVisibleSize=n;this.maxSymbolicSize=a;this.maxDashLength=o;this.maxGapLength=s;this.maxPatternScale=u;this._mustUpdate=true}return l};ol.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};ol.prototype.getVersion=function e(){return this._version};var sl={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]};var ul=function e(){this._linearEasing=[0,1,0,0,0,1,0,0];this._nameToPolygon={};this._polygonToName={};this.add(sl)};ul.prototype.add=function e(t){var r=this;Object.keys(t).forEach(function(e){var i=t[e].slice();if(i.length<8){i[4]=i[0];i[5]=i[1];i[6]=i[2];i[7]=i[3]}var n=ll(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]);r._nameToPolygon[e]=i;r._polygonToName[n]=e})};ul.prototype.getPolygonFromName=function e(t){return this._nameToPolygon[t]||this._linearEasing};ul.prototype.getNameFromPolygon=function e(t,r,i,n,a,o,s,u){var l=ll(t,r,i,n,a,o,s,u);return this._polygonToName[l]||"linear"};function ll(e,t,r,i,n,a,o,s){return e+n+(t+a)*256+(r+o)*65536+(i+s)*16777216}var dl=function e(){var t=this;this._elementType=Zo;this._animated=false;this._size=0;this._capacity=Hi;this._depth=0;this._id=0;this._stencilUsage=ls;this._baseElt=Fs();this._list=new Array(this._capacity);for(var r=0;r<this._capacity;++r){t._list[r]=Fs()}};dl.prototype.setDepth=function e(t){this._depth=t;return this};dl.prototype.reset=function e(t,r,i,n){this._elementType=t;this._animated=r;this._depth=i;this._id=n;this._stencilUsage=ls;this._size=0;return this};dl.prototype.setStencilUsage=function e(t){this._stencilUsage=t};dl.prototype.next=function e(){if(this._size>=this._capacity){throw new Error("internal error: block.next() was called on a full block")}return this._list[this._size++]};dl.prototype.nextAndReset=function e(){var t=this.next();Ms(t.end);Ms(t.start);Ls(t.animation);return t};dl.prototype.forEach=function e(t){this._list.forEach(t)};dl.prototype.getElement=function e(t){return this._list[t]};dl.prototype.getCurrentElement=function e(){return this._list[this._size-1]};dl.prototype.getSize=function e(){return this._size};dl.prototype.getDepth=function e(){return this._depth};dl.prototype.getElements=function e(){return this._list};dl.prototype.getType=function e(){return this._elementType};dl.prototype.getId=function e(){return this._id};dl.prototype.isAnimated=function e(){return this._animated};dl.prototype.getStencilUsage=function e(){return this._stencilUsage};dl.prototype.setGlobalAnimation=function e(t,r,i){var n=this;for(var a=0;a<this._size;++a){var o=n._list[a].animation;o.duration=t;o.beginTime=r;o.easing=i}};var hl=function e(){this._maps=[]};hl.prototype.reset=function e(){this._maps=[]};hl.prototype.set=function e(t,r,i){var n=this;var a=t.getId();while(this._maps.length<=a){n._maps.push(new Array(Wi))}this._maps[a][r]=i};hl.prototype.get=function e(t,r){return this._maps[t.getId()][r]};var fl={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,hideImages:false,isBufferDisplayable:function(){return true}};var cl={webgl:Ru,canvas:Qu,svg:al,null:zs};var vl=Math.PI*2;var gl=[0,0,0,0];var pl=function e(){this._colorManager=new zr;this._easingManager=new ul;this._patternManager=new cs;this._shapeManager=new vs;this._boundariesManager=new ol;this._textManager=new Iu(this._patternManager);this._bufferList=new Ts;this._idRecorder=new hl;this._maxCoord=0;this._maxScaledSize=0;this._maxPixelSize=0;this._maxMinVisibleSize=0;this._maxSymbolicSize=0;this._maxDashLength=0;this._maxGapLength=0;this._maxPatternScale=0;this._actualCoordToBytes=1;this._actualScaledSizeToBytes=Ki;this._actualMinVisibleSizeToBytes=Ji;this._actualSymbolicSizeToBytes=Zi;this._actualDashLengthToBytes=$i;this._actualGapLengthToBytes=$i;this._actualPatternScaleToBytes=Zi;this._blockIdToAddress=new Uint32Array(0);this._currentDataView=null;this._currentElementSize=0;this._currentBlockOffset=0;this._currentByteOffset=0;this._view=U(fl);this._domElement=typeof document!=="undefined"?document.createElement("div"):Se();this._renderersByType={};this._switchMainRenderer=true;this._renderType=null;this._renderer=null;this._littleEndian=D();this._additionalCanvases=[];this._refreshTexts=false};pl.prototype.addCanvas=function e(t){this._resizeCanvas(t);this._additionalCanvases.push(t);this._updateDomElement()};pl.prototype.removeCanvas=function e(t){M(this._additionalCanvases,t);this._updateDomElement()};pl.prototype.createBlock=function e(){return new dl};pl.prototype.parseColor=function e(t){return this._colorManager.parseColor(t)};pl.prototype.clear=function e(){this._blockIdToAddress.fill(0);this._patternManager.reset();this._boundariesManager.reset();this._textManager.reset();this._bufferList.reset();this._idRecorder.reset()};pl.prototype.notifyFontsReloaded=function e(){this._patternManager.notifyUpdate();this._textManager.clear();this._refreshTexts=true};pl.prototype.notifyPatternUpdate=function e(){this._patternManager.notifyUpdate()};pl.prototype.getShapePoints=function e(t){return this._shapeManager.getDefinitionFromName(t).points};pl.prototype.checkShapeHit=function e(t,r,i){var n=this._shapeManager.getDefinitionFromName(t);var a=n.getDistanceFromStrokeVertically;var o=n.getDistanceFromStrokeHorizontally;return Math.min(a(r,i),o(r,i))>=0};pl.prototype.setGlobalBoundaries=function e(t){var r=t.maxBlockId;if(r===void 0)r=0;var i=t.maxCoord;var n=t.maxScaledSize;var a=t.maxMinVisibleSize;var o=t.maxSymbolicSize;var s=t.maxDashLength;var u=t.maxGapLength;var l=t.maxPatternScale;if(r>this._blockIdToAddress.length){this._resizeBlockArray(r)}if(this._boundariesManager.set(t)){this._maxCoord=i;this._maxScaledSize=n;this._maxMinVisibleSize=a;this._maxSymbolicSize=o;this._maxDashLength=s;this._maxGapLength=u;this._maxPatternScale=l;this._actualCoordToBytes=1;this._actualScaledSizeToBytes=Qi/n;this._actualMinVisibleSizeToBytes=Ji/a;this._actualSymbolicSizeToBytes=Zi/o;this._actualDashLengthToBytes=$i/s;this._actualGapLengthToBytes=$i/u;this._actualPatternScaleToBytes=Zi/l;return true}return false};pl.prototype._resizeBlockArray=function e(t){var r=new Uint32Array(t);r.set(this._blockIdToAddress);this._blockIdToAddress=r};pl.prototype._clamp=function e(t,r,i){return Math.min(Math.max(t,r),i)};pl.prototype._signedToUnsignedShort=function e(value){return this._clamp(value+32768,0,65535)};pl.prototype._parseColor=function e(t){return this._colorManager.parseColor(t)||gl};pl.prototype._colorToBytes=function e(t){var r=this._parseColor(t);var i=Math.round(r[0]*15);var n=Math.round(r[1]*15);var a=Math.round(r[2]*15);var o=Math.round(r[3]*15);return i+(n<<4)+(a<<8)+(o<<12)};pl.prototype._formatAngle=function e(t){return this._clampAngle(t)*(Qi/vl)};pl.prototype._clampAngle=function e(t){return(t%vl+vl)%vl};pl.prototype._coordToBytes=function e(value){return value};pl.prototype._scaledSizeToBytes=function e(value){return Math.ceil(Math.min(value,this._maxScaledSize)*this._actualScaledSizeToBytes)};pl.prototype._fixedSizeToBytes=function e(value){return value};pl.prototype._minVisibleSizeToBytes=function e(value){return Math.round(Math.min(value,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)};pl.prototype._symbolicSizeToBytes=function e(value){return Math.round(Math.min(value,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)};pl.prototype._dashLengthToBytes=function e(value){return Math.round(Math.min(value,this._maxDashLength)*this._actualDashLengthToBytes)};pl.prototype._gapLengthToBytes=function e(value){return Math.round(Math.min(value,this._maxGapLength)*this._actualGapLengthToBytes)};pl.prototype._patternScaleToBytes=function e(value){return Math.round(Math.min(value,this._maxPatternScale)*this._actualPatternScaleToBytes)};pl.prototype._offsetAngleToBytes=function e(value){return Math.round((value+vl)%vl*(8/vl))};pl.prototype._opacityToBytes=function e(value){return Math.round(Math.min(value,1)*15)};pl.prototype._curvatureToBytes=function e(value){return this._signedToUnsignedByte(value)};pl.prototype._signedToUnsignedByte=function e(value){return this._clamp(value,-128,127)+128};pl.prototype.registerShape=function e(t,r){this._shapeManager.register(t,r)};pl.prototype._bindBlock=function e(t,r,i,n,a,o,s){this._checkBlockId(t);var u=this._blockIdToAddress[t];var l=this._bufferList.allocateBlock(u,r,i,n,a,o,s);this._blockIdToAddress[t]=l.address;this._currentDataView=l.buffer.getDataView();this._currentElementSize=l.buffer.getElementSize();this._currentBlockOffset=l.offset;this._currentByteOffset=this._currentBlockOffset*this._currentElementSize;this._currentSideDataView=l.buffer.getSideDataView();this._currentSideElementSize=l.buffer.getTotalSideElementsSize();this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize;return l};pl.prototype._setItemIndex=function e(t){var r=this._currentBlockOffset+t;this._currentByteOffset=r*this._currentElementSize;this._currentSideByteOffset=r*this._currentSideElementSize};pl.prototype._freeBlock=function e(t){this._checkBlockId(t);var r=this._blockIdToAddress[t];var i=this._bufferList.freeBlock(r);this._blockIdToAddress[t]=i;return i};pl.prototype._checkBlockId=function e(t){if(t>=this._blockIdToAddress.length){this._resizeBlockArray(tt(t+1))}};pl.prototype._setUint16=function e(t,value){this._currentDataView.setUint16(this._currentByteOffset+t,value,this._littleEndian)};pl.prototype._setInt16=function e(t,value){this._currentDataView.setInt16(this._currentByteOffset+t,value,this._littleEndian)};pl.prototype._setUint8=function e(t,value){this._currentDataView.setUint8(this._currentByteOffset+t,value)};pl.prototype._setInt8=function e(t,value){this._currentDataView.setInt8(this._currentByteOffset+t,value)};pl.prototype._setFloat32=function e(t,value){this._currentDataView.setFloat32(this._currentByteOffset+t,value,this._littleEndian)};pl.prototype._setAnimationBeginTime=function e(t,r){this._setFloat32(t,r)};pl.prototype._setAnimationDuration=function e(t,r){this._setFloat32(t+4,r)};pl.prototype._setAnimationEasing=function e(t,r){var i=this._easingManager.getPolygonFromName(r);this._setUint16(t+8,(i[0]+128<<8)+(i[4]+128));this._setUint16(t+10,(i[1]+128<<8)+(i[5]+128));this._setUint16(t+12,(i[2]+128<<8)+(i[6]+128));this._setUint16(t+14,(i[3]+128<<8)+(i[7]+128))};pl.prototype._setTextCharacters=function e(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)};pl.prototype._storeGenericObject=function e(t,r){var i=this._shapeManager.getIdFromName(r.shape);var n=this._dashLengthToBytes(r.dashLength);var a=this._gapLengthToBytes(r.gapLength);var o=+r.hasHead;var s=+r.hasTail;var u=r.pieceId;var l=this._patternScaleToBytes(r.patternScale);var d=this._offsetAngleToBytes(r.offsetAngle);var h=+r.isSelfLoop;var f=+r.unusedFlag2;var c=+r.isText;var v=+r.adjustTextAngle;var g=+r.unusedFlag1;var p=this._opacityToBytes(r.opacity);var _=this._minVisibleSizeToBytes(r.globalMinVisibleSize);var y=this._minVisibleSizeToBytes(r.strokeMinVisibleSize);var m=this._minVisibleSizeToBytes(r.patternMinVisibleSize);var x=this._symbolicSizeToBytes(r.symbolicSize);var b=this._curvatureToBytes(r.curvature);var S=this._patternManager.getIdFromDefinition(r.pattern);var A=this._colorToBytes(r.fillColor);var E=this._colorToBytes(r.strokeColor);var w=this._colorToBytes(r.patternColor);var T=this._coordToBytes(r.x1);var k=this._coordToBytes(r.y1);var C=this._coordToBytes(r.x2);var I=this._coordToBytes(r.y2);var M=this._scaledSizeToBytes(r.rectWidthOrSourceRadiusScaled);var L=this._fixedSizeToBytes(r.rectWidthOrSourceRadiusFixed);var F=this._scaledSizeToBytes(r.rectHeightTargetRadiusScaled);var N=this._fixedSizeToBytes(r.rectHeightTargetRadiusFixed);var z=this._scaledSizeToBytes(r.thicknessOrFontSizeScaled);var P=this._fixedSizeToBytes(r.thicknessOrFontSizeFixed);var O=this._scaledSizeToBytes(r.strokeWidthScaled);var D=this._fixedSizeToBytes(r.strokeWidthFixed);var R=this._scaledSizeToBytes(r.offsetScaled);var B=this._fixedSizeToBytes(r.offsetFixed);var j=i+(n<<4)+(a<<6)+(o<<8)+(s<<9)+(u<<10);var U=l+(d<<8)+(h<<11)+(f<<12)+(c<<13)+(v<<14)+(g<<15);var V=p+(_<<4)+(y<<8)+(m<<12);var G=x+(b<<8);this._setUint16(t+0,j);this._setUint16(t+2,U);this._setUint16(t+4,V);this._setUint16(t+6,G);this._setUint16(t+8,S);this._setUint16(t+10,A);this._setUint16(t+12,E);this._setUint16(t+14,w);this._setFloat32(t+16,T);this._setFloat32(t+20,k);this._setFloat32(t+24,C);this._setFloat32(t+28,I);this._setUint16(t+32,M);this._setUint16(t+34,L);this._setUint16(t+36,F);this._setUint16(t+38,N);this._setUint16(t+40,z);this._setUint16(t+42,P);this._setUint16(t+44,O);this._setUint16(t+46,D);this._setUint16(t+48,R);this._setUint16(t+50,B)};pl.prototype._storeAnimationInformation=function e(t,r){this._setAnimationBeginTime(t,r.beginTime);this._setAnimationDuration(t,r.duration);this._setAnimationEasing(t,r.easing)};pl.prototype._storeElement=function e(t,r){this._storeGenericObject(0,t.end);if(r){this._storeGenericObject(dn,t.start);this._storeAnimationInformation(dn*2,t.animation)}};pl.prototype.storeBlock=function e(t,r){var i=this;if(!r||!r.getSize()){return this._freeBlock(t)}var n=r.getType();var a=r.getDepth();var o=r.getSize();var s=r.getElements();var u=r.isAnimated();var l=r.getStencilUsage();var d=r.getId();var h=0;if(n===Ko){for(var f=0;f<o;++f){var c=s[f];if(c.end.pattern.type===is){h=Math.max(h,c.end.pattern.attributes.text.length)}if(u&&c.start.pattern.type===is){h=Math.max(h,c.start.pattern.attributes.text.length)}}}var v=this._bindBlock(t,n,u,a,o,h,l);for(var g=0;g<o;++g){var p=s[g];i._setItemIndex(g);i._storeElement(p,u);i._idRecorder.set(v.buffer,v.offset+g,d)}if(n===Ko){for(var _=0;_<o;++_){var y=s[_];i._setItemIndex(_);i._setTextCharacters(y.end.pattern)}}return v.address};pl.prototype.freeBlock=function e(t){return this._freeBlock(t)};pl.prototype._refreshTextElements=function e(){var t=this;var r=this._bufferList.getBuffers();for(var i=0,n=r;i<n.length;i+=1){var a=n[i];if(a&&a.getElementType()===Ko){var o=a.getSideDataView();var s=a.getTotalSideElementsSize();var u=a.getSize();var l=0;var d=s;for(var h=0;h<u;++h){var f=t._textManager.extractTextFromDataView(o,l,d);t._textManager.storeTextInDataView(o,l,d,f);l=d;d+=s}a.triggerUpdate()}}};pl.prototype._extractElement=function e(t,r){if(!t){return null}var i=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(i.buffer,i.offset+r)};pl.prototype.extractElement=function e(t,r){if(r===void 0)r=0;return this._extractElement(t,r)};pl.prototype.getDomElement=function e(){return this._domElement};pl.prototype.measureText=function e(t,r,i,n){if(n===void 0)n=1;return this._textManager.measureText(t,r,i,n)};pl.prototype.setRenderType=function e(t){if(this._renderType!==t){this._renderType=t;this._switchMainRenderer=true}};pl.prototype._setMainRenderer=function e(){this._renderer=this._renderersByType[this._renderType];if(!this._renderer){this._renderer=this._instanciateRenderer(this._renderType);this._renderersByType[this._renderType]=this._renderer}this._updateDomElement()};pl.prototype._updateDomElement=function e(){var t=this;var r=this._renderer&&this._renderer.getDomElement();while(this._domElement.firstChild){t._domElement.removeChild(t._domElement.firstChild)}if(r){this._appendDomChild(r)}for(var i=0;i<this._additionalCanvases.length;++i){t._appendDomChild(t._additionalCanvases[i])}};pl.prototype._appendDomChild=function e(t){t.style.position="absolute";t.style.left="0";t.style.top="0";this._domElement.appendChild(t)};pl.prototype._instanciateRenderer=function e(t){var r=cl[t]||zs;return new r({bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,colorManager:this._colorManager,easingManager:this._easingManager,idRecorder:this._idRecorder})};pl.prototype.setView=function e(t){Object.assign(this._view,t)};pl.prototype._updateManagers=function e(){this._patternManager.setPixelRatio(this._view.pixelRatio);this._shapeManager.update();this._patternManager.update();this._textManager.update();this._boundariesManager.update();this._bufferList.update();if(this._refreshTexts){this._refreshTexts=false;this._refreshTextElements()}};pl.prototype._resizeCanvas=function e(t){Ns(t,this._view.width,this._view.height,this._view.pixelRatio)};pl.prototype.render=function e(){var t=this;if(this._switchMainRenderer){this._setMainRenderer();this._switchMainRenderer=false}if(this._domElement.offsetWidth!==this._view.width||this._domElement.offsetHeight!==this._view.height){this._domElement.style.width=this._view.width+"px";this._domElement.style.height=this._view.height+"px";for(var r=0;r<this._additionalCanvases.length;++r){t._resizeCanvas(t._additionalCanvases[r])}}this._updateManagers();this._renderer.renderFrame(this._view)};pl.prototype.export=function e(t,r,i){var n=this._instanciateRenderer(t);var a=Object.assign({},this._view,r);n.setViewportClipping(false);this._updateManagers();n.renderFrame(a);return n.export(i).then(function(){return n.getDomElement()})};pl.prototype.getCurrentTime=function e(){return tr()};pl.prototype.getImageData=function e(){return this._renderer&&this._renderer.getImageData()};pl.prototype.destroy=function e(){var t=this;for(var r=0,i=Object.keys(t._renderersByType);r<i.length;r+=1){var n=i[r];var a=t._renderersByType[n];if(a){a.destroy()}}};pl.prototype.transparentify=function e(t){var r=this._parseColor(t);var i=Math.round(r[0]*255);var n=Math.round(r[1]*255);var a=Math.round(r[2]*255);return"rgba("+i+","+n+","+a+",0)"};pl.prototype.initDebugRenderingLoop=function e(t){var r=this;if(t===void 0)t={};var i=t.triggerKey;if(i===void 0)i="r";var n=t.start;if(n===void 0)n=true;var a=n;document.addEventListener("keydown",function(e){var t=e.key;if(t===i){a=!a}});var o=function(e){if(a||e){r.setView({currentTime:tr()});r.render()}window.requestAnimationFrame(function(){o()})};window.requestAnimationFrame(function(){document.body.appendChild(r.getDomElement());o(true)})};var _l=function(e){function t(){e.call(this);this.isDummy=true;this.width=0;this.height=0}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={src:{configurable:true}};r.src.set=function(e){var t=this;if(e){this._src=e;setTimeout(function(){if(t.onload){t.onload.call(t)}t.width=1;t.height=1;t.fire("load")},10)}};r.src.get=function(){return this._src};t.prototype.addEventListener=function e(t,r){this.on(t,r)};Object.defineProperties(t.prototype,r);return t}(Fr);var yl=typeof Image!=="undefined"?Image:_l;var ml=function e(){this._images={};this._crossOrigin="anonymous";this._whenReady=[];this._onFetch=[];this._nbLoaded=0;this._nbToLoad=0};ml.prototype.setImgCrossOrigin=function e(t){this._crossOrigin=t};ml.prototype.clear=function e(){this._images={};this._nbLoaded=0;this._nbToLoad=0};ml.prototype.getImage=function e(t){var r=this;var i=this._images[t];if(i===undefined){this._nbToLoad+=1;i=new yl;i.crossOrigin=this._crossOrigin;i.onload=function(){return r._onImgLoad(t)};i.onerror=function(){r._onImgLoad(t);r._images[t]=null};i.src=t;this._images[t]=i}return i};ml.prototype._onImgLoad=function e(t){this._nbLoaded+=1;this._onFetch.forEach(function(e){return e(t)});if(this._nbLoaded===this._nbToLoad){this._whenReady.forEach(function(e){return e()});this._whenReady=[]}};ml.prototype.onFetch=function e(t){this._onFetch.push(t)};ml.prototype.whenReady=function e(){var t=this;if(this._nbLoaded===this._nbToLoad){return Promise.resolve()}else{return new Promise(function(e){return t._whenReady.push(e)})}};ml.prototype.destroy=function e(){this._whenReady=[];this._onFetch=[]};function xl(e,t){if(t<2){return e}var r=e.split("\n");var i=[];for(var n=0;n<r.length;++n){var a=r[n];if(a.length<t){i.push(a)}else{var o=bl(r[n],t);for(var s=0;s<o.length;++s){i.push(o[s])}}}return i.join("\n")}function bl(e,t){var r=e.split(" ");var i=[];var n=0;var a=-1;var o=[];var s=true;for(var u=0;u<r.length;++u){if(s){if(r[u].length>t){var l=Sl(r[u],t);for(var d=0;d<l.length;++d){i.push([l[d]]);++a}n=l[l.length-1].length}else{i.push([r[u]]);++a;n=r[u].length+1}s=false}else if(n+r[u].length<=t){i[a].push(r[u]);n+=r[u].length+1}else{s=true;--u}}for(var h=0;h<i.length;++h){o.push(i[h].join(" "))}return o}function Sl(e,t){var r=[];for(var i=0;i<e.length;i+=t-1){r.push(e.substr(i,t-1)+"-")}var n=r[r.length-1].length;r[r.length-1]=r[r.length-1].substr(0,n-1)+" ";return r}function Al(e,t){if(e===null){return null}e=e.toString();var r=e.split("\n");var i=[];var n=0;for(var a=0;a<r.length;a++){var o=r[a];if(!t||t<=1||o.length<t){i.push(o);n=Math.max(n,o.length)}else{var s=bl(r[a],t);for(var u=0;u<s.length;u++){o=s[u];i.push(o);n=Math.max(n,o.length)}}}return{data:i,maxLength:n,lines:i.length}}function El(e){return typeof e==="number"&&isFinite(e)}function wl(e){return e===null?e:undefined}function Tl(e){return typeof e==="boolean"||e===0||e===1?e:undefined}function kl(e){return typeof e==="number"&&isFinite(e)?e:undefined}function Cl(e){return typeof e==="number"&&isFinite(e)&&e>=0?e:undefined}function Il(e){return typeof e==="number"&&isFinite(e)&&e>0?e:undefined}var Ml=-1;var Ll=4;function Fl(e){return El(e)&&e%1===0&&e>=Ml&&e<=Ll?e:undefined}function Nl(e){return e===null||typeof e==="string"||typeof e==="number"?e:undefined}function zl(e){return e==="fixed"||e==="scaled"?e:undefined}function Pl(e,t){return t.parseColor(e)?e:undefined}function Ol(e,t){return e==="inherit"||t.parseColor(e)?e:undefined}function Dl(e,t){return e==="source"||e==="target"||!!t.parseColor(e)?e:undefined}function Rl(e){if(e===null){return null}if(typeof e!=="string"){return undefined}return e.split(",").map(function(e){var t=e.trim();var r=t.indexOf(" ")!==-1;var i=t[0];return r&&i!=='"'&&i!=="'"?'"'+t+'"':t}).join(",")}function Bl(e){if(e==="none"){return"normal"}return e==="normal"||e==="italic"||e==="bold"||e==="italic bold"?e:undefined}function jl(e){return e==="left"||e==="center"?e:undefined}function Ul(e){if(e==="equilateral"){return"pentagon"}return e==="circle"||e==="square"||e==="cross"||e==="diamond"||e==="pentagon"||e==="star"?e:undefined}function Vl(e){return["line","tapered","arrow","dashed","dotted"].includes(e)?e:undefined}function Gl(e){return e==="line"||e==="triangle"?e:undefined}function Wl(e){return e===null||e==="arrow"?e:undefined}function Hl(e){return e==="plain"||e==="dashed"||e==="dotted"?e:undefined}function Xl(e){return e==="top"||e==="bottom"||e==="left"||e==="right"||e==="center"?e:undefined}function ql(e,t){if(t.parseColor(e)){return e}if(Array.isArray(e)){if(e.length<1){return undefined}for(var r=0;r<e.length;++r){if(!t.parseColor(e[r])){return undefined}}return e}return undefined}function Yl(e){return new Function("x",["if (typeof x === 'number') { return (typeof x === 'number' && isFinite(x) && x >= 0) ? x : undefined; }","else if (typeof x !== 'string' || x.charAt(x.length - 1) !== '%') { return undefined; }","else { var p = parseFloat(x); return isNaN(p) ? undefined : ("+e+" * p / 100); }"].join("\n"))}function Zl(e){return{_check:Nl,_set:new Function("flexArrays","index","value",["flexArrays.badges."+e+".text.content.set(index, value);","if (value === null || value === undefined) flexArrays.badges."+e+".image.url.set(index, value);"].join("\n")),_get:new Function("flexArrays","index","return flexArrays.badges."+e+".text.content.get(index);"),color:{_flexArray:"white",_check:Ol},scale:{_flexArray:.45,_check:Yl(.45)},positionScale:{_flexArray:1,_check:Cl},minVisibleSize:{_flexArray:12,_check:Yl(12)},image:{_alias:"badges."+e+".image.url",url:{_flexArray:null,_check:Nl},scale:{_flexArray:1,_check:Yl(1)}},stroke:{color:{_flexArray:"black",_check:Ol},width:{_flexArray:2,_check:Yl(2)},scalingMethod:{_flexArray:"fixed",_check:zl}},text:{_alias:"badges."+e+".text.content",content:{_flexArray:null,_check:Nl},color:{_flexArray:"black",_check:Ol},font:{_flexArray:"Arial",_check:Rl},style:{_flexArray:"normal",_check:Bl},scale:{_flexArray:.5,_check:Yl(.5)}},threshold:"badges."+e+".minVisibleSize"}}var Kl={_check:Tl,_get:function e(t,r){return t.opacity.get(r)===0},_set:function e(t,r,value){t.opacity.set(r,value===undefined?undefined:+!value)}};var Ql={x:{_flexArray:0,_check:kl,_disableMemoryOptimization:true},y:{_flexArray:0,_check:kl,_disableMemoryOptimization:true},radius:{_flexArray:5,_check:Yl(5)},scalingMethod:{_flexArray:"scaled",_check:zl},color:{_flexArray:"grey",_check:ql},opacity:{_flexArray:1,_check:Cl},hidden:Kl,shape:{_flexArray:"circle",_check:Ul},layer:{_flexArray:0,_check:Fl},detectable:{_flexArray:true,_check:Tl},draggable:{_flexArray:true,_check:Tl},layoutable:{_flexArray:true,_check:Tl},innerStroke:{_alias:"outerStroke.color",width:{_flexArray:2,_check:Yl(2)},scalingMethod:{_flexArray:"fixed",_check:zl},color:{_flexArray:"white",_check:Ol},minVisibleSize:{_flexArray:12,_check:Yl(12)},threshold:"innerStroke.minVisibleSize"},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:5,_check:Yl(5)},scalingMethod:{_flexArray:"fixed",_check:zl},color:{_flexArray:null,_check:Ol},minVisibleSize:{_flexArray:0,_check:Yl(0)},threshold:"outerStroke.minVisibleSize"},badges:{_check:wl,_set:function e(t,r,value){t.badges.topLeft.text.content.set(r,value);t.badges.topLeft.image.url.set(r,value);t.badges.topRight.text.content.set(r,value);t.badges.topRight.image.url.set(r,value);t.badges.bottomLeft.text.content.set(r,value);t.badges.bottomLeft.image.url.set(r,value);t.badges.bottomRight.text.content.set(r,value);t.badges.bottomRight.image.url.set(r,value)},topLeft:Zl("topLeft"),topRight:Zl("topRight"),bottomLeft:Zl("bottomLeft"),bottomRight:Zl("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:null,_check:Pl},width:{_flexArray:50,_check:Yl(50)},scalingMethod:{_flexArray:"fixed",_check:zl},strokeColor:{_flexArray:null,_check:Pl},strokeWidth:{_flexArray:1,_check:Yl(1)},clustering:{_flexArray:false,_check:Tl},hideNonAdjacentEdges:{_flexArray:false,_check:Tl},size:"halo.width"},icon:{_alias:"icon.content",content:{_flexArray:null,_check:Nl},font:{_flexArray:"Arial",_check:Rl},color:{_flexArray:"black",_check:Pl},scale:{_flexArray:.7,_check:Yl(.7)},style:{_flexArray:"normal",_check:Bl},minVisibleSize:{_flexArray:12,_check:Yl(12)},threshold:"icon.minVisibleSize"},image:{_alias:"image.url",url:{_flexArray:null,_check:Nl},scale:{_flexArray:1,_check:Yl(1)},fit:{_flexArray:true,_check:Tl},tile:{_flexArray:false,_check:Tl},minVisibleSize:{_flexArray:12,_check:Yl(12)},rescale:"image.fit",duplicate:"image.tile",threshold:"image.minVisibleSize"},outline:{_alias:"outline.enabled",enabled:{_flexArray:false,_check:Tl},color:{_flexArray:"rgba(0, 0, 0, 0.36)",_check:Pl},minVisibleSize:{_flexArray:12,_check:Yl(12)}},text:{_alias:"text.content",content:{_flexArray:null,_check:Nl},font:{_flexArray:"Arial",_check:Rl},color:{_flexArray:"black",_check:Ol},size:{_flexArray:12,_check:Yl(12)},scale:{_flexArray:.1,_check:Cl},style:{_flexArray:"normal",_check:Bl},align:{_flexArray:"center",_check:jl},margin:{_flexArray:10,_check:Yl(10)},padding:{_flexArray:2,_check:Yl(2)},backgroundColor:{_flexArray:null,_check:Ol},tip:{_flexArray:true,_check:Tl},minVisibleSize:{_flexArray:24,_check:Yl(24)},scaling:{_flexArray:false,_check:Tl},position:{_flexArray:"bottom",_check:Xl},maxLineLength:{_flexArray:0,_check:Cl},truncateLength:{_flexArray:0,_check:Cl},backgroundArrowBaseSize:"text.margin",backgroundMargin:"text.padding",threshold:"text.minVisibleSize",secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Nl},font:{_flexArray:"Arial",_check:Rl},color:{_flexArray:"black",_check:Ol},size:{_flexArray:10,_check:Yl(10)},scale:{_flexArray:.08,_check:Cl},style:{_flexArray:"normal",_check:Bl},align:{_flexArray:"center",_check:jl},margin:{_flexArray:5,_check:Yl(5)},padding:{_flexArray:2,_check:Yl(2)},backgroundColor:{_flexArray:null,_check:Ol},minVisibleSize:{_flexArray:24,_check:Yl(24)},backgroundArrowBaseSize:"text.secondary.margin",backgroundMargin:"text.secondary.padding",threshold:"text.secondary.minVisibleSize"}}};var Jl={undefined:{type:undefined,style:undefined,head:undefined,tail:undefined},line:{type:"line",style:"plain",head:null,tail:null},arrow:{type:"line",style:"plain",head:"arrow",tail:null},tapered:{type:"triangle",style:"plain",head:null,tail:null},dashed:{type:"line",style:"dashed",head:null,tail:null},dotted:{type:"line",style:"dotted",head:null,tail:null}};var $l={width:{_flexArray:1,_check:Yl(1)},scalingMethod:{_flexArray:"scaled",_check:zl},color:{_flexArray:"grey",_check:Dl},opacity:{_flexArray:1,_check:Cl},hidden:Kl,minVisibleSize:{_flexArray:0,_check:Cl},threshold:"minVisibleSize",layer:{_flexArray:0,_check:Fl},detectable:{_flexArray:true,_check:Tl},curvature:{_flexArray:0,_check:kl},adjustAnchors:{_flexArray:true,_check:Tl},shape:{_check:Vl,_set:function e(t,r,value){var i=Jl[value];var n=i.type;var a=i.style;var o=i.head;var s=i.tail;t.shape.type.set(r,n);t.shape.style.set(r,a);t.shape.head.set(r,o);t.shape.tail.set(r,s)},type:{_flexArray:"line",_check:Gl},head:{_flexArray:null,_check:Wl},tail:{_flexArray:null,_check:Wl},style:{_flexArray:"plain",_check:Hl}},stroke:{color:{_flexArray:"inherit",_check:Ol},width:{_flexArray:0,_check:Yl(0)},scalingMethod:{_flexArray:"fixed",_check:zl},minVisibleSize:{_flexArray:0,_check:Cl}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:null,_check:Pl},width:{_flexArray:10,_check:Yl(10)},scalingMethod:{_flexArray:"fixed",_check:zl},size:"halo.width"},outline:{_alias:"outline.enabled",enabled:{_flexArray:false,_check:Tl},color:{_flexArray:"rgba(0, 0, 0, 0.36)",_check:Pl},minVisibleSize:{_flexArray:0,_check:Cl}},text:{_alias:"text.content",content:{_flexArray:null,_check:Nl},font:{_flexArray:"Arial",_check:Rl},color:{_flexArray:"black",_check:Pl},size:{_flexArray:12,_check:Yl(12)},scale:{_flexArray:1,_check:Cl},style:{_flexArray:"normal",_check:Bl},align:{_flexArray:"center",_check:jl},margin:{_flexArray:2,_check:Yl(2)},padding:{_flexArray:2,_check:Yl(2)},backgroundColor:{_flexArray:null,_check:Ol},minVisibleSize:{_flexArray:4,_check:Cl},threshold:"text.minVisibleSize",adjustAngle:{_flexArray:true,_check:Tl},scaling:{_flexArray:false,_check:Tl},maxLineLength:{_flexArray:0,_check:Cl},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Nl},font:{_flexArray:"Arial",_check:Rl},color:{_flexArray:"black",_check:Pl},size:{_flexArray:12,_check:Yl(12)},scale:{_flexArray:.8,_check:Cl},style:{_flexArray:"normal",_check:Bl},align:{_flexArray:"center",_check:jl},margin:{_flexArray:2,_check:Yl(2)},padding:{_flexArray:2,_check:Yl(2)},backgroundColor:{_flexArray:null,_check:Ol},minVisibleSize:{_flexArray:4,_check:Cl},threshold:"text.secondary.minVisibleSize"}}};var ed=function e(t,r){this._attributesManager=t;this._id=r};ed.prototype.getDefinition=function e(){return this._attributesManager.getAttributeLayerDefinition(this._id)};ed.prototype.update=function e(t){this._attributesManager.updateAttributeLayer(this._id,t)};ed.prototype.destroy=function e(){this._attributesManager.destroyAttributeLayer(this._id)};ed.prototype.updateElements=function e(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)};ed.prototype.updateAll=function e(){this._attributesManager.updateAllForAttributeLayer(this._id)};ed.prototype.setAttributeValues=function e(t,r,i){this._attributesManager.setAttributeLayerValues(this._id,t,r,i)};ed.prototype.getUsedAttributeNames=function e(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)};ed.prototype.getFlexArrays=function e(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)};var td=1;var rd=2;var id=3;var nd=4;var ad=5;var od=6;var sd="_visible";var ud="_data";var ld="_hovered";var dd="_hoverExtremityHighlighted";var hd="_selected";var fd="_selectionExtremityHighlighted";var cd="_dragged";var vd="_rewirable";var gd="_export";var pd="_faded";var _d="_transparent";var yd=[hd,cd,fd,ld,dd,vd,gd,pd,_d];var md=2;var xd=3;var bd=3;var Sd=4;var Ad=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"];var Ed={storage:1,default:0};var wd=function e(t,r){this._isNode=r;this._graph=t.modules.graph;this._EltList=r?t.NodeList:t.EdgeList;this._flexArray=r?this._graph.createNodeAttribute(Ed):this._graph.createEdgeAttribute(Ed);this._all=false;this._indexList=this._graph.createIndexList(r)};wd.prototype._getAllIndexes=function e(){var t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex();var r=new Uint32Array(t);for(var i=1;i<=t;++i){r[i-1]=i}return r};wd.prototype.addAll=function e(){this._all=true};wd.prototype.add=function e(t){var r=this;if(this._all){return}for(var i=0,n=t._indexes;i<n.length;i+=1){var a=n[i];r._addIndex(a)}};wd.prototype._addIndex=function e(t){if(this._flexArray.get(t)===0){this._flexArray.set(t,1);this._indexList.push(t)}};wd.prototype.isEmpty=function e(){return!this._all&&this._indexList.isEmpty()};wd.prototype.isFull=function e(){return this._all};wd.prototype.getListAndClear=function e(){var t=this.getList();this.clear();return t};wd.prototype.getList=function e(){var t=this._all?this._getAllIndexes():this._indexList.slice();var r=new this._EltList(t);r.isFull=this._all;return r};wd.prototype.clear=function e(){this._all=false;if(!this._indexList.isEmpty()){this._indexList.reset();this._flexArray.reset()}};wd.prototype.addSet=function e(t){var r=this;if(t._all){this.addAll()}else{var i=t._indexList.getBuffer();var n=t._indexList.getLength();for(var a=0;a<n;++a){r._addIndex(i[a])}}};var Td={name:"animationStart",storage:32,default:0};var kd={name:"animationDuration",storage:16,default:0};var Cd={name:"animationEasing",storage:"resource",default:"linear"};var Id={self:{attributes:"all",tags:[],selection:true,hover:false,data:true},adjacentNodes:{attributes:"all",tags:[],selection:true,hover:false,data:true},adjacentEdges:{attributes:"all",tags:[],selection:true,hover:false,data:true},allNodes:null,allEdges:null};var Md={self:{attributes:"all",tags:[],selection:true,hover:false,data:true},extremities:{attributes:"all",tags:[],selection:true,hover:false,data:true},parallelEdges:{attributes:"all",tags:[],selection:true,hover:false,data:true},allNodes:null,allEdges:null};var Ld=["x","y","radius","halo.hideNonAdjacentEdges"];var Fd=function e(t,r,i){this._ogma=t;this._colorManager=r;this._graph=t.modules.graph;this._isNode=i;this._eltName=i?"node":"edge";this._attributesDefinition=i?Ql:$l;this._accessors=Ud(this._attributesDefinition);this._createFlexArrays=Pd(this._isNode,this._attributesDefinition);this._finalFlexArrays=this._createFlexArrays({named:true,useDefaultValues:true});this._prevFlexArrays=this._createFlexArrays({named:false,useDefaultValues:true});this._defaultFlexArrays=this._createFlexArrays({named:false,useDefaultValues:true});this._allAttributePaths=Y(this._defaultFlexArrays);this._currentFlexArrays=this._defaultFlexArrays;this._lastFlexArrays=null;this.setLastFlexArrays(this._defaultFlexArrays);this._elementsToRedraw=new wd(t,i);this._elementsUpdated=new wd(t,i);this._updatedAttributes=new Ot;this._updatedAttributesTmp=new Ot;this._allUsedAttributes=new Ot;this._finalFlexArraysWrapped=Object.assign({},this._finalFlexArrays,{excluded:this._graph.getAttribute(i,"excluded"),textHidden:this._graph.getAttribute(i,"textHidden"),animationStart:this._graph.createAttribute(i,Td),animationDuration:this._graph.createAttribute(i,kd),animationEasing:this._graph.createAttribute(i,Cd),id:this._graph.getAttribute(i,"id")});if(!i){Object.assign(this._finalFlexArraysWrapped,{source:this._graph.getEdgeAttribute("source"),target:this._graph.getEdgeAttribute("target")})}};Fd.prototype.clear=function e(){this._elementsToRedraw.clear();this._elementsUpdated.clear();this._updatedAttributes.clear();this._updatedAttributesTmp.clear()};Fd.prototype.getAttributeFlexArrays=function e(){return this._finalFlexArraysWrapped};Fd.prototype.getPrevAttributeFlexArrays=function e(){return this._prevFlexArrays};Fd.prototype.getAnimationInformation=function e(t){var r=this;var i=t._indexes;var n=new Array(i.length);for(var a=0;a<i.length;++a){var o=i[a];n[a]={duration:r._finalFlexArraysWrapped.animationDuration.get(o),start:r._finalFlexArraysWrapped.animationStart.get(o),easing:r._finalFlexArraysWrapped.animationEasing.get(o)}}return n};Fd.prototype.startUpdate=function e(){};Fd.prototype.prepareFlexArraysUpdate=function e(t){this._currentFlexArrays=t.inputFlexArrays};Fd.prototype.setLastFlexArrays=function e(t){this._lastFlexArrays=t};Fd.prototype.updateFlexArrays=function e(t){var r=t.attributes;var i=t.selector;var n=t.context;var a=t.outputFlexArrays;var o=t.toUpdate;var s=t.formattedOutput;this._elementsUpdated.addSet(o);this._elementsToRedraw.addSet(o);var u=o.getListAndClear();if(r&&u.size){var l=this._graph.splitElements(u,i,n);var d=l.valid;var h=l.invalid;for(var f=0,c=s.attributes;f<c.length;f+=1){var v=c[f];var g=H(a,v);for(var p=0,_=h._indexes;p<_.length;p+=1){var y=_[p];g.set(y,undefined)}}this._assignAttributesToFlexArrays(this._accessors,a,d,r,n);this._addUpdatedAttributes(t)}};Fd.prototype.endUpdate=function e(){var t=this;var r=this._elementsUpdated.getList();var i=this._updatedAttributesTmp.values();for(var n=0,a=i;n<a.length;n+=1){var o=a[n];var s=H(t._lastFlexArrays,o);var u=H(t._finalFlexArrays,o);for(var l=0,d=r._indexes;l<d.length;l+=1){var h=d[l];u.set(h,s.get(h))}}this._updatedAttributesTmp.clear();this._currentFlexArrays=this._finalFlexArrays};Fd.prototype.setAttributeValues=function e(t,r,i,n){var a=t.outputFlexArrays;var o=this._accessors;var s=null;this._assignAttributesToFlexArrays(o,a,r,i,s);this._addUpdatedAttributes(t,n);this._elementsUpdated.add(r);this._elementsToRedraw.add(r)};Fd.prototype.notifyLayerDestroyed=function e(t){this._addUpdatedAttributes(t)};Fd.prototype._addUpdatedAttributes=function e(t,r){var i=this;var n=t.outputFlexArrays;var a=t.formattedOutput;var o=Array.isArray(r)?Kd(r):a.attributes;for(var s=0,u=o;s<u.length;s+=1){var l=u[s];var d=H(n,l);if(d.isInitialized()){i._updatedAttributes.add(l);i._updatedAttributesTmp.add(l);i._allUsedAttributes.add(l)}}};Fd.prototype.getUsedAttributeNames=function e(t){return zd(t.outputFlexArrays)};Fd.prototype.redrawElements=function e(t){this._elementsToRedraw.add(t)};Fd.prototype.redrawAll=function e(){this._elementsToRedraw.addAll()};Fd.prototype.getAndResetElementsToRedraw=function e(){return this._elementsToRedraw.getListAndClear()};Fd.prototype.getAndResetElementsUpdated=function e(){return this._elementsUpdated.getListAndClear()};Fd.prototype.getAndResetAttributesUpdated=function e(){var t=this._updatedAttributes.values();this._updatedAttributes.clear();return t};Fd.prototype.createFlexArrays=function e(){return this._createFlexArrays({named:false,useDefaultValues:false})};Fd.prototype.getAttributeValues=function e(t,r,i,n){var a=n?this._prevFlexArrays:this._currentFlexArrays;if(i){return this._getMultipleAttributeValues(t,r,a)}else{return this._getSingleAttributeValues(t,r,a)}};Fd.prototype._getAccessor=function e(t){var r=this;if(t===void 0)t="";var i=this._accessors;var n=F(t);for(var a=0,o=n;a<o.length;a+=1){var s=o[a];i=i.nested[s];if(!i){throw new Error(r._eltName+' attribute "'+n.join("")+'" does not exist')}}return i};Fd.prototype._getSingleAttributeValues=function e(t,r,i){var n=this._getAccessor(r);var a=t._indexes;var o=new Array(a.length);for(var s=0;s<a.length;++s){o[s]=n.get(i,a[s])}return o};Fd.prototype._getMultipleAttributeValues=function e(t,r,i){var n=this;if(!r||r==="all"){return this._getSingleAttributeValues(t,"",i)}var a=new Array(t.size);for(var o=0;o<a.length;++o){a[o]={}}for(var s=0;s<r.length;++s){var u=r[s];var l=n._getSingleAttributeValues(t,u,i);for(var d=0;d<a.length;++d){var h=a[d];var value=l[d];W(h,u,value)}}return a};Fd.prototype.setAnimationAttributes=function e(t,r){var i=this;var n=r.duration;var a=r.startTime;var o=r.easing;var s=t._indexes;var u=this._finalFlexArraysWrapped.animationDuration;var l=this._finalFlexArraysWrapped.animationStart;var d=this._finalFlexArraysWrapped.animationEasing;var h=this._allUsedAttributes.values();if(n){var f=false;for(var c=0,v=h;c<v.length;c+=1){var g=v[c];if(g==="x"||g==="y"){f=true;continue}var p=H(i._finalFlexArrays,g);var _=H(i._prevFlexArrays,g);for(var y=0,m=s;y<m.length;y+=1){var x=m[y];_.set(x,p.get(x))}}if(f){var b=tr();var S=this._finalFlexArrays.x;var A=this._finalFlexArrays.y;var E=this._prevFlexArrays.x;var w=this._prevFlexArrays.y;for(var T=0;T<s.length;++T){var k=s[T];var C=u.get(k);if(C){var I=l.get(k);var M=d.get(k);var L=Po[M]||Po.linear;var F=Math.min((b-I)/C,1);var N=L(F);var z=nt(E.get(k),S.get(k),N);var P=nt(w.get(k),A.get(k),N);E.set(k,z);w.set(k,P)}else{E.set(k,S.get(k));w.set(k,A.get(k))}}}}u.fill(s,n);l.fill(s,a);d.fill(s,o)};Fd.prototype.resetAnimationAttributes=function e(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)};Fd.prototype.getUsedAttributes=function e(){return this._allUsedAttributes.values()};Fd.prototype.getDefaultFlexArrays=function e(){return this._defaultFlexArrays};Fd.prototype._assignAttributesToFlexArrays=function e(t,r,i,n,a,o){var s=this;if(o===void 0)o=[];if(typeof n==="function"){var u=o.join(".");for(var l=0;l<i.size;++l){var d=i.get(l);var h=n(d,a,u);s._assignSingleValueToFlexArray(r,d,t,h,o)}}else if(J(n)){var f=Object.keys(n);for(var c=0;c<f.length;++c){var v=f[c];o.push(v);var g=s._getNestedAccessor(t,v,o);var p=n[v];s._assignAttributesToFlexArrays(g,r,i,p,a,o);o.pop()}}else if((Array.isArray(n)||ArrayBuffer.isView(n))&&o[0]!=="color"){if(!o.length){for(var _=0;_<i.size;++_){s._assignSingleValueToFlexArray(r,i.get(_),t,n[_],o)}}else{for(var y=0;y<i.size;++y){var m=i._indexes[y];var x=t.check(n[y],s._colorManager);t.set(r,m,x)}}}else{var b=t.check(n,this._colorManager);for(var S=0;S<i.size;++S){var A=i.get(S);t.set(r,A._index,b)}}};Fd.prototype._getNestedAccessor=function e(t,r,i){var n=t.nested[r];if(!n){throw new Error(this._eltName+' attribute "'+i.join(".")+'" does not exist')}return n};Fd.prototype._assignSingleValueToFlexArray=function e(t,r,i,value,n){var a=this;if(J(value)){var o=Object.keys(value);for(var s=0,u=o;s<u.length;s+=1){var l=u[s];n.push(l);var d=value[l];var h=a._getNestedAccessor(i,l,n);a._assignSingleValueToFlexArray(t,r,h,d,n);n.pop()}}else{var f=i.check(value,this._colorManager);i.set(t,r._index,f)}};var Nd=function e(t){this._ogma=t;this._graph=t.modules.graph;this._dom=t.modules.dom;this._colorManager=new zr;this._textHiddenSet=new Ir(t,"textHidden");this._nodes=new Fd(t,this._colorManager,true);this._edges=new Fd(t,this._colorManager,false);this._layerIdCounter=0;this._layers=[];this._destroyedLayers=[];this._layersNeedUpdate=false;this._updateOngoing=false;this._needUpdate=false};Nd.prototype._getLayerById=function e(t){var r=this;for(var i=0;i<this._layers.length;++i){var n=r._layers[i];if(n.id===t){n.index=i;return n}}throw new Error("usage of a destroyed style rule or class")};Nd.prototype._fetch=function e(t){return t.isNode?this._nodes:this._edges};Nd.prototype.getFlexArrays=function e(){return{nodes:{current:this._nodes.getAttributeFlexArrays(),previous:this._nodes.getPrevAttributeFlexArrays()},edges:{current:this._edges.getAttributeFlexArrays(),previous:this._edges.getPrevAttributeFlexArrays()}}};Nd.prototype.createFlexArrays=function e(){return{nodes:this._nodes.createFlexArrays(),edges:this._edges.createFlexArrays()}};Nd.prototype.clear=function e(){this._updateOngoing=false;this._needUpdate=false;this._destroyedLayers=[];this._nodes.clear();this._edges.clear();this.updateAllForAllAttributeLayers()};Nd.prototype.redrawElements=function e(t){this._fetch(t).redrawElements(t);this._dom.refresh()};Nd.prototype.redrawAll=function e(){this._nodes.redrawAll();this._edges.redrawAll();this._dom.refresh()};Nd.prototype._triggerUpdate=function e(){this._needUpdate=true;this._dom.refresh()};Nd.prototype._reconstructAttributeLayersIfNecessary=function e(){if(this._layersNeedUpdate){this._reconstructAttributeLayers();this._layersNeedUpdate=false;this._dom.refresh();return true}return false};Nd.prototype.getAnimationInformation=function e(t){return this._fetch(t).getAnimationInformation(t)};Nd.prototype.update=function e(){var t=this;if(!this._needUpdate||this._updateOngoing||!this._ogma._token){return false}this._reconstructAttributeLayersIfNecessary();this._updateOngoing=true;this._nodes.startUpdate();this._edges.startUpdate();for(var r=0,i=t._destroyedLayers;r<i.length;r+=1){var n=i[r];if(n.initialized){t._nodes.notifyLayerDestroyed(n.nodes);t._edges.notifyLayerDestroyed(n.edges)}}for(var a=0,o=t._layers;a<o.length;a+=1){var s=o[a];var u=s;var l=u.nodes;var d=u.edges;t._nodes.prepareFlexArraysUpdate(l);t._edges.prepareFlexArraysUpdate(d);t._nodes.updateFlexArrays(l);t._edges.updateFlexArrays(d)}this._nodes.endUpdate();this._edges.endUpdate();this._updateOngoing=false;this._needUpdate=false;return true};Nd.prototype.setAttributeLayerValues=function e(t,r,i,n){var a=this._getLayerById(t);var o=r.isNode?a.nodes:a.edges;this._reconstructAttributeLayersIfNecessary();this._fetch(r).setAttributeValues(o,r,i,n);this._updateElementsForAttributeLayers([a],r)};Nd.prototype.getAttributeLayerFlexArrays=function e(t){var r=this._getLayerById(t);return{nodes:r.nodes.outputFlexArrays,edges:r.edges.outputFlexArrays}};Nd.prototype.getUsedAttributeLayerAttributes=function e(t,r){var i=this._getLayerById(t);return this._fetch(r).getUsedAttributeNames(r.isNode?i.nodes:i.edges)};Nd.prototype.getAndResetElementsUpdated=function e(){return{nodes:this._nodes.getAndResetElementsUpdated(),edges:this._edges.getAndResetElementsUpdated(),nodeAttributes:this._nodes.getAndResetAttributesUpdated(),edgeAttributes:this._edges.getAndResetAttributesUpdated()}};Nd.prototype.getAndResetElementsToRedraw=function e(){return{nodes:this._nodes.getAndResetElementsToRedraw(),edges:this._edges.getAndResetElementsToRedraw()}};Nd.prototype.addAttributeLayer=function e(t){if(t===void 0)t={};if(t.name&&this._layers.find(function(e){return e.name===t.name})){throw new Error('attribute layer with name "'+t.name+'" already exists')}var r={id:++this._layerIdCounter,name:t.name,tag:t.tag,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:false,nodes:{name:t.name,standaloneSelector:!!t.standaloneSelectors,toUpdate:new wd(this._ogma,true),outputFlexArrays:this._nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{name:t.name,standaloneSelector:!!t.standaloneSelectors,toUpdate:new wd(this._ogma,false),outputFlexArrays:this._edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}};this._layers.push(r);this._updateLayer(r,t);return new ed(this,this._layerIdCounter)};Nd.prototype._reconstructAttributeLayers=function e(){var t=this;this._layers.sort(function(e,t){return e.priority-t.priority});var r=U(this._nodes.getDefaultFlexArrays());var i=U(this._edges.getDefaultFlexArrays());var n=Y(r);var a=Y(i);for(var o=0,s=t._layers;o<s.length;o+=1){var u=s[o];u.nodes.allAttributePaths=n;u.edges.allAttributePaths=a;u.nodes.formattedDependencies=qd(u.nodes);u.edges.formattedDependencies=Yd(u.edges);u.nodes.formattedOutput=Gd(u.nodes,u.tag);u.edges.formattedOutput=Gd(u.edges,u.tag);u.nodes.redrawAdjacentEdges=u.nodes.formattedOutput.attributes.some(function(e){return Ld.includes(e)});u.initialized=true}for(var l=0,d=t._layers;l<d.length;l+=1){var h=d[l];h.nodes.inputFlexArrays=U(r);h.edges.inputFlexArrays=U(i);h.depsNodeSelf=[];h.depsNodeAdjacentNodes=[];h.depsNodeAdjacentEdges=[];h.depsNodeAllNodes=[];h.depsNodeAllEdges=[];h.depsEdgeSelf=[];h.depsEdgeExtremities=[];h.depsEdgeParallelEdges=[];h.depsEdgeAllNodes=[];h.depsEdgeAllEdges=[];h.nodes.toUpdate.addAll();h.edges.toUpdate.addAll();for(var f=0,c=h.nodes.formattedOutput.attributes;f<c.length;f+=1){var v=c[f];var g=H(r,v);var p=H(h.nodes.outputFlexArrays,v);p.setFallback(g);W(r,v,p)}for(var _=0,y=h.edges.formattedOutput.attributes;_<y.length;_+=1){var m=y[_];var x=H(i,m);var b=H(h.edges.outputFlexArrays,m);b.setFallback(x);W(i,m,b)}for(var S=0,A=t._layers;S<A.length;S+=1){var E=A[S];if(h===E){continue}var w=h.priority;var T=E.priority;var k=h.nodes.formattedOutput;var C=h.edges.formattedOutput;var I=E.nodes.formattedDependencies;var M=E.edges.formattedDependencies;Xd(h.depsNodeSelf,E,k,I.self,w,T);Xd(h.depsNodeAdjacentNodes,E,k,I.adjacentNodes,w,T);Xd(h.depsNodeAdjacentEdges,E,C,M.extremities,w,T);Xd(h.depsNodeAllNodes,E,k,I.allNodes,w,T);Xd(h.depsNodeAllEdges,E,C,M.allNodes,w,T);Xd(h.depsEdgeSelf,E,C,M.self,w,T);Xd(h.depsEdgeExtremities,E,k,I.adjacentEdges,w,T);Xd(h.depsEdgeParallelEdges,E,C,M.parallelEdges,w,T);Xd(h.depsEdgeAllNodes,E,k,I.allEdges,w,T);Xd(h.depsEdgeAllEdges,E,C,M.allEdges,w,T)}}this._nodes.setLastFlexArrays(r);this._edges.setLastFlexArrays(i);for(var L=0,F=t._layers;L<F.length;L+=1){var N=F[L];N.nodes.needAdjacentElements=N.nodes.redrawAdjacentEdges||N.depsNodeAdjacentNodes.length>0||N.depsNodeAdjacentEdges.length>0;N.edges.needAdjacentElements=N.depsEdgeExtremities.length>0||N.depsEdgeParallelEdges.length>0}};Nd.prototype._updateLayer=function e(t,r){if(r===void 0)r={};var i=r.priority;var n=r.fullOverwrite;var a=r.nodeAttributes;var o=r.nodeSelector;var s=r.nodeContext;var u=r.nodeDependencies;var l=r.nodeOutput;var d=r.edgeAttributes;var h=r.edgeSelector;var f=r.edgeContext;var c=r.edgeDependencies;var v=r.edgeOutput;if(a!==undefined){t.nodes.attributes=n?a:$(t.nodes.attributes,a)}if(o!==undefined){t.nodes.selector=o}if(s!==undefined){t.nodes.context=s}if(u!==undefined){t.nodes.dependencies=u}if(l!==undefined){t.nodes.output=l}if(d!==undefined){t.edges.attributes=n?d:$(t.edges.attributes,d)}if(h!==undefined){t.edges.selector=h}if(f!==undefined){t.edges.context=f}if(c!==undefined){t.edges.dependencies=c}if(v!==undefined){t.edges.output=v}if(i!==undefined){t.priority=i}this._triggerLayerUpdate()};Nd.prototype._triggerLayerUpdate=function e(){this._layersNeedUpdate=true;this._triggerUpdate()};Nd.prototype.updateAllForAttributeLayer=function e(t){var r=this._getLayerById(t);this._updateAllForAttributeLayer(r)};Nd.prototype.updateAllForAllAttributeLayers=function e(){var t=this;for(var r=0,i=t._layers;r<i.length;r+=1){var n=i[r];t._updateAllForAttributeLayer(n)}};Nd.prototype._updateAllForAttributeLayer=function e(t,r,i){var n=this;if(r===void 0)r=true;if(i===void 0)i=true;if(r&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(var a=0,o=t.depsNodeSelf;a<o.length;a+=1){var s=o[a];n._updateAllForAttributeLayer(s,true,false)}for(var u=0,l=t.depsNodeAdjacentNodes;u<l.length;u+=1){var d=l[u];n._updateAllForAttributeLayer(d,true,false)}for(var h=0,f=t.depsNodeAdjacentEdges;h<f.length;h+=1){var c=f[h];n._updateAllForAttributeLayer(c,false,true)}for(var v=0,g=t.depsNodeAllNodes;v<g.length;v+=1){var p=g[v];n._updateAllForAttributeLayer(p,true,false)}for(var _=0,y=t.depsNodeAllEdges;_<y.length;_+=1){var m=y[_];n._updateAllForAttributeLayer(m,false,true)}}if(i&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(var x=0,b=t.depsEdgeSelf;x<b.length;x+=1){var S=b[x];n._updateAllForAttributeLayer(S,false,true)}for(var A=0,E=t.depsEdgeExtremities;A<E.length;A+=1){var w=E[A];n._updateAllForAttributeLayer(w,true,false)}for(var T=0,k=t.depsEdgeParallelEdges;T<k.length;T+=1){var C=k[T];n._updateAllForAttributeLayer(C,false,true)}for(var I=0,M=t.depsEdgeAllNodes;I<M.length;I+=1){var L=M[I];n._updateAllForAttributeLayer(L,true,false)}for(var F=0,N=t.depsEdgeAllEdges;F<N.length;F+=1){var z=N[F];n._updateAllForAttributeLayer(z,false,true)}}this._triggerUpdate()};Nd.prototype.updateElementsForAttributeLayer=function e(t,r){var i=this._getLayerById(t);this._updateElementsForAttributeLayers([i],r)};Nd.prototype.updateForAllAttributeLayers=function e(t){this._updateElementsForAttributeLayers(this._layers,t)};Nd.prototype._updateElementsForAttributeLayers=function e(t,r){var i=this;var n=null;if(r.isNode){for(var a=0,o=t;a<o.length;a+=1){var s=o[a];if(!s.nodes.toUpdate.isFull()){if(s.nodes.needAdjacentElements){n=n||r.fastGetAdjacentElements()}s.nodes.toUpdate.add(r);for(var u=0,l=s.depsNodeSelf;u<l.length;u+=1){var d=l[u];d.nodes.toUpdate.add(r)}for(var h=0,f=s.depsNodeAdjacentNodes;h<f.length;h+=1){var c=f[h];c.nodes.toUpdate.add(n.nodes)}for(var v=0,g=s.depsNodeAdjacentEdges;v<g.length;v+=1){var p=g[v];p.edges.toUpdate.add(n.edges)}for(var _=0,y=s.depsNodeAllNodes;_<y.length;_+=1){var m=y[_];i._updateAllForAttributeLayer(m,true,false)}for(var x=0,b=s.depsNodeAllEdges;x<b.length;x+=1){var S=b[x];i._updateAllForAttributeLayer(S,false,true)}if(s.nodes.redrawAdjacentEdges){i._edges.redrawElements(n.edges)}}}}else{for(var A=0,E=t;A<E.length;A+=1){var w=E[A];if(!w.edges.toUpdate.isFull()){if(w.edges.needAdjacentElements){n=n||r.fastGetAdjacentElements()}w.edges.toUpdate.add(r);for(var T=0,k=w.depsEdgeSelf;T<k.length;T+=1){var C=k[T];C.edges.toUpdate.add(r)}for(var I=0,M=w.depsEdgeExtremities;I<M.length;I+=1){var L=M[I];L.nodes.toUpdate.add(n.nodes)}for(var F=0,N=w.depsEdgeParallelEdges;F<N.length;F+=1){var z=N[F];z.edges.toUpdate.add(n.edges)}for(var P=0,O=w.depsEdgeAllNodes;P<O.length;P+=1){var D=O[P];i._updateAllForAttributeLayer(D,true,false)}for(var R=0,B=w.depsEdgeAllEdges;R<B.length;R+=1){var j=B[R];i._updateAllForAttributeLayer(j,false,true)}}}}this._triggerUpdate()};Nd.prototype.destroyAttributeLayer=function e(t){var r=this._getLayerById(t);this._destroyedLayers.push(r);this._layers.splice(r.index,1);this._triggerLayerUpdate()};Nd.prototype.updateAttributeLayer=function e(t,r){var i=this._getLayerById(t);this._updateLayer(i,r)};Nd.prototype.getAttributeLayerDefinition=function e(t){var r=this._getLayerById(t);var i=r.priority;var n=r.nodes;var a=r.edges;return{priority:i,nodeAttributes:n.attributes,nodeSelector:n.selector,nodeContext:n.context,nodeDependencies:n.dependencies,nodeOutput:n.output,edgeAttributes:a.attributes,edgeSelector:a.selector,edgeContext:a.context,edgeDependencies:a.dependencies,edgeOutput:a.output}};Nd.prototype.getAttributeValues=function e(t,r,i,n){this.update();return this._fetch(t).getAttributeValues(t,r,i,n)};Nd.prototype.setAnimationAttributes=function e(t,r){var i=t.nodes;var n=t.edges;this._nodes.setAnimationAttributes(i,r);this._edges.setAnimationAttributes(n,r)};Nd.prototype.resetAnimationAttributes=function e(t){var r=t.nodes;var i=t.edges;this._nodes.resetAnimationAttributes(r);this._edges.resetAnimationAttributes(i)};Nd.prototype.setTextHidden=function e(t,value){var r=this._textHiddenSet.addOrRemoveElements(t,value);this._fetch(r).redrawElements(r)};Nd.prototype.resetTextHidden=function e(){var t=this._textHiddenSet.getElements();var r=t.nodes;var i=t.edges;this._textHiddenSet.clear();this._nodes.redrawElements(r);this._edges.redrawElements(i)};Nd.prototype.getUsedNodeAttributes=function e(){return this._nodes.getUsedAttributes()};Nd.prototype.getUsedEdgeAttributes=function e(){return this._edges.getUsedAttributes()};function zd(e,t,r){if(t===void 0)t=[];if(r===void 0)r="";if(e.constructor===Wt){if(e.isInitialized()){t.push(r)}}else if(e.constructor===Object){Object.keys(e).forEach(function(i){zd(e[i],t,Bd(r,i))})}return t}function Pd(e,t){var r=["var graph = this._graph;","var isNode = this._isNode;","var named = options.named;","var useDefaultValues = options.useDefaultValues;","","return "+Dd(e,t)+";"].join("\n");return new Function("options",r)}function Od(value){if(typeof value==="string"){return'"'+value+'"'}else{return""+value}}function Dd(e,t,r){if(r===void 0)r="";var i=t._flexArray;if(i!==undefined){var n=t._disableMemoryOptimization?"any":"resource";var a=n==="float"?Infinity:undefined;var o=['storage: "'+n+'"',"default: (useDefaultValues ? "+Od(i)+" : "+Od(a)+")",'name: (named ? "'+r+'" : undefined)'];return"graph.createAttribute("+e+", {"+o.join(", ")+"})"}else{var s=Object.keys(t).filter(function(e){if(e.startsWith("_")){return false}var r=t[e];return!Rd(r)&&(r._flexArray!==undefined||Object.keys(r).some(function(e){return!e.startsWith("_")}))});var u=s.map(function(i){var n=Bd(r,i);var value=Dd(e,t[i],n);return i+": "+value});return"{\n"+u.join(",\n").split("\n").map(function(e){return"  "+e}).join("\n")+"\n}"}}function Rd(e){return typeof e==="string"}function Bd(e,t){return e?e+"."+t:t}function jd(e,t){if(!e._check){throw new Error("error somewhere for "+t)}return{check:e._check,set:new Function("flexArrays","index","value","flexArrays."+t+".set(index, value);"),get:new Function("flexArrays","index","return flexArrays."+t+".get(index);"),nested:{}}}function Ud(e,t,r){t=t||e;if(t._flexArray!==undefined){return jd(t,r)}else{var i={};if(Rd(t)||t._alias){var n=Rd(t)?t:t._alias;var a=H(e,n);i=jd(a,n)}else{if(t._set){i.set=t._set;i.check=t._check}else{i.set=new Function;i.check=new Function("return undefined;")}if(t._get){i.get=t._get}else{var o="return "+Vd(t,r)+";";i.get=new Function("flexArrays","index",o)}i.nested={}}if(!Rd(t)){var s=Object.keys(t);for(var u=0,l=s;u<l.length;u+=1){var d=l[u];var h=t[d];if(!d.startsWith("_")){i.nested[d]=Ud(e,h,Bd(r,d))}}}return i}}function Vd(e,t){if(e._flexArray!==undefined){return"flexArrays."+t+".get(index)"}else{var r=[];var i=Object.keys(e);for(var n=0,a=i;n<a.length;n+=1){var o=a[n];var s=e[o];if(!o.startsWith("_")&&J(s)){var u=Vd(e[o],Bd(t,o));if(u){r.push(o+": "+u)}}}if(r.length){return"{\n"+r.join(",\n").split("\n").map(function(e){return"  "+e}).join("\n")+"\n}"}else{return""}}}function Gd(e,t){return{attributes:Wd(e),tags:t?[t]:[]}}function Wd(e){var t=null;if(e.output===undefined){if(typeof e.attributes==="function"){t="all"}else if(J(e.attributes)){t=Y(e.attributes)}else{t=null}}else{t=e.output&&e.output.attributes}return Kd(t,e.allAttributePaths)}function Hd(e,t,r,i){if(i>r){for(var n=0,a=t.attributes;n<a.length;n+=1){var o=a[n];for(var s=0,u=e.attributes;s<u.length;s+=1){var l=u[s];if(l===o){return true}}}}for(var d=0,h=t.tags;d<h.length;d+=1){var f=h[d];for(var c=0,v=e.tags;c<v.length;c+=1){var g=v[c];if(f===g){return true}}}return false}function Xd(e,t,r,i,n,a){if(Hd(r,i,n,a)){e.push(t)}}function qd(e){var t=e.dependencies;if(t===undefined){t=Id}else if(!J(t)){t={}}var r=Z(e.attributes).some(function(value){return typeof value==="function"});var i=e.selector&&!e.standaloneSelector;var n=r||i;var a=t.adjacentEdges;if(!a&&t.adjacentNodes){a=true}return{self:Zd(t.self,n,e.allAttributePaths),adjacentNodes:Zd(t.adjacentNodes,n,e.allAttributePaths),adjacentEdges:Zd(a,n,e.allAttributePaths),allNodes:Zd(t.allNodes,n,e.allAttributePaths),allEdges:Zd(t.allEdges,n,e.allAttributePaths)}}function Yd(e){var t=e.dependencies;if(t===undefined){t=Md}else if(!J(t)){t={}}var r=Z(e.attributes).some(function(value){return typeof value==="function"});var i=e.selector&&!e.standaloneSelector;var n=r||i;return{self:Zd(t.self,n,e.allAttributePaths),extremities:Zd(t.extremities,n,e.allAttributePaths),parallelEdges:Zd(t.parallelEdges,n,e.allAttributePaths),allNodes:Zd(t.allNodes,n,e.allAttributePaths),allEdges:Zd(t.allEdges,n,e.allAttributePaths)}}function Zd(e,t,r){if(!t){return{attributes:[],tags:[]}}if(e===true){return{attributes:[],tags:[sd]}}e=e||{};var i={attributes:Kd(e.attributes,r),tags:Qd(e.tags)};if(e.data){i.tags.push(ud)}if(e.selection){i.tags.push(hd)}if(e.hover){i.tags.push(ld)}return i}function Kd(value,e){if(value==="all"){return e.slice()}else if(!Array.isArray(value)){return[]}else{value=value.map(function(e){return Array.isArray(e)?e.join("."):e});value=value.filter(function(e){return typeof e==="string"});if(e){return e.filter(function(e){return value.some(function(t){return e.startsWith(t)})})}else{return value}}}function Qd(value){if(!Array.isArray(value)){return[]}else{return value.filter(function(e){return typeof e==="string"})}}function Jd(e){return e||e===0}function $d(e,t,r){if(r===void 0)r=0;if(e==="inherit"){if(!Array.isArray(t)){return t}else{var i=r/(2*Math.PI)*t.length|0;return t[i]}}else{return e}}function eh(e,t,r){if(e==="source"){return t}else if(e==="target"){return r}else{return e}}function th(e,t){var r=e();var i=Y(r);var n=i.map(function(e){var value=H(r,e);if(!Array.isArray(value)){return"target."+e+" = source."+e+"."+t+";"}else{return"for (var i = 0; i < "+value.length+"; ++i) target."+e+"[i] = source."+e+"[i]."+t+";"}}).join("\n");return new Function("target, source",n)}function rh(e){var t=e();var r=Y(t);var i=r.map(function(e){var value=H(t,e);if(!Array.isArray(value)){return"target."+e+" = target."+e+" || source."+e+";"}else{return"for (var i = 0; i < "+value.length+"; ++i) target."+e+"[i] = target."+e+"[i] || source."+e+"[i];"}}).join("\n");return new Function("target","source",i)}function ih(e){var t=e.getDepth();if(t===Ln||t===Mn){return true}return(t-Fn)%Bn>=On}function nh(e){var t=(e.getDepth()-Fn)%Bn;return t>=0&&t!==Nn&&t!==On}function ah(e,t,r,i){oh(e,t,r,i);sh(e,t.texts.primary,r.text,i,t);sh(e,t.texts.secondary,r.text.secondary,i,t);uh(e,t.badges.topLeft,r.badges.topLeft,i,t);uh(e,t.badges.topRight,r.badges.topRight,i,t);uh(e,t.badges.bottomLeft,r.badges.bottomLeft,i,t);uh(e,t.badges.bottomRight,r.badges.bottomRight,i,t)}function oh(e,t,r,i){var n=+(r.scalingMethod.get(i)==="scaled");var a=r.radius.get(i)*2;var o=r.innerStroke.width.get(i);var s=+(r.innerStroke.scalingMethod.get(i)==="scaled");var u=r.outerStroke.width.get(i);var l=+(r.outerStroke.scalingMethod.get(i)==="scaled");t.x=r.x.get(i);t.y=r.y.get(i);t.shape=r.shape.get(i);t.color=r.color.get(i);t.opacity=r.opacity.get(i);t.diameterScaled=a*n;t.diameterFixed=a*(1-n);t.innerStroke.color=$d(r.innerStroke.color.get(i),t.color);t.innerStroke.widthScaled=o*s;t.innerStroke.widthFixed=o*(1-s);t.innerStroke.minVisibleSize=r.innerStroke.minVisibleSize.get(i);t.outerStroke.color=$d(r.outerStroke.color.get(i),t.color);t.outerStroke.widthScaled=u*l;t.outerStroke.widthFixed=u*(1-l);t.halo.color=r.halo.color.get(i);t.halo.strokeColor=r.halo.strokeColor.get(i);t.icon.content=e.formatText(r.icon.content.get(i));t.image.url=r.image.url.get(i);t.outline.enabled=r.outline.enabled.get(i);t.textHidden=r.textHidden.get(i)}function sh(e,t,r,i,n){var a=t===n.texts.primary;t.hidden=n.textHidden;t.content=e.formatText(r.content.get(i));t.backgroundColor=$d(r.backgroundColor.get(i),n.color);t.tip=a&&r.tip.get(i);t.position=a?r.position.get(i):"bottom"}function uh(e,t,r,i){t.textContent=e.formatText(r.text.content.get(i));t.imageUrl=r.image.url.get(i)}function lh(){return{x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,minVisibleSize:0},image:{url:"",content:null,scale:0,rescale:false,duplicate:false,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:false,color:"",minVisibleSize:""},badges:{topLeft:dh(Gn),topRight:dh(Wn),bottomLeft:dh(Hn),bottomRight:dh(Xn)},textHidden:false,texts:{primary:hh(),secondary:hh()}}}function dh(e){return{angle:e,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:"",textStyle:"",imageUrl:"",imageContent:null,imageScale:0}}function hh(){return{hidden:false,content:"",position:"",backgroundColor:"",tip:false,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"",align:"",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:false,isPositionVertical:false,isPositionHorizontal:false}}function fh(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function ch(e,t){var r=t||fh();var i=(e-Ml)*Bn+Fn;r.edgeHalo=In;r.nodeHaloStroke=Mn;r.nodeHalo=Ln;r.edgeBody=i+Nn;r.edgeTextBackground=i+zn;r.edgeText=i+Pn;r.nodeBody=i+On;r.nodeTextBackground=i+Dn;r.nodeText=i+Rn;return r}function vh(e,t){gh(e,t);ph(e.texts.primary,t.texts.primary);ph(e.texts.secondary,t.texts.secondary);_h(e.badges.topLeft,t.badges.topLeft);_h(e.badges.topRight,t.badges.topRight);_h(e.badges.bottomLeft,t.badges.bottomLeft);_h(e.badges.bottomRight,t.badges.bottomRight)}function gh(e,t){e.body=true;e.icon=!!t.icon.content;e.image=!!t.image.url;e.pieChart=Array.isArray(t.color);e.outerStroke=!!t.outerStroke.color;e.outline=!!t.outline.enabled;e.halo=!!t.halo.color;e.haloStroke=e.halo&&!!t.halo.strokeColor}function ph(e,t){e.text=!t.hidden&&!!t.content;e.background=e.text&&!!t.backgroundColor;e.tip=e.background&&t.tip&&t.position!=="center"}function _h(e,t){e.text=!!t.textContent;e.image=!!t.imageUrl}function yh(e,t,r){mh(e,t);e.fillColor=Array.isArray(t.color)?null:t.color;e.strokeColor=t.innerStroke.color;e.strokeMinVisibleSize=t.innerStroke.minVisibleSize;e.strokeWidthScaled=t.innerStroke.widthScaled;e.strokeWidthFixed=t.innerStroke.widthFixed;if(r){e.pattern.type=0}}function mh(e,t){e.pieceId=ns;e.x1=t.x;e.y1=t.y;e.x2=t.x;e.y2=t.y;e.rectWidthOrSourceRadiusScaled=t.diameterScaled;e.rectWidthOrSourceRadiusFixed=t.diameterFixed;e.rectHeightTargetRadiusScaled=t.diameterScaled;e.rectHeightTargetRadiusFixed=t.diameterFixed;e.shape=t.shape;e.opacity=t.opacity;e.symbolicSize=t.diameterScaled;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=0;e.offsetFixed=0;e.fillColor=null;e.strokeColor=null;e.globalMinVisibleSize=0;e.strokeMinVisibleSize=0;e.offsetAngle=0;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function xh(e,t){var r=t.image.fit&&!t.image.tile;mh(e,t);e.pattern.type=$o;e.pattern.attributes.image=t.image.content;e.pattern.attributes.scaled=r;e.pattern.attributes.duplicated=t.image.tile;e.patternScale=r?t.image.scale:0;e.patternMinVisibleSize=t.image.minVisibleSize;e.patternColor=null}function bh(e,t){var r=t.diameterScaled+t.halo.widthScaled*2;var i=t.diameterFixed+t.halo.widthFixed*2;e.pieceId=ns;e.shape="circle";e.x1=t.x;e.y1=t.y;e.x2=t.x;e.y2=t.y;e.rectWidthOrSourceRadiusScaled=r;e.rectWidthOrSourceRadiusFixed=i;e.rectHeightTargetRadiusScaled=r;e.rectHeightTargetRadiusFixed=i;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=0;e.offsetFixed=0;e.pattern.type=0;e.opacity=t.opacity;e.fillColor=t.halo.color;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=0;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=0;e.patternScale=0;e.symbolicSize=t.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function Sh(e,t){var r=t.diameterScaled+t.halo.widthScaled*2;var i=t.diameterFixed+t.halo.widthFixed*2;e.pieceId=ns;e.shape="circle";e.x1=t.x;e.y1=t.y;e.x2=t.x;e.y2=t.y;e.rectWidthOrSourceRadiusScaled=r;e.rectWidthOrSourceRadiusFixed=i;e.rectHeightTargetRadiusScaled=r;e.rectHeightTargetRadiusFixed=i;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=t.halo.strokeWidthScaled;e.strokeWidthFixed=t.halo.strokeWidthFixed;e.offsetScaled=0;e.offsetFixed=0;e.pattern.type=0;e.opacity=t.opacity;e.fillColor=null;e.strokeColor=t.halo.strokeColor;e.patternColor=null;e.globalMinVisibleSize=0;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=0;e.patternScale=0;e.symbolicSize=t.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function Ah(e,t){var r=t.diameterScaled*qn;var i=t.diameterFixed*qn;var n=t.diameterScaled*Yn;var a=t.diameterFixed*Yn+Zn;if(t.outerStroke.color){n+=t.outerStroke.widthScaled/2;a+=t.outerStroke.widthFixed/2}e.pieceId=ns;e.shape=t.shape;e.x1=t.x;e.y1=t.y;e.x2=t.x;e.y2=t.y;e.rectWidthOrSourceRadiusScaled=r;e.rectWidthOrSourceRadiusFixed=i;e.rectHeightTargetRadiusScaled=r;e.rectHeightTargetRadiusFixed=i;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=n;e.offsetFixed=a;e.pattern.type=0;e.opacity=t.opacity;e.fillColor=t.outline.color;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=t.outline.minVisibleSize;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=1.5707963267948966;e.patternScale=0;e.symbolicSize=t.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function Eh(e,t){mh(e,t);e.pattern.type=rs;e.pattern.attributes.text=t.icon.content;e.pattern.attributes.font=t.icon.font;e.pattern.attributes.style=t.icon.style;e.pattern.attributes.size="sdf";e.patternMinVisibleSize=t.icon.minVisibleSize;e.patternColor=t.icon.color;e.patternScale=t.icon.scale}function wh(e,t){mh(e,t);if(Array.isArray(t.color)){e.pattern.type=ts;e.pattern.attributes.colors=t.color.join(";");e.patternScale=1;e.patternMinVisibleSize=0;e.patternColor=null}}function Th(e,t){var r=t.diameterScaled+t.innerStroke.widthScaled*2;var i=t.diameterFixed+t.innerStroke.widthFixed*2;e.pieceId=ns;e.shape=t.shape;e.x1=t.x;e.y1=t.y;e.x2=t.x;e.y2=t.y;e.rectWidthOrSourceRadiusScaled=r;e.rectWidthOrSourceRadiusFixed=i;e.rectHeightTargetRadiusScaled=r;e.rectHeightTargetRadiusFixed=i;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=t.outerStroke.widthScaled;e.strokeWidthFixed=t.outerStroke.widthFixed;e.offsetScaled=0;e.offsetFixed=0;e.pattern.type=0;e.opacity=t.opacity;e.fillColor=null;e.strokeColor=t.outerStroke.color;e.patternColor=null;e.globalMinVisibleSize=t.outerStroke.minVisibleSize;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=0;e.patternScale=0;e.symbolicSize=t.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function kh(e,t,r){Ih(e,t,r);if(t.imageContent){e.pattern.type=$o;e.pattern.attributes.image=t.imageContent;e.pattern.attributes.scaled=true;e.pattern.attributes.duplicated=false;e.patternScale=t.imageScale;e.patternMinVisibleSize=0;e.patternColor=null}else{e.fillColor=null;e.strokeColor=null}}function Ch(e,t,r){Ih(e,t,r);if(t.textContent){e.pattern.type=rs;e.pattern.attributes.text=t.textContent;e.pattern.attributes.font=t.textFont;e.pattern.attributes.style=t.textStyle;e.pattern.attributes.size="sdf";e.patternMinVisibleSize=0;e.patternColor=t.textColor;e.patternScale=t.textScale}if(t.imageUrl||!t.textContent){e.fillColor=null;e.strokeColor=null}}function Ih(e,t,r){var i=r.diameterScaled*t.scale;var n=r.diameterFixed*t.scale;var a=r.diameterScaled*t.positionScale/2;var o=r.diameterFixed*t.positionScale/2;e.pieceId=ns;e.shape="circle";e.x1=r.x;e.y1=r.y;e.x2=r.x;e.y2=r.y;e.rectWidthOrSourceRadiusScaled=i;e.rectWidthOrSourceRadiusFixed=n;e.rectHeightTargetRadiusScaled=i;e.rectHeightTargetRadiusFixed=n;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=t.strokeWidthScaled;e.strokeWidthFixed=t.strokeWidthFixed;e.offsetScaled=a;e.offsetFixed=o;e.pattern.type=0;e.opacity=r.opacity;e.fillColor=t.color;e.strokeColor=t.strokeColor;e.patternColor=null;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=t.angle;e.patternScale=0;e.symbolicSize=r.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function Mh(e,t,r){Nh(e,t,r);e.pattern.type=is;e.pattern.attributes.text=t.content;e.pattern.attributes.font=t.font;e.pattern.attributes.style=t.style;e.pattern.attributes.align=t.align;e.patternMinVisibleSize=0;e.patternColor=t.color;e.thicknessOrFontSizeScaled=t.sizeScaled;e.thicknessOrFontSizeFixed=t.sizeFixed;e.isText=true}function Lh(e,t,r){Nh(e,t,r);e.fillColor=t.backgroundColor}function Fh(e,t,r){var i=Math.ceil(t.margin/2)+1;var n=r.diameterScaled/2+r.innerStroke.widthScaled+r.outerStroke.widthScaled;var a=r.diameterFixed/2+r.innerStroke.widthFixed+r.outerStroke.widthFixed+i;var o=na[t.position];var s=Math.cos(o);var u=Math.sin(o);e.pieceId=ns;e.shape="triangle";e.x1=r.x-s;e.y1=r.y-u;e.x2=r.x+s;e.y2=r.y+u;e.rectWidthOrSourceRadiusScaled=0;e.rectWidthOrSourceRadiusFixed=t.margin;e.rectHeightTargetRadiusScaled=0;e.rectHeightTargetRadiusFixed=t.margin*ta;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=n;e.offsetFixed=a;e.pattern.type=0;e.opacity=r.opacity;e.fillColor=t.backgroundColor;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=t.positionAngle;e.patternScale=0;e.symbolicSize=r.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false}function Nh(e,t,r){var i=0;var n=0;var a,o;if(!t.isPositionCenter){i+=r.innerStroke.widthScaled+r.outerStroke.widthScaled+r.diameterScaled/2;n+=r.innerStroke.widthFixed+r.outerStroke.widthFixed+r.diameterFixed/2+t.margin+t.padding}if(t.isPositionVertical){i+=t.heightScaled/2;n+=t.heightFixed/2;if(t===r.texts.secondary&&r.texts.primary.position==="bottom"){var s=r.texts.primary;i+=s.heightScaled;n+=s.heightFixed+s.margin+s.padding*2}}else if(t.isPositionHorizontal){i+=t.widthScaled/2;n+=t.widthFixed/2}if(t.sizeScaled>0){a="sdf";o=1}else{a=t.sizeFixed;o=0}e.pieceId=ns;e.shape="square";e.x1=r.x;e.y1=r.y;e.x2=r.x;e.y2=r.y;e.rectWidthOrSourceRadiusScaled=t.widthScaled;e.rectWidthOrSourceRadiusFixed=t.widthFixed+t.padding*2;e.rectHeightTargetRadiusScaled=t.heightScaled;e.rectHeightTargetRadiusFixed=t.heightFixed+t.padding*2;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=i;e.offsetFixed=n;e.pattern.type=0;e.pattern.attributes.size=a;e.opacity=r.opacity;e.fillColor=null;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=t.positionAngle;e.patternScale=o;e.symbolicSize=r.diameterScaled;e.curvature=0;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=false;e.isText=false}function zh(e,t,r,i,n,a){var o=n;var s=i;var u=a;var l=n.badges;var d=i.badges;var h=a.badges;Ph(e,t,r,i,n,a);Dh(e,t,r,s.text,o.texts.primary,u.texts.primary,u);Dh(e,t,r,s.text.secondary,o.texts.secondary,u.texts.secondary,u);Oh(e,t,r,d.topLeft,l.topLeft,h.topLeft,u);Oh(e,t,r,d.topRight,l.topRight,h.topRight,u);Oh(e,t,r,d.bottomLeft,l.bottomLeft,h.bottomLeft,u);Oh(e,t,r,d.bottomRight,l.bottomRight,h.bottomRight,u)}function Ph(e,t,r,i,n,a){if(n.halo){var o=i.halo.width.get(r);var s=+(i.halo.scalingMethod.get(r)==="scaled");a.halo.widthScaled=o*s;a.halo.widthFixed=o*(1-s);bh(n.halo,a);if(n.haloStroke){a.halo.strokeWidthScaled=0;a.halo.strokeWidthFixed=i.halo.strokeWidth.get(r);Sh(n.haloStroke,a)}}if(n.outline){a.outline.color=i.outline.color.get(r);a.outline.minVisibleSize=i.outline.minVisibleSize.get(r);Ah(n.outline,a)}if(n.outerStroke){a.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(r);Th(n.outerStroke,a)}if(n.pieChart){wh(n.pieChart,a)}if(n.image){a.image.content=t.imageManager.getImage(a.image.url);a.image.fit=i.image.fit.get(r);a.image.tile=i.image.tile.get(r);a.image.scale=i.image.scale.get(r);a.image.minVisibleSize=i.image.minVisibleSize.get(r);xh(n.image,a)}if(n.icon){a.icon.font=t.fontManager.getFont(i.icon.font.get(r));a.icon.style=i.icon.style.get(r);a.icon.color=i.icon.color.get(r);a.icon.scale=i.icon.scale.get(r);a.icon.minVisibleSize=i.icon.minVisibleSize.get(r);Eh(n.icon,a)}if(n.body){var u=!n.pieChart&&!n.image&&!n.icon;yh(n.body,a,u)}}function Oh(e,t,r,i,n,a,o){if(n.image||n.text){var s=i.stroke.width.get(r);var u=+(i.stroke.scalingMethod.get(r)==="scaled");a.color=$d(i.color.get(r),o.color,a.angle);a.strokeColor=i.stroke.color.get(r);a.strokeWidthScaled=s*u;a.strokeWidthFixed=s*(1-u);a.minVisibleSize=i.minVisibleSize.get(r);a.positionScale=i.positionScale.get(r);a.scale=i.scale.get(r)}if(n.image){a.imageContent=t.imageManager.getImage(a.imageUrl);a.imageScale=i.image.scale.get(r);kh(n.image,a,o)}if(n.text){a.textFont=t.fontManager.getFont(i.text.font.get(r));a.textStyle=i.text.style.get(r);a.textColor=$d(i.text.color.get(r),o.color);a.textScale=i.text.scale.get(r);Ch(n.text,a,o)}}function Dh(e,t,r,i,n,a,o){if(n.text){var s=i.scaling.get(r);a.font=t.fontManager.getFont(i.font.get(r));a.color=$d(i.color.get(r),o.color);a.style=i.style.get(r);a.align=i.align.get(r);a.minVisibleSize=i.minVisibleSize.get(r);a.margin=i.margin.get(r);a.padding=i.padding.get(r);a.maxLineLength=i.maxLineLength.get(r);a.content=xl(a.content,a.maxLineLength);if(s){var u=i.scale.get(r);a.sizeScaled=o.diameterScaled*u;a.sizeFixed=o.diameterFixed*u}else{a.sizeFixed=i.size.get(r);a.sizeScaled=0}var l=e.measureText(a.content,a.font,a.style);a.widthScaled=l.width*a.sizeScaled;a.widthFixed=l.width*a.sizeFixed;a.heightScaled=l.height*a.sizeScaled;a.heightFixed=l.height*a.sizeFixed;a.positionAngle=ia[a.position];a.isPositionCenter=a.position==="center";a.isPositionVertical=a.position==="top"||a.position==="bottom";a.isPositionHorizontal=a.position==="left"||a.position==="right";Mh(n.text,a,o);if(n.background){Lh(n.background,a,o);if(n.tip){Fh(n.tip,a,o)}}}}var Rh=th(Gh,"start");var Bh=th(Gh,"end");var jh=rh(Gh);var Uh=function e(t){var r=t.engine;var i=t.imageManager;var n=t.fontManager;var a=t.formatText;var o=t.attributes;var s=t.attributesPrev;this._engine=r;this._attributes=o;this._attributesPrev=s;this._helper={imageManager:i,fontManager:n,formatText:a};this._blocks=Vh(function(){return r.createBlock()});this._blockIds=Vh();this._fullComponents=Gh();this._startComponents=Gh();this._endComponents=Gh();this._startFlags=Gh();this._endFlags=Gh();this._startInput=lh();this._endInput=lh();this._depthInfo=fh();this._nodePatternAssigned=false;this._nullElt={start:null,end:null}};Uh.prototype.drawNode=function e(t){this._computeBlockIds(t);var r=this._attributes.excluded.get(t);if(r){this._freeBlocks()}else{var i=this._engine;var n=this._helper;var a="n"+t;var o=this._attributes.layer.get(t);var s=ch(o,this._depthInfo);var u=this._attributes.animationDuration.get(t);var l=u>0;this._prepareBlocks(l,s,a);ah(n,this._endInput,this._attributes,t);vh(this._endFlags,this._endInput);if(l){ah(n,this._startInput,this._attributesPrev,t);vh(this._startFlags,this._startInput);jh(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._blocks);Bh(this._endComponents,this._fullComponents);zh(i,n,t,this._attributes,this._endComponents,this._endInput);if(l){Rh(this._startComponents,this._fullComponents);zh(i,n,t,this._attributesPrev,this._startComponents,this._startInput)}if(l){var d=this._attributes.animationStart.get(t);var h=this._attributes.animationEasing.get(t);this._setBlocksAnimation(u,d,h)}if(this._endFlags.halo){var f=this._attributes.halo.hideNonAdjacentEdges.get(t);if(f){this._blocks.halo.setStencilUsage(ds);this._blocks.haloStroke.setStencilUsage(ds)}}this._storeBlocks()}};Uh.prototype._computeBlockIds=function e(t){var r=t*Cn;this._blockIds.body=r+yn;this._blockIds.text=r+mn;this._blockIds.textBg=r+xn;this._blockIds.halo=r+bn;this._blockIds.haloStroke=r+Sn};Uh.prototype._prepareBlocks=function e(t,r,i){this._blocks.body.reset(Zo,t,r.nodeBody,i);this._blocks.text.reset(Ko,t,r.nodeText,i);this._blocks.textBg.reset(Zo,t,r.nodeTextBackground,i);this._blocks.halo.reset(Zo,t,r.nodeHalo,i);this._blocks.haloStroke.reset(Zo,t,r.nodeHaloStroke,i)};Uh.prototype._storeBlocks=function e(){this._engine.storeBlock(this._blockIds.body,this._blocks.body);this._engine.storeBlock(this._blockIds.text,this._blocks.text);this._engine.storeBlock(this._blockIds.textBg,this._blocks.textBg);this._engine.storeBlock(this._blockIds.halo,this._blocks.halo);this._engine.storeBlock(this._blockIds.haloStroke,this._blocks.haloStroke)};Uh.prototype._freeBlocks=function e(){this._engine.freeBlock(this._blockIds.body);this._engine.freeBlock(this._blockIds.text);this._engine.freeBlock(this._blockIds.textBg);this._engine.freeBlock(this._blockIds.halo);this._engine.freeBlock(this._blockIds.haloStroke)};Uh.prototype._setBlocksAnimation=function e(t,r,i){this._blocks.body.setGlobalAnimation(t,r,i);this._blocks.text.setGlobalAnimation(t,r,i);this._blocks.textBg.setGlobalAnimation(t,r,i);this._blocks.halo.setGlobalAnimation(t,r,i);this._blocks.haloStroke.setGlobalAnimation(t,r,i)};Uh.prototype._initComponents=function e(t,r,i){this._nodePatternAssigned=false;this._initBaseComponents(t,r,i);this._initBadgeComponents(t.badges.topLeft,r.badges.topLeft,i);this._initBadgeComponents(t.badges.topRight,r.badges.topRight,i);this._initBadgeComponents(t.badges.bottomLeft,r.badges.bottomLeft,i);this._initBadgeComponents(t.badges.bottomRight,r.badges.bottomRight,i);this._initTextComponents(t.texts.primary,r.texts.primary,i);this._initTextComponents(t.texts.secondary,r.texts.secondary,i)};Uh.prototype._initBaseComponents=function e(t,r,i){t.haloStroke=this._nextElement(r.haloStroke,i.haloStroke);t.halo=this._nextElement(r.halo,i.halo);t.outline=this._nextElement(r.outline,i.body);t.outerStroke=this._nextElement(r.outerStroke,i.body);t.body=this._nextElement(r.body,i.body);t.pieChart=this._getNodePatternElement(r.pieChart,i);t.image=this._getNodePatternElement(r.image,i);t.icon=this._getNodePatternElement(r.icon,i)};Uh.prototype._initBadgeComponents=function e(t,r,i){t.image=this._nextElement(r.image,i.body);t.text=this._nextElement(r.text,i.body)};Uh.prototype._initTextComponents=function e(t,r,i){t.background=this._nextElement(r.background,i.textBg);t.tip=this._nextElement(r.tip,i.textBg);t.text=this._nextElement(r.text,i.text)};Uh.prototype._nextElement=function e(t,r){return t?r.next():this._nullElt};Uh.prototype._getNodePatternElement=function e(t,r){if(!t){return this._nullElt}else if(!this._nodePatternAssigned){this._nodePatternAssigned=true;return r.body.getCurrentElement()}else{return r.body.next()}};function Vh(e){if(e===void 0)e=function(){return 0};return{body:e(),text:e(),textBg:e(),halo:e(),haloStroke:e()}}function Gh(){return{haloStroke:undefined,halo:undefined,outline:undefined,outerStroke:undefined,body:undefined,pieChart:undefined,image:undefined,icon:undefined,badges:{topLeft:{text:undefined,image:undefined},topRight:{text:undefined,image:undefined},bottomLeft:{text:undefined,image:undefined},bottomRight:{text:undefined,image:undefined}},texts:{primary:{text:undefined,background:undefined,tip:undefined},secondary:{text:undefined,background:undefined,tip:undefined}}}}function Wh(e,t,r,i,n,a){Hh(e,t,r,i,n,a);Xh(e,t.texts.primary,r.text,i,t);Xh(e,t.texts.secondary,r.text.secondary,i,t)}function Hh(e,t,r,i,n,a){var o=n.source;var s=n.target;var u=r.source.get(i);var l=r.target.get(i);var d=o.x.get(u);var h=o.y.get(u);var f=o.radius.get(u);var c=o.color.get(u);var v=+(o.scalingMethod.get(u)==="scaled");var g=s.x.get(l);var p=s.y.get(l);var _=s.radius.get(l);var y=s.color.get(l);var m=+(s.scalingMethod.get(l)==="scaled");var x=eh(r.color.get(i),c,y);var b=r.width.get(i);var S=+(r.scalingMethod.get(i)==="scaled");var A=r.stroke.width.get(i);var E=+(r.stroke.scalingMethod.get(i)==="scaled");var w=ra[r.shape.style.get(i)];var T=r.adjustAnchors.get(i);t.source=u;t.target=l;t.sourceX=d;t.sourceY=h;t.targetX=g;t.targetY=p;t.sourceRadiusScaled=f*v;t.sourceRadiusFixed=f*(1-v);t.targetRadiusScaled=_*m;t.targetRadiusFixed=_*(1-m);t.widthScaled=b*S;t.widthFixed=b*(1-S);t.curvature=r.curvature.get(i);t.isSelfLoop=u===l;t.color=x;t.opacity=r.opacity.get(i);t.minVisibleSize=r.minVisibleSize.get(i);t.shape.type=r.shape.type.get(i);t.shape.head=r.shape.head.get(i);t.shape.tail=r.shape.tail.get(i);t.shape.dashLength=w.dash;t.shape.gapLength=w.gap;t.stroke.color=$d(r.stroke.color.get(i),x);t.stroke.widthScaled=A*E;t.stroke.widthFixed=A*(1-E);t.stroke.minVisibleSize=r.stroke.minVisibleSize.get(i);t.halo.color=r.halo.color.get(i);t.outline.enabled=r.outline.enabled.get(i);t.textHidden=r.textHidden.get(i);if(T&&(t.shape.head||t.shape.tail||t.shape.type==="triangle")){var k=t;var C=k.curvature;var I=k.sourceX;var M=k.sourceY;var L=k.targetX;var F=k.targetY;var N=1;var z=1;if(!C){N=qh(k,a,o,u,I,M,L,F);z=qh(k,a,s,l,L,F,I,M)}else if(!k.isSelfLoop){var P=aa(I,M,L,F,C/2);N=qh(k,a,o,u,I,M,P.x,P.y);z=qh(k,a,s,l,L,F,P.x,P.y)}t.sourceRadiusScaled*=N;t.sourceRadiusFixed*=N;t.targetRadiusScaled*=z;t.targetRadiusFixed*=z}}function Xh(e,t,r,i,n){t.hidden=n.textHidden;t.content=e.formatText(r.content.get(i));t.backgroundColor=$d(r.backgroundColor.get(i),n.color)}function qh(e,t,r,i,n,a,o,s){var u=t.angle;var l=Math.atan2(s-a,o-n)-u;var d=1;var h=0;var f=null;if(l<-Un){l+=Vn}else if(l>Un){l-=Vn}if(l<-Un/2){h=Gn;f=r.badges.topLeft}else if(l<0){h=Wn;f=r.badges.topRight}else if(l<Un/2){h=Xn;f=r.badges.bottomRight}else{h=Hn;f=r.badges.bottomLeft}h+=u;var c=f.text.content.get(i);var v=f.image.url.get(i);if(Jd(c)||v){var g=f.positionScale.get(i);var p=f.scale.get(i);var _=Math.cos(h);var y=Math.sin(h);var m=n+_*g;var x=a+y*g;var b=Br(o,s,n,a,m,x,p);if(b){var S=b.x-n;var A=b.y-a;var E=Math.sqrt(S*S+A*A);d=Math.max(d,E)}}var w=r.shape.get(i);if(w==="square"){var T=Math.abs(Math.cos(l));var k=Math.abs(Math.sin(l));var C=1/Math.max(T,k);d=Math.max(d,C)}return d}function Yh(){return{sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:false,color:"",opacity:0,minVisibleSize:0,shape:{type:"",head:null,tail:null,dashLength:0,gapLength:0},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:false,color:"",minVisibleSize:""},textHidden:false,texts:{primary:Zh(),secondary:Zh()}}}function Zh(){return{hidden:false,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:false}}function Kh(e,t){Qh(e.body,t,true,true);Qh(e.outline,t,t.outline.enabled,true);Qh(e.halo,t,!!t.halo.color,false);Jh(e.texts.primary,t.texts.primary);Jh(e.texts.secondary,t.texts.secondary)}function Qh(e,t,value,r){e.body=value;e.head=value&&r&&!!t.shape.head;e.tail=value&&r&&!!t.shape.tail}function Jh(e,t){e.text=!t.hidden&&!!t.content;e.background=e.text&&!!t.backgroundColor}function $h(e,t,r){ef(e,t);e.pieceId=r;e.shape=t.shape.type;e.thicknessOrFontSizeScaled=t.widthScaled;e.thicknessOrFontSizeFixed=t.widthFixed;e.strokeWidthScaled=t.stroke.widthScaled;e.strokeWidthFixed=t.stroke.widthFixed;e.offsetScaled=0;e.offsetFixed=0;e.fillColor=t.color;e.strokeColor=t.stroke.color;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=t.stroke.minVisibleSize;e.offsetAngle=0;e.symbolicSize=t.widthScaled;e.dashLength=t.shape.dashLength;e.gapLength=t.shape.gapLength;e.hasHead=!!t.shape.head;e.hasTail=!!t.shape.tail}function ef(e,t){e.pieceId=0;e.shape="";e.x1=t.sourceX;e.y1=t.sourceY;e.x2=t.targetX;e.y2=t.targetY;e.rectWidthOrSourceRadiusScaled=t.sourceRadiusScaled;e.rectWidthOrSourceRadiusFixed=t.sourceRadiusFixed;e.rectHeightTargetRadiusScaled=t.targetRadiusScaled;e.rectHeightTargetRadiusFixed=t.targetRadiusFixed;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=0;e.offsetFixed=0;e.pattern.type=0;e.opacity=t.opacity;e.fillColor=null;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=null;e.patternMinVisibleSize=0;e.offsetAngle=0;e.patternScale=0;e.symbolicSize=t.widthScaled;e.curvature=t.curvature;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=t.isSelfLoop;e.isText=false}function tf(e,t,r){var i=t.widthScaled+t.halo.widthScaled*2;var n=t.widthFixed+t.halo.widthFixed*2;ef(e,t);e.pieceId=r;e.shape="line";e.thicknessOrFontSizeScaled=i;e.thicknessOrFontSizeFixed=n;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=0;e.offsetFixed=0;e.fillColor=t.halo.color;e.strokeColor=null;e.globalMinVisibleSize=t.minVisibleSize;e.strokeMinVisibleSize=0;e.offsetAngle=0;e.symbolicSize=t.widthScaled;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false}function rf(e,t,r){ef(e,t);e.pieceId=r;e.shape=t.shape.type;e.thicknessOrFontSizeScaled=t.widthScaled*Kn;e.thicknessOrFontSizeFixed=t.widthFixed*Kn;e.strokeWidthScaled=0;e.strokeWidthFixed=0;e.offsetScaled=t.widthScaled*Qn;e.offsetFixed=t.widthFixed*Qn+Jn;e.fillColor=t.outline.color;e.strokeColor=0;e.globalMinVisibleSize=Math.max(t.minVisibleSize,t.outline.minVisibleSize);e.strokeMinVisibleSize=0;e.offsetAngle=Math.PI/2;e.symbolicSize=t.widthScaled;e.dashLength=t.shape.dashLength;e.gapLength=t.shape.gapLength;e.hasHead=!!t.shape.head;e.hasTail=!!t.shape.tail}function nf(e,t,r){of(e,t,r);e.pattern.type=is;e.pattern.attributes.text=t.content;e.pattern.attributes.size="sdf";e.pattern.attributes.font=t.font;e.pattern.attributes.style=t.style;e.pattern.attributes.align=t.align;e.patternColor=t.color;e.patternScale=1;e.thicknessOrFontSizeScaled=t.sizeScaled;e.thicknessOrFontSizeFixed=t.sizeFixed;e.isText=true}function af(e,t,r){of(e,t,r);e.fillColor=t.backgroundColor}function of(e,t,r){var i=(r.widthScaled+t.heightScaled)/2+r.stroke.widthScaled;var n=(r.widthFixed+t.heightFixed)/2+r.stroke.widthFixed+t.padding+t.margin;e.pieceId=us;e.shape="square";e.x1=r.sourceX;e.y1=r.sourceY;e.x2=r.targetX;e.y2=r.targetY;e.rectWidthOrSourceRadiusScaled=t.widthScaled;e.rectWidthOrSourceRadiusFixed=t.widthFixed+t.padding*2+1;e.rectHeightTargetRadiusScaled=t.heightScaled;e.rectHeightTargetRadiusFixed=t.heightFixed+t.padding*2;e.thicknessOrFontSizeScaled=0;e.thicknessOrFontSizeFixed=0;e.strokeWidthScaled=r.sourceRadiusScaled+r.targetRadiusScaled;e.strokeWidthFixed=r.sourceRadiusFixed+r.targetRadiusFixed;e.offsetScaled=i;e.offsetFixed=n;e.pattern.type=0;e.opacity=r.opacity;e.fillColor=null;e.strokeColor=null;e.patternColor=null;e.globalMinVisibleSize=Math.max(t.minVisibleSize,r.minVisibleSize);e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.offsetAngle=t.offsetAngle;e.patternScale=0;e.symbolicSize=r.widthScaled;e.curvature=r.curvature;e.dashLength=0;e.gapLength=0;e.hasHead=false;e.hasTail=false;e.isSelfLoop=r.isSelfLoop;e.isText=false;e.adjustTextAngle=t.adjustAngle}function sf(e,t,r,i,n,a){uf(e,t,r,i,n,a);df(e,t,r,i.text,n.texts.primary,a.texts.primary,a);df(e,t,r,i.text.secondary,n.texts.secondary,a.texts.secondary,a)}function uf(e,t,r,i,n,a){lf(n.body,a,$h);if(n.halo.body){var o=i.halo.width.get(r);var s=+(i.halo.scalingMethod.get(r)==="scaled");a.halo.widthScaled=o*s;a.halo.widthFixed=o*(1-s);lf(n.halo,a,tf)}if(n.outline.body){a.outline.color=i.outline.color.get(r);a.outline.minVisibleSize=i.outline.minVisibleSize.get(r);lf(n.outline,a,rf)}}function lf(e,t,r){r(e.body,t,as);if(e.head){r(e.head,t,os)}if(e.tail){r(e.tail,t,ss)}}function df(e,t,r,i,n,a,o){if(n.text){var s=i.scaling.get(r);a.font=t.fontManager.getFont(i.font.get(r));a.color=$d(i.color.get(r),o.color);a.style=i.style.get(r);a.minVisibleSize=i.minVisibleSize.get(r);a.margin=i.margin.get(r);a.padding=i.padding.get(r);a.maxLineLength=i.maxLineLength.get(r);a.content=xl(a.content,a.maxLineLength);a.adjustAngle=i.adjustAngle.get(r);a.align=i.align.get(r);if(s){var u=i.scale.get(r);a.sizeScaled=o.widthScaled*u;a.sizeFixed=o.widthFixed*u}else{a.sizeFixed=i.size.get(r);a.sizeScaled=0}var l=e.measureText(a.content,a.font,a.style);a.widthScaled=l.width*a.sizeScaled;a.widthFixed=l.width*a.sizeFixed;a.heightScaled=l.height*a.sizeScaled;a.heightFixed=l.height*a.sizeFixed;a.offsetAngle=a===o.texts.primary?$n:ea;nf(n.text,a,o);if(n.background){af(n.background,a,o)}}}var hf=th(pf,"start");var ff=th(pf,"end");var cf=rh(pf);var vf=function e(t){var r=t.engine;var i=t.imageManager;var n=t.fontManager;var a=t.formatText;var o=t.view;var s=t.attributes;var u=t.attributesPrev;var l=t.nodeAttributes;var d=t.nodeAttributesPrev;this._engine=r;this._view=o;this._helper={imageManager:i,fontManager:n,formatText:a};this._attributes=s;this._attributesPrev=u;this._nodeAttributes=l;this._nodeAttributesPrev=d;this._extremitiesAttributes={source:null,target:null};this._blocks=gf(function(){return r.createBlock()});this._blockIds=gf();this._fullComponents=pf();this._startComponents=pf();this._endComponents=pf();this._startFlags=pf();this._endFlags=pf();this._startInput=Yh();this._endInput=Yh();this._depthInfo=fh();this._nullElt={start:null,end:null}};vf.prototype.drawEdge=function e(t){this._computeBlockIds(t);var r=this._attributes.excluded.get(t);if(r){this._freeBlocks()}else{var i=this._engine;var n=this._helper;var a=this._extremitiesAttributes;var o="e"+t;var s=this._attributes.layer.get(t);var u=ch(s,this._depthInfo);var l=this._attributes.source.get(t);var d=this._attributes.target.get(t);var h=this._attributes.curvature.get(t);var f=this._attributesPrev.curvature.get(t);var c=this._attributes.animationDuration.get(t);var v=this._attributes.animationStart.get(t);var g=this._attributes.animationEasing.get(t);var p=c>0;var _=h!==0||p&&f!==0;this._prepareBlocks(p,u,o,_);a.source=this._nodeAttributes;a.target=this._nodeAttributes;Wh(n,this._endInput,this._attributes,t,a,this._view);Kh(this._endFlags,this._endInput);if(p){var y=this._nodeAttributes.animationDuration.get(l)>0;var m=this._nodeAttributes.animationDuration.get(d)>0;a.source=y?this._nodeAttributesPrev:this._nodeAttributes;a.target=m?this._nodeAttributesPrev:this._nodeAttributes;Wh(n,this._startInput,this._attributesPrev,t,a,this._view);Kh(this._startFlags,this._startInput);cf(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._blocks);ff(this._endComponents,this._fullComponents);sf(i,n,t,this._attributes,this._endComponents,this._endInput);if(p){hf(this._startComponents,this._fullComponents);sf(i,n,t,this._attributesPrev,this._startComponents,this._startInput);this._setBlocksAnimation(c,v,g)}this._setupHaloMasking(l,d);this._storeBlocks()}};vf.prototype._setupHaloMasking=function e(t,r){var i=this._nodeAttributes.halo;var n=i.color.get(t)&&i.hideNonAdjacentEdges.get(t);var a=i.color.get(r)&&i.hideNonAdjacentEdges.get(r);var o=!n&&!a;var s=o?hs:ls;this._blocks.body.setStencilUsage(s);this._blocks.text.setStencilUsage(s);this._blocks.textBg.setStencilUsage(s)};vf.prototype._computeBlockIds=function e(t){var r=t*Cn;this._blockIds.body=r+An;this._blockIds.halo=r+Tn;this._blockIds.text=r+En;this._blockIds.textBg=r+wn};vf.prototype._prepareBlocks=function e(t,r,i,n){this._blocks.body.reset(n?Qo:Zo,t,r.edgeBody,i);this._blocks.halo.reset(n?Qo:Zo,t,r.edgeHalo,i);this._blocks.text.reset(Ko,t,r.edgeText,i);this._blocks.textBg.reset(Zo,t,r.edgeTextBackground,i)};vf.prototype._storeBlocks=function e(){this._engine.storeBlock(this._blockIds.body,this._blocks.body);this._engine.storeBlock(this._blockIds.halo,this._blocks.halo);this._engine.storeBlock(this._blockIds.text,this._blocks.text);this._engine.storeBlock(this._blockIds.textBg,this._blocks.textBg)};vf.prototype._freeBlocks=function e(){this._engine.freeBlock(this._blockIds.body);this._engine.freeBlock(this._blockIds.halo);this._engine.freeBlock(this._blockIds.text);this._engine.freeBlock(this._blockIds.textBg)};vf.prototype._setBlocksAnimation=function e(t,r,i){this._blocks.body.setGlobalAnimation(t,r,i);this._blocks.halo.setGlobalAnimation(t,r,i);this._blocks.text.setGlobalAnimation(t,r,i);this._blocks.textBg.setGlobalAnimation(t,r,i)};vf.prototype._initComponents=function e(t,r,i){this._initEdgeComponents(t.halo,r.halo,i.halo);this._initEdgeComponents(t.outline,r.outline,i.body);this._initEdgeComponents(t.body,r.body,i.body);this._initTextComponents(t.texts.primary,r.texts.primary,i);this._initTextComponents(t.texts.secondary,r.texts.secondary,i)};vf.prototype._initEdgeComponents=function e(t,r,i){t.head=this._nextElement(r.head,i);t.tail=this._nextElement(r.tail,i);t.body=this._nextElement(r.body,i)};vf.prototype._initTextComponents=function e(t,r,i){t.background=this._nextElement(r.background,i.textBg);t.text=this._nextElement(r.text,i.text)};vf.prototype._nextElement=function e(t,r){return t?r.next():this._nullElt};function gf(e){if(e===void 0)e=function(){return 0};return{body:e(),halo:e(),text:e(),textBg:e()}}function pf(){return{halo:{body:undefined,head:undefined,tail:undefined},outline:{body:undefined,head:undefined,tail:undefined},body:{body:undefined,head:undefined,tail:undefined},texts:{primary:{text:undefined,background:undefined},secondary:{text:undefined,background:undefined}}}}function _f(e){var t=e.ogma;var r=e.graph;var i=e.engine;var n=e.imageManager;var a=e.fontManager;var o=e.view;var s=e.attributes;var u=e.boundaries;var l=e.formatText;var d=yf(s);var h=d.nodeAttributes;var f=d.nodeAttributesPrev;var c=d.edgeAttributes;var v=d.edgeAttributesPrev;var g=r.nodes;var p=r.edges;var _=u.maxSize;var y=u.maxMinVisibleSize;if(!g.size&&!p.size){return}var m=Math.max(t.modules.graph.getNodeMaxIndex(),t.modules.graph.getEdgeMaxIndex());var x=(m+1)*Cn;var b=i.setGlobalBoundaries({maxBlockId:tt(x),maxScaledSize:tt(_*8),maxMinVisibleSize:tt(y),maxSymbolicSize:tt(_),maxDashLength:3,maxGapLength:1,maxPatternScale:2});var S=(b?t.getNodes("_all"):g)._indexes;var A=(b?t.getEdges("_all"):p)._indexes;var E=new Uh({engine:i,imageManager:n,fontManager:a,formatText:l,attributes:h,attributesPrev:f});var w=new vf({engine:i,imageManager:n,fontManager:a,formatText:l,view:o,attributes:c,attributesPrev:v,nodeAttributes:h,nodeAttributesPrev:f});for(var T=0;T<S.length;++T){E.drawNode(S[T])}for(var k=0;k<A.length;++k){w.drawEdge(A[k])}}function yf(e){var t=$(e.nodes.current,{text:{secondary:{scaling:e.nodes.current.text.scaling,maxLineLength:e.nodes.current.text.maxLineLength}}});var r=$(e.nodes.previous,{textHidden:t.textHidden,text:{secondary:{scaling:e.nodes.previous.text.scaling,maxLineLength:e.nodes.previous.text.maxLineLength}}});var i=$(e.edges.current,{text:{secondary:{scaling:e.edges.current.text.scaling,maxLineLength:e.edges.current.text.maxLineLength,adjustAngle:e.edges.current.text.adjustAngle}}});var n=$(e.edges.previous,{source:e.edges.current.source,target:e.edges.current.target,textHidden:e.edges.current.textHidden,text:{secondary:{scaling:e.edges.previous.text.scaling,maxLineLength:e.edges.previous.text.maxLineLength,adjustAngle:e.edges.previous.text.adjustAngle}}});return{nodeAttributes:t,nodeAttributesPrev:r,edgeAttributes:i,edgeAttributesPrev:n}}var mf=typeof document!=="undefined"&&!window.__OGMA_HEADLESS;var xf=mf&&document.fonts;var bf=200;var Sf="/qwerty/ [HELLO] ";var Af="serif";var Ef="12px FontThatDoesNotExist";var wf=function e(){this._fontFaceSet=xf?document.fonts:null;this._checkReliable=this._fontFaceSet&&this._fontFaceSet.check&&!this._fontFaceSet.check(Ef);this._canvas=ke();this._ctx=this._canvas.getContext("2d")};wf.prototype._measureText=function e(t,r){this._ctx.font="12px "+r;return this._ctx.measureText(t).width};wf.prototype.check=function e(t){if(this._checkReliable){return this._fontFaceSet.check("12px "+t)}else{var r=this._measureText(Sf,Af);var i=this._measureText(Sf,t);return i!==r}};wf.prototype.load=function e(t){if(this._fontFaceSet&&this._fontFaceSet.load){return this._fontFaceSet.load("12px "+t)}else{this._ctx.font="12px "+t;this._ctx.fillText(Sf,10,50);return Promise.resolve()}};var Tf=function e(){this._fontFaceSet=new wf;this._fonts={};this._onFontLoaded=[];this._hideUntilFontsLoaded=true};Tf.prototype.setHideUntilFontsLoaded=function e(value){this._hideUntilFontsLoaded=value};Tf.prototype.getFont=function e(t){var r=this;var i=this._fonts[t];if(!i){i=new kf(this._fontFaceSet,t);this._fonts[t]=i;if(!i.isLoaded()){i.load().then(function(){return r._triggerFontLoaded(t)})}}return!this._hideUntilFontsLoaded&&t||i.getValue()};Tf.prototype.onFontLoaded=function e(t){this._onFontLoaded.push(t)};Tf.prototype.destroy=function e(){var t=this;this._onFontLoaded=[];Object.keys(this._fonts).forEach(function(e){return t._fonts[e].destroy()})};Tf.prototype._triggerFontLoaded=function e(t){this._onFontLoaded.forEach(function(e){return e(t)})};var kf=function e(t,r){this._fontFaceSet=t;this._fontName=r;this._loaded=false;this._value=null;this._timeout=null;if(!mf||this._fontFaceSet.check(this._fontName)){this._setLoaded()}};kf.prototype._setLoaded=function e(){this._loaded=true;this._value=this._fontName};kf.prototype.getValue=function e(){return this._value};kf.prototype.isLoaded=function e(){return this._loaded};kf.prototype.destroy=function e(){clearTimeout(this._timeout)};kf.prototype.load=function e(){var t=this;return this._tryLoad(bf).then(function(){t._setLoaded()})};kf.prototype._tryLoad=function e(t){var r=this;return this._fontFaceSet.load(this._fontName).then(function(){var e=r._fontFaceSet.check(r._fontName);if(!e){return new Promise(function(e){if(t<6e4){r._timeout=setTimeout(e,t)}}).then(function(){return r._tryLoad(t*1.5)})}})};Ogma.extend(function(e){var t=new Df(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.graphics=t;e.reloadFonts=function(){t.reloadFonts()};e.view.getImageData=function(){return t.getImageData()};e.events.onRendererStateChange=function(t){e.modules.events.on("rendererStateChange",t);return e.events};e.styles.setNodesVisibility=function(value){return t.setNodesVisibility(value)};e.styles.setEdgesVisibility=function(value){return t.setEdgesVisibility(value)};e.styles.setNodeTextsVisibility=function(value){return t.setNodeTextsVisibility(value)};e.styles.setEdgeTextsVisibility=function(value){return t.setEdgeTextsVisibility(value)};r.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)[0]};n.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)};i.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)[0]};a.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)};Cf([r,i,n,a],"setStyle","setAttributes");Cf([r,i,n,a],"resetStyle","resetAttributes");Cf([r,i,n,a],"getStyle","getAttribute");Cf([r,n],"setPosition","setAttributes")});function Cf(e,t,r){for(var i=0;i<e.length;++i){var n=e[i];n.prototype[t]=function(e,i){Ja('Deprecated method "'+t+'"; please use "'+r+'" instead.');return this[r](e,i)}}}var If="anonymous";var Mf="white";var Lf="default";var Ff={maxBlockId:1024,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1};Ogma.atInit(function(e,t){if(t.renderer!==undefined){e.setOptions({renderer:t.renderer})}if(t.imgCrossOrigin!==undefined){e.setOptions({imgCrossOrigin:t.imgCrossOrigin})}e.modules.dom.addWindowEventListener("unload",function(){Nf(e)})});Ogma.onDestroy(function(e){Nf(e);zf(e)});function Nf(e){if(e.modules){e.modules.graphics.getGraphicsEngine().destroy()}}function zf(e){if(e.modules){e.modules.graphics.getImageManager().destroy();e.modules.graphics.getFontManager().destroy()}}function Pf(){var e=S("mapbox-gl-rtl-text");if(e){var t=e.applyArabicShaping;return function(e){if(e===null){return null}else if(typeof e==="number"){return e.toString()}else{return t(e)}}}else{return function(e){return e===null?null:e.toString()}}}var Of=typeof window==="undefined"||window.__OGMA_HEADLESS?null:"webgl";var Df=function e(t){var r=this;this._ogma=t;this._debug=t._debug;this._events=t.modules.events;this._dom=t.modules.dom;this._graph=t.modules.graph;this._camera=t.modules.camera;this._events=t.modules.events;this._settings=t.modules.settings;this._formatText=Pf();this._attributesManager=new Nd(t);this._imageManager=new ml;this._fontManager=new Tf;this._engine=new pl;this._domElement=this._engine.getDomElement();this._animations=[];this._cursorStyle=[];this._initDone=false;this._fontsNewlyLoaded=[];this._rendererState={type:"",code:"",state:"",message:""};this._boundaries={maxSize:10,maxMinVisibleSize:64};this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0};this._nextAnimationId=1;this._nodeAnimationList=this._graph.createNodeAttribute({storage:32,default:0});this._edgeAnimationList=this._graph.createEdgeAttribute({storage:32,default:0});this._nextGeIndex=1;this._availableGeIndexes=[];this._events.register(["reloadFonts","rendererStateChange","updateAttributes","animate"]);this._settings.register("renderer",Of,function(e){r._updateRendererState({type:e,state:"requested",code:null,message:null});r._dom.refresh()});this._settings.register("backgroundColor",Mf,function(e){if(!r._engine.parseColor(e)){Ja('Invalid background color "'+e+'" specified; will default to black.');r._settings.set("backgroundColor","black")}else{r._dom.refresh()}});this._settings.register("texts.hideUntilFontsLoaded",true,function(e){r._fontManager.setHideUntilFontsLoaded(e)});this._settings.register("imgCrossOrigin",If,function(){return r._updateImageCrossOrigin()});this._settings.register("cursor.default",Lf,function(){return r._applyCursorStyle()});this._dom.setLayer("graphics",this._domElement);this._engine.setGlobalBoundaries(Ff);this._dom.beforeNextFrame().then(function(){r._initDone=true;r._fireRendererStateChangeEvent()});this._isBufferDisplayable=function(e){var t=ih(e);var i=nh(e);var n=t?r._visibility.nodes:r._visibility.edges;var a=t?r._visibility.nodeTexts:r._visibility.edgeTexts;var o=n===0;var s=!i||a===0;return o&&s};this._imageManager.onFetch(function(){r._engine.notifyPatternUpdate();r._dom.refresh()});this._fontManager.onFontLoaded(function(e){r._fontsNewlyLoaded.push(e);r._engine.notifyPatternUpdate();r._dom.refresh()});this._dom.addMediaListener("(min-resolution: 2dppx)",function(){r._dom.refresh()});this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:"internal("+sd+")",tag:sd,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:null,edgeDependencies:null});this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:"internal("+ud+")",tag:ud,nodeDependencies:null,edgeDependencies:null});this._events.on({cameraMove:function(){return r._dom.refresh()},newFrame:function(){r._processAnimations();r._loadGraphInGraphicsEngine();r._render()},clear:function(){r._nextGeIndex=1;r._availableGeIndexes=[];r._engine.clear();r._attributesManager.clear();r._dom.refresh()},viewChanged:function(e){var t=e.type;if(t==="rotate"){var i=r._ogma.getEdges().filter(function(e){return e.getAttribute("adjustAnchors")});r._attributesManager.redrawElements(i)}},"addNodes addEdges":function(e){r._attributesManager.updateForAllAttributeLayers(e.nodes||e.edges)},excludedStateChange:function(e){r._visibleAttributeLayer.updateElements(e.elements)},setData:function(e){r._dataAttributeLayer.updateElements(e.elements)}})};Df.prototype.getTransparentBackgroundColor=function e(){return this._engine.transparentify(this._settings.get("backgroundColor"))};Df.prototype._render=function e(){var t=this._settings.get("renderer");var r=this._dom.getDimensions();var i=this._camera.getView();var n=Ce();var a=tr();var o=this._settings.get("backgroundColor");var s=this._isBufferDisplayable;this._engine.setView({x:i.x,y:i.y,zoom:i.zoom,angle:i.angle,width:r.width,height:r.height,pixelRatio:n,currentTime:a,backgroundColor:o,isBufferDisplayable:s});this._engine.setRenderType(t);try{this._engine.render();if(this._rendererState.state==="requested"){this._updateRendererState({state:"ok"})}}catch(e){if(this._debug){throw e}var u=e.message;var l=e.code;if(l===void 0)l="OTHER";var d=this._formatRendererName(t);var h=this._rendererState.state==="requested";var f="Error while initializing the "+d+" renderer";var c="The "+d+" renderer encountered an unexpected runtime error";var v=h?f:c;var g=null;if(t==="webgl"){v+="; fallbacking on canvas renderer";g="canvas"}Ja(u);Ja(v);this._updateRendererState({state:"error",code:l,message:u});this._settings.set("renderer",g)}};Df.prototype._formatRendererName=function e(t){if(t==="webgl"){return"WebGL"}else if(t==="svg"){return"SVG"}else{return t}};Df.prototype._fireRendererStateChangeEvent=function e(){var t={type:this._rendererState.type,state:this._rendererState.state,code:this._rendererState.code,message:this._rendererState.message};this._events.fire("rendererStateChange",t)};Df.prototype._updateRendererState=function e(t){var r=t.type;var i=t.state;var n=t.code;var a=t.message;var o=false;if(r!==undefined&&this._rendererState.type!==r){this._rendererState.type=r;o=true}if(i!==undefined&&this._rendererState.state!==i){this._rendererState.state=i;o=true}if(n!==undefined&&this._rendererState.code!==n){this._rendererState.code=n;o=true}if(a!==undefined&&this._rendererState.message!==a){this._rendererState.message=a;o=true}if(o&&this._initDone){this._fireRendererStateChangeEvent()}};Df.prototype.getImageData=function e(){var t=this;return this._dom.afterNextFrame().then(function(){return t._engine.getImageData()})};Df.prototype.addCanvas=function e(t){this._engine.addCanvas(t)};Df.prototype.removeCanvas=function e(t){this._engine.removeCanvas(t)};Df.prototype.getNodeAttributes=function e(){return this._attributesManager.getFlexArrays().nodes.current};Df.prototype.getEdgeAttributes=function e(){return this._attributesManager.getFlexArrays().edges.current};Df.prototype.getGraphicsEngine=function e(){return this._engine};Df.prototype.getImageManager=function e(){return this._imageManager};Df.prototype.getFontManager=function e(){return this._fontManager};Df.prototype.allocateGraphicsEngineBlockId=function e(){if(this._availableGeIndexes.length){return this._availableGeIndexes.pop()}else{return this._nextGeIndex++*Cn+kn}};Df.prototype.releaseGraphicsEngineBlockId=function e(t){this._engine.freeBlock(t);this._availableGeIndexes.push(t);this._dom.refresh()};Df.prototype.addCursorStyle=function e(t){if(!t){return}this._cursorStyle.push(t);this._applyCursorStyle()};Df.prototype.removeCursorStyle=function e(t){if(!t){return}var r=this._cursorStyle.lastIndexOf(t);if(r!==-1){this._cursorStyle.splice(r,1);this._applyCursorStyle()}};Df.prototype._applyCursorStyle=function e(){var t=this._cursorStyle[this._cursorStyle.length-1]||this._settings.get("cursor.default");Ve(this._domElement,t)};Df.prototype.reloadFonts=function e(){this._events.fire("reloadFonts");this._engine.notifyFontsReloaded();this._dom.refresh()};Df.prototype._updateImageCrossOrigin=function e(){this._imageManager.setImgCrossOrigin(this._settings.get("imgCrossOrigin"))};Df.prototype.getDomElement=function e(){return this._domElement};Df.prototype.setTextHidden=function e(t,r){this._attributesManager.setTextHidden(t,r);this._dom.refresh()};Df.prototype.resetTextHidden=function e(){this._attributesManager.resetTextHidden();this._dom.refresh()};Df.prototype.getAttributesManager=function e(){return this._attributesManager};Df.prototype._checkFontsNewlyLoaded=function e(){if(this._fontsNewlyLoaded.length){this._fontsNewlyLoaded=[];return true}return false};Df.prototype._loadGraphInGraphicsEngine=function e(){this._attributesManager.update();if(this._checkFontsNewlyLoaded()){this._attributesManager.redrawAll()}var t=this._attributesManager.getAndResetElementsToRedraw();var r=this._attributesManager.getAndResetElementsUpdated();var i=r.nodes.size||r.edges.size;if(r.nodeAttributes.includes("radius")||r.edgeAttributes.includes("width")){this._computeMaxSize()}_f({ogma:this._ogma,graph:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText});if(i){this._events.fire("updateAttributes",r)}};Df.prototype._computeMaxSize=function e(){var t=this._graph.getNodeAttribute("radius");var r=this._graph.getEdgeAttribute("width");var i=this._graph.getNodes();var n=this._graph.getEdges();var a=0;var o=0;for(var s=0,u=i._indexes;s<u.length;s+=1){var l=u[s];var d=t.get(l);if(d>a){a=d}}for(var h=0,f=n._indexes;h<f.length;h+=1){var c=f[h];var v=r.get(c);if(v>o){o=v}}this._boundaries.maxSize=Math.max(a*2,o)};Df.prototype._forceCompleteGraphRefresh=function e(){this._attributesManager.redrawAll();this._loadGraphInGraphicsEngine()};Df.prototype.export=function e(t,r,i,n){var a=this;var o;return Promise.all([this._graph.getNodes().addClass(gd),this._graph.getEdges().addClass(gd)]).then(function(){return a.resolveAtNextFrame()}).then(function(){return a._imageManager.whenReady()}).then(function(){if(i==="all"){o=Vf(a._ogma);a._forceCompleteGraphRefresh()}else{a._loadGraphInGraphicsEngine()}return a._engine.export(t,r,n)}).then(function(e){return Promise.all([a._graph.getNodes().removeClass(gd),a._graph.getEdges().removeClass(gd)]).then(function(){return e})}).then(function(e){if(i==="all"){Gf(o);a._forceCompleteGraphRefresh()}return e})};Df.prototype.addAttributeLayer=function e(t){return this._attributesManager.addAttributeLayer(t)};Df.prototype.createFlexArrays=function e(){return this._attributesManager.createFlexArrays()};Df.prototype.getAttributeValues=function e(t,r,i,n){return this._attributesManager.getAttributeValues(t,r,i,n)};Df.prototype.forceAttributesComputation=function e(){this._attributesManager.update()};Df.prototype.resolveAtNextFrame=function e(t){return this._dom.afterNextFrame().then(function(){return t})};Df.prototype.animate=function e(t,r,i){var n=this;var a=Rf(i);var o=function(){return n._animate(t,r,a)};if(a.duration&&this._rendererState.state==="requested"){return this._dom.afterNextFrame().then(o)}else{return o()}};Df.prototype.isAnimating=function e(){return this._animations.length>0};Df.prototype.getAnimationInformation=function e(t){return this._attributesManager.getAnimationInformation(t)};Df.prototype._toSubGraph=function e(t){var r=this._graph;var i=r.Node;var n=r.Edge;var a=r.NodeList;var o=r.EdgeList;if(t instanceof a||t instanceof i){return{nodes:t.toList(),edges:t.getAdjacentEdges()}}else if(t instanceof o||t instanceof n){return{nodes:new a,edges:t.toList()}}else{var s={nodes:t.nodes||new a,edges:t.edges||new o};if(s.nodes.size){if(s.edges.size){s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe()}else{s.edges=s.nodes.getAdjacentEdges()}}return s}};Df.prototype._animate=function e(t,r,i){var n=this;var a=i.duration;var o=i.easing;if(!this._animations.length&&!a){r(t);return Promise.resolve(t)}var s=this._toSubGraph(t);var u=s.nodes;var l=s.edges;if(!u.size&&!l.size){return Promise.resolve(t)}if(u.size){this._events.fire("animate",{elements:u,duration:a,easing:o})}if(l.size){this._events.fire("animate",{elements:l,duration:a,easing:o})}var d={id:this._nextAnimationId++,startTime:-1,finished:false,func:function(){return r(t)},duration:a,easing:o,nodes:u,edges:l,resolve:undefined};var h=new Promise(function(e){return d.resolve=function(){return e(t)}});for(var f=0,c=u._indexes;f<c.length;f+=1){var v=c[f];n._nodeAnimationList.set(v,d.id)}for(var g=0,p=l._indexes;g<p.length;g+=1){var _=p[g];n._edgeAnimationList.set(_,d.id)}this._animations.push(d);this._dom.refresh();if(!a){this._processAnimations()}return h};Df.prototype._isElementAnimated=function e(t){var r=(t.isNode?this._nodeAnimationList:this._edgeAnimationList).get(t._index)!==0;if(!t.isNode){r|=this._nodeAnimationList.get(t.getSource()._index)!==0;r|=this._nodeAnimationList.get(t.getTarget()._index)!==0}return r};Df.prototype._endAnimation=function e(t){t.resolve(t.elements);t.finished=true};Df.prototype._removeFinishedAnimations=function e(){this._animations=this._animations.filter(function(e){return!e.finished})};Df.prototype._getAnimationElements=function e(t){var r=this;var i=this._graph;var n=i.NodeList;var a=i.EdgeList;var o=[];var s=[];for(var u=0,l=t.nodes._indexes;u<l.length;u+=1){var d=l[u];if(r._nodeAnimationList.get(d)===t.id){o.push(d)}}for(var h=0,f=t.edges._indexes;h<f.length;h+=1){var c=f[h];if(r._edgeAnimationList.get(c)===t.id){s.push(c)}}return{nodes:new n(o),edges:new a(s)}};Df.prototype._resetAnimationAttributes=function e(t){var r=t.nodes;var i=t.edges;this._attributesManager.resetAnimationAttributes({nodes:r,edges:i});this._nodeAnimationList.fill(r._indexes,0);this._edgeAnimationList.fill(i._indexes,0)};Df.prototype._processAnimations=function e(){var t=this;if(!this._animations.length){return}var r=tr();var i=[];this._attributesManager.update();for(var n=0,a=t._animations;n<a.length;n+=1){var o=a[n];if(o.startTime===-1){o.startTime=r;i.push(o.func);if(o.duration>0){t._attributesManager.setAnimationAttributes(t._getAnimationElements(o),o)}}}for(var s=0,u=i;s<u.length;s+=1){var l=u[s];l()}for(var d=0,h=t._animations;d<h.length;d+=1){var f=h[d];if(r>=f.startTime+f.duration){t._resetAnimationAttributes(t._getAnimationElements(f));t._endAnimation(f)}}this._removeFinishedAnimations();if(this._animations.length){this._dom.refresh()}};Df.prototype.hideTexts=function e(){this.setNodeTextsVisibility(false);this.setEdgeTextsVisibility(false)};Df.prototype.showTexts=function e(){this.setNodeTextsVisibility(true);this.setEdgeTextsVisibility(true)};Df.prototype.setNodesVisibility=function e(value){return this._updateVisibilityCounter("nodes",value)};Df.prototype.setNodeTextsVisibility=function e(value){return this._updateVisibilityCounter("nodeTexts",value)};Df.prototype.setEdgesVisibility=function e(value){return this._updateVisibilityCounter("edges",value)};Df.prototype.setEdgeTextsVisibility=function e(value){return this._updateVisibilityCounter("edgeTexts",value)};Df.prototype._updateVisibilityCounter=function e(t,value){this._visibility[t]+=value?-1:1;this._dom.refresh()};Df.prototype.detectNode=function e(t){var r=this;var i=t.position;var n=t.margin;var a=t.texts;var o=t.indexes;if(o===void 0)o=this._graph.getNodes()._indexes;var s=this._engine;var u=this._graph._nodes;var l=this._attributesManager.getFlexArrays().nodes.current;var d=this._camera.getZoom();var h=i.x;var f=i.y;var c={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}};var v=0;this._attributesManager.update();for(var g=0;g<o.length;++g){var p=o[g];if(!l.excluded.get(p)&&l.detectable.get(p)&&l.animationDuration.get(p)===0){var _=l.x.get(p);var y=l.y.get(p);var m=r._camera.graphToScreenCoordinates({x:_,y:y});var x=m.x;var b=m.y;var S=l.shape.get(p);var A=l.scalingMethod.get(p)==="scaled";var E=l.radius.get(p)*(A?d:1);var w=E+n;var T=(h-x)/w;var k=(f-b)/w;if(s.checkShapeHit(S,T,k)){v=p}else if(a){var C=r._formatText(l.text.content.get(p));var I=l.textHidden.get(p);var M=l.text.minVisibleSize.get(p);var L=A?E*2:Infinity;if(!I&&C&&L>=M){var F=xl(C,l.text.maxLineLength.get(p));var N=l.innerStroke.width.get(p);var z=l.outerStroke.width.get(p);var P=l.text.margin.get(p);var O=l.text.padding.get(p);var D=l.text.size.get(p);var R=l.text.scale.get(p);var B=l.text.scaling.get(p);var j=l.text.font.get(p);var U=l.text.style.get(p);var V=l.text.position.get(p);var G=s.measureText(F,j,U,1);var W=B?R*E:D;var H=G.width*W/2+O+n;var X=G.height*W/2+O+n;var q=c[V];var Y=N+z+P+E;var Z=(Y+H)*q.x;var K=(Y+X)*q.y;var Q=x+Z;var J=b+K;var $=Q-H;var ee=Q+H;var te=J-X;var re=J+X;if(h>$&&h<ee&&f>te&&f<re){v=p}}}}}return u.get(v)||null};Df.prototype.detectEdge=function e(t){var r=t.position;var i=t.margin;var n=t.texts;var a=t.indexes;if(a===void 0)a=this._graph.getEdges()._indexes;var o=this._graph._edges;var s=this._attributesManager.getFlexArrays();var u=s.edges.current;var l=s.nodes.current;var d=this._camera.getZoom();var h=i/d;var f=this._camera.screenToGraphCoordinates(r);var c=f.x;var v=f.y;var g=0;this._attributesManager.update();for(var p=0;p<a.length;++p){var _=a[p];var y=u.source.get(_);var m=u.target.get(_);var x=u.excluded.get(_);var b=u.detectable.get(_);var S=u.animationDuration.get(_)!==0;var A=l.animationDuration.get(y)!==0;var E=l.animationDuration.get(m)!==0;if(!x&&b&&!S&&!A&&!E){var w=y===m;var T=u.curvature.get(_);var k=u.shape.type.get(_)==="triangle";var C=u.scalingMethod.get(_)==="scaled";var I=u.width.get(_)/(C?1:d);var M=l.x.get(y);var L=l.y.get(y);var F=l.x.get(m);var N=l.y.get(m);if(w){var z=l.scalingMethod.get(y)==="scaled";var P=l.radius.get(y)/(z?1:d);var O=oa(M,L,T,P,0);if(ha(c,v,M,L,M,L,O.x1,O.y1,O.x2,O.y2,I,h)){g=_}}else if(T!==0){var D=aa(M,L,F,N,T);if(ua(c,v,M,L,F,N,D.x,D.y,I,h,k)){g=_}}else{if(Zr(c,v,M,L,F,N,I,h,k)){g=_}}}}return o.get(g)||null};Df.prototype._getAttributeArray=function e(t,r){var i=this._attributesManager.getFlexArrays();var n=t?i.nodes:i.edges;return no(n.current,r)};function Rf(e){if(typeof e==="number"){e={duration:e}}else if(typeof e!=="object"||e===null){e={}}return{duration:Bf(e.duration),easing:e.easing||"linear",chain:!!e.chain}}function Bf(e){if(typeof e!=="number"||!isFinite(e)||e<0){return 0}else{return e}}function jf(e,t){var r=e.modules.graph.getAttribute(t,"excluded"),i=(t?e.getNodes("all"):e.getEdges("all"))._indexes,n=r.getMultiple(i);r.fill(i,0);return{excludedList:r,indexes:i,values:n}}function Uf(e){var t=e.excludedList;var r=e.indexes;var i=e.values;t.setMultiple(r,i)}function Vf(e){return{nodes:jf(e,true),edges:jf(e,false)}}function Gf(e){var t=e.nodes;var r=e.edges;Uf(t);Uf(r)}Ogma.extend(function(e){return e.modules.curvatureManager=new Wf(e)});var Wf=function e(t){var r=this;this._settings=t.modules.settings;this._graphics=t.modules.graphics;this._context={edgesAlwaysCurvy:false,directedEdges:false};this._attributeLayer=this._addAttributeLayer();this._settings.register("edgesAlwaysCurvy",false,function(value){r._context.edgesAlwaysCurvy=value;r._attributeLayer.updateAll()});this._settings.register("directedEdges",false,function(value){r._context.directedEdges=value;r._attributeLayer.updateAll()})};Wf.prototype._addAttributeLayer=function e(){return this._graphics.addAttributeLayer({name:"curvature",priority:rd,edgeDependencies:{parallelEdges:true},edgeContext:this._context,edgeAttributes:{curvature:function(e,t){var r=t.edgesAlwaysCurvy;var i=t.directedEdges;var n=e.getSource()===e.getTarget();var a=e.getParallelEdges();var o=a.indexOf(e);if(o===-1){return 0}var s;if(n){s=o+1}else{var u=e.getSource();var l=a.size;if(l===1&&!r){return 0}if(i){var d=0;for(var h=0;h<o;++h){if(a.get(h).getSource()===u){d+=1}}s=d+1}else{var f=u!==a.get(0).getSource();if(l%2===1&&!r){if(o===0){s=0}else{s=((o+1)/2|0)*(o%2===0?1:-1)*(f?-1:1)}}else{s=((o/2|0)+1)*(o%2===0?1:-1)*(f?-1:1)}}}return s}}})};var Hf=function e(t){var r=this;this._events=t.modules.events;this._graphics=t.modules.graphics;this._events.on({"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=e.objects;var a=t||i;var o=n.map(function(e){return e.attributes});r._originalAttributesLayer.setAttributeValues(a,o)}});this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:td,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:null,edgeDependencies:null});this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:nd,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:null,edgeDependencies:null})};Hf.prototype.getOriginalAttributes=function e(){return this._originalAttributesLayer.getFlexArrays()};Hf.prototype.setMultipleAttributes=function e(t,r,i,n){var a=this;return this._graphics.animate(t,function(){a._individualAttributesLayer.setAttributeValues(t,r,n)},i)};Hf.prototype.setSingleAttribute=function e(t,r,i,n){var a={};W(a,r,i);return this.setMultipleAttributes(t,a,n)};Hf.prototype.resetMultipleAttributes=function e(t,r,i){var n=this;r=r||this._individualAttributesLayer.getUsedAttributeNames(t);var a={};for(var o=0,s=r;o<s.length;o+=1){var u=s[o];W(a,u,undefined)}return this._graphics.animate(t,function(){n._individualAttributesLayer.setAttributeValues(t,a)},i)};Hf.prototype.getMultipleAttributes=function e(t,r){return this._graphics.getAttributeValues(t,r,true,false)};Hf.prototype.getSingleAttribute=function e(t,r){return this._graphics.getAttributeValues(t,r,false,false)};Hf.prototype.replaceOriginalAttributes=function e(t,r,i){if(i===void 0)i=[];var n={};var a=this._originalAttributesLayer.getUsedAttributeNames(t).filter(function(e){return!i.includes(e)});for(var o=0;o<a.length;++o){W(n,a[o],undefined)}this._originalAttributesLayer.setAttributeValues(t,n);this._originalAttributesLayer.setAttributeValues(t,r)};Hf.prototype.getSinglePreviousAttribute=function e(t,r){return this._graphics.getAttributeValues(t,r,false,true)};Hf.prototype.getMultiplePreviousAttributes=function e(t,r){return this._graphics.getAttributeValues(t,r,true,true)};Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new Hf(e);var o=e.modules.camera;e.modules.individualAttributes=a;t.prototype.setAttributes=function(e,t,r){return a.setMultipleAttributes(this,e,t,r)};t.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};t.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};t.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)[0]};t.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)[0]};i.prototype.setAttributes=function(e,t,r){return a.setMultipleAttributes(this,e,t,r)};i.prototype.setAttribute=function(e,t,r){return a.setSingleAttribute(this,e,t,r)};i.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)};i.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)};i.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};r.prototype.setAttributes=function(e,t,r){return a.setMultipleAttributes(this,e,t,r)};r.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};r.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)[0]};r.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)[0]};r.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};n.prototype.setAttributes=function(e,t,r){return a.setMultipleAttributes(this,e,t,r)};n.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};n.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)};n.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)};n.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};t.prototype.getPosition=function(){return this.getAttributes(["x","y"])};i.prototype.getPosition=function(){return this.getAttributes(["x","y"])};t.prototype.getPositionOnScreen=function(){return o.graphToScreenCoordinates(this.getPosition())};i.prototype.getPositionOnScreen=function(){return this.getPosition().map(function(e){return o.graphToScreenCoordinates(e)})};t.prototype.isInScreen=function(){var e=this.getPositionOnScreen();return e.x>=0&&e.x<=o.width&&e.y>=0&&e.y<=o.height};t.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};i.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};r.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};n.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};t.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)[0]};i.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)};r.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)[0]};n.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)};i.prototype.getPreviousAttribute=function(e){return a.getSinglePreviousAttribute(this,e)};n.prototype.getPreviousAttribute=function(e){return a.getSinglePreviousAttribute(this,e)}});var Xf=1e3;var qf=1/Xf;var Yf=function e(t){this._ogma=t;this._events=t.modules.events;this._graphics=t.modules.graphics;this._idCounter=1;this._rules=[]};Yf.prototype._get=function e(t){var r=this;for(var i=0;i<this._rules.length;++i){var n=r._rules[i];if(n.id===t){n.index=i;return n}}throw new Error("calling a method on a destroyed style rule")};Yf.prototype._updatePriorities=function e(){var t=this;for(var r=0;r<this._rules.length;++r){var i=t._rules[r];var n=id+r*qf;i.attributeLayer.update({priority:n})}};Yf.prototype._afterNextFrame=function e(){return this._ogma.view.afterNextFrame()};Yf.prototype.addRule=function e(t){if(t===void 0)t={};var r=this._idCounter++;var i=this._graphics.addAttributeLayer(Object.assign({name:"rule("+r+")"},Zf(t)));var n=this._afterNextFrame();var a=new Kf(this,r,n);var o={id:r,attributeLayer:i,wrapper:a};this._rules.push(o);this._updatePriorities();return a};Yf.prototype.getRuleIndex=function e(t){return this._get(t).index};Yf.prototype.setRuleIndex=function e(t,r){var i=this._get(t);var n=it(r,0,this._rules.length-1);this._rules.splice(i.index,1);this._rules.splice(n,0,i);this._updatePriorities();return this._afterNextFrame()};Yf.prototype.updateRule=function e(t,r){var i=this._get(t);var n=Object.assign({fullOverwrite:r.fullOverwrite},Zf(r));i.attributeLayer.update(n);return this._afterNextFrame()};Yf.prototype.getRuleDefinition=function e(t){var r=this._get(t);var i=r.attributeLayer.getDefinition();return Zf(i)};Yf.prototype.destroyRule=function e(t){var r=this._get(t);r.attributeLayer.destroy();this._rules.splice(r.index,1);return this._afterNextFrame()};Yf.prototype.refreshRule=function e(t){var r=this._get(t);r.attributeLayer.updateAll();return this._afterNextFrame()};Yf.prototype.refreshAllRules=function e(){var t=this;for(var r=0,i=t._rules;r<i.length;r+=1){var n=i[r];n.attributeLayer.updateAll()}return this._afterNextFrame()};Yf.prototype.getRuleList=function e(){return this._rules.map(function(e){return e.wrapper})};function Zf(e){return{nodeAttributes:e.nodeAttributes,edgeAttributes:e.edgeAttributes,nodeSelector:e.nodeSelector,edgeSelector:e.edgeSelector,nodeDependencies:e.nodeDependencies,edgeDependencies:e.edgeDependencies,nodeOutput:e.nodeOutput,edgeOutput:e.edgeOutput}}var Kf=function e(t,r,i){var n=this;this._module=t;this._id=r;this._whenApplied=i.then(function(){return n})};Kf.prototype.getId=function e(){return this._id};Kf.prototype.whenApplied=function e(){return this._whenApplied};Kf.prototype.refresh=function e(){return this._module.refreshRule(this._id)};Kf.prototype.getIndex=function e(){return this._module.getRuleIndex(this._id)};Kf.prototype.setIndex=function e(t){return this._module.setRuleIndex(this._id,t)};Kf.prototype.update=function e(t){return this._module.updateRule(this._id,t)};Kf.prototype.getDefinition=function e(){return this._module.getRuleDefinition(this._id)};Kf.prototype.destroy=function e(){return this._module.destroyRule(this._id)};Kf.prototype.delete=function e(){return this.destroy()};Ogma.extend(function(e){var t=new Yf(e);e.modules.styleRules=t;e.styles.addRule=function(e){return t.addRule(e)};e.styles.getRuleList=function(){return t.getRuleList()};e.styles.addNodeRule=function(t,r){if(arguments.length===1){r=t;t=undefined}return e.styles.addRule({nodeAttributes:r,nodeSelector:t})};e.styles.addEdgeRule=function(t,r){if(arguments.length===1){r=t;t=undefined}return e.styles.addRule({edgeAttributes:r,edgeSelector:t})};e.styles.getNodeRules=function(){return e.styles.getRuleList().filter(function(e){return e.getDefinition().edgeAttributes===undefined})};e.styles.getEdgeRules=function(){return e.styles.getRuleList().filter(function(e){return e.getDefinition().nodeAttributes===undefined})}});var Qf=1e3;var Jf=.5/Qf;var $f=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._graphics=t.modules.graphics;this._builtinClasses=[];this._userClasses=[];this._classesByName={};this._events.on({excludedStateChange:function(e){var t=e.elements;var value=e.value;if(value){var i=r._builtinClasses.map(function(e){return e.name});r._addOrRemoveClassesToElements(i,t,false)}},clear:function(){r._builtinClasses.concat(r._userClasses).forEach(function(e){return e.elementSet.clear()})}})};$f.prototype._getClassList=function e(t){return t?this._builtinClasses:this._userClasses};$f.prototype.createClass=function e(t){if(t===void 0)t={};var r=t.name;var i=t.isBuiltin;var n=t.after;var a=t.nodeAttributes;var o=t.nodeDependencies;var s=t.nodeOutput;var u=t.edgeAttributes;var l=t.edgeDependencies;var d=t.edgeOutput;if(typeof r!=="string"){throw new Error('the "name" argument should be a string')}var h=this._getClassList(i);var f=n?tc(h,n)+1:h.length;if(f===-1){throw new Error('createClass: class specified as `after` parameter "'+n+'" does not exist')}if(i&&!r.startsWith("_")){throw new Error('invalid builtin class name "'+r+"\": builtin classes should start with '_'")}var c=new Ir(this._ogma);var v=new rc(this,r);var g=this._graphics.addAttributeLayer({name:"class("+r+")",tag:r,standaloneSelectors:true,nodeAttributes:a,edgeAttributes:u,nodeSelector:function(e,t){return t.hasElement(e)},edgeSelector:function(e,t){return t.hasElement(e)},nodeContext:c,edgeContext:c,nodeOutput:s,edgeOutput:d,nodeDependencies:o,edgeDependencies:l});var p={name:r,elementSet:c,attributeLayer:g,isBuiltin:i,wrapper:v};h.splice(f,0,p);if(i){h.sort(function(e,t){return yd.indexOf(e.name)-yd.indexOf(t.name)})}this._updatePriorities(i);this._classesByName[r]=p;this._events.register([ec(r,true,true),ec(r,true,false),ec(r,false,true),ec(r,false,false)]);return v};$f.prototype._updatePriorities=function e(t){var r=this._getClassList(t);var i=ad+(t?.5:0);for(var n=0;n<r.length;++n){var a=r[n];var o=i+Jf*n;a.attributeLayer.update({priority:o})}};$f.prototype._get=function e(t){var r=this._classesByName[t];if(!r){throw new Error('class "'+t+'" does not exist')}return r};$f.prototype.getIndex=function e(t){var r=this._get(t);var i=this._getClassList(r.isBuiltin);return i.indexOf(r)};$f.prototype.setIndex=function e(t,r){var i=this._get(t);var n=this._getClassList(i.isBuiltin);var a=n.indexOf(i);var o=it(r,0,n.length-1);n.splice(a,1);n.splice(o,0,i);this._updatePriorities(i.isBuiltin)};$f.prototype.update=function e(t,r){if(r===void 0)r={};var i=this._get(t);i.attributeLayer.update({nodeAttributes:r.nodeAttributes,edgeAttributes:r.edgeAttributes,nodeDependencies:r.nodeDependencies,edgeDependencies:r.edgeDependencies,nodeOutput:r.nodeOutput,edgeOutput:r.edgeOutput,fullOverwrite:r.fullOverwrite})};$f.prototype.getDefinition=function e(t){var r=this._get(t);var i=r.attributeLayer.getDefinition();var n=i.nodeAttributes;var a=i.nodeDependencies;var o=i.nodeOutput;var s=i.edgeAttributes;var u=i.edgeDependencies;var l=i.edgeOutput;return{nodeAttributes:n,edgeAttributes:s,nodeDependencies:a,edgeDependencies:u,nodeOutput:o,edgeOutput:l}};$f.prototype._addOrRemoveClassesToElements=function e(t,r,i){var n=this;var a=r.isNode;for(var o=0;o<t.length;++o){var s=t[o];var u=n._get(s);var l=u.elementSet;var d=u.attributeLayer;var h=l.addOrRemoveElements(r,i);var f=ec(s,a,i);if(h.size){d.updateElements(h);n._events.fire(f,a?{nodes:h}:{edges:h})}}};$f.prototype.addClassesToElements=function e(t,r,i){var n=this;return this._graphics.animate(r,function(){n._addOrRemoveClassesToElements(t,r,true)},i)};$f.prototype.removeClassesFromElements=function e(t,r,i){var n=this;return this._graphics.animate(r,function(){n._addOrRemoveClassesToElements(t,r,false)},i)};$f.prototype.hasSingleElementClass=function e(t,r){return this._get(t).elementSet.hasElement(r)};$f.prototype.getElementsClassList=function e(t,r){if(r===void 0)r={};var i=r.includeBuiltinClasses;if(i===void 0)i=false;var n=new Array(t.size);for(var a=0;a<n.length;++a){n[a]=[]}this._addClassNamesToList(n,t,this._userClasses);if(i){this._addClassNamesToList(n,t,this._builtinClasses)}return n};$f.prototype._addClassNamesToList=function e(t,r,i){var n=this;var a=r.toList();for(var o=0;o<i.length;++o){var s=n._userClasses[o];var u=s.name;var l=s.elementSet;for(var d=0;d<a.size;++d){var h=a.get(d);if(l.hasElement(h)){t[d].push(u)}}}};$f.prototype.getClassByName=function e(t,r){if(r===void 0)r=false;var i=this._classesByName[t]||null;if(r&&!i){throw new Error('class "'+t+'" does not exist')}return i&&i.wrapper};$f.prototype.getClassList=function e(){return this._userClasses.map(function(e){return e.wrapper})};$f.prototype.getElementsByClass=function e(t){var r=this._get(t);var i=r.elementSet;var n=i.getElements();return{nodes:n.nodes.filter(function(e){return e.isVisible()}),edges:n.edges.filter(function(e){return e.isVisible()})}};$f.prototype._onClassEvent=function e(t,r,i,n){var a=ec(t,i,n);this._events.on(a,r)};$f.prototype.onNodeClassAdded=function e(t,r){this._onClassEvent(t,r,true,true)};$f.prototype.onNodeClassRemoved=function e(t,r){this._onClassEvent(t,r,true,false)};$f.prototype.onEdgeClassAdded=function e(t,r){this._onClassEvent(t,r,false,true)};$f.prototype.onEdgeClassRemoved=function e(t,r){this._onClassEvent(t,r,false,false)};function ec(e,t,r){return(t?"node":"edge")+"Class"+(r?"Added":"Removed")+"_"+e}function tc(e,t){for(var r=0;r<e.length;++r){if(e[r].name===t){return r}}return-1}var rc=function e(t,r){this._classes=t;this._name=r};rc.prototype.getName=function e(){return this._name};rc.prototype.getIndex=function e(){return this._classes.getIndex(this._name)};rc.prototype.setIndex=function e(t){return this._classes.setIndex(this._name,t)};rc.prototype.update=function e(t){return this._classes.update(this._name,t)};rc.prototype.getDefinition=function e(){return this._classes.getDefinition(this._name)};rc.prototype.getNodes=function e(){return this._classes.getElementsByClass(this._name).nodes};rc.prototype.getEdges=function e(){return this._classes.getElementsByClass(this._name).edges};rc.prototype.clearNodes=function e(){this.getNodes().removeClass(this._name)};rc.prototype.clearEdges=function e(){this.getEdges().removeClass(this._name)};rc.prototype.add=function e(t){t.addClass(this._name)};rc.prototype.remove=function e(t){t.removeClass(this._name)};Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new $f(e);e.modules.classes=a;e.createClass=function(t,r){return e.styles.createClass(Object.assign({},r,{name:t}))};e.updateClass=function(e,t){return a.getClassByName(e,true).update(t)};e.getNodesByClassName=function(e){return a.getClassByName(e,true).getNodes()};e.getEdgesByClassName=function(e){return a.getClassByName(e,true).getEdges()};e.styles.createClass=function(e){return a.createClass(e)};e.styles.getClass=function(e){return a.getClassByName(e)};e.styles.getClassList=function(){return a.getClassList()};e.events.onNodesClassAdded=function(t,r){a.onNodeClassAdded(t,r);return e.events};e.events.onNodesClassRemoved=function(t,r){a.onNodeClassRemoved(t,r);return e.events};e.events.onEdgesClassAdded=function(t,r){a.onEdgeClassAdded(t,r);return e.events};e.events.onEdgesClassRemoved=function(t,r){a.onEdgeClassRemoved(t,r);return e.events};t.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};i.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};t.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};i.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};t.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};i.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};t.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};i.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};t.prototype.hasClass=function(e){return a.hasSingleElementClass(e,this)};i.prototype.hasClass=function(e){return this.map(function(t){return a.hasSingleElementClass(e,t)})};t.prototype.getClassList=function(){return a.getElementsClassList(this)[0]};i.prototype.getClassList=function(){return a.getElementsClassList(this)};r.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};n.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};r.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};n.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};r.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};n.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};r.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};n.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};r.prototype.hasClass=function(e){return a.hasSingleElementClass(e,this)};n.prototype.hasClass=function(e){return this.map(function(t){return a.hasSingleElementClass(e,t)})};r.prototype.getClassList=function(){return a.getElementsClassList(this)[0]};n.prototype.getClassList=function(){return a.getElementsClassList(this)}});var ic=function e(t,r){this.key=t;this.data=r;this.left=null;this.right=null};function nc(e,t){return e>t?1:e<t?-1:0}function ac(e,t,r){if(t===null){return t}var i,n,a;var o=new ic;i=n=o;while(true){var s=r(e,t.key);if(s<0){if(t.left===null){break}if(r(e,t.left.key)<0){a=t.left;t.left=a.right;a.right=t;t=a;if(t.left===null){break}}n.left=t;n=t;t=t.left}else if(s>0){if(t.right===null){break}if(r(e,t.right.key)>0){a=t.right;t.right=a.left;a.left=t;t=a;if(t.right===null){break}}i.right=t;i=t;t=t.right}else{break}}i.right=t.left;n.left=t.right;t.left=o.right;t.right=o.left;return t}function oc(e,t,r,i,n){var a=new ic(e,t);n._size++;if(r===null){a.left=a.right=null;return a}r=ac(e,r,i);var o=i(e,r.key);if(o<0){a.left=r.left;a.right=r;r.left=null}else if(o>=0){a.right=r.right;a.left=r;r.right=null}return a}function sc(e,t,r,i,n){var a=new ic(e,t);if(r===null){a.left=a.right=null;n._size++;return a}r=ac(e,r,i);var o=i(e,r.key);if(o===0){return r}else{if(o<0){a.left=r.left;a.right=r;r.left=null}else if(o>0){a.right=r.right;a.left=r;r.right=null}n._size++;return a}}function uc(e,t,r,i){var n;if(t===null){return null}t=ac(e,t,r);if(e===t.key){if(t.left===null){n=t.right}else{n=ac(e,t.left,r);n.right=t.right}i._size--;return n}return t}function lc(e,t,r){var i,n;if(t===null){i=n=null}else{t=ac(e,t,r);var a=r(t.key,e);if(a===0){i=t.left;n=t.right}else if(a<0){n=t.right;t.right=null;i=t}else{i=t.left;t.left=null;n=t}}return{left:i,right:n}}function dc(e,t,r){if(t===null){return e}if(e===null){return t}t=ac(e.key,t,r);t.left=e;return t}function hc(e,t,r,i,n){if(e){i(""+t+(r?" ":" ")+n(e)+"\n");var a=t+(r?"    ":"   ");if(e.left){hc(e.left,a,false,i,n)}if(e.right){hc(e.right,a,true,i,n)}}}var fc=function e(t){if(t===void 0)t=nc;this._comparator=t;this._root=null;this._size=0};var cc={size:{configurable:true}};fc.prototype.insert=function e(t,r){return this._root=oc(t,r,this._root,this._comparator,this)};fc.prototype.add=function e(t,r){return this._root=sc(t,r,this._root,this._comparator,this)};fc.prototype.remove=function e(t){this._root=uc(t,this._root,this._comparator,this)};fc.prototype.pop=function e(){var t=this._root;if(t){while(t.left){t=t.left}this._root=ac(t.key,this._root,this._comparator);this._root=uc(t.key,this._root,this._comparator,this);return{key:t.key,data:t.data}}return null};fc.prototype.findStatic=function e(t){var r=this._root;var i=this._comparator;while(r){var n=i(t,r.key);if(n===0){return r}else if(n<0){r=r.left}else{r=r.right}}return null};fc.prototype.find=function e(t){if(this._root){this._root=ac(t,this._root,this._comparator);if(this._comparator(t,this._root.key)!==0){return null}}return this._root};fc.prototype.contains=function e(t){var r=this._root;var i=this._comparator;while(r){var n=i(t,r.key);if(n===0){return true}else if(n<0){r=r.left}else{r=r.right}}return false};fc.prototype.forEach=function e(t,r){var i=this._root;var n=[];var a=false;while(!a){if(i!==null){n.push(i);i=i.left}else{if(n.length!==0){i=n.pop();t.call(r,i);i=i.right}else{a=true}}}return this};fc.prototype.range=function e(t,r,i,n){var a=this;var o=[];var s=this._comparator;var u=this._root,l;while(o.length!==0||u){if(u){o.push(u);u=u.left}else{u=o.pop();l=s(u.key,r);if(l>0){break}else if(s(u.key,t)>=0){if(i.call(n,u)){return a}}u=u.right}}return this};fc.prototype.keys=function e(){var e=[];this.forEach(function(t){var r=t.key;return e.push(r)});return e};fc.prototype.values=function e(){var e=[];this.forEach(function(t){var r=t.data;return e.push(r)});return e};fc.prototype.min=function e(){if(this._root){return this.minNode(this._root).key}return null};fc.prototype.max=function e(){if(this._root){return this.maxNode(this._root).key}return null};fc.prototype.minNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.left){t=t.left}}return t};fc.prototype.maxNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.right){t=t.right}}return t};fc.prototype.at=function e(t){var r=this._root,i=false,n=0;var a=[];while(!i){if(r){a.push(r);r=r.left}else{if(a.length>0){r=a.pop();if(n===t){return r}n++;r=r.right}else{i=true}}}return null};fc.prototype.next=function e(t){var r=this._root;var i=null;if(t.right){i=t.right;while(i.left){i=i.left}return i}var n=this._comparator;while(r){var a=n(t.key,r.key);if(a===0){break}else if(a<0){i=r;r=r.left}else{r=r.right}}return i};fc.prototype.prev=function e(t){var r=this._root;var i=null;if(t.left!==null){i=t.left;while(i.right){i=i.right}return i}var n=this._comparator;while(r){var a=n(t.key,r.key);if(a===0){break}else if(a<0){r=r.left}else{i=r;r=r.right}}return i};fc.prototype.clear=function e(){this._root=null;this._size=0;return this};fc.prototype.toList=function e(){return pc(this._root)};fc.prototype.load=function e(t,r,i){if(t===void 0)t=[];if(r===void 0)r=[];if(i===void 0)i=false;var n=t.length;var a=this._comparator;if(i){mc(t,r,0,n-1,a)}if(this._root===null){this._root=vc(this._root,t,r,0,n);this._size=n}else{var o=yc(this.toList(),gc(t,r),a);n=this._size+n;this._root=_c({head:o},0,n)}return this};fc.prototype.isEmpty=function e(){return this._root===null};cc.size.get=function(){return this._size};fc.prototype.toString=function e(t){if(t===void 0)t=function(e){return e.key};var r=[];hc(this._root,"",true,function(e){return r.push(e)},t);return r.join("")};fc.prototype.update=function e(t,r,i){var n=this._comparator;var a=lc(t,this._root,n);var o=a.left;var s=a.right;this._size--;if(n(t,r)<0){s=oc(r,i,s,n,this)}else{o=oc(r,i,o,n,this)}this._root=dc(o,s,n)};fc.prototype.split=function e(t){return lc(t,this._root,this._comparator)};Object.defineProperties(fc.prototype,cc);function vc(e,t,r,i,n){var a=n-i;if(a>0){var o=i+Math.floor(a/2);var s=t[o];var u=r[o];var l={key:s,data:u,parent:e};l.left=vc(l,t,r,i,o);l.right=vc(l,t,r,o+1,n);return l}return null}function gc(e,t){var r={next:null};var i=r;for(var n=0;n<e.length;n++){i=i.next={key:e[n],data:t[n]}}i.next=null;return r.next}function pc(e){var t=e;var r=[],i=false;var n={next:null};var a=n;while(!i){if(t){r.push(t);t=t.left}else{if(r.length>0){t=a=a.next=r.pop();t=t.right}else{i=true}}}a.next=null;return n.next}function _c(e,t,r){var i=r-t;if(i>0){var n=t+Math.floor(i/2);var a=_c(e,t,n);var o=e.head;o.left=a;e.head=e.head.next;o.right=_c(e,n+1,r);return o}return null}function yc(e,t,r){if(r===void 0)r=function(e,t){return e-t};var i={};var n=i;var a=e;var o=t;while(a!==null&&o!==null){if(r(a.key,o.key)<0){n.next=a;a=a.next}else{n.next=o;o=o.next}n=n.next}if(a!==null){n.next=a}else if(o!==null){n.next=o}return i.next}function mc(e,t,r,i,n){if(r>=i){return}var a=e[r+i>>1];var o=r-1;var s=i+1;while(true){do{o++}while(n(e[o],a)<0);do{s--}while(n(e[s],a)>0);if(o>=s){break}var u=e[o];e[o]=e[s];e[s]=u;u=t[o];t[o]=t[s];t[s]=u}mc(e,t,r,s,n);mc(e,t,s+1,i,n)}var xc=function(e){function t(t){e.call(this,t,true)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;return t}(fc);xc.prototype.lte=function(e){var t=this._comparator;var r=this._root,i;while(r){i=t(r.key,e);if(r.left===null&&r.right===null&&i>0){return null}if(i<=0&&r.right===null||i<=0&&t(r.right.key,e)>0){return r}if(i>=0){r=r.left}else{r=r.right}}return r};xc.prototype.gte=xc.prototype.gte||function(e){var t=[];var r=this._comparator;var i=this._root;while(t.length!==0||i){if(i){t.push(i);i=i.left}else{i=t.pop();if(r(i.key,e)>=0){break}i=i.right}}return i};xc.prototype.clear=xc.prototype.clear||function(){this._root=null;this._size=0;return this};var bc=16;var Sc=function e(t,r,i){if(t===void 0)t=Int32Array;if(r===void 0)r=bc;if(i===void 0)i=8;this._BIG_LIST=new Uint8Array([-1])[0];this._ArrayType=t;this._capacity=r;this._MAX_LIST_SIZE=i;this._freeIndex=-1;this.clear()};var Ac={averageSize:{configurable:true}};Sc.prototype.clear=function e(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE);this._sizes=new Uint8Array(this._capacity);this._bigLists=[];this._nextIndex=0;this._idToIndex={};this._constList=new Array(this._MAX_LIST_SIZE)};Sc.prototype.addEntry=function e(t){var r;if(this._freeIndex===-1){r=this._nextIndex++}else{r=this._freeIndex;this._freeIndex=-1}this._idToIndex[t]=r;if(r>=this._capacity){this._expand(r+1)}this._sizes[r]=0;return r};Sc.prototype.getItems=function e(t){var r=this;var i=this._idToIndex[t];if(i===undefined){return}var n=this._sizes[i];var a=this._MAX_LIST_SIZE*i;if(n<=this._MAX_LIST_SIZE){this._constList.length=n;for(var o=0,s=n;o<s;++o){r._constList[o]=r._buffer[a+o]}return this._constList}else if(n===this._BIG_LIST){var u=this._buffer[a];return this._bigLists[u]}};Sc.prototype.removeEntry=function e(t){var r=this._idToIndex[t];var i=this._sizes[r];if(i===this._BIG_LIST){var n=this._MAX_LIST_SIZE*r;var a=this._buffer[n];this._bigLists[a].length=0}this._sizes[r]=0;this._freeIndex=r};Sc.prototype.size=function e(t){var r=this._idToIndex[t];var e=this._sizes[r];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[r*this._MAX_LIST_SIZE]].length};Sc.prototype.sizes=function e(t){var r=this;var e=this._sizes;var i=this._bigLists;var n=this._buffer;var a=this._MAX_LIST_SIZE;var o=t.length;var s=new Array(o);for(var u=0;u<o;u++){var l=r._idToIndex[t[u]];var d=e[l];s[u]=d<=a?d:i[n[l*a]].length}return s};Sc.prototype.addTo=function e(t,value){var r=this;var i=this._idToIndex[t];var n=this._sizes[i];var a=i*this._MAX_LIST_SIZE;if(n<this._MAX_LIST_SIZE){this._buffer[a+n]=value;this._sizes[i]=n+1}else if(n===this._BIG_LIST){var o=this._buffer[a];this._bigLists[o].push(value)}else{var s=new Array(this._MAX_LIST_SIZE);for(var u=0;u<this._MAX_LIST_SIZE;++u){s[u]=r._buffer[a+u]}s.push(value);this._bigLists.push(s);this._sizes[i]=this._BIG_LIST;this._buffer[a]=this._bigLists.length-1}};Sc.prototype.removeFrom=function e(t,value){this.removeFromAndGetSize(t,value)};Sc.prototype.removeFromAndGetSize=function e(t,value){var r=this;var i=this._idToIndex[t];var n=this._sizes[i],a=this._MAX_LIST_SIZE*i;if(n<=this._MAX_LIST_SIZE){for(var o=a,s=a+n;o<s;++o){if(r._buffer[o]===value){n-=1;r._buffer[o]=r._buffer[s-1];r._sizes[i]=n;return n}}}else if(n===this._BIG_LIST){var u=this._buffer[a],l=this._bigLists[u],d=l.indexOf(value);if(d!==-1){l.splice(d,1);return l.length}}};Sc.prototype.reserve=function e(t){if(this._capacity<t){this._expand(t)}};Sc.prototype._expand=function e(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t)));this._buffer=Ec(this._buffer,this._capacity*this._MAX_LIST_SIZE);this._sizes=Ec(this._sizes,this._capacity)};Sc.prototype.has=function e(t){var r=this._idToIndex[t];if(r===undefined||r>=this._capacity){return false}return this._sizes[r]!==0};Ac.averageSize.get=function(){var e=this;var t=0;for(var r=0;r<this._capacity;r++){t+=e._sizes[r]}return t/this._capacity};Object.defineProperties(Sc.prototype,Ac);function Ec(e,t){var r=new e.constructor(t);r.set(e);return r}var wc=[0,1],Tc=[0,2];for(var kc=4;kc<65535;kc<<=2){for(var Cc=0,Ic=wc.length;Cc<Ic;Cc++){wc.push(wc[Cc]|kc);Tc.push((wc[Cc]|kc)<<1)}}function Mc(e,t){return(Tc[t&255]|wc[e&255])+(Tc[t>>8&255]|wc[e>>8&255])*65536+(Tc[t>>16&255]|wc[e>>16&255])*4294967296}Mc.code=function e(t,r,i){if(t>24){throw"Morton codes are only supported up to Z=24"}var n=1<<24-t;return Mc(r*n,i*n)};Mc.range=function e(t,r,i){if(t>24){throw"Morton ranges are only supported up to Z=24"}var n=1<<24-t;var a=Mc(r*n,i*n);return[a,a+n*n-1]};var Lc,Fc;function Nc(e,t){if(t===void 0)t=[];if(e>0xffffffffffff){throw"Only morton codes up to 48 bits are supported."}if(!Lc){Lc={};Fc={};for(var r=0;r<256;r++){Lc[Mc(r,0)]=r;Fc[Mc(0,r)]=r}}var i=Lc[e&21845];var n=Fc[e&43690];if(e>65535){e/=65536;i|=Lc[e&21845]<<8;n|=Fc[e&43690]<<8;if(e>65535){e/=65536;i|=Lc[e&21845]<<16;n|=Fc[e&43690]<<16}}t[0]=i;t[1]=n;return t}Mc.reverse=Nc;Mc.decode=function e(t,r){var i=Nc(r);var n=1<<24-t;return[i[0]/n,i[1]/n]};Mc.min=function e(t,r){var i=t&1431655765;var n=r&1431655765;var a=t&2863311530;var o=r&2863311530;return Math.min(i,n)+Math.min(a,o)};var zc=0;var Pc=1;var Oc=3;var Dc=4;var Rc=5;var Bc=Ui;var jc=Gi;function Uc(e,t){return e[3]>t[1]&&e[1]<t[3]&&(e[2]>t[0]&&e[0]<t[2])}function Vc(e,t,r,i,n,a,o,s){if(e>=n&&t>=a&&e<=o&&t<=s){return true}if(r>=n&&i>=a&&r<=o&&i<=s){return true}if(Hc(e,t,r,i,n,a,n,s)){return true}if(Hc(e,t,r,i,o,a,o,s)){return true}if(Hc(e,t,r,i,n,a,o,a)){return true}if(Hc(e,t,r,i,n,s,o,s)){return true}return false}function Gc(e,t,r){return Math.min(Math.max(t,e),r)}function Wc(e,t,r,i,n,a,o){var s=Gc(e,i,a);var u=Gc(t,n,o);var l=e-s;var d=t-u;var h=l*l+d*d;return h<r*r}function Hc(e,t,r,i,n,a,o,s){var u=((o-n)*(t-a)-(s-a)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));var l=((r-e)*(t-a)-(i-t)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));if(u>=0&&u<=1&&l>=0&&l<=1){return true}return false}function Xc(e,t){var r=e.type;var i=e.coordinates;if(r===Rc){return Wc(i[0],i[1],i[2],t[0],t[1],t[2],t[3])}else if(r===Pc){return Vc(i[0],i[1],i[2],i[3],t[0],t[1],t[2],t[3])}else if(r===Oc){return Bc(i[0],i[1],i[2],i[3],i[4],i[5],t[0],t[1],t[2],t[3])}else if(r===Dc){return jc(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],t[0],t[1],t[2],t[3])}else{return Uc(i,t)}}function qc(e,t,r,i,n){var a=Math.abs(r-e),o=e<r?1:-1;var s=-Math.abs(i-t),u=t<i?1:-1;var l=a+s,d;for(;;){n(e,t);d=2*l;if(d>=s){if(e===r){break}l+=s;e+=o}if(d<=a){if(t===i){break}l+=a;t+=u}}}function Yc(e,t,r,i,n){var a=e<r?1:-1,o=t<i?1:-1,s;var u=Math.abs(r-e),l=Math.abs(i-t),d=u*u+l*l;var h=d==0?1:16777087/Math.sqrt(d);u*=h;l*=h;d=u-l;for(;;){n(e,t,Math.abs(d-u+l)>>16);h=d;s=e;if(2*h>=-u){if(e==r){break}if(h+l<16711680){n(e,t+o,h+l>>16)}d-=l;e+=a}if(2*h<=l){if(t==i){break}if(u-h<16711680){n(s+a,t,u-h>>16)}d+=u;t+=o}}}function Zc(e,t){if(t===void 0)t="assert error";if(!e){throw new Error(t)}}function Kc(e,t,r,i,n,a,o){var s=n-r,u=a-i;var l=e-r,d=t-i,h;var f,c,v,g=l*u-d*s;Zc(l*s<=0&&d*u<=0,"sign of gradient must not change");if(s*s+u*u>l*l+d*d){n=e;e=s+r;a=t;t=u+i;g=-g}if(g!=0){l+=s;l*=s=e<n?1:-1;d+=u;d*=u=t<a?1:-1;h=2*l*d;l*=l;d*=d;if(g*s*u<0){l=-l;d=-d;h=-h;g=-g}f=4*u*g*(r-e)+l-h;c=4*s*g*(t-i)+d-h;l+=l;d+=d;v=f+c+h;do{o(e,t);if(e==n&&t==a){return}i=2*v<f;if(2*v>c){e+=s;f-=h;v+=c+=d}if(i){t+=u;c-=h;v+=f+=l}}while(c<0&&f>0)}qc(e,t,n,a,o)}function Qc(e,t,r,i,n,a,o){var s=e-r,u=t-i;var l=e-2*r+n,d;if(s*(n-r)>0){if(u*(a-i)>0){if(Math.abs((t-2*i+a)/l*s)>Math.abs(u)){e=n;n=s+r;t=a;a=u+i}}l=(e-r)/l;d=(1-l)*((1-l)*t+2*l*i)+l*l*a;l=(e*n-r*r)*l/(e-r);s=Math.floor(l+.5);u=Math.floor(d+.5);d=(i-t)*(l-e)/(r-e)+t;Jc(e,t,s,Math.floor(d+.5),s,u,o);d=(i-a)*(l-n)/(r-n)+a;e=r=s;t=u;i=Math.floor(d+.5)}if((t-i)*(a-i)>0){l=t-2*i+a;l=(t-i)/l;d=(1-l)*((1-l)*e+2*l*r)+l*l*n;l=(t*a-i*i)*l/(t-i);s=Math.floor(d+.5);u=Math.floor(l+.5);d=(r-e)*(l-t)/(i-t)+e;Jc(e,t,Math.floor(d+.5),u,s,u,o);d=(r-n)*(l-a)/(i-a)+n;e=s;r=Math.floor(d+.5);t=i=u}Jc(e,t,r,i,n,a,o)}function Jc(e,t,r,i,n,a,o){var s=n-r,u=a-i;var l=e-r,d=t-i,h;var f,c,v,g,p=l*u-d*s;if(s*s+u*u>l*l+d*d){n=e;e=s+r;a=t;t=u+i;p=-p}if(p!=0){l+=s;l*=s=e<n?1:-1;d+=u;d*=u=t<a?1:-1;h=2*l*d;l*=l;d*=d;if(p*s*u<0){l=-l;d=-d;h=-h;p=-p}f=4*u*(r-e)*p+l-h;c=4*s*(t-i)*p+d-h;l+=l;d+=d;v=f+c+h;do{p=Math.min(f+h,-h-c);g=Math.max(f+h,-h-c);g+=2*g*p*p/(4*g*g+p*p);o(e,t,255*Math.abs(v-f-c-h)/g);if(e==n||t==a){break}r=e;p=f-v;i=2*v+c<0;if(2*v+f>0){if(v-c<g){o(e,t+u,255*Math.abs(v-c)/g)}e+=s;f-=h;v+=c+=d}if(i){if(p<g){o(r+s,t,255*Math.abs(p)/g)}t+=u;c-=h;v+=f+=l}}while(c<f)}Yc(e,t,n,a,o)}function $c(e,t,r,i,n,a,o,s,u){var l,d,h,f=1;var c=e<o?1:-1,v=t<s?1:-1;var g=-Math.abs(e+r-n-o),p=g-4*c*(r-n),_=c*(e-r-n+o);var y=-Math.abs(t+i-a-s),m=y-4*v*(i-a),x=v*(t-i-a+s);var b,S,A,E,w,T,k,C,I,M,L,F=.01;Zc((r-e)*(n-o)<F&&((o-e)*(r-n)<F||_*_<p*g+F),"slope change");Zc((i-t)*(a-s)<F&&((s-t)*(i-a)<F||x*x<m*y+F),"slope change");if(p==0&&m==0){c=Math.floor((3*r-e+1)/2);v=Math.floor((3*i-t+1)/2);return Kc(e,t,c,v,o,s,u)}r=(r-e)*(r-e)+(i-t)*(i-t)+1;n=(n-o)*(n-o)+(a-s)*(a-s)+1;do{b=p*x-_*m;S=p*y-g*m;A=_*y-g*x;M=b*(b+S-3*A)+S*S;l=M>0?1:Math.sqrt(1+1024/r);b*=l;S*=l;A*=l;M*=l*l;T=9*(b+S+A)/8;E=8*(p-m);C=27*(8*b*(x*x-m*y)+M*(m+2*x+y))/64-m*m*(T-m);I=27*(8*b*(_*_-p*g)-M*(p+2*_+g))/64-p*p*(T+p);w=3*(3*b*(3*x*x-m*m-2*m*y)-m*(3*S*(m+x)+m*E))/4;k=3*(3*b*(3*_*_-p*p-2*p*g)-p*(3*S*(p+_)+p*E))/4;T=p*m*(6*b+6*S-3*A+E);S=m*m;E=p*p;T=3*(T+9*l*(E*x*y-_*g*S)-18*_*x*b)/8;if(M<0){C=-C;I=-I;w=-w;k=-k;T=-T;S=-S;E=-E}b=6*m*S;S=-6*p*S;A=6*m*E;E=-6*p*E;C+=T;M=C+I;I+=T;e:for(L=T,d=h=l;e!=o&&t!=s;){u(e,t);do{if(C>L||I<L){break e}i=2*M-I;if(2*M>=C){d--;M+=C+=w;I+=T+=S;k+=A;w+=b}if(i<=0){h--;M+=I+=k;C+=T+=A;w+=S;k+=E}}while(d>0&&h>0);if(2*d<=l){e+=c;d+=l}if(2*h<=l){t+=v;h+=l}if(L==T&&C<0&&I>0){L=F}}w=e;e=o;o=w;c=-c;_=-_;k=t;t=s;s=k;v=-v;x=-x;r=n}while(f--);qc(e,t,o,s,u)}function ev(e,t,r,i,n,a,o,s,u,l){var d=0,h=0;var f=e+r-n-o,c=f-4*(r-n);var v=e-r-n+o,g=v+4*(r+n);var p=t+i-a-s,_=p-4*(i-a);var y=t-i-a+s,m=y+4*(i+a);var x=e,b,S,A,E=t,w,T,k;var C=v*v-c*f,I,M=[0,0,0,0,0];if(c==0){if(Math.abs(f)<2*Math.abs(v)){M[d++]=f/(2*v)}}else if(C>0){I=Math.sqrt(C);C=(v-I)/c;if(Math.abs(C)<1){M[d++]=C}C=(v+I)/c;if(Math.abs(C)<1){M[d++]=C}}C=y*y-_*p;if(_==0){if(Math.abs(p)<2*Math.abs(y)){M[d++]=p/(2*y)}}else if(C>0){I=Math.sqrt(C);C=(y-I)/_;if(Math.abs(C)<1){M[d++]=C}C=(y+I)/_;if(Math.abs(C)<1){M[d++]=C}}for(h=1;h<d;h++){if((C=M[h-1])>M[h]){M[h-1]=M[h];M[h]=C;h=0}}C=-1;M[d]=1;for(h=0;h<=d;h++){I=M[h];b=(C*(C*v-2*f)-I*(C*(C*c-2*v)+f)+g)/8-x;w=(C*(C*y-2*p)-I*(C*(C*_-2*y)+p)+m)/8-E;S=(I*(I*v-2*f)-C*(I*(I*c-2*v)+f)+g)/8-x;T=(I*(I*y-2*p)-C*(I*(I*_-2*y)+p)+m)/8-E;x-=A=(I*(I*(3*v-I*c)-3*f)+g)/8;E-=k=(I*(I*(3*y-I*_)-3*p)+m)/8;o=Math.floor(A+.5);s=Math.floor(k+.5);if(x!=0){b*=x=(e-o)/x;S*=x}if(E!=0){w*=E=(t-s)/E;T*=E}if(e!=o||t!=s){u(e,t,e+b,t+w,e+S,t+T,o,s,l)}e=o;t=s;x=A;E=k;C=I}}function tv(e,t,r,i,n,a,o,s,u){ev(e,t,r,i,n,a,o,s,$c,u)}/**
   * Bresenham rasterisation functions by Alois Zingl
   * @author Alois Zingl
   * @preserve
   */
var rv=Mc;var iv=14;var nv,av,ov;function sv(){return nv}function uv(e){nv=e;av=1<<nv;ov=1<<nv-1}uv(iv);function lv(e,t,r){var i=1<<r;e=~~(i*((e+ov)/av)),t=~~(i*((t+ov)/av));return[e,t]}function dv(e,t,r){var i=1<<r;e=i*((e+ov)/av),t=i*((t+ov)/av);return[e,t]}function hv(e,t,r,i,n,a){var o=lv(e,t,n);var s=lv(r,i,n);for(var u=o[0];u<=s[0];u++){for(var l=o[1];l<=s[1];l++){a.push(rv(u,l,n))}}}function fv(e,t,r,i){var n,a;for(var o=0;o<e.length-1;o++){var s=dv(e[o][0],e[o][1],t),u=dv(e[o+1][0],e[o+1][1],t),l=s[0],d=s[1],h=u[0],f=u[1],c=h-l,v=f-d;if(v===0&&c===0){continue}var g=c>0?1:-1,p=v>0?1:-1,_=Math.floor(l),y=Math.floor(d),m=c===0?Infinity:Math.abs(((c>0?1:0)+_-l)/c),x=v===0?Infinity:Math.abs(((v>0?1:0)+y-d)/v),b=Math.abs(g/c),S=Math.abs(p/v);if(_!==n||y!==a){i.push(rv(_,y,t));if(r&&y!==a){r.push([_,y])}n=_;a=y}while(m<1||x<1){if(m<x){m+=b;_+=g}else{x+=S;y+=p}i.push(rv(_,y,t));if(r&&y!==a){r.push([_,y])}n=_;a=y}}if(r&&y===r[0][1]){r.pop()}}function cv(e,t,r){var i=lv(e[0],e[1],t);var n=i[0];var a=i[1];var o=lv(e[2],e[3],t);var s=o[0];var u=o[1];var l=lv(e[4],e[5],t);var d=l[0];var h=l[1];Qc(n,a,s,u,d,h,function(e,i){r.push(rv(e,i,t))})}function vv(e,t,r){var i=lv(e[0],e[1],t);var n=i[0];var a=i[1];var o=lv(e[2],e[3],t);var s=o[0];var u=o[1];var l=lv(e[4],e[5],t);var d=l[0];var h=l[1];var f=lv(e[6],e[7],t);var c=f[0];var v=f[1];tv(n,a,s,u,d,h,c,v,function(e,i){r.push(rv(e,i,t))})}var gv=[[0,0],[0,0]];function pv(e,t){var r=e.type;var i=e.coordinates;var n=[];switch(r){case Pc:gv[0][0]=i[0];gv[0][1]=i[1];gv[1][0]=i[2];gv[1][1]=i[3];fv(gv,t,undefined,n);break;case zc:hv(i[0],i[1],i[2],i[3],t,n);break;case Rc:var a=i[0];var o=i[1];var s=i[2];hv(a-s,o-s,a+s,o+s,t,n);break;case Oc:cv(i,t,n);break;case Dc:vv(i,t,n);break;default:break}return n}var _v=1,yv=3,mv=4,xv=5;var bv=2863311530;var Sv=4294967295;var Av=31;function Ev(e,t,r){var i=e;for(var n=Av;n>=0;n--){var a=1<<n;var o=((r&a)<<2|(e&a)<<1|t&a)>>n;if(o===_v){var s=bv>>>Av-n&(~(Sv<<n)&Sv);t=(t|s)&~(1<<n)&Sv}else if(o===yv){return i}else if(o===mv){return t}else if(o===xv){var u=bv>>>Av-n&(~(Sv<<n)&Sv);i=(t|u)&~(1<<n)&Sv;var l=~(bv>>>Av-n)&Sv;e=e&l|1<<n}}return i}function wv(e,t,r){var i=t;for(var n=Av;n>=0;n--){var a=1<<n;var o=((r&a)<<2|(e&a)<<1|t&a)>>n;if(o===_v){var s=~(bv>>>Av-n)&Sv;i=e&s|1<<n;var u=bv>>>Av-n&(~(Sv<<n)&Sv);t=(t|u)&~(1<<n)&Sv}else if(o===yv){return e}else if(o===mv){return i}else if(o===xv){var l=~(bv>>>Av-n)&Sv;e=e&l|1<<n}}return i}function Tv(e,t,r){for(var i=Av;i>=0;i--){var n=1<<i;var a=((r&n)<<2|(e&n)<<1|t&n)>>i;if(a===_v){var o=bv>>>Av-i&(~(Sv<<i)&Sv);t=(t|o)&~(1<<i)&Sv}else if(a===yv){return false}else if(a===mv){return false}else if(a===xv){var s=~(bv>>>Av-i)&Sv;e=e&s|1<<i}}return true}function kv(e,t,r){var i=r+1;var n=0;for(var a=Av;a>=0;a--){var o=1<<a;var s=(i&o)>>a;var u=(e&o)>>a;var l=(t&o)>>a;var d=a&1;var h=n&3<<2*d;if(h===0&&s>l&&u<=l){n|=2<<2*d;break}else if(h===0&&s<u){n|=1<<2*d;break}}if(n===0){return i}else{return wv(e,t,r)}}var Cv=12;var Iv=function e(t,r){if(r===void 0)r=8;this.setLevel(r);this.setAccessor(t);this._tree=new xc(function(e,t){return e-t});this._nodeToId=new Sc(Uint32Array,1e3,16);this._idToNode=new Sc(Uint32Array,16,8);this._size=0;this._checkedNodes=[];this._codeCache=[0,0]};var Mv={intersectionChecks:{configurable:true},level:{configurable:true},size:{configurable:true}};Iv.prototype.setAccessor=function e(t){this._getGeometry=t;return this};Iv.prototype.load=function e(t){var r=[];var i=this._nodeToId;var n=this._idToNode;var a=this._level;var o=this._getGeometry;for(var s=0;s<t.length;s++){var u=t[s];var l=o(u);var d=pv(l,a);n.addEntry(u);for(var h=0;h<d.length;h++){var f=d[h];if(!i.has(f)){i.addEntry(f);r.push(f)}i.addTo(f,u);n.addTo(u,f)}}this._tree.load(r,[],true);this._size+=t.length;return this};Iv.prototype.addToPage=function e(){};Iv.prototype.removeFromPage=function e(){};Iv.prototype.insert=function e(t){var r=pv(this._getGeometry(t),this._level);var i=this._idToNode;var n=this._nodeToId;var a=this._tree;this._size++;i.addEntry(t);for(var o=0;o<r.length;o++){var s=r[o];if(!n.has(s)){a.insert(s);n.addEntry(s)}n.addTo(s,t);i.addTo(t,s)}};Iv.prototype.remove=function e(t){var r=this._idToNode.getItems(t);var i=this._nodeToId;var n=this._tree;if(r){for(var a=0;a<r.length;a++){var o=r[a];var s=i.removeFromAndGetSize(o,t);if(s===0){n.remove(o)}}}this._idToNode.removeEntry(t);this._size--;return this};Iv.prototype.update=function e(t){this.remove(t);this.insert(t);return this};Iv.prototype.forEach=function e(t){this._tree.forEach(t);return this};Iv.prototype.all=function e(){var e=[];this._tree.forEach(function(t){return e.push(t)});return e};Iv.prototype.clear=function e(){this._tree.clear();this._nodeToId.clear();this._idToNode.clear();return this};Iv.prototype.setLevel=function e(t){this._level=t;return this};Iv.prototype.traverse=function e(t,r){var i=this;var n=r[0];var a=r[1];var o=r[2];var s=r[3];var u=dv(n,a,this._level);var l=u[0];var d=u[1];var h=dv(o,s,this._level);var f=h[0];var c=h[1];var v=Mc(l,d);var g=Mc(f,c);var p=this._tree;var _=p._root;var y=[];var m=v;while(y.length>0||_){if(_){y.push(_);_=_.left}else{_=y.pop();var x=_.key;if(x>g){break}else if(x>=v){if(x>=m){m=kv(v,g,x);if(t(_)){return i}}}_=_.right}}return this};Iv.prototype.getKeys=function e(t){var r=t[0];var i=t[1];var n=t[2];var a=t[3];var o=dv(r,i,this._level);var s=o[0];var u=o[1];var l=dv(n,a,this._level);var d=l[0];var h=l[1];var f=Mc(s,u);var c=Mc(d,h);var v=this._tree;var g=v._root;var p=[];var _=f;while(p.length>0||g){if(g){p.push(g);g=g.left}else{g=p.pop();var y=g.key;if(y>c){break}else if(y>=f){if(y>=_){_=kv(f,c,y)}}g=g.right}}return this};Iv.prototype.traverseDescend=function e(t,r){var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=dv(i,n,this._level);var u=dv(a,o,this._level);var l=Mc(s[0],s[1]);var d=Mc(u[0],u[1]);this._recurse(this._tree._root,l,d,l,d,t,i,n,a,o);return this};Iv.prototype.traverseRange=function e(t,r){var i=this;var n=r[0];var a=r[1];var o=r[2];var s=r[3];var u=dv(n,a,this._level);var l=u[0];var d=u[1];var h=dv(o,s,this._level);var f=h[0];var c=h[1];var v=Mc(l,d);var g=Mc(f,c);this._tree.range(v,g,function(e){var r=e.key;if(Tv(v,g,r)){if(t(e)){return i}}});return this};Iv.prototype._recurse=function e(t,r,i,n,a,o){if(t===null){return}var s=t.key;if(s<r){return this._recurse(t.right,r,i,n,a,o)}if(s>i){return this._recurse(t.left,r,i,n,a,o)}if(Tv(n,a,s)){this._recurse(t.left,r,s,n,a,o);if(o(t)){return}this._recurse(t.right,s,i,n,a,o)}else{var u=wv(n,a,s);var l=Ev(n,a,s);this._recurse(t.left,r,l,n,a,o);this._recurse(t.right,u,i,n,a,o)}};Iv.prototype.query=function e(t){var r=this;var i=[];var n=[];this.traverse(function(e){i.push(e)},t);var a={};var o=this._getGeometry;this._intersectionChecks=0;for(var s=0;s<i.length;s++){var u=i[s];var l=r._nodeToId.getItems(u.key);for(var d=0;d<l.length;d++){var h=l[d];if(!a[h]){var f=o(h);r._intersectionChecks++;if(Xc(f,t)){n.push(h)}a[h]=true}}}this._checkedNodes=i;return n};Iv.prototype.getItems=function e(t){return this._nodeToId.getItems(t)};Mv.intersectionChecks.get=function(){return this._intersectionChecks};Mv.level.get=function(){return this._level};Mv.size.get=function(){return this._size};Iv.prototype.keyToBBox=function e(t){var r=sv();var i=Mc.reverse(t);var n=i[0];var a=i[1];var o=1<<Cv-this._level+(r-Cv);var s=1<<r-1;return[n*o-s,a*o-s,(n+1)*o-s,(a+1)*o-s]};Object.defineProperties(Iv.prototype,Mv);Iv.MAX_ZOOM=Cv;var Lv=typeof Map==="undefined"?function(){function e(){this._values={};this._size=0}var t={size:{configurable:true}};t.size.get=function(){return this._size};e.prototype.has=function e(t){return!!this._values[t]};e.prototype.set=function e(t,value){if(!(t in this._values)){this._size++}this._values[t]=value};e.prototype.get=function e(t){return this._values[t]};e.prototype.delete=function e(t){if(t in this._values){delete this._values[t];this._size--}};e.prototype.keys=function e(){return Object.keys(this._values)};e.prototype.clear=function e(){this._values={};this._size=0};Object.defineProperties(e.prototype,t);return e}():Map;var Fv=typeof Set==="undefined"?function(){function e(){this._values={};this._size=0}var t={size:{configurable:true}};t.size.get=function(){return this._size};e.prototype.has=function e(t){return!!this._values[t]};e.prototype.add=function e(t){if(!(t in this._values)){this._size++}this._values[t]=true};e.prototype.delete=function e(t){if(t in this._values){delete this._values[t];this._size--}};e.prototype.keys=function e(){return Object.keys(this._values)};e.prototype.clear=function e(){this._values={};this._size=0};Object.defineProperties(e.prototype,t);return e}():Set;var Nv=1<<16;var zv=16;var Pv=16;var Ov=(1<<zv)-1;var Dv=Math.log2(zv);var Rv=(1<<Dv)-1;var Bv=function(e,t,r){return r|Mc(e,t)<<4};var jv=function(e,t){if(t===void 0)t=[];Mc.reverse(e>>4,t);t[2]=e&Rv;return t};var Uv=function e(t,r,i,n,a){var o=this;if(i===void 0)i=Pv;if(n===void 0)n=Nv;if(a===void 0)a=Int32Array;this._intersects=t;this._getBounds=r;this._occupied=0;this._cells=new Sc(a);this._objectsAtLevel=new Array(zv).fill(0);this._idToCode=new Lv;this._codeCache=[];this._offset=n;this._min=-n;this._max=n;this._resolution=Ov/(this._max-this._min);this._minCellSize=i*this._resolution;this._bounds=new Array(zv*4);for(var s=0;s<zv;s++){o._bounds[s*4]=Infinity;o._bounds[s*4+1]=Infinity;o._bounds[s*4+2]=-Infinity;o._bounds[s*4+3]=-Infinity}};var Vv={averageCellOccupancy:{configurable:true},size:{configurable:true}};Uv.prototype.setMinCellSize=function e(t){this._minCellSize=t;return this};Uv.prototype.setOffset=function e(t){this._offset=t;this._min=-t;this._max=t;this._resolution=Ov/(this._max-this._min);return this};Uv.prototype.setIntersector=function e(t){this._intersects=t;return this};Uv.prototype.setBoundsGetter=function e(t){this._getBounds=t;return this};Uv.prototype.insert=function e(t,r){if(r===void 0)r=this._getBounds(t);var i=Math.max(r[2]-r[0],r[3]-r[1]);var n=this._minCellSize,a;for(a=0;n<i&&a<zv;a++){n*=2}var o=this._resolution,s=this._min;var u=o*((r[2]+r[0])*.5-s);var l=o*((r[3]+r[1])*.5-s);var d=u/n|0;var h=l/n|0;var f=Bv(d,h,a);if(!this._cells.has(f)){this._cells.addEntry(f)}this._cells.addTo(f,t);this._objectsAtLevel[a]++;this._occupied|=1<<a;var c=a*4;var v=this._bounds;if(d<v[c]){v[c]=d}if(h<v[c+1]){v[c+1]=h}if(d>v[c+2]){v[c+2]=d}if(h>v[c+3]){v[c+3]=h}this._idToCode.set(t,f);return f};Uv.prototype.has=function e(t){return this._idToCode.has(t)};Uv.prototype.update=function e(t,r){this.remove(t);return this.insert(t,r)};Uv.prototype.remove=function e(t){var r=this._idToCode.get(t);jv(r,this._codeCache);var i=this._codeCache[2];if(--this._objectsAtLevel[i]===0){this._occupied&=~(1<<i);this._bounds[i*4]=Infinity;this._bounds[i*4+1]=Infinity;this._bounds[i*4+2]=-Infinity;this._bounds[i*4+3]=-Infinity}this._cells.removeFrom(r,t);this._idToCode.delete(t);return this};Uv.prototype.query=function e(t){var r=t[0];var i=t[1];var n=t[2];var a=t[3];var o=this._cells;var s=this._bounds;var u=this._intersects;var l=this._min;var d=this._resolution;var h=0;var f=this._minCellSize;var c=this._occupied;var v=[];r=d*(r-l);i=d*(i-l);n=d*(n-l);a=d*(a-l);for(var g=h;g<zv;f*=2,c>>=1,g++){if(c===0){break}if((c&1)===0){continue}var p=1/f;var _=g*4;var y=Math.max(s[_],r*p-1>>0);var m=Math.max(s[_+1],i*p-1>>0);var x=Math.min(s[_+2],n*p+1>>0);var b=Math.min(s[_+3],a*p+1>>0);for(var S=y;S<=x;S++){for(var A=m;A<=b;A++){var E=Bv(S,A,g);var w=o.getItems(E);if(w===undefined){continue}for(var T=0;T<w.length;T++){var k=w[T];if(u(k,t)){v.push(k)}}}}}return v};Uv.prototype.collisions=function e(t,r){var i=this;if(r===void 0)r=this._getBounds;if(typeof r!=="function"){throw new Error("getBounds function is required to get the object bounds")}var n=Array.from(this._idToCode.keys());var a=this._min;var o=this._resolution;var s=this._cells;var u=new Lv;var l=[];for(var d=0;d<n.length;d++){var h=0;var f=i._minCellSize;var c=i._occupied;var v=n[d];var g=r(v);var p=g[0];var _=g[1];var y=g[2];var m=g[3];var x=Math.max(y-p,m-_);for(h=0;f<x;h++){f*=2;c>>=1}p=o*(p-a);_=o*(_-a);y=o*(y-a);m=o*(m-a);for(var b=h;b<zv;f*=2,c>>=1,b++){if(c===0){break}if((c&1)===0){continue}var S=1/f;var A=p*S-1>>0;var E=_*S-1>>0;var w=y*S+1>>0;var T=m*S+1>>0;for(var k=A;k<=w;k++){for(var C=E;C<=T;C++){var I=Bv(k,C,b);if(u.get(I)===d){continue}u.set(I,d);var M=s.getItems(I);if(M===undefined){continue}for(var L=0;L<M.length;L++){var F=M[L];if(F!==v){if(t(v,F)){l.push(v,F)}}}}}}}return Gv(l)};Uv.prototype.clear=function e(){var t=this;this._occupied=0;this._cells.clear();this._idToCode.clear();this._objectsAtLevel=new Array(zv).fill(0);this._bounds=new Array(zv*4);for(var r=0;r<zv;r++){t._bounds[r*4]=Infinity;t._bounds[r*4+1]=Infinity;t._bounds[r*4+2]=-Infinity;t._bounds[r*4+3]=-Infinity}return this};Uv.prototype.keyToBBox=function e(t){var r=jv(t);var i=r[0];var n=r[1];var a=r[2];var o=this._minCellSize*(1<<a);var s=this._min;var u=this._resolution;return[i*o/u+s,n*o/u+s,(i+1)*o/u+s,(n+1)*o/u+s]};Uv.prototype.keys=function e(){return Object.keys(this._cells._idToIndex)};Vv.averageCellOccupancy.get=function(){return this._cells.averageSize};Vv.size.get=function(){return this._idToCode.size};Object.defineProperties(Uv.prototype,Vv);function Gv(e){var t=new Fv;var r=[];for(var i=0;i<e.length;i+=2){var n=e[i],a=e[i+1];var o=n<a?n*a+(a-n-1)*(a-n-1)/4:n*a+(n-a-1)*(n-a-1)/4;if(!t.has(o)){t.add(o);r.push(n,a)}}return r}Uv.code=Bv;Uv.decode=jv;var Wv=["x","y","radius"];var Hv=["width","curvature"];var Xv=function e(t){var r=this;var i=t.modules;var n=i.dom;var a=i.graph;var o=i.camera;var s=i.graphics;var u=i.settings;var l=i.events;this._dom=n;this._graph=a;this._camera=o;this._graphics=s;this._settings=u;this._events=l;this._minCellSize=8;this._index=new Uv(this._getIntersector(),this._boundsGetter(),this._minCellSize,1e6);this._elementsToUpdate=new Ir(t);this._removedNodes=a.getAttribute(true,"removed");this._removedEdges=a.getAttribute(false,"removed");this._queryResult={edges:[],nodes:[]};this._queryBounds=[0,0,0,0];l.on({"addNodes addEdges removeNodes removeEdges updateAttributes":function(e){if(e.nodes){if(!e.nodeAttributes||e.nodeAttributes.some(function(e){return Wv.includes(e)})){var t=e.nodes.fastGetAdjacentElements().edges;r._elementsToUpdate.addElements(e.nodes);r._elementsToUpdate.addElements(t)}}if(e.edges){if(!e.edgeAttributes||e.edgeAttributes.some(function(e){return Hv.includes(e)})){r._elementsToUpdate.addElements(e.edges)}}},clear:function(){r._index.clear();r._elementsToUpdate.clear()}})};Xv.prototype._getIntersector=function e(){var t=this._graph;var r=t.getAttributes(true,["x","y","radius"]);var i=r[0];var n=r[1];var a=r[2];var o=t.getAttributes(false,["source","target","width","curvature"]);var s=o[0];var u=o[1];var l=o[2];var d=o[3];var h={};return function(e,t){if(e<0){e=-e;var r=s.get(e);var o=u.get(e);var f=d.get(e);var c=l.get(e)/2;var v=i.get(r),g=n.get(r);var p=i.get(o),_=n.get(o);if(r===o){oa(v,g,f,a.get(r),0,h);return Gi(v,g,h.x1,h.y1,h.x2,h.y2,p,_,t[0]-c,t[1]-c,t[2]+c,t[3]+c)}else if(f===0){return li(v,g,p,_,t[0]-c,t[1]-c,t[2]+c,t[3]+c)}else{aa(v,g,p,_,f,h);return Ui(v,g,h.x,h.y,p,_,t[0]-c,t[1]-c,t[2]+c,t[3]+c)}}else{var y=i.get(e),m=n.get(e),x=a.get(e);return Rr(y,m,x,t[0],t[1],t[2],t[3])}}};Xv.prototype._boundsGetter=function e(){var t=this._graph;var r=t.getAttributes(true,["x","y","radius"]);var i=r[0];var n=r[1];var a=r[2];var o=t.getAttributes(false,["source","target","curvature"]);var s=o[0];var u=o[1];var l=o[2];var d={};var h={};return function(e){if(e<0){e=-e;var t=s.get(e);var r=u.get(e);var o=l.get(e);var f=i.get(t),c=n.get(t);var v=i.get(r),g=n.get(r);if(t===r){oa(f,c,o,a.get(t),0,d);ca(f,c,d.x1,d.y1,d.x2,d.y2,v,g,h)}else if(o===0){h.minX=Math.min(f,v);h.minY=Math.min(c,g);h.maxX=Math.max(f,v);h.maxY=Math.max(c,g)}else{aa(f,c,v,g,o,d);fa(f,c,d.x,d.y,v,g,h)}}else{var p=i.get(e);var _=n.get(e);var y=a.get(e);h.minX=p-y;h.minY=_-y;h.maxX=p+y;h.maxY=_+y}return[h.minX,h.minY,h.maxX,h.maxY]}};Xv.prototype.reindex=function e(){this._graphics.forceAttributesComputation();this._index.clear();this._elementsToUpdate.clear();this._updateItems(this._graph.getNodes("all")._indexes,this._graph.getEdges("all")._indexes)};Xv.prototype._updateIndex=function e(){if(!this._elementsToUpdate.isEmpty()){var t=this._elementsToUpdate.getElements();var r=t.nodes;var i=t.edges;this._updateItems(r._indexes,i._indexes);this._elementsToUpdate.clear()}};Xv.prototype._updateItems=function e(t,r){var i=this._index;var n=this._removedNodes;var a=this._removedEdges;var o=[];var s=[];for(var u=0;u<t.length;u++){var l=t[u];if(n.get(l)!==0){o.push(l)}else if(i.has(l)){o.push(l);s.push(l)}else{s.push(l)}}for(var d=0;d<r.length;d++){var h=-r[d];if(a.get(-h)!==0){o.push(h)}else if(i.has(h)){o.push(h);s.push(h)}else{s.push(h)}}for(var f=0,c=o;f<c.length;f+=1){var v=c[f];i.remove(v)}for(var g=0,p=s;g<p.length;g+=1){var _=p[g];i.insert(_)}};Xv.prototype.getNodesInScreenByDistance=function e(t){var r=t.getPositionOnScreen();var i=r.x;var n=r.y;return this._graph.getNodes().filter(function(e){return e.isInScreen()&&e!==t}).sort(function(e,t){var r=e.getPositionOnScreen(),a=t.getPositionOnScreen();return distance(r.x,r.y,i,n)-distance(a.x,a.y,i,n)})};Xv.prototype.getNearestNodesForNode=function e(t,r,i){if(r===void 0)r=240;var n=t.getPosition();var a=n.x;var o=n.y;return this.getNearestNodes(a,o,r,i,t)};Xv.prototype.getNearestNodes=function e(t,r,i,n,a){this._updateIndex();if(n){var o=this._camera.screenToGraphVector({x:i,y:i});i=distance(0,0,o.x,o.y)}return this._getNearestNodes(t,r,i,a)};Xv.prototype._getNearestNodes=function e(t,r,i,n){var a=[];var o=i*i;var s=n?n._index:0;var u=this._graph.getNodes()._indexes;var l=this._graph.getAttributes(true,["x","y"]);var d=l[0];var h=l[1];for(var f=0,c=u.length;f<c;f++){var v=u[f];if(v===s){continue}var g=t-d.get(v);var p=r-h.get(v);if(g*g+p*p<=o){a.push(v)}}return new this._graph.NodeList(a)};Xv.prototype.queryRaw=function e(t,r,i,n){this._updateIndex();var a=this._queryBounds;a[0]=t;a[1]=r;a[2]=i;a[3]=n;var o=this._index.query(a);var s=this._queryResult;var u=s.nodes;var l=s.edges;u.length=l.length=0;for(var d=0;d<o.length;d++){var h=o[d];if(h<0){l.push(-h)}else{u.push(h)}}return this._queryResult};Xv.prototype.queryRawProjected=function e(t,r,i,n){var a=this._queryBounds;a[0]=t;a[1]=r;a[2]=i;a[3]=n;this._camera.projectBounds(a);return this.queryRaw(a[0],a[1],a[2],a[3])};Xv.prototype.query=function e(t,r,i,n){var a=this._graph;var o=this.queryRaw(t,r,i,n);var s=o.nodes;var u=o.edges;return{nodes:new a.NodeList(s.slice()),edges:new a.EdgeList(u.slice())}};Xv.prototype.queryProjected=function e(t,r,i,n){var a=this._graph;var o=this.queryRawProjected(t,r,i,n);var s=o.nodes;var u=o.edges;return{nodes:new a.NodeList(s.slice()),edges:new a.EdgeList(u.slice())}};Xv.prototype.getNodesByBoundingBox=function e(t,r,i,n,a){this._updateIndex();if(a){var o;o=this._camera.screenToGraphVector({x:t,y:r});t=o.x;r=o.y;o=this._camera.screenToGraphVector({x:i,y:n});i=o.x;n=o.y}var s=this._graph;var u=s.getNodes()._indexes;var l=[];var d=s.getAttributes(true,["excluded","x","y"]);var h=d[0];var f=d[1];var c=d[2];for(var v=0,g=u.length;v<g;v++){var p=u[v];if(h.get(p)){continue}var _=f.get(p),y=c.get(p);if(_>=t&&_<=i&&y>=r&&y<=n){l.push(p)}}return new s.NodeList(l)};Xv.prototype.toggleDebug=function e(t){if(t){this._canvas=ke();this._graphics.addCanvas(this._canvas);this._ctx=this._canvas.getContext("2d")}else if(this._canvas){this._graphics.removeCanvas(this._canvas);this._canvas=this._ctx=null}};Xv.prototype.renderDebug=function e(t){if(!this._ctx){this.toggleDebug(true)}qv(this,t)};function qv(e,t){if(t===void 0)t={};var r=t.cells;if(r===void 0)r=true;var i=t.boxes;if(i===void 0)i=true;var n=t.query;if(n===void 0)n=true;var a=Ogma.utils.getPixelRatio();var o=e._ctx;var s=e._canvas;var u=e._camera;var l=e._index;var d=-u.getAngle();var h=u.getZoom()*a;var f=u._x;var c=u._y;var v=u._dimensions.width*a/2;var g=u._dimensions.height*a/2;var p=function(e,t){return{x:(e-f)*h,y:(t-c)*h}};var _=l.keys().map(function(e){return l.keyToBBox(e)});var y=Array.from(l._idToCode.keys()).map(function(e){return l._getBounds(e)});o.clearRect(0,0,s.width,s.height);o.save();o.translate(v,g);o.rotate(d);if(r){o.beginPath();o.lineWidth=1;o.strokeStyle="#707070";_.forEach(function(e){var t=p(e[0],e[1]);var r=p(e[2],e[3]);o.rect(t.x,t.y,r.x-t.x,r.y-t.y)});o.stroke()}if(i){o.beginPath();o.lineWidth=1;o.strokeStyle="#ff7070";y.forEach(function(e){var t=p(e[0],e[1]);var r=p(e[2],e[3]);o.rect(t.x,t.y,r.x-t.x,r.y-t.y)});o.closePath();o.stroke()}if(n&&e._queryBounds){var m=e._queryBounds;o.beginPath();o.lineWidth=2;o.strokeStyle="#3030ff";var x=p(m[0],m[1]);var b=p(m[2],m[3]);o.rect(x.x,x.y,b.x-x.x,b.y-x.y);o.closePath();o.stroke()}o.restore()}Ogma.extend(function(e){return e.modules.spatial=new Xv(e)});Ogma.extend(function(e){var t=new Zv(e);e.modules.watcher=t;e.schema={watchNodeObjectProperty:function e(r){return t.watchNodeObjectProperty(r)},watchEdgeObjectProperty:function e(r){return t.watchEdgeObjectProperty(r)},watchNodeNonObjectProperty:function e(r){return t.watchNodeNonObjectProperty(r)},watchEdgeNonObjectProperty:function e(r){return t.watchEdgeNonObjectProperty(r)}}});function Yv(e){if(typeof e!=="object"||e===null||Array.isArray(e)){return{path:Kv(e),filter:"visible",unwindArrays:false}}else{return{path:Kv(e.path),filter:Qv(e.filter),unwindArrays:!!e.unwindArrays}}}var Zv=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._events=t.modules.events;this._propertyWatchers=[];this._objectPropertyWatchers=[];this._events.on({excludedStateChange:function(e){var t=e.elements;var value=e.value;var i=!value;for(var n=0,a=r._propertyWatchers.length;n<a;n++){var o=r._propertyWatchers[n];if(o.isNode===t.isNode&&o.filter==="visible"){if(i){rg(o,t.getData(o.property))}else{ig(o,t.getData(o.property))}Jv(o)}}},"updateNodeData updateEdgeData":function(e){var t=e.isNode;var i=e.changes;for(var n=0;n<r._propertyWatchers.length;++n){var a=r._propertyWatchers[n],o=a.property,s=a.filter==="all";if(a.isNode!==t){continue}for(var u=0;u<i.length;++u){var l=i[u],d=l.property||[],h=eg(d,o);if(h){var f=l.nodes||l.edges,c=[],v=[];for(var g=0;g<f.size;++g){var p=f.get(g);if(s||p.isVisible()){c.push(no(l.newValues[g],h));v.push(no(l.previousValues[g],h))}}if(c.length){rg(a,c);ig(a,v);Jv(a)}}}}for(var _=0,y=r._objectPropertyWatchers.length;_<y;_++){var m=r._objectPropertyWatchers[_];var x=m._path;var b=function(e){var t=i[e];var r=t.property;var n=t.nodes;var a=t.edges;var o=n||a,s=o.isNode;if(!r||r.length<=x.length+1&&x.every(function(e,t){return e===r[t]})){m._updateSubPropertiesToWatch(s,o)}};for(var S=0;S<i.length;++S)b(S)}},"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=t||i;for(var a=0;a<r._propertyWatchers.length;++a){var o=r._propertyWatchers[a];if(o.isNode===n.isNode){var s=n.getData(o.property);if(s.length){rg(o,s);Jv(o)}}}for(var u=0;u<r._objectPropertyWatchers.length;u++){r._objectPropertyWatchers[u]._updateSubPropertiesToWatch(n.isNode,n)}},"removeNodes removeEdges":function(e){var t=e.nodes;var i=e.edges;var n=t||i;for(var a=0;a<r._propertyWatchers.length;++a){var o=r._propertyWatchers[a];var s=o.filter==="all";if(o.isNode===n.isNode&&s){var u=n.getData(o.property);if(u.length){ig(o,u);Jv(o)}}}},clear:function(){r._propertyWatchers.forEach(function(e){e.nbNumbers=0;e.nbAny=0;e.nbTotal=0;e.boundaries=null;e.values.clear()})}})};Zv.prototype.watchNodeObjectProperty=function e(t){return this._watchObjectProperty(true,Yv(t))};Zv.prototype.watchEdgeObjectProperty=function e(t){return this._watchObjectProperty(false,Yv(t))};Zv.prototype.watchNodeNonObjectProperty=function e(t){return this._watchNonObjectProperty(true,Yv(t))};Zv.prototype.watchEdgeNonObjectProperty=function e(t){return this._watchNonObjectProperty(false,Yv(t))};Zv.prototype._watchPropertyInformation=function e(t,r,i,n,a){var o=this._findWatcher(t,r,n,a);if(!o){o=this._createWatcher(t,r,n,a)}if(i){o.onChange.push(i)}return o.info};Zv.prototype._unwatchPropertyInformation=function e(t,r,i,n,a){var o=this._findWatcher(t,r,n,a);if(!o){return}var s=o.onChange,u=s.indexOf(i);if(u!==-1){s.splice(u,1);if(s.length===0){var l=this._propertyWatchers.indexOf(o);this._propertyWatchers.splice(l,1)}}};Zv.prototype._watchObjectProperty=function e(t,r){var i=new og(this,t,r);this._objectPropertyWatchers.push(i);i._updateSubPropertiesToWatch(t,this._graph[t?"getNodes":"getEdges"](r.filter));return i};Zv.prototype._watchNonObjectProperty=function e(t,r){return new sg(this,t,r)};Zv.prototype._findWatcher=function e(t,r,i,n){var a=this;for(var o=0;o<this._propertyWatchers.length;++o){var s=a._propertyWatchers[o];if(s.isNode===t&&s.filter===i&&s.unwindArrays===n&&$v(s.property,r)){return s}}return null};Zv.prototype._createWatcher=function e(t,r,i,n){var a={isNode:t,property:r,nbNumbers:0,nbAny:0,nbTotal:0,values:new yt,boundaries:null,onChange:[],filter:i,unwindArrays:n,info:undefined};a.info=new tg(a);rg(a,this._ogma[t?"getNodes":"getEdges"](i).getData(r));this._propertyWatchers.push(a);return a};function Kv(value){if(value===null||value===undefined){return[]}else{return F(value)}}function Qv(value){return value==="all"?"all":"visible"}function Jv(e){for(var t=0;t<e.onChange.length;++t){e.onChange[t](e.info)}}function $v(e,t){if(e.length!==t.length){return false}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return false}}return true}function eg(e,t){if(e.length>t.length){return null}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return null}}return t.slice(r)}var tg=function e(t){this._watcher=t};tg.prototype.isNode=function e(){return this._watcher.isNode};tg.prototype.getPath=function e(){return this._watcher.property.slice()};tg.prototype.getBoundaries=function e(){var t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null};tg.prototype.getValues=function e(){return this._watcher.values.keys()};tg.prototype.getValueCount=function e(value){return this._watcher.values.get(value)||0};tg.prototype.getCount=function e(){return this._watcher.nbTotal};tg.prototype.getType=function e(){if(this._watcher.nbAny>0){return"any"}else if(this._watcher.nbNumbers>0){return"number"}else{return"undefined"}};function rg(e,t,r){var i=e.values,n=!r&&e.unwindArrays;for(var a=0;a<t.length;++a){var value=t[a];if(!r&&value!==undefined){e.nbTotal+=1}if(n&&Array.isArray(value)){rg(e,value,true)}else{var o=i.get(value);if(o){i.set(value,o+1)}else{i.set(value,1);if(ag(value)){if(!e.boundaries){e.boundaries={min:value,max:value}}else if(value<e.boundaries.min){e.boundaries.min=value}else if(value>e.boundaries.max){e.boundaries.max=value}e.nbNumbers+=1}else if(value!==undefined){e.nbAny+=1}}}}}function ig(e,t,r){var i=e.values,n=!r&&e.unwindArrays,a=e.boundaries,o=false;for(var s=0;s<t.length;++s){var value=t[s];if(!r&&value!==undefined){e.nbTotal-=1}if(n&&Array.isArray(value)){o|=ig(e,value,true)}else{var u=i.get(value);if(u>1){i.set(value,u-1)}else{i.delete(value);if(ag(value)){e.nbNumbers-=1;if(a&&(a.min===value||a.max===value)){o=true}}else if(value!==undefined){e.nbAny-=1}}}}if(!r&&o){e.boundaries=ng(i.keys())}return o}function ng(e){var t=undefined,r=undefined;for(var i=0;i<e.length;++i){var value=e[i];if(ag(value)){if(t===undefined||value<t){t=value}if(r===undefined||value>r){r=value}}}return t===undefined?null:{min:t,max:r}}function ag(value){return typeof value==="number"&&isFinite(value)}var og=function e(t,r,i){var n=i.path;var a=i.filter;var o=i.unwindArrays;this._module=t;this._isNode=r;this._path=n;this._filter=a;this._unwindArrays=o;this._propertyList=[];this._properties={};this._onAddHandlers=[];this._onRemoveHandlers=[];this._onUpdateHandlers=[]};og.prototype.onPropertyAdded=function e(t){this._onAddHandlers.push(t);return this};og.prototype.onPropertyRemoved=function e(t){this._onRemoveHandlers.push(t);return this};og.prototype.onPropertyUpdated=function e(t){this._onUpdateHandlers.push(t);return this};og.prototype.getPath=function e(){return this._path.slice()};og.prototype.getProperties=function e(){return this._propertyList.slice()};og.prototype.getPropertyInfo=function e(t){var r=this._properties[t];return r?r.info:null};og.prototype.destroy=function e(){var t=this;j(this._properties,function(e,r){var i=e.handler;var n=t._path.concat([r]);t._module._unwatchPropertyInformation(t._isNode,n,i,t._filter,t._unwindArrays)});this._propertyList=undefined;this._properties=undefined;this._onAddHandlers=undefined;this._onRemoveHandlers=undefined;this._onUpdateHandlers=undefined;var r=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(r,1)};og.prototype.kill=function e(){return this.destroy()};og.prototype._updateSubPropertiesToWatch=function e(t,r){var i=this;if(t!==this._isNode){return}var n=r.getData(this._path);for(var a=0;a<n.length;a++){var o=n[a];if(R(o)){var s=Object.keys(o);for(var u=0;u<s.length;u++){i._addSubPropertyToWatch(s[u])}}}};og.prototype._addSubPropertyToWatch=function e(t){var r=this;if(!this._properties[t]){var i=this._path.concat([t]);var n=function(){return r._triggerPropertyUpdate(t)};var a=this._unwindArrays;var o=this._isNode;var s=this._filter;var u=this._module._watchPropertyInformation(o,i,n,s,a);this._properties[t]={handler:n,info:u};this._triggerPropertyUpdate(t)}};og.prototype._triggerPropertyUpdate=function e(t){var r=this._properties[t];var i=r.info;var n=this._propertyList.indexOf(t),a=n!==-1,o=i.getType()!=="undefined";if(!a&&o){this._propertyList.push(t);this._triggerHandlers("_onAddHandlers",t,i);this._triggerHandlers("_onUpdateHandlers",t,i)}else if(a&&!o){this._propertyList.splice(n,1);this._triggerHandlers("_onUpdateHandlers",t,i);this._triggerHandlers("_onRemoveHandlers",t,i)}else if(a&&o){this._triggerHandlers("_onUpdateHandlers",t,i)}};og.prototype._triggerHandlers=function e(t,r,i){var n=this[t];for(var a=0,o=n.length;a<o;a++){n[a](r,i)}};var sg=function e(t,r,i){var n=this;var a=i.path;var o=i.filter;var s=i.unwindArrays;this._module=t;this._isNode=r;this._path=a||[];this._filter=o;this._unwindArrays=s;this._onUpdateHandlers=[];this._triggerUpdate=function(e){for(var t=0;t<n._onUpdateHandlers.length;++t){n._onUpdateHandlers[t](e)}};this._info=t._watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)};sg.prototype.onUpdate=function e(t){this._onUpdateHandlers.push(t)};sg.prototype.getPropertyInfo=function e(){return this._info};sg.prototype.getPath=function e(){return this._path.slice()};sg.prototype.destroy=function e(){this._module._unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)};sg.prototype.kill=function e(){return this.destroy()};var ug=function e(t){var r=this;this._ogma=t;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._styleRules=t.modules.styleRules;this._watcher=t.modules.watcher;this._events=t.modules.events;this._mappingList=[];this._events.on({"addNodes addEdges updateNodeData updateEdgeData removeNodes removeEdges excludedStateChange clear":function(){if(r._mappingList.length){for(var e=0;e<r._mappingList.length;++e){r._mappingList[e].markAsInvalid()}r._styleRules.refreshAllRules();r._ogma.modules.legend.refresh()}}})};ug.prototype.createMapping=function e(t){if(t===void 0)t={};var r=t.field;var i=t.values;if(i===void 0)i={};var n=t.fallback;r=F(r);if(!T(n)){n=[n]}else if(n.length===0){n=[undefined]}if(typeof i!=="object"||i===null||T(i)){throw new Error('"mapping" should be an object')}return this._createMappingFunction(dg,r,{values:i,fallback:n})};ug.prototype.createSlices=function e(t){if(t===void 0)t={};var r=t.field;var i=t.fallback;var n=t.stops;if(n===void 0)n={};var a=t.values;if(a===void 0)a={nbSlices:7};var o=t.reverse;if(o===void 0)o=false;r=F(r);if(!a.nbSlices){a.nbSlices=7}if(T(n)&&T(a)&&n.length!==a.length-1){throw new Error("there should be exactly one more value that stops")}return this._createMappingFunction(hg,r,{fallback:i,stops:n,values:a,reverse:o})};ug.prototype._createMappingFunction=function e(t,r,i){var n=new cg(this._ogma,t,r,i);this._mappingList.push(n);var a=function(e,t,r){return n.getValue(e,r)};a.mapping=n;return a};ug.prototype.createTemplate=function e(t){if(typeof t!=="string"){throw new TypeError('"template" should be a string')}var r=[];var i=0;var n=false;while(!n){var a=-1;var o=t.indexOf("{{",i);if(o!==-1){a=t.indexOf("}}",o+2)}if(a!==-1){r.push(t.substring(i,o));r.push(t.substring(o+2,a));i=a+2}else{r.push(t.slice(i));n=true}}return function(e){var t=r[0];for(var i=1;i<r.length;i+=2){t+=e.getData(r[i]);t+=r[i+1]}return t}};function lg(e,t,r){var i=t?e.getNodes():e.getEdges();var n=i.getData(r);var a={};for(var o=0;o<n.length;++o){var value=n[o];if(Array.isArray(value)){for(var s=0;s<value.length;++s){a[value[s]]=1}}else{a[value]=1}}delete a.undefined;return Object.keys(a).sort()}function dg(e,t,r,i){var n=r.values;var a=r.fallback;var o=lg(e,i,t);var s={};var u=0;for(var l=0;l<o.length;++l){var value=o[l];if(value in n){s[value]=n[value]}else{s[value]=a[u];u=(u+1)%a.length}}return s}function hg(e,t,r,i){var n=r.fallback;var a=r.stops;var o=r.values;var s=r.reverse;var u=lg(e,i,t);var l=Infinity;var d=-Infinity;for(var h=0;h<u.length;++h){var value=+u[h];if(fg(value)){l=Math.min(l,value);d=Math.max(d,value);u[h]=value}}var f={};if(!isFinite(l)){for(var c=0;c<u.length;++c){f[u[c]]=n}}else{var v=T(o)?o.length:o.nbSlices,g,p;if(T(a)){g=a.slice()}else{var _=a.min;var y=a.max;if(_===undefined||y===undefined){_=l;y=d}var m=(y-_)/v;g=[];for(var x=1;x<v;++x){g.push(_+m*x)}}if(T(o)){p=o}else{var b=o.min;var S=o.max;var A=g.length+1,E=(S-b)/g.length;p=[];for(var w=0;w<A;++w){p.push(b+w*E)}}if(s){p.reverse()}for(var k=0;k<u.length;++k){var C=u[k];var I=+C;if(!isFinite(I)){f[C]=n}else{var M=0;while(M<g.length&&g[M]<=C){M+=1}f[C]=p[M]}}}return f}function fg(value){return typeof value==="number"&&isFinite(value)}var cg=function e(t,r,i,n){this._ogma=t;this._computeMapping=r;this._field=i;this._options=n;this._nodeMapping={valid:false,values:null};this._edgeMapping={valid:false,values:null}};cg.prototype.getValue=function e(t,r){var i=t.isNode;var n=i?this._nodeMapping:this._edgeMapping;if(!n.valid){n.values=this._computeMapping(this._ogma,this._field,this._options,i);n.valid=true}var a=t.getData(this._field);var o;if(T(a)){if(r==="color"){o=a.map(function(e){return n.values[e]})}else{o=n.values[a[0]]}}else{o=n.values[a]}return o};cg.prototype.markAsInvalid=function e(){this._nodeMapping.valid=false;this._edgeMapping.valid=false};cg.prototype.getValues=function e(t){return t?this._nodeMapping.values:this._edgeMapping.values};cg.prototype.getField=function e(){return this._field};Ogma.extend(function(e){var t=new ug(e);e.modules.rules=t;e.rules={map:function e(r){return t.createMapping(r)},slices:function e(r){return t.createSlices(r)},template:function e(r){return t.createTemplate(r)}}});var vg={0:"left",1:"middle",2:"right"};Ogma.extend(function(e){e.modules.mouse=new gg(e)});var gg=function e(t){var r=this;this._dom=t.modules.dom;this._settings=t.modules.settings;this._events=t.modules.events;this._graphics=t.modules.graphics;this._focus=false;this._domElt=this._graphics.getDomElement();this._x=0;this._y=0;this._left=false;this._middle=false;this._right=false;this._settings.register("mouse.enabled",true);this._settings.register("mouse.wheelEnabled",true);this._settings.register("mouse.disableWheelUntilMouseDown",false);this._settings.register("mouse.doubleClickTimer",500);this._events.register(["mouseDown","mouseUp","mouseMove","mouseWheel","mouseClick","mouseDoubleClick","mouseLeave","documentMouseMove","documentMouseUp"]);this._dom.addDocumentEventListener("contextmenu",function(e){if(r._focus&&r._settings.get("mouse.enabled")){e.preventDefault()}},false);this._initializeListeners()};var pg={x:{configurable:true},y:{configurable:true},left:{configurable:true},right:{configurable:true},middle:{configurable:true}};pg.x.get=function(){return this._x};pg.y.get=function(){return this._y};pg.left.get=function(){return this._left};pg.right.get=function(){return this._right};pg.middle.get=function(){return this._middle};gg.prototype._isEnabled=function e(){return this._settings.get("mouse.enabled")};gg.prototype._isWheelEnabled=function e(){return this._settings.get("mouse.wheelEnabled")};gg.prototype._disableWheelUntilMouseDown=function e(){return this._settings.get("mouse.disableWheelUntilMouseDown")};gg.prototype._getDoubleClickTimer=function e(){return this._settings.get("mouse.doubleClickTimer")};gg.prototype._initializeListeners=function e(){var t=this;var r=6;var i=this;var n={left:0,middle:0,right:0};var a=function(e,t){return i._events.fire(e,t)};var o=0,s=0;var u=0,l=0;var d;var h={left:false,middle:false,right:false};var f=null;var c=null;var v=0,g=0;var p=false;var _=null;var y=function(e,value){if(value===void 0)value=0;if(e){n[e]=value}else{n.left=value;n.middle=value;n.right=value}i._dom.clearTimeout(_)};var m=function(e){d=Ge(i._domElt);if(!d){return false}c=e;f=vg[e.button];u=o;l=s;o=e.clientX-d.left;s=e.clientY-d.top;i._x=o;i._y=s;i._left=h.left;i._right=h.right;i._middle=h.middle;return true};var x=function(e){if(m(e)){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));a("mouseWheel",{delta:t,x:o,y:s,domEvent:c})}};function b(e){if(i._isEnabled()&&i._isWheelEnabled()&&(!i._disableWheelUntilMouseDown()||i._focus)){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}x(e)}}this._dom.addElementEventListener(this._domElt,"mousewheel",b);this._dom.addElementEventListener(this._domElt,"DOMMouseScroll",b);this._dom.addDocumentEventListener("mousemove",function(e){if(!t._isEnabled()||!m(e)){return}var i=o-u;var n=s-l;if(o>0&&o<d.width&&s>0&&s<d.height){if(i===0&&n===0){return}if(p){p=false}else if(distance(o,s,v,g)>=r){y();a("mouseMove",{x:o,y:s,dx:i,dy:n,domEvent:c})}}else{a("documentMouseMove",{x:o,y:s,dx:i,dy:n,domEvent:c})}});this._dom.addElementEventListener(this._domElt,"mouseleave",function(){if(!t._isEnabled()){return}t._focus=false;a("mouseLeave",{domEvent:c})});this._dom.addElementEventListener(this._domElt,"mousedown",function(e){if(!t._isEnabled()||!m(e)){return}p=true;v=o;g=s;t._focus=true;h[f]=true;n[f]+=1;var r=f;_=t._dom.setTimeout(function(){return y(r,0)},t._getDoubleClickTimer());a("mouseDown",{button:f,x:o,y:s,domEvent:c})});this._dom.addDocumentEventListener("mouseup",function(e){if(!t._isEnabled()||!m(e)){return}h[f]=false;if(o>0&&o<d.width&&s>0&&s<d.height){if(n[f]===1){a("mouseClick",{button:f,x:o,y:s,domEvent:c})}else if(n[f]>1){a("mouseDoubleClick",{button:f,x:o,y:s,domEvent:c});y(f)}a("mouseUp",{button:f,x:o,y:s,domEvent:c})}else{a("documentMouseUp",{button:f,x:o,y:s,domEvent:c})}})};Object.defineProperties(gg.prototype,pg);Ogma.extend(function(e){var t=new _g(e);e.modules.virtualMouse=t;e.mouse={move:function e(r){return t.move(r)},down:function e(r){return t.down(r)},up:function e(r){return t.up(r)},click:function e(r){return t.click(r)},doubleClick:function e(r){return t.doubleClick(r)},drag:function e(r,i){return t.drag(r,i)},wheel:function e(r){return t.wheel(r)}}});var _g=function e(t){this._ogma=t;this._dom=t.modules.dom;this._events=t.modules.events;this._events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])};var yg={x:{configurable:true},y:{configurable:true}};yg.x.get=function(){return this._ogma.modules.captor._x||0};yg.y.get=function(){return this._ogma.modules.captor._y||0};_g.prototype._later=function e(){var t=this;return this._dom.afterNextFrame().then(function(){return new Promise(function(e){return t._dom.setTimeout(e,0)})})};_g.prototype.move=function e(t){var r=this;var i=t.x;var n=t.y;if(i!==undefined&&n!==undefined){return this._dom.afterNextFrame().then(function(){var e=i-r.x;var t=n-r.y;r._events.fire("virtualMove",{x:i,y:n,dx:e,dy:t});return r._later()})}else{return Promise.resolve()}};_g.prototype.down=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualDown",{x:r.x,y:r.y,button:a});r._events.fire("virtualMove",{x:r.x,y:r.y,dx:0,dy:0});return r._later()})};_g.prototype.up=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualUp",{x:r.x,y:r.y,button:a});return r._later()})};_g.prototype.click=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualClick",{x:r.x,y:r.y,button:a});return r._later()})};_g.prototype.doubleClick=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualDoubleClick",{x:r.x,y:r.y,button:a});return r._later()})};_g.prototype.drag=function e(t,r){var i=this;return this.down(t).then(function(){return i.move(r)}).then(function(){return i.up()})};_g.prototype.wheel=function e(t){var r=this;var i=t.x;var n=t.y;var a=t.delta;return this.move({x:i,y:n}).then(function(){r._events.fire("virtualWheel",{x:r.x,y:r.y,delta:a});return r._later()})};Object.defineProperties(_g.prototype,yg);var mg={doubleTapTimer:500,touchEventRate:15};Ogma.extend(function(e){e.modules.touch=new xg(e)});var xg=function e(t){this._dom=t.modules.dom;this._events=t.modules.events;this._settings=t.modules.settings;this._graphics=t.modules.graphics;this._x=0;this._y=0;this._pressed=false;this._domElt=this._graphics.getDomElement();this._settings.register("touch.enabled",true);this._events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]);Sg(this)};var bg={x:{configurable:true},y:{configurable:true},pressed:{configurable:true}};bg.x.get=function(){return this._x};bg.y.get=function(){return this._y};bg.pressed.get=function(){return this._pressed};xg.prototype._isEnabled=function e(){return this._settings.get("touch.enabled")};xg.prototype._bind=function e(t,r){this._dom.addElementEventListener(this._domElt,t,r)};Object.defineProperties(xg.prototype,bg);function Sg(e){var t=function(t,r){return e._events.fire(t,r)};var r=0,i=0,n=0,a=0,o=false,s=0,u=false,l=false,d=1,h=0,f=null;var c=null;var v=function(){e._x=r;e._y=i;e._pressed=o};var g=function(e,t,n,a){d=e;h=t;r=n;i=a;v()};var p=function(t){var n=Ge(e._domElt);if(!n){return null}var a=t.touches[0].clientX-n.left;var o=t.touches[0].clientY-n.top;var s=t.touches[1].clientX-n.left;var u=t.touches[1].clientY-n.top;var l=(a+s)/2,f=(o+u)/2,c=l-r,v=f-i,p=distance(a,o,s,u),_=p/d,y=ti(a,o,s,u),m=y-h,x={dx:c,dy:v,rotation:m,scale:_};g(p,y,l,f);return x};var _=function(e){if(e.touches.length!==2&&l){l=false;t("touchEndGesture",{domEvent:f})}else if(e.touches.length===2&&!l){if(p(e,true)){l=true;t("touchStartGesture",{domEvent:f})}}return e.touches.length===2};var y=function(e){if(e.touches.length===2&&l){var n=p(e);if(n){var a=n.dx;var o=n.dy;var s=n.rotation;var u=n.scale;t("touchProgressGesture",{dx:a,dy:o,rotation:s,scale:u,x:r,y:i,domEvent:f})}}};var m=function(t,r){e._bind(t,r)};var x=function(s){if(s.touches.length!==1){o=false;if(s.touches.length>1){t("touchUp",{x:r,y:i,domEvent:f})}return false}else{var u=Ge(e._domElt);if(u){n=r;a=i;r=s.touches[0].clientX-u.left;i=s.touches[0].clientY-u.top;o=true;f=s;v()}return true}};var b=function(){s=0;e._dom.clearTimeout(c)};m("touchstart",function(n){_(n);if(x(n)){t("touchDown",{x:r,y:i,domEvent:f});s+=1;c=e._dom.setTimeout(b,mg.doubleTapTimer);u=true}});var S=function(e){_(e);x(e);if(e.touches.length===0){if(s===1){t("touchTap",{x:r,y:i,domEvent:f})}else if(s>1){t("touchDoubleTap",{x:r,y:i,domEvent:f});b()}t("touchUp",{x:r,y:i,domEvent:f})}};m("touchend",S);m("touchcancel",S);m("touchmove",function(e){y(e);if(u){u=false;return}b();if(x(e)){t("touchMove",{x:r,y:i,dx:r-n,dy:i-a,domEvent:f})}});var A=function(e){return e.preventDefault()};m("touchstart",A);m("touchend",A);m("touchcancel",A)}var Ag={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"};var Eg={};(function(){var e=Object.keys(Ag);e.forEach(function(e){var t=Ag[e];if(!Eg[t]){Eg[t]=[]}Eg[t].push(e)})})();Ogma.extend(function(e){var t=new wg(e);e.modules.keyboard=t;e.events.onKeyPress=function(r,i){t.onKeyPress(r,i);return e.events};e.keyboard={isKeyPressed:function e(r){return t.isPressed(r)},resetKeys:function e(){t.resetKeys()}}});var wg=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._events.register(["keyUp","keyDown"]);this._binds=[];this._pressed=[];this._onKeyDown=function(e){var t=e.keyCode||e.which,i=r._binds[t];r._pressed[t]=true;if(i){for(var n=0;n<i.length;++n){var a=i[n],o=true;for(var s=0;s<a.keys.length;++s){var u=false,l=a.keys[s];for(var d=0;d<l.length;++d){if(r._pressed[l[d]]){u=true}}if(!u){o=false}}if(o){a.handler({domEvent:e})}}}r._events.fire("keyDown",{domEvent:e,key:Ag[t],code:t})};this._onKeyUp=function(e){var t=e.keyCode||e.which;r._pressed[t]=false;r._events.fire("keyUp",{domEvent:e,key:Ag[t],code:t})};this._onBlur=function(){return r._resetKeys()};this._dom.addWindowEventListener("keydown",this._onKeyDown);this._dom.addWindowEventListener("keyup",this._onKeyUp);this._dom.addWindowEventListener("visibilitychange",this._onBlur);this._dom.addWindowEventListener("blur",this._onBlur,false)};wg.prototype.resetKeys=function e(){this._resetKeys()};wg.prototype._resetKeys=function e(){var t=this;for(var r=0;r<this._pressed.length;++r){if(t._pressed[r]){t._pressed[r]=false;t._events.fire("keyUp",{key:Ag[r],code:r})}}};wg.prototype.onKeyPress=function e(t,r){var i=this;if(typeof t==="number"){t=[t]}else if(typeof t==="string"){t=t.split(" ")}else if(!Array.isArray(t)){throw new TypeError(t+" is not a number, string or array")}else if(t.length===0){throw new Error("the array should contain at least one element")}var n=[];t.forEach(function(e){if(typeof e==="number"){n.push([e])}else if(typeof e==="string"){var t=Eg[e];if(!t){throw new Error(e+" is not a valid key identifier")}n.push(t)}else{throw new TypeError(e+" is not a valid key identifier")}});var a=n.pop(),o={keys:n,handler:r};a.forEach(function(e){if(!i._binds[e]){i._binds[e]=[]}i._binds[e].push(o)})};wg.prototype.isPressed=function e(t){var r=this;if(typeof t==="number"){return this._pressed[t]}else if(typeof t==="string"){var i=Eg[t];if(i){for(var n=0;n<i.length;++n){if(r._pressed[i[n]]){return true}}}}return false};Ogma.extend(function(e){var t=new Tg(e);var r=e.modules.events;e.modules.captor=t;e.getHoveredElement=function(){return t.getPointedElement()};e.view.getElementAt=function(e){return t.getElementAt(e)};e.getPointerInformation=function(){return t.getCursorInformation()};Object.assign(e.events,{onMouseMove:function t(i){r.on("move",i);return e.events},onMouseButtonDown:function t(i){r.on("down",i);return e.events},onMouseButtonUp:function t(i){r.on("up",i);return e.events},onClick:function t(i){r.on("click",i);return e.events},onDoubleClick:function t(i){r.on("doubleClick",i);return e.events},onMouseWheel:function t(i){r.on("wheel",i);return e.events},onHover:function t(i){r.on("hover",i);return e.events},onUnhover:function t(i){r.on("unhover",i);return e.events},onDragStart:function t(i){r.on("dragStart",i);return e.events},onDragProgress:function t(i){r.on("dragProgress",i);return e.events},onDragEnd:function t(i){r.on("dragEnd",i);return e.events},onGestureStart:function t(i){r.on("gestureStart",i);return e.events},onGestureProgress:function t(i){r.on("gestureProgress",i);return e.events},onGestureEnd:function t(i){r.on("gestureEnd",i);return e.events}})});var Tg=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._camera=t.modules.camera;this._mouse=t.modules.mouse;this._events=t.modules.events;this._settings=t.modules.settings;this._spatial=t.modules.spatial;this._elt=null;this._hoveredElt=null;this._draggedElt=null;this._disabledCounter=0;this._x=undefined;this._y=undefined;this._accDx=0;this._accDy=0;this._timeout=null;this._buttons={left:{isPressed:false,isDragging:false},middle:{isPressed:false,isDragging:false},right:{isPressed:false,isDragging:false}};this._events.register(["move","down","up","click","doubleClick","hover","unhover","wheel","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]);this._settings.register("detect.nodes",true);this._settings.register("detect.edges",true);this._settings.register("detect.nodeTexts",true);this._settings.register("detect.edgeTexts",true);this._settings.register("detect.nodeErrorMargin",5);this._settings.register("detect.edgeErrorMargin",7);this._settings.register("detect.enableSpatialIndex",true);this._settings.register("detect.spatialIndexMarginRatio",3);this._events.on({"removeNodes removeEdges clear":function(){Og(r,r._x,r._y);if(!r._timeout){r._timeout=r._dom.setTimeout(function(){Mg(r,{x:r._x,y:r._y});r._timeout=null},0)}},"mouseMove touchMove virtualMove":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;Mg(r,{domEvent:i,x:n,y:a,source:kg(t)})},"mouseDown touchDown virtualDown":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";Ig(r,{domEvent:i,x:n,y:a,button:o,source:kg(t)})},"mouseUp touchUp virtualUp":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";Ng(r,{domEvent:i,x:n,y:a,button:o,source:kg(t)})},"mouseClick touchTap virtualClick":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";zg(r,{domEvent:i,x:n,y:a,button:o,source:kg(t)})},"mouseDoubleClick touchDoubleTap virtualDoubleClick":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";Pg(r,{domEvent:i,x:n,y:a,button:o,source:kg(t)})},"mouseWheel virtualWheel":function(e){var t=e.domEvent;var i=e.x;var n=e.y;var a=e.delta;r._x=i;r._y=n;Cg(r,"wheel",undefined,{domEvent:t,x:i,y:n,delta:a,source:"mouse",target:r._hoveredElt})},touchStartGesture:function(e){return r._events.fire("gestureStart",e)},touchProgressGesture:function(e){return r._events.fire("gestureProgress",e)},touchEndGesture:function(e){return r._events.fire("gestureEnd",e)},documentMouseMove:function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=kg(t);j(r._buttons,function(e,t){var s=e.isDragging;if(s){var u=r._setPointerPosition(n,a);var l=u.dx;var d=u.dy;Cg(r,"dragProgress",r._draggedElt,{domEvent:i,x:n,y:a,dx:l,dy:d,button:t,source:o})}})},documentMouseUp:function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";var s=kg(t);if(r._buttons[o].isDragging){Cg(r,"dragEnd",r._draggedElt,{domEvent:i,x:n,y:a,button:o,source:s});if(Lg(r)===0){r._draggedElt=null}var u=r._buttons[o];u.isDragging=false;u.isPressed=false}}})};Tg.prototype._storeDXY=function e(t,r){this._accDx=t;this._accDy=r};Tg.prototype._getStoredDXY=function e(){var t=this._accDx;var r=this._accDy;this._accDx=0;this._accDy=0;return{dx:t,dy:r}};Tg.prototype._setPointerPosition=function e(t,r){var i=t-this._x;var n=r-this._y;this._x=t;this._y=r;return{dx:i,dy:n}};Tg.prototype.triggerUnhover=function e(){this._hover=false;this._hoveredElt=null};Tg.prototype.triggerDetection=function e(){Dg(this,this._x,this._y);if(this._elt){this._hoveredElt=this._elt;this._hover=true}};Tg.prototype.getElementAt=function e(t,r){var i=t.x;var n=t.y;return Rg(this,i,n,r)};Tg.prototype.getPointedElement=function e(){return this._hoveredElt};Tg.prototype.getDraggedElement=function e(){return this._draggedElt};Tg.prototype.isAnyButtonPressed=function e(){return Fg(this)>0};Tg.prototype.isButtonPressed=function e(t){return this._buttons[t].isPressed};Tg.prototype.isLeftPressed=function e(){return this.isButtonPressed("left")};Tg.prototype.getCursorPosition=function e(){return{x:this._x,y:this._y}};Tg.prototype.getCursorInformation=function e(){return{x:this._x,y:this._y,target:this._hoveredElt}};Tg.prototype.setDetectionEnabled=function e(value){this._disabledCounter=Math.max(0,this._disabledCounter+(value?-1:1))};function kg(e){if(e.indexOf("touch")===0){return"touch"}else{return"mouse"}}function Cg(e,t,r,i){i.target=r||null;e._events.fire(t,i);return i}function Ig(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;Dg(e,i,n);if(e._elt!==e._hoveredElt){Og(e,i,n)}var s=e._buttons[a];e._hoveredElt=e._elt;e._hoveredEltIsNode=e._elt&&e._elt.isNode;s.isPressed=true;Cg(e,"down",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function Mg(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.source;var o=e._x;var s=e._y;var u=e._setPointerPosition(i,n);var l=u.dx;var d=u.dy;e._events.fire("move",{domEvent:r,x:i,y:n,dx:l,dy:d,source:a});j(e._buttons,function(t,u){if(t.isPressed){if(!t.isDragging){t.isDragging=true;if(e._hoveredElt){if(e._hover){Cg(e,"unhover",e._hoveredElt,{domEvent:r,x:i,y:n,source:a});e._hover=false}}if(!e._draggedElt){e._draggedElt=e._hoveredElt;e._draggedEltIsNode=e._hoveredEltIsNode}e._storeDXY(l,d);Cg(e,"dragStart",e._draggedElt,{domEvent:r,x:o,y:s,button:u,source:a})}else{var h=e._getStoredDXY();l+=h.dx;d+=h.dy;Cg(e,"dragProgress",e._draggedElt,{domEvent:r,x:i,y:n,dx:l,dy:d,button:u,source:a})}}});if(!r||e._graphics.getDomElement().contains(r.target)){Dg(e,i,n)}if(e._elt!==e._hoveredElt){if(e._hoveredElt&&e._hover){e._hover=true;Cg(e,"unhover",e._hoveredElt,{domEvent:r,x:i,y:n,source:a})}e._hoveredElt=e._elt;e._hoveredEltIsNode=e._isNode;if(e._elt){e._hover=true;Cg(e,"hover",e._hoveredElt,{domEvent:r,x:i,y:n,source:a})}}}function Lg(e){return B(e._buttons).reduce(function(e,t){var r=t.isDragging;if(r===void 0)r=false;return e+r},0)}function Fg(e){return B(e._buttons).reduce(function(e,t){var r=t.isPressed;if(r===void 0)r=false;return e+r},0)}function Ng(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;var s=e._buttons[a];if(!s.isPressed){return}if(s.isDragging){Cg(e,"dragEnd",e._draggedElt,{domEvent:r,x:i,y:n,button:a,source:o});s.isDragging=false;if(Lg(e)===0){e._draggedElt=null}}s.isPressed=false;Dg(e,i,n);Cg(e,"up",e._elt,{domEvent:r,x:i,y:n,button:a,source:o});if(!Fg(e)&&!e._hover&&o!=="touch"){e._hoveredElt=e._elt;e._hoveredEltIsNode=e._isNode;if(e._hoveredElt){Cg(e,"hover",e._hoveredElt,{domEvent:r,x:i,y:n,source:o});e._hover=true}}}function zg(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;Cg(e,"click",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function Pg(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;Cg(e,"doubleClick",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function Og(e,t,r){var i=null;j(e._buttons,function(n,a){var o=n.isDragging;if(o){Cg(e,"dragEnd",e._draggedElt,{domEvent:i,x:t,y:r,button:a})}});if(e._hover&&e._hoveredElt){Cg(e,"unhover",e._hoveredElt,{domEvent:i,x:t,y:r})}Object.keys(e._buttons).forEach(function(t){var r=e._buttons[t];r.isPressed=false;r.isDragging=false});e._hover=false;e._hoveredElt=null;e._draggedElt=null}function Dg(e,t,r,i){e._elt=Rg(e,t,r,i);e._isNode=!e._elt||e._elt.isNode}function Rg(e,t,r,i){if(e._disabledCounter!==0||t===undefined||r===undefined){return null}var n=e._settings;var a=n.get("detect.enableSpatialIndex");var o=n.get("detect.nodeErrorMargin");var s=n.get("detect.edgeErrorMargin");var u=n.get("detect.nodes");var l=n.get("detect.edges");var d={x:t,y:r};var h=null,f,c;if(!i&&a){if(u||l){var v=n.get("detect.spatialIndexMarginRatio");var g=Math.max(o*v,s*v);var p=e._spatial.queryRawProjected(t-g,r-g,t+g,r+g);f=p.nodes;c=p.edges}}if(u){h=e._graphics.detectNode({position:d,indexes:f,margin:o,texts:n.get("detect.nodeTexts")})}if(!h&&l){h=e._graphics.detectEdge({position:d,indexes:c,margin:s,texts:n.get("detect.edgeTexts")})}return h}Ogma.extend(function(e){e.modules.sync=new Bg(e)});var Bg=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._captor=t.modules.captor;this._delayedCalls=[];this._idIdle=function(){return!r._captor.isAnyButtonPressed()&&!r._dom.isPlayingFrame()};this._events.on({"down up beforeNewFrame newFrame":function(){r._delayedCalls.forEach(function(e){return e.reset()})}})};Bg.prototype._nextTimeIdle=function e(t){var r=this;var i=new jg(this._dom,this._idIdle,t);this._delayedCalls.push(i);return i.whenDone().then(function(){r._delayedCalls.splice(r._delayedCalls.indexOf(i),1)})};Bg.prototype.debounceIdle=function e(t,r){var i=this;if(r===void 0)r=0;var n=false;var a=[];var o=function(){var e=a;n=false;a=[];t();e.forEach(function(e){return e()})};return function(){return new Promise(function(e){a.push(e);if(!n){n=true;i._nextTimeIdle(r).then(o)}})}};var jg=function e(t,r,i){var n=this;this._dom=t;this._promise=new Promise(function(e){return n._resolve=e});this._isIdle=r;this._delay=i;this._timeout=null;this._done=false;this._startTimeout()};jg.prototype._startTimeout=function e(){var t=this;this._timeout=this._dom.setTimeout(function(){if(t._isIdle()){t._done=true;t._resolve()}else{t._startTimeout()}},this._delay)};jg.prototype.reset=function e(){if(!this._done){this._dom.clearTimeout(this._timeout);this._startTimeout()}};jg.prototype.whenDone=function e(){return this._promise};var Ug=40;var Vg="quadraticInOut";var Gg=200;Ogma.atInit(function(e){e.view.locateGraph()});Ogma.extend(function(e){var t=new Wg(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.locate=t;r.prototype.locate=function(e){return t.locateElements(this,e)};n.prototype.locate=function(e){return t.locateElements(this,e)};i.prototype.locate=function(e){return t.locateElements(this,e)};a.prototype.locate=function(e){return t.locateElements(this,e)};r.prototype.getBoundingBox=function(){return t.getBoundingBox(this)};n.prototype.getBoundingBox=function(){return t.getBoundingBox(this)};i.prototype.getBoundingBox=function(e){return t.getBoundingBox(this,e)};a.prototype.getBoundingBox=function(e){return t.getBoundingBox(this,e)};e.view.locateGraph=function(e){return t.locateGraph(e)};e.view.locateRawGraph=function(e,r){return t.locateRawGraph(e,r)};e.view.getGraphBoundingBox=function(){return t.getGraphBoundingBox()}});var Wg=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._events=t.modules.events;this._camera=t.modules.camera;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._settings=t.modules.settings;this._sync=t.modules.sync;this._cacheValid=true;this._cachedGraphBoundingBox=new Mr;this._scheduleCacheUpdate=this._sync.debounceIdle(function(){r._updateCache()},50);this._events.on({"addNodes removeNodes addEdges removeEdges excludedStateChange clear updateAttributes":function(){r._invalidCache()}})};Wg.prototype.locateGraph=function e(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t)};Wg.prototype.locateElements=function e(t,r){return this._locateBoundingBox(this.getBoundingBox(t),r)};Wg.prototype.locateRawGraph=function e(t,r){return this._locateBoundingBox(this._getRawGraphBoundingBox(t),r)};Wg.prototype.getGraphBoundingBox=function e(){if(!this._cacheValid){this._updateCache()}return Object.assign({},this._cachedGraphBoundingBox)};Wg.prototype.forceInvalidCache=function e(){this._invalidCache()};Wg.prototype._invalidCache=function e(){this._cacheValid=false};Wg.prototype._updateCache=function e(){this._cacheValid=true;this._cachedGraphBoundingBox=this.getBoundingBox(this._ogma.getNodes())};Wg.prototype.getBoundingBox=function e(t,r){if(t.isNode){return this._getNodesBoundingBox(t.toList())}else{return this._getEdgesBoundingBox(t.toList(),r)}};Wg.prototype._getNodesBoundingBox=function e(t){this._graphics.forceAttributesComputation();var r=this._graphics.getNodeAttributes();var i=[];var n=[];var a=[];var o=[];for(var s=0;s<t.size;++s){var u=t._indexes[s];var l=r.x.get(u);var d=r.y.get(u);var h=r.radius.get(u)*2;if(r.scalingMethod.get(u)==="scaled"){a.push(h)}else{o.push(h)}i.push(l);n.push(d)}return new Mr({xValues:i,yValues:n,scaledSizeValues:a,fixedSizeValues:o})};Wg.prototype._getEdgesBoundingBox=function e(t,r){if(r===void 0)r=false;this._graphics.forceAttributesComputation();var i=this._graphics.getEdgeAttributes();var n=this._graphics.getNodeAttributes();var a={x1:0,y1:0,x2:0,y2:0};var o={x:0,y:0};var s={minX:0,minY:0,maxX:0,maxY:0};var u=[];var l=[];var d=[];var h=[];for(var f=0;f<t.size;++f){var c=t._indexes[f];var v=i.source.get(c);var g=i.target.get(c);var p=i.curvature.get(c);var _=n.x.get(v);var y=n.y.get(v);var m=n.scalingMethod.get(v)==="scaled";var x=n.radius.get(v)*2;var b=n.x.get(g);var S=n.y.get(g);var A=n.scalingMethod.get(g)==="scaled";var E=n.radius.get(g)*2;if(m){d.push(x)}else{h.push(x)}if(A){d.push(E)}else{h.push(E)}if(r||p===0){u.push(_,b);l.push(y,S)}else if(v===g){var w=x/2;oa(_,y,p,w,0,a);ca(_,y,a.x1,a.y1,a.x2,a.y2,b,S,s);u.push(s.minX,s.maxX);l.push(s.minY,s.maxY)}else{aa(_,y,b,S,p,o);fa(_,y,o.x,o.y,b,S,s);u.push(s.minX,s.maxX);l.push(s.minY,s.maxY)}}return new Mr({xValues:u,yValues:l,scaledSizeValues:d,fixedSizeValues:h})};Wg.prototype._getRawGraphBoundingBox=function e(t){return new Mr({xValues:t.nodes.map(function(e){return e.x||0}),yValues:t.nodes.map(function(e){return e.y||0}),scaledSizeValues:t.nodes.map(function(e){return+(e.attributes&&e.attributes.radius)||5})})};Wg.prototype._computeCameraConfig=function e(t,r,i){if(typeof r==="number"){r={left:r,right:r,top:r,bottom:r}}var n=$a(r.left,Ug);var a=$a(r.right,Ug);var o=$a(r.top,Ug);var s=$a(r.bottom,Ug);var u=this._dom.getDimensions();var l=n+a;var d=o+s;var h=(u.width-l)/(t.width+t.maxScaledSize);var f=(u.height-d)/(t.height+t.maxScaledSize);var c=(u.width-l-t.maxFixedSize)/t.width;var v=(u.height-d-t.maxFixedSize)/t.height;var g=i/t.maxScaledSize||NaN;var p=Yo([h,f,c,v,g]);return{x:t.cx+(a-n)/(p*2),y:t.cy+(s-o)/(p*2),zoom:p}};Wg.prototype._locateBoundingBox=function e(t,r){if(r===void 0)r={};if(isNaN(t.cx)){return Promise.resolve()}var i=r.padding;if(i===void 0)i={};var n=r.easing;if(n===void 0)n=Vg;var a=r.duration;if(a===void 0)a=0;var o=r.maxNodeSizeOnScreen;if(o===void 0)o=Gg;var s=r.ignoreZoomLimits;if(s===void 0)s=false;var u=this._computeCameraConfig(t,i,o);var l=u.x;var d=u.y;var h=u.zoom;var f=h/this._camera.getZoom();return this._moveCamera(l,d,h,a,n,f,s)};Wg.prototype._moveCamera=function e(t,r,i,n,a,o,s){if(o>1.01){this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s});return this._camera.setZoom(i,{duration:n,easing:a,ignoreZoomLimits:s,startAfter:.5})}else if(o<.99){this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s,startAfter:.5});return this._camera.setZoom(i,{duration:n,easing:a,ignoreZoomLimits:s})}else{return this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s})}};Wg.prototype.computeConfigForBounds=function e(t,r){if(r===void 0)r={};var i=r.padding;if(i===void 0)i={};var n=r.maxNodeSizeOnScreen;if(n===void 0)n=Gg;return this._computeCameraConfig(t,i,n)};Wg.prototype.layoutDataBoundingBox=function e(t){var r=t.x;var i=t.y;var n=t.indexes;var a=this._graphics.getNodeAttributes();var o=[];var s=[];var u=[];var l=[];for(var d=0;d<n.length;++d){var h=n[d];var f=r[d];var c=i[d];var v=a.radius.get(h)*2;var g=a.scalingMethod.get(h)==="scaled";o.push(f);s.push(c);if(g){u.push(v)}else{l.push(v)}}return new Mr({xValues:o,yValues:s,scaledSizeValues:u,fixedSizeValues:l})};Ogma.extend(function(e){e.modules.imports=new Hg(e);e.fetch=function(e){return je(e)}});var Hg=function e(t){this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._locate=t.modules.locate;this._dom=t.modules.dom;this._camera=t.modules.camera;this._importers={}};Hg.prototype.from=function e(t,r){var i=this._importers[t];if(!i){throw new Error(t+" is not a valid importer.")}return new Promise(function(e,t){try{var n=i.translate(r);e(n)}catch(e){t(e)}})};Hg.prototype.register=function e(t,r){if(typeof r==="function"){r={translate:r,webWorkerCompatible:false}}ro(this._importers,t,r,"importer")};var Xg=pp(" ");var qg=pp("<");var Yg=pp(">");var Zg=pp('"');var Kg=pp("\n");var Qg=pp("\r");var Jg=pp("/");var $g=pp("\\");var ep=pp("a");var tp=pp("z");var rp=pp("A");var ip=pp("Z");var np=pp("0");var ap=pp("9");var op=pp(":");var sp=-1,up=-2,lp=-3,dp=-4;function hp(e){var t=new Int32Array(e.length);for(var r=0,i=e.length;r<i;++r){t[r]=e.charCodeAt(r)}return t}function fp(e,t,r,i){var n=i.length;if(r-t!==n){return false}for(var a=0;a<n;++a){if(e[t+a]!==i[a]){return false}}return true}function cp(e,t,r,i){return gp(e.tags,t,r,i)}function vp(e,t,r,i){return gp(e.attributes,t,r,i)}function gp(e,t,r,i){var n=e.length;for(var a=0;a<n;++a){if(fp(t,r,i,e[a])){return a}}e.push(t.slice(r,i));return n}function pp(e){return e.charCodeAt(0)}function _p(e,t,r){var i,n,a;r=xp(t,r);i=t[r];if(i===Yg||i===Jg){return r}n=r;r=Sp(t,r);a=vp(e,t,n,r);while(t[r]!==Zg){++r}++r;n=r;while((i=t[r])!==Zg){if(i===$g){++r}++r}e.tokens.push(lp,a,n,r);return r+1}function yp(e,t){var r,i,n,a,o=e.length;var s={tags:[],attributes:[],tokens:[]};var u=s.tokens;t=xp(e,t);while(t<o){a=e[t];if(a===qg){t=xp(e,++t);if(e[t]===Jg){u.push(up);while(e[++t]!==Yg){}}else{r=t;t=Sp(e,r);n=cp(s,e,r,t);u.push(sp,n);a=e[t];while(a!==Yg&&a!==Jg){t=_p(s,e,t);a=e[t]}if(a===Jg){u.push(up);while(e[++t]!==Yg){}}}t+=1}else{r=t;while(e[++t]!==qg){}i=t-1;while(mp(e[i])){--i}u.push(dp,r,i+1)}t=xp(e,t)}return s}function mp(e){return e===Xg||e===Kg||e===Qg}function xp(e,t){while(mp(e[t])){++t}return t}function bp(e){return e>=ep&&e<=tp||e>=rp&&e<=ip||e===op||e>=np&&e<=ap}function Sp(e,t){while(bp(e[t])){++t}return t}function Ap(e,t){var r=["this.id = undefined;","this.attributes = {","  text: undefined,","  color: undefined,","  "+(e?"radius":"width")+": undefined",e?"  ,x: undefined":"",e?"  ,y: undefined":"","};"];if(!e){r.push("this.source = undefined;","this.target = undefined;")}var i=Object.keys(t);if(i.length){r.push("  this.data = {")}for(var n=0;n<i.length;++n){var a=i[n],o=t[a],s=o.title;r.push('  "'+s+'": '+(o.default!==undefined?JSON.stringify(o.default):undefined)+(n===i.length-1?"":","))}if(i.length){r.push("};")}return new Function(r.join("\n"))}function Ep(e){if(e.indexOf("\\")===-1){return e}e=e.replace(/\\"/g,'"');return e}function wp(e){if(e.indexOf("<gexf")===-1){throw new Error("not a GEXF file")}var t=hp(e),r=yp(t,e.indexOf("<gexf ")),i={},n={};r.tags.forEach(function(e,t){var r=String.fromCharCode.apply(null,e);i[r]=t});r.attributes.forEach(function(e,t){var r=String.fromCharCode.apply(null,e);n[r]=t});var a=i.attributes;var o=i.attribute;var s=i.node;var u=i.edge;var l=i.default;var d=i["viz:position"];var h=i["viz:size"];var f=i["viz:color"];var c=i.attvalue;var v=n.class;var g=n.id;var p=n.type;var _=n.title;var y=n.label;var m=n.source;var x=n.target;var b=n.x;var S=n.y;var A=n.r;var E=n.g;var w=n.b;var T=n.a;var k=n.value;var C=n.for;var I=n.weight;var M=4;var L=5;var F=6;var N=1;var z=2;var P=3;var O=4;var D=5;var R={float:N,double:N,integer:z,boolean:P,string:O,"list-string":D};var B=0,j=r.tokens,U=j.length;var V=new Array(16);var G=0;var W=0;var H=0;var X=true;var q={};var Y={};var Z=null;var K=null;var Q=null;var J=undefined;var $=null;var ee=0,te=0,re=0,ie=1;var ne=null;var ae=undefined;var oe=false;var se=true;var ue=null;var le=null;var de=[];var he=[];var fe=0;var ce=null;while(B<U){var ve=j[B];if(ve===sp){W=G;G=j[B+1];V[H]=G;H+=1;if(G===s){if(!ue){ue=Ap(true,q)}$=new ue;se=true;ce=q}else if(G===u){if(!le){le=Ap(false,Y)}$=new le;se=false;ce=Y}B+=2}else if(ve===up){if(Z&&G===o){ce=X?q:Y;var ge=R[K];var value=J;if(value){if(ge===N){value=+value}else if(ge===z){value=+value|0}else if(ge===P){value=value==="true"}else if(ge===D){value=value.split(" ").filter(function(e){return e})}}ce[Z]={title:Q||Z,type:ge,default:value};Z=null;Q=null;K=null;J=undefined}else if(G===s&&H===M){if(oe){$.attributes.color="rgba("+ee+", "+te+", "+re+", "+ie+")";ee=0;te=0;re=0;ie=1;oe=false}if(!$.id){$.id=++fe}de.push($)}else if(G===u&&H===M){if(!$.id){$.id=++fe}he.push($)}else if(G===c&&H===F&&ne){var pe=(se?q:Y)[ne];if(pe){if(ae===undefined){ae=pe.default}else{ge=pe.type;if(ge){if(ge===N){ae=+ae}else if(ge===z){ae=+ae|0}else if(ge===P){ae=ae==="true"}else if(ge===D){ae=ae.split(" ").filter(function(e){return e}).map(function(e){return Ep(e)})}else{ae=Ep(ae)}}}$.data[ce[ne].title]=ae}ne=null;ae=null}H-=1;G=W;W=V[H-2];B+=1}else if(ve===lp){var _e=j[B+1];value=e.substring(j[B+2],j[B+3]);if(G===a){if(_e===v){X=value!=="edge"&&value!=="edges"}}else if(G===o){if(_e===g){Z=value}else if(_e===p){K=value}else if(_e===_){Q=value}}else if((G===s||G===u)&&H===M){if(_e===g){$.id=value}else if(_e===y){$.attributes.text=value}else if(_e===m){$.source=value}else if(_e===x){$.target=value}else if(_e===I){$.attributes.width=+value}}else if(G===d&&H===L){if(_e===b){$.attributes.x=+value}else if(_e===S){$.attributes.y=-value}}else if(G===f&&H===L){oe=true;if(_e===A){ee=value}else if(_e===E){te=value}else if(_e===w){re=value}else if(_e===T){ie=value}}else if(G===h&&H===L){if(_e===k){if(se){$.attributes.radius=+value}else{$.attributes.width=+value}}}else if(G===c&&H===F){if(_e===C||_e===g){ne=value}else if(_e===k){ae=value}}B+=4}else if(ve===dp){value=e.substring(j[B+1],j[B+2]);if(G===l){J=value}B+=3}else{throw new Error("at index "+B+": token "+ve)}}return{nodes:de,edges:he}}Ogma.extend(function(e){e.modules.imports.register("gexf",{translate:wp,webWorkerCompatible:true});e.parse.gexf=function(t){return e.modules.imports.from("gexf",t)};e.parse.gexfFromUrl=function(t){return je(t).then(function(t){return e.modules.imports.from("gexf",t)})}});function Tp(e,t,r){r=r||t;if(t in e){if(!e.attributes){e.attributes={}}e.attributes[r]=e[t]}}function kp(e){var t=JSON.parse(e);var r=t.nodes||[];var i=t.edges||[];for(var n=0,a=r;n<a.length;n+=1){var o=a[n];if(typeof o.size==="string"){o.size=+o.size}if(typeof o.x==="string"){o.x=+o.x}if(typeof o.y==="string"){o.y=+o.y}Tp(o,"x");Tp(o,"y");Tp(o,"size","radius");Tp(o,"color");Tp(o,"text")}for(var s=0,u=i;s<u.length;s+=1){var l=u[s];if(typeof l.size==="string"){l.size=+l.size}Tp(l,"size","width");Tp(l,"color");Tp(l,"text")}return t}Ogma.extend(function(e){e.modules.imports.register("json",{translate:kp,webWorkerCompatible:true});e.parse.json=function(t){return e.modules.imports.from("json",t)};e.parse.jsonFromUrl=function(t){return je(t).then(function(t){return e.modules.imports.from("json",t)})}});var Cp=function e(){this._decimalPowerOfTwo=new Uint8Array(20);this._binaryNumber=new Uint8Array(64);this._decimalNumber=new Uint8Array(20)};Cp.prototype._addDecimalNumbers=function e(t,r){var i=0;for(var n=0;n<20;++n){var a=i+t[n]+r[n];i=+(a>=10);t[n]=a%10}};Cp.prototype._loadNumberInBits=function e(t,r,i){for(var n=0;n<32;++n){i[n]=+!!(t&1<<n)}for(var a=0;a<32;++a){i[a+32]=+!!(r&1<<a)}return i};Cp.prototype._negateBinaryNumber=function e(t){for(var r=0;r<64;++r){t[r]^=1}for(var i=0;i<64&&!(t[i]^=1);++i){}};Cp.prototype.int64ToString=function e(t){var r=this;var i=t.low;var n=t.high;if(i===0&&n===0){return"0"}this._loadNumberInBits(i,n,this._binaryNumber);this._decimalNumber.fill(0);this._decimalPowerOfTwo.fill(0);this._decimalPowerOfTwo[0]=1;var a=this._binaryNumber[63]===1;if(a){this._negateBinaryNumber(this._binaryNumber)}for(var o=0;o<64;++o){if(r._binaryNumber[o]){r._addDecimalNumbers(r._decimalNumber,r._decimalPowerOfTwo)}r._addDecimalNumbers(r._decimalPowerOfTwo,r._decimalPowerOfTwo)}var s=[];var u=this._decimalNumber.length-1;if(a){s.push("-")}while(!this._decimalNumber[u]){u-=1}for(var l=u;l>=0;--l){s.push(r._decimalNumber[l])}return s.join("")};Ogma.extend(function(e){e.modules.imports.register("neo4j",Op);e.parse.neo4j=function(t){return e.modules.imports.from("neo4j",t)}});var Ip=new Cp;function Mp(e){return Ip.int64ToString(e)}function Lp(e){if(typeof e!=="object"||e===null){throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. "+"Please make sure that your Cypher query returns nodes and edges, not values.")}var t=Object.keys(e.properties);for(var r=0;r<t.length;r++){var i=t[r];var n=e.properties[i];if(typeof n==="object"&&"high"in n&&"low"in n){n=Mp(n)}}if(typeof e.identity!=="number"){e.identity=Mp(e.identity);if("start"in e&&"end"in e){e.start=Mp(e.start);e.end=Mp(e.end)}}}var Fp=function(e){return"start"in e&&"end"in e&&"type"in e};var Np=function(e){return"segments"in e};function zp(e,t){t.segments.forEach(function(t){Pp(e,t.start);Pp(e,t.end);Pp(e,t.relationship)})}function Pp(e,t){if(t){if(Array.isArray(t)){t.forEach(function(t){return Pp(e,t)})}else if(Np(t)){zp(e,t)}else{Lp(t);if(Fp(t)){e.edges.push({id:t.identity,source:t.start,target:t.end,data:{neo4jType:t.type,neo4jProperties:t.properties}})}else{e.nodes.push({id:t.identity,attributes:{x:Math.random()*100,y:Math.random()*100},data:{neo4jLabels:t.labels,neo4jProperties:t.properties}})}}}}function Op(e){var t={nodes:[],edges:[]};e.records.forEach(function(e){e.forEach(function(e){Pp(t,e)})});return t}Ogma.extend(function(e){e.modules.imports.register("janus",Dp);e.parse.janus=function(t){return e.modules.imports.from("janus",t)}});function Dp(e){var t=[],r=[];var i=function(e){if(!e||typeof e!=="object"){return}if(e.type==="vertex"){var n={};if(e.properties){Object.keys(e.properties).forEach(function(t){n[t]=e.properties[t][0].value})}t.push({id:e.id+"",data:{id:e.id+"",categories:[e.label],properties:n}})}else if(e.type==="edge"){r.push({id:e.id+"",source:e.inV+"",target:e.outV+"",data:{id:e.id+"",type:e.label,properties:e.properties||{}}})}else if(Array.isArray(e)){e.forEach(function(e){return i(e)})}else{Object.keys(e).forEach(function(t){return i(e[t])})}};i(e);return{nodes:t,edges:r}}Ogma.extend(function(e){e.modules.labels=new t_(e.modules)});var Rp=1.2;var Bp=5;var jp=Math.PI/2;var Up="topDown";var Vp="bottomUp";var Gp=.25;var Wp=200;var Hp=6;var Xp=5;var qp={left:-1,right:1,top:0,bottom:0,center:0};var Yp={left:0,right:0,top:-1,bottom:1,center:0};var Zp=4;var Kp={left:-1,right:0,top:-1/2,bottom:-1/2,center:-1/2};var Qp={left:-1/2,right:-1/2,top:-1,bottom:0,center:-1/2};var Jp={x1:0,y1:0,x2:0,y2:0};var $p={x:0,y:0};var e_=["x","y","radius","width","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"];var t_=function e(t){var r=this;var i=t.dom;var n=t.graph;var a=t.graphics;var o=t.camera;var s=t.events;var u=t.settings;var l=t.sync;var d=t.spatial;this._dom=i;this._graph=n;this._graphics=a;this._camera=o;this._events=s;this._settings=u;this._sync=l;this._spatial=d;this._engine=a.getGraphicsEngine();this._textBBoxes=[];this._textQuad=new qa(function(e){var t=Hp;var i=t*e;return r._textBBoxes.slice(i,i+t)},Bp);this._enabled=false;this._forceEnabled=false;this._events.register(["labelCollisionsRemoved"]);this.setRate(Wp);u.register("texts.preventOverlap",true,function(e){return r._onToggle(e)});u.register("texts.debug",false,function(e){return r._toggleDebug(e)});u.register("texts.removalStrategy",Up);this._rects=[];this._events.on({"addNodes addEdges":function(e){var t=e.nodes||e.edges;if(r._settings.get("texts.preventOverlap")){r._graphics.setTextHidden(t,true)}},viewChanged:function(){r._update()},updateAttributes:function(e){var t=e.nodeAttributes.concat(e.edgeAttributes);if(t.some(function(e){return e_.includes(e)})){r._update()}},setContainer:function(e){var t=e.element;if(t){r._enable()}else{r._disable()}}})};t_.prototype.setRate=function e(t){var r=this;this._updateDebounced=this._sync.debounceIdle(function(){return r._updateLabels()},t)};t_.prototype._update=function e(){if(this._enabled||this._forceEnabled){this._updateDebounced()}};t_.prototype._enable=function e(){this._enabled=true;this._update()};t_.prototype._disable=function e(){this._enabled=false};t_.prototype.forceEnable=function e(){this._forceEnabled=true};t_.prototype._onToggle=function e(t){if(t){this._update()}else{this._reset()}};t_.prototype._toggleDebug=function e(t){if(t){this._canvas=ke();this._graphics.addCanvas(this._canvas);this._ctx=this._canvas.getContext("2d");this._update()}else if(this._canvas){this._graphics.removeCanvas(this._canvas);this._canvas=this._ctx=null}};t_.prototype.update=function e(){this._update()};t_.prototype._onCameraMove=function e(){this._update()};t_.prototype.forceUpdate=function e(){this._updateLabels()};t_.prototype._updateLabels=function e(){if(!this._settings.get("texts.preventOverlap")){return}this._intersects=[];var t=this._textQuad;t.clear();var r=this._textBBoxes=[];var i=this._rects=[];var n=this._camera.getAngle();var a=this._camera.getProjectedScreenBounds(Gp);var o=this._settings.get("texts.removalStrategy")===Vp;this._screen=a;var s={angle:n,zoom:this._camera.getZoom(),sin:Math.sin(n),cos:Math.cos(n),screen:a};var u={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]}};var l=this._spatial.queryRaw(a[0],a[1],a[2],a[3]);var d=l.nodes;var h=l.edges;this._fillNodeTexts(d,t,r,i,s,o,u);this._fillEdgeTexts(h,t,r,i,s,o,u);this._clearOverlaps(u);if(this._settings.get("texts.debug")){this.drawAll(s)}};t_.prototype._fillNodeTexts=function e(t,r,i,n,a,o,s){var u=this;var l=this._graph;var d=s.remove.nodes;var h=s.remove.edges;var f=s.redraw.nodes;var c=a.angle;var v=a.zoom;var g=a.sin;var p=a.cos;var _=l.getNodeAttribute("layer");E(t,_);var y=l.getAttributes(true,["x","y","radius","innerStroke.width","outerStroke.width","scalingMethod","text.content","text.position","text.size","text.font","text.style","text.maxLineLength","text.scaling","text.scale","text.minVisibleSize","text.padding","text.margin","animationDuration"]);var m=y[0];var x=y[1];var b=y[2];var S=y[3];var A=y[4];var w=y[5];var T=y[6];var k=y[7];var C=y[8];var I=y[9];var M=y[10];var L=y[11];var F=y[12];var N=y[13];var z=y[14];var P=y[15];var O=y[16];var D=y[17];var R,B;for(var j=0,U=t.length;j<U;j++){R=t[j];var V=D.get(R);var G=T.get(R);if(G===null||G===""||V){continue}var W=b.get(R);var H=z.get(R);if(W*2*v<H){continue}if(w.get(R)==="fixed"){W/=v}var X=m.get(R);var q=x.get(R);if(typeof G==="number"){G=G.toString()}var Y=!F.get(R);var Z=k.get(R);var K=P.get(R);var Q=N.get(R);var J=(Y?C.get(R):Q*W)*Rp;var $=M.get(R);var ee=I.get(R);var te=L.get(R);var re=Al(G,te);var ie=re.lines;var ne=K+S.get(R)+A.get(R)+O.get(R);var ae=qp[Z];var oe=Yp[Z];var se=u._engine.measureText(G,ee,$,J).width/ie;var ue=ie*J*Rp;var le=se/2/v;var de=ue/2/v;var he=ne/v;var fe=Kp[Z]*se;var ce=Qp[Z]*ue;if(Y){fe/=v;ce/=v}fe=fe+ae*he+le+ae*W;ce=ce+oe*he+de+oe*W;var ve=pa(X-le,q-de,se/v,ue/v,-c,g,-p);var ge=[X-le,q-de,se/v,ue/v,c];var pe=p*fe-g*ce;var _e=g*fe+p*ce;ve[0]+=pe;ve[1]+=_e;ve[2]+=pe;ve[3]+=_e;ge[0]+=pe;ge[1]+=_e;var ye=r.query(ve[0],ve[1],ve[2],ve[3]);if(ye.length!==0){var me=false;var xe=_a(ge[0],ge[1],ge[2],ge[3],ge[4]);for(var be=0;be<ye.length;be++){var Se=ye[be];var Ae=Se*Xp;var Ee=_a(n[Ae],n[Ae+1],n[Ae+2],n[Ae+3],n[Ae+4]);if(Fi(xe,Ee)){u._intersects.push(xe,Ee);me=true;if(o){r.remove(Se);if(i[Se*Hp+4]===1){d.push(i[Se*Hp+5])}else{h.push(i[Se*Hp+5])}}else{break}}}if(me&&!o){d.push(R);continue}}f.push(R);B=i.length/Hp;i.push(ve[0],ve[1],ve[2],ve[3],1,R);r.insert(B);n.push(ge[0],ge[1],ge[2],ge[3],ge[4])}};t_.prototype._fillEdgeTexts=function e(t,r,i,n,a,o,s){var u=this;var l=this._graph;var d,h;var f=s.remove.nodes;var c=s.remove.edges;var v=s.redraw.edges;var g=a.angle;var p=a.zoom;var _=l.getAttributes(true,["x","y","radius"]);var y=_[0];var m=_[1];var x=_[2];var b=l.getEdgeAttribute("layer");E(t,b);var S=Math.PI;var A=this._graph.getAttributes(false,["source","target","width","curvature","scalingMethod"]);var w=A[0];var T=A[1];var k=A[2];var C=A[3];var I=A[4];var M=this._graph.getAttributes(false,["text.content","text.scaling","text.size","text.font","text.style","text.scale","text.maxLineLength","text.padding","animationDuration","text.minVisibleSize"]);var L=M[0];var F=M[1];var N=M[2];var z=M[3];var P=M[4];var O=M[5];var D=M[6];var R=M[7];var B=M[8];var j=M[9];for(var U=0,V=t.length;U<V;U++){d=t[U];var G=B.get(d);var W=L.get(d);if(W===null||W===""||G){continue}var H=w.get(d);var X=T.get(d);var q=k.get(d);var Y=C.get(d);var Z=j.get(d);if(q*p<Z){continue}if(I.get(d)==="fixed"){q/=p}var K=(y.get(H)+y.get(X))/2;var Q=(m.get(H)+m.get(X))/2;if(typeof W==="number"){W=W.toString()}var J=!F.get(d);var $=O.get(d);var ee=z.get(d);var te=(J?N.get(d):$*q)*Rp;var re=P.get(d);var ie=D.get(d);var ne=R.get(d);var ae=y.get(H),oe=m.get(H);var se=y.get(X),ue=m.get(X);var le=void 0;if(H===X){le=S/4-g;oa(ae,oe,Y,x.get(H),0,Jp);da(.5,ae,oe,se,ue,Jp.x1,Jp.y1,Jp.x2,Jp.y2,$p);K=$p.x;Q=$p.y;ne*=-p}else if(Y===0){le=ti(ae,oe,se,ue)-g}else{le=ti(ae,oe,se,ue)-g;aa(ae,oe,se,ue,Y,Jp);sa(.5,ae,oe,se,ue,Jp.x,Jp.y,$p);K=$p.x;Q=$p.y}var de=ne+Zp;var he=Al(W,ie);var fe=he.lines;var ce=u._engine.measureText(W,ee,re,te).width*Rp/fe;var ve=fe*te;var ge=ce/p/2;var pe=ve/p/2;var _e=Math.abs(le)<jp?1:-1;var ye=_e*(de/p+q/2+pe);var me=[K-ge,Q-pe,K+ge,Q+pe,le+g];ya(me,-(le+g),-ye,me);me[2]=me[2]-me[0];me[3]=me[3]-me[1];le=S-le-g;var xe=pa(K-ge,Q-pe,ge*2,pe*2,le);ya(xe,le,ye,xe);var be=r.query(xe[0],xe[1],xe[2],xe[3]);if(be.length){var Se=false;var Ae=_a(me[0],me[1],me[2],me[3],me[4]);for(var Ee=0;Ee<be.length;Ee++){var we=be[Ee];var Te=we*Xp;var ke=_a(n[Te],n[Te+1],n[Te+2],n[Te+3],n[Te+4]);if(Fi(Ae,ke)){Se=true;u._intersects.push(Ae,ke);if(o){r.remove(we);if(i[we*Hp+4]===1){f.push(i[we*Hp+5])}else{c.push(i[we*Hp+5])}}else{break}}}if(Se&&!o){c.push(d);continue}}v.push(d);h=i.length/Hp;i.push(xe[0],xe[1],xe[2],xe[3],0,d);r.insert(h);n.push(me[0],me[1],me[2],me[3],me[4])}};t_.prototype._clearOverlaps=function e(t){var r=this;var i=this._graph.NodeList;var n=this._graph.EdgeList;var a=new i(t.remove.nodes);var o=new n(t.remove.edges);var s=new i(t.redraw.nodes);var u=new n(t.redraw.edges);this._graphics.setTextHidden(a,true);this._graphics.setTextHidden(o,true);this._graphics.setTextHidden(s,false);this._graphics.setTextHidden(u,false);this._dom.setTimeout(function(){return r._events.fire("labelCollisionsRemoved",t)})};t_.prototype._reset=function e(){this._graphics.resetTextHidden()};t_.prototype.drawAll=function e(){var t=this;this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);var r=this._textBBoxes;for(var i=0,n=r.length;i<n;i+=6){r_(r.slice(i,i+4),t._ctx,t._camera,"#aaaaaa")}var a=this._rects;for(var o=0;o<a.length;o+=5){var s=_a(a[o],a[o+1],a[o+2],a[o+3],a[o+4]);i_(s,t._ctx,t._camera,"green")}this._intersects.forEach(function(e){return i_(e,t._ctx,t._camera,"red")})};function r_(e,t,r,i){if(i===void 0)i="#22ff00";return i_([[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]].map(function(e){return{x:e[0],y:e[1]}}),t,r,i)}function i_(e,t,r,i){if(i===void 0)i="#ff0000";t.strokeStyle=i;t.lineWidth=1;t.beginPath();var n=Ogma.utils.getPixelRatio();for(var a=0,o=e.length;a<o;a++){var s=r.graphToScreenCoordinates(e[a]);if(a===0){t.moveTo(s.x*n,s.y*n)}else{t.lineTo(s.x*n,s.y*n)}}t.closePath();t.stroke()}Ogma.extend(function(e){var t=new n_(e);e.modules.interactions=t});var n_=function e(t){var r=this;this._dom=t.modules.dom;this._captor=t.modules.captor;this._events=t.modules.events;this._settings=t.modules.settings;this._interactionsByStartEvent={};this._boundProgressEvents={};this._boundStopEvents={};this._onStartInteractionEvent=function(e,t){if(r._current){return}var i=r._interactionsByStartEvent[t];var n=null;for(var a=0,o=i;a<o.length;a+=1){var s=o[a];var u=s.check(e);if(u&&(!n||s.priority>=n.priority)){n=s}}if(n){r._startInteraction(n,e)}};this._onProgressInteractionEvent=function(e,t){if(r._current&&r._current.progressEventName===t){r._current.onProgress(e)}};this._onStopInteractionEvent=function(e,t){if(r._current&&r._current.stopEventName===t){r._stopCurrentInteraction()}}};n_.prototype._startInteraction=function e(t,r){t.onStart(r);if(t.onStop){this._current=t;if(t.disableDetection){this._captor.setDetectionEnabled(false)}}};n_.prototype._stopCurrentInteraction=function e(t){if(this._current.disableDetection){this._captor.setDetectionEnabled(true)}this._current.onStop(t);this._current=null};n_.prototype._forceStartInteraction=function e(t,r){if(this._current){this._stopCurrentInteraction(r)}this._startInteraction(t,r)};n_.prototype._createWrapper=function e(t){var r=this;return{start:function(e){return r._forceStartInteraction(t,e)}}};n_.prototype._addInteraction=function e(t,r){var i=this._interactionsByStartEvent[t];if(i){i.push(r)}else{this._interactionsByStartEvent[t]=[r];this._events.on(t,this._onStartInteractionEvent)}return this._createWrapper(r)};n_.prototype._createProgressiveInteraction=function e(t,r,i,n){var a={priority:a_(n.priority),check:n.check||function(){},onStart:n.onStart||function(){},onProgress:n.onProgress||function(){},onStop:n.onStop||function(){},disableDetection:!!n.disableDetection,progressEventName:r,stopEventName:i};if(!this._boundProgressEvents[r]){this._boundProgressEvents[r]=true;this._events.on(r,this._onProgressInteractionEvent)}if(!this._boundStopEvents[i]){this._boundStopEvents[i]=true;this._events.on(i,this._onStopInteractionEvent)}return this._addInteraction(t,a)};n_.prototype._createNonProgressiveInteraction=function e(t,r){var i={priority:a_(r.priority),check:r.check||function(){},onStart:r.handler||function(){},onProgress:null,onStop:null,disableDetection:false,progressEventName:null,stopEventName:null};return this._addInteraction(t,i)};n_.prototype.onDrag=function e(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)};n_.prototype.onGesture=function e(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)};n_.prototype.onClick=function e(t){return this._createNonProgressiveInteraction("click",t)};n_.prototype.onDoubleClick=function e(t){return this._createNonProgressiveInteraction("doubleClick",t)};n_.prototype.onHover=function e(t){return this._createNonProgressiveInteraction("hover",t)};n_.prototype.onUnhover=function e(t){return this._createNonProgressiveInteraction("unhover",t)};n_.prototype.onMouseWheel=function e(t){return this._createNonProgressiveInteraction("wheel",t)};n_.prototype.onMouseDown=function e(t){return this._createNonProgressiveInteraction("down",t)};n_.prototype.onMouseUp=function e(t){return this._createNonProgressiveInteraction("up",t)};n_.prototype.onMouseMove=function e(t){return this._createNonProgressiveInteraction("move",t)};function a_(e){if(typeof e==="string"){return Ad.indexOf(e)}else if(typeof e==="number"&&!isNaN(e)){return e}else{return 0}}var o_=function(){return{}},s_=function(){return undefined},u_=function(){return false},l_=function(){},d_=function(){},h_=function(){};var f_=function(e){function t(t,r,i){e.call(this);this._dependencies=r;this._dom=i;this.configure(t);this._complete=false}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.configure=function e(t){this._onStart=t.onStart||d_;this._onEnd=t.onEnd||h_;this._update=t.update||s_;this._onUpdate=t.onUpdate||l_;this._createContext=t.context||o_;this._isRunning=t.isRunning||u_};t.prototype.onStart=function e(){this.fire("start",{target:this});this._onStart.call(this);return this};return t}(Fr);var c_=function(e){function t(t,r,i){var n=this;e.call(this,t,r,i);var a=[v_(t.imports),"","","var __CONTEXT = ("+this._createContext.toString()+")();","var __UPDATE_FUNC = "+this._update.toString()+";","var __IS_RUNNING_FUNC = "+this._isRunning.toString()+";","",'self.addEventListener("message", function (evt) {',"  var result    = __UPDATE_FUNC(evt.data, __CONTEXT);","  var isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);","  self.postMessage({ result: result, isRunning: isRunning });","});"].join("\n");this._worker=lr(a);this._sync=function(e){if(!n._dom.isDestroyed()){n.sync(e)}};this._worker.addEventListener("message",this._sync)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.sync=function e(t){var r=t.data.isRunning;var i=t.data.result;var n=this._onUpdate.call(this,i,this._dependencies,r);this.fire("update",{target:this,isRunning:r});if(r){this.send(n)}else{this.stop(i)}};t.prototype.stop=function e(t){if(!this._complete){this._onEnd.call(this,t,this._dependencies);this._worker.terminate();this.fire("stop",{target:this})}this._complete=true};t.prototype.send=function e(t){this._worker.postMessage(sr(t));return this};return t}(f_);function v_(e){if(!e||e.length===0){return""}var t=[];var r=Object.keys(e);for(var i=0,n=r.length;i<n;i++){var a=r[i];var o=e[a];if(typeof o!=="function"){throw new Error('Asynchronous task: dependency "'+a+'" is not found')}else{var s=g_(o);if(s){t.push(o.toString(),"var "+a+" = "+s+";")}else{t.push("var "+a+" = "+o.toString()+";")}}}return t.join("\n")}function g_(e){var t=e.toString();var r=t.startsWith("function ");if(!r){return null}else{return t.substring("function ".length,t.indexOf("("))}}var p_=function(e){function t(t,r,i){e.call(this,t,r,i);this._context=this._createContext()}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.sync=function e(t){var r=this._update(t,this._context),i=this._isRunning(this._context,t);t=this._onUpdate.call(this,r,this._dependencies,i);this.fire("update",{target:this,isRunning:i});if(i){this.send(t)}else{this.stop(r)}};t.prototype.send=function e(t){var r=this;if(!this._complete){this._dom.setTimeout(function(){return r.sync(t)},0)}return this};t.prototype.stop=function e(t){if(!this._complete){this._onEnd(t,this._dependencies);this._complete=true}};return t}(f_);Ogma.extend(function(e){return e.modules.tasks=new __(e)});var __=function e(t){this._ogma=t;this._dom=t.modules.dom};__.prototype.run=function e(t,r,i,n){var a=$a(i,true),o=t.configure||function(e){return e};var s=y_(o,r,n);var u=a?c_:p_;var l=new u(t,n,this._dom);l.onStart();l.send(s);return l};function y_(e,t,r){var i=e(t,r);if(i===undefined){i=t}return i}Ogma.extend(function(e){e.modules.generators=new m_(e);e.generate={}});var m_=function e(t){this._ogma=t;this._graph=t.modules.graph;this._tasks=t.modules.tasks;this._generators={}};m_.prototype.register=function e(t,r){ro(this._generators,t,r,"generator")};m_.prototype.load=function e(t,r){var i=io(this._generators,t,"generator"),n=i.configure(r);return Promise.resolve(i.generate(n))};function x_(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=10;var r=e.edges;if(r===void 0)r=10;var i=e.texts;if(i===void 0)i=false;return{nodes:t,edges:r,texts:i}}function b_(e){var t=e.nodes;var r=e.edges;var i=e.texts;var n=Math.max(t,200);var a=[];var o=[];for(var s=0;s<t;s++){a.push({id:s,attributes:{x:Math.random()*n,y:Math.random()*n,text:i?"Node "+s:undefined}})}for(var u=0;u<r;u++){o.push({id:u,source:Math.random()*t|0,target:Math.random()*t|0,attributes:{text:i?"Edge "+u:undefined}})}return{nodes:a,edges:o}}Ogma.extend(function(e){e.modules.generators.register("random",{configure:x_,generate:b_});e.generate.random=function(t){return e.modules.generators.load("random",t)}});function S_(e){if(e===void 0)e={};var t=e.rows;if(t===void 0)t=4;var r=e.columns;if(r===void 0)r=4;return{rows:t,columns:r}}function A_(e){var t=e.rows;var r=e.columns;var i={nodes:[],edges:[]},n=20,a=20,o=0;for(var s=0;s<t;++s){for(var u=0;u<r;++u){var l=s*r+u;i.nodes.push({id:l,attributes:{x:u*n,y:s*a}});if(u!==r-1){i.edges.push({id:o,source:l,target:s*r+u+1});o+=1}if(s!==t-1){i.edges.push({id:o,source:l,target:(s+1)*r+u});o+=1}}}return i}Ogma.extend(function(e){e.modules.generators.register("grid",{configure:S_,generate:A_});e.generate.grid=function(t){return e.modules.generators.load("grid",t)}});function E_(e){if(e===void 0)e={};var t=e.length;if(t===void 0)t=5;return{length:t}}function w_(e){var t=e.length;var r={nodes:[],edges:[]};if(t<=0){return r}r.nodes.push({id:0,attributes:{x:Math.random()*100,y:Math.random()*100}});for(var i=1;i<t;++i){r.nodes.push({id:i,attributes:{x:Math.random()*100,y:Math.random()*100}});r.edges.push({id:i-1,source:i-1,target:i})}return r}Ogma.extend(function(e){e.modules.generators.register("path",{configure:E_,generate:w_});e.generate.path=function(t){return e.modules.generators.load("path",t)}});function T_(e){if(e===void 0)e={};var t=e.children;if(t===void 0)t=2;var r=e.height;if(r===void 0)r=3;if(!Il(t)){throw new TypeError('Invalid argument: "children" is not a positive number, was '+t)}if(!Cl(r)){throw new TypeError('Invalid argument: "height" is not a positive number, was '+r)}return{children:t,height:r}}function k_(e){var t=e.children;var r=e.height;r+=1;var i=Math.pow(t,r),n=[],a=[],o=1,s=0,u=0;for(var l=0;l<r;++l){var d=i/(o+1)/1.5;for(var h=0;h<o;++h){var f=s++;n.push({id:f,attributes:{x:(h+1)*d*10,y:l*20}});if(l!==r-1){for(var c=0;c<t;++c){a.push({id:u,source:f,target:f*t+c+1});u+=1}}}o*=t}return{nodes:n,edges:a}}Ogma.extend(function(e){e.modules.generators.register("balancedTree",{configure:T_,generate:k_});e.generate.balancedTree=function(t){return e.modules.generators.load("balancedTree",t)}});function C_(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=20;var r=e.edges;var i=e.p;if(!kl(t)||t<3){throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t)}if(r!==undefined&&i!==undefined){throw new TypeError("Invalid argument: choose between options.edges and options.p")}if(r===undefined&&i===undefined){i=.1}return{nodes:t,edges:r,p:i}}function I_(e){var t={nodes:[],edges:[]},r,i,n,a=0,o=e.nodes,s=e.p;if(e.p>=0){for(i=0;i<o;i++){t.nodes.push({id:i,attributes:{x:Math.random()*100,y:Math.random()*100}});for(n=0;n<i;n++){if(Math.random()<s){t.edges.push({id:a++,source:i,target:n})}}}}else{var u=[],l=e.edges;for(i=0;i<o;i++){t.nodes.push({id:i,x:Math.random()*100,y:Math.random()*100,size:1});for(n=i+1;n<o;n++){u.push({source:i,target:n})}}a=u.length-1;for(i=0;i<l;i++){r=u.splice(Math.floor(Math.random()*a),1)[0];r.id=i;t.edges.push(r);a--}}return t}Ogma.extend(function(e){e.modules.generators.register("erdosRenyi",{configure:C_,generate:I_});e.generate.erdosRenyi=function(t){return e.modules.generators.load("erdosRenyi",t)}});function M_(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=40;var r=e.m0;if(r===void 0)r=5;var i=e.m;if(i===void 0)i=1;var n=e.scale;if(n===void 0)n=100;if(!kl(t)||t<3){throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t)}if(!kl(r)||r>=t){throw new TypeError("Invalid argument: options.m0 is not a number < "+t+", was "+r)}if(!kl(r)||i>=r){throw new TypeError("Invalid argument: options.m is not a number <= "+r+", was "+i)}if(!kl(n)||n<0){throw new TypeError("Invalid argument: options.scale is not a number or is less than 0")}return{nodes:t,m0:r,m:i,scale:n}}function L_(e){var t={nodes:[],edges:[]},r={},i=[],n,a,o,s,u,l,d,h,f=e.scale,c=0,v=e.nodes,g=e.m0,p=e.m;var _=f/10;for(n=0;n<g;n++){t.nodes.push({id:n,attributes:{x:Math.random()*_,y:Math.random()*_}});i[n]=0}for(n=0;n<g;n++){for(a=n+1;a<g;a++){o={id:c++,source:n,target:a};r[o.source+"-"+o.target]=o;t.edges.push(o);i[n]++;i[a]++}}for(n=g;n<v;n++){t.nodes.push({id:n,attributes:{x:Math.random()*f,y:Math.random()*f}});i[n]=0;s=0;for(a=0;a<n;a++){s+=i[a]}u=0;for(l=0;l<p;l++){d=Math.random();h=0;for(a=0;a<n;a++){if(r[n+"-"+a]||r[a+"-"+n]){continue}if(n==1){h=1}else{h+=i[a]/s+u/(n-l)}if(d<=h){u+=i[a]/s;o={id:c++,source:n,target:a};r[o.source+"-"+o.target]=o;t.edges.push(o);i[n]++;i[a]++;break}}}}return t}Ogma.extend(function(e){e.modules.generators.register("barabasiAlbert",{configure:M_,generate:L_});e.generate.barabasiAlbert=function(t){return e.modules.generators.load("barabasiAlbert",t)}});function F_(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=50;var r=e.width;if(r===void 0)r=100;var i=e.height;if(i===void 0)i=100;var n=e.x;if(n===void 0)n=0;var a=e.y;if(a===void 0)a=0;if(!isFinite(t)||t<1){throw new RangeError("Tree generator: number of nodes must be a positive integer")}return{nodes:t,width:r,height:i,x:n,y:a}}function N_(e){var t=e.nodes;var r=e.x;var i=e.y;var n=e.width;var a=e.height;var o=r-n/2;var s=i-a/2;return{nodes:new Array(t).fill(0).map(function(e,t){return{id:t,attributes:{x:o+Math.random()*n,y:s+Math.random()*a}}}),edges:new Array(t-1).fill(0).map(function(e,t){return{id:t,source:Math.floor(Math.sqrt(t)),target:t+1}})}}Ogma.extend(function(e){e.modules.generators.register("randomTree",{configure:F_,generate:N_});e.generate.randomTree=function(t){return e.modules.generators.load("randomTree",t)}});var z_=5;var P_=10;var O_=10;var D_=2.7;var R_=1/5;function B_(e){var t=e.depth;if(t===void 0)t=3;var r=e.breadth;if(r===void 0)r=3;var i=e.nbNodes;if(i!==undefined){r=5;t=Math.ceil(Math.log(i)/Math.log(5))}return{depth:t,breadth:r,nbNodes:i}}function j_(e){var t=e.depth;var r=e.breadth;var i=e.nbNodes;var n={id:0,attributes:{x:0,y:0,radius:V_(t+1)}};var a={nodes:[n],edges:[]};G_(a,r,t,n,1);if(i!==undefined){a.nodes=a.nodes.slice(0,i);a.edges=a.edges.slice(0,Math.max(i-1,0))}return a}function U_(e){return Math.pow(D_,e)*P_}function V_(e){return z_+U_(e)/O_}function G_(e,t,r,i,n){if(r===0){return n}var distance=U_(r);var a=V_(r);var o=a*R_;var s=-Math.PI;var u=Math.PI*2/t;var l=i.attributes.x;var d=i.attributes.y;for(var h=0;h<t;++h){var f=Math.cos(s);var c=Math.sin(s);var v={id:n,attributes:{x:l+distance*f,y:d+distance*c,radius:a}};var g={id:n,source:i.id,target:n,attributes:{width:o}};e.nodes.push(v);e.edges.push(g);n=G_(e,t,r-1,v,n+1);s+=u}return n}Ogma.extend(function(e){e.modules.generators.register("flower",{configure:B_,generate:j_});e.generate.flower=function(t){return e.modules.generators.load("flower",t)}});var W_=40;var H_="layoutStart";var X_="layoutEnd";var q_="layoutComputed";var Y_="complete";var Z_={defaultSyncDuration:500,skipTextDrawing:true,useWebWorker:true,locate:false};Ogma.extend(function(e){var t=new K_(e);e.modules.layouts=t;e.layouts={stop:function(){return t.stop()}};e.events.onLayoutStart=function(t){e.modules.events.on(H_,t);return e.events};e.events.onLayoutComplete=function(t){e.modules.events.on(X_,t);return e.events};e.events.onLayoutComputed=function(t){e.modules.events.on(q_,t);return e.events}});var K_=function e(t){var r=this;this._modules=t.modules;this._dom=t.modules.dom;this._events=t.modules.events;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._tasks=t.modules.tasks;this._settings=t.modules.settings;this._locate=t.modules.locate;this._camera=t.modules.camera;this._layouts={};Object.keys(Z_).forEach(function(e){r._settings.register("layouts."+e,Z_[e])});this._events.register([H_,X_,q_]);this._currentLayout=null;this._events.on("clear",function(){return r.stop()})};K_.prototype.register=function e(t,r){ro(this._layouts,t,r,"layout")};K_.prototype.getAvailableLayouts=function e(){return Object.keys(this._layouts)};K_.prototype.start=function e(t,r){var i=this;if(r===void 0)r={};var n=this._layouts[t];var a=this._settings;var o=this;return new Promise(function(e){if(!n){throw new Error("layout "+t+" does not exist")}if(i._currentLayout){i.stop()}var s=typeof r.duration==="number"?r.duration:a.get("layouts.defaultSyncDuration");var u=n.onSync;var l=r.onSync;var d=r.onEnd;var h=r.onUpdate;var f=r.dryRun;var c=-Infinity;var v=$a(r.skipTextDrawing,a.get("layouts.skipTextDrawing"));var g=r.locate||a.get("layouts.locate");r.name=t;r.skipTextDrawing=v;if(g&&typeof g==="boolean"){g={}}var p={update:n.update,isRunning:n.isRunning,configure:n.configure,context:n.context,imports:n.imports,onStart:function(){if(v){o._graphics.hideTexts()}o.onStart(n,r,this)},onUpdate:function(e,r,i){var n=this;var a=tr();if(i&&a-c<W_){return}c=a;if(l){o._dom.setTimeout(function(){return l(e,r,i)},s)}if(u){var d=u(e,r,i);o._events.fire(q_,{type:q_,name:t,positions:d});if(h){h(e,d,i)}var v=o._assignNodePositions(d,s,f);if(!i){if(g){o._animateCamera(d,g,s)}v.then(function(){return n.fire(Y_,d)})}}else if(!i){this.fire(Y_,e)}},onEnd:function(t,i){this.once(Y_,function(a){o.onComplete(t,n,r,i,e,d,a)})}};delete r.onSync;delete r.onEnd;i._graphics.forceAttributesComputation();i._currentLayout=i._tasks.run(p,r,$a(r.useWebWorker,i._settings.get("layouts.useWebWorker")),i._modules)})};K_.prototype._animateCamera=function e(t,r,i){var n=this._locate.layoutDataBoundingBox(t);var a=this._locate.computeConfigForBounds(n,r);return this._camera.setView(a,{duration:i,easing:r.easing})};K_.prototype.onComplete=function e(t,r,i,n,a,o,s){var u=this;this._currentLayout=null;if(r.onEnd){r.onEnd(t,n,null,false)}if(i.skipTextDrawing){this._dom.setTimeout(function(){return u._graphics.showTexts()},50)}var l=new this._graph.NodeList(i.nodeData.indexes);var d=s?J_(s,l):Q_(l);var h=i.nodeData;this._events.fire(X_,{type:X_,name:i.name,positions:{current:d.positions,before:h.positions},ids:d.ids});this._dom.setTimeout(function(){if(o){o(t)}a({name:i.name,positions:{current:d.positions,before:h.positions},ids:d.ids})},0)};K_.prototype.onStart=function e(t,r,i){var n=this._graph.getNodes(r.nodes);var a=Q_(n);var o=a.ids;r.nodeData=a;this._events.fire(H_,{type:H_,name:r.name,ids:o,task:i})};K_.prototype.stop=function e(){if(this._currentLayout){this._currentLayout.stop();this._currentLayout.fire(Y_);this._currentLayout=null}return this};K_.prototype.isRunning=function e(){return!!this._currentLayout};K_.prototype._assignNodePositions=function e(t,r,i){if(!t||i){return Promise.resolve()}var n=t.indexes;var a=t.x;var o=t.y;var s=new this._graph.NodeList(n);var u=new Array(n.length);for(var l=0;l<u.length;++l){u[l]={x:a[l],y:o[l]}}return s.setAttributes(u,r)};function Q_(e){return{size:e.size,ids:e.getId(),positions:e.getPosition(),indexes:e._indexes}}function J_(e,t){var r=e.indexes;var i=e.x;var n=e.y;var a={};for(var o=0;o<r.length;o++){a[r[o]]=o}var s=[];for(var u=0;u<t._indexes.length;u++){var l=a[t._indexes[u]];s.push({x:i[l],y:n[l]})}return{positions:s,indexes:t._indexes,ids:t.getId(),size:r.length}}var $_={configure:function(e,t){var r=t.graph;var i=t.camera;var n=t.graphics;if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&e.nodes instanceof r.NodeList){e.nodes=e.nodes.getId()}var a=r.getNodes(e.nodes);var o=a._indexes;var s,u={},l={};var d=o.length,h,f;var c=r._nodes,v=r._edges;if(e.nodes){e=U(e);delete e.nodes}var g=n._getAttributeArray(true,"innerStroke.width");var p=n._getAttributeArray(true,"outerStroke.width");var _=r._degrees(o);var y=r.getNodeAttributesArrays(["x","y","radius"],{ids:o,destArrays:[new Float32Array(d),new Float32Array(d),new Array(d)]});var m=y[0];var x=y[1];var b=y[2];g=g.getMultiple(o);p=p.getMultiple(o);var S=new r.NodeList(o).getAttribute("layoutable");var A=typeof e.nodeMass==="function"?e.nodeMass:function(e,t,r){return t+1};delete e.nodeMass;var E=typeof e.edgeWeight==="function"?e.edgeWeight:function(e){return 1};delete e.edgeWeight;if(!isFinite(e.scalingRatio)){delete e.scalingRatio}var w=o.reduce(function(e,t,r){if(!S[r]){e[t]=true}return e},{});var T=0,k=0,C=0;var I=i.getZoom();for(f=0;f<o.length;++f){var M=o[f];var L=m[f],F=x[f];var N=b[f]+(g[f]+p[f])/I;u[M]={id:M,x:L,y:F,degree:_[f],size:N,pinned:!!w[M],mass:A(c.get(M),_[f],f)};C=Math.max(N,C)}if(d>1){for(f=0;f<d;f++){var z=u[o[f]];T+=z.x;k+=z.y}}T/=d;k/=d;var P={x:T,y:k};var O=a.getAdjacentEdges();s=O._indexes;h=s.length;var D=O.getSource()._indexes;var R=O.getTarget()._indexes;for(f=0;f<h;f++){var B=s[f];var j=D[f];var V=R[f];if(u[j]&&u[V]){l[B]={source:j,target:V};l[B].weight=E(v.get(B))}}return{nodes:u,edges:l,maxSize:C,config:K(e),barycentre:P}},context:function(){return{}},update:function(e,t){var r;if(!t.W){r={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:false,settings:{linLogMode:false,outboundAttractionDistribution:false,adjustSizes:false,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:true,gravity:1,slowDown:1,barnesHutOptimize:false,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:true,alignNodeSiblings:true,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}};t.W=r;v(e,e.config);r.settings=o(e.config,r.settings);t.nodes=e.nodes;t.edges=e.edges;t.barycentre=e.barycentre}else{r=t.W}var i=t.NodeMatrix,n=t.EdgeMatrix,a;function o(){var e=arguments;var t,r,i={},n=arguments.length;for(t=n-1;t>=0;t--){for(r in arguments[t]){i[r]=e[t][r]}}return i}function s(e,t,r,i){var n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function u(value,e,t,r,i){return(i-r)*(value-e)/(t-e)+r}function l(e){return Math.acos(e.x/Math.sqrt(e.x*e.x+e.y*e.y))}function d(e,t,r,i){return{xi:-(i-t),yi:r-e,xiPrime:i-t,yiPrime:-(r-e)}}function h(e,t){return{x:(e.xiPrime-e.xi)/t,y:(e.yiPrime-e.yi)/t}}function f(e,t,r,i,n){return{x:e+(r-e)*n,y:t+(i-t)*n}}function c(e,t){var i=e.nodes,n=e.edges,a=e.maxSize,o=Object.keys(e.nodes),s=Object.keys(e.edges),u=o.length*r.ppn,l=s.length*r.ppe,d={},h,f,c;var v=Math.pow(10,Math.log(Math.max(a,1))-6);var g=v/2;var p=Math.random;var _=t.randomizeFactor||1;var y;if(t.randomize==="locally"){y=function(e){return e+p()*_}}else if(t.randomize==="globally"){y=function(e){return p()*_}}else{y=function(e){return e+p()*v-g}}var m=new Float32Array(u);var x=new Float32Array(l);for(h=f=0,c=o.length;h<c;h++){var b=o[h],S=i[b];var A=S.x;var E=S.y;if(!S.pinned){A=y(A);E=y(E)}d[b]=f;m[f]=A;m[f+1]=E;m[f+2]=0;m[f+3]=0;m[f+4]=0;m[f+5]=0;m[f+6]=S.mass;m[f+7]=1;m[f+8]=S.size;m[f+9]=S.pinned||0;f+=r.ppn}for(h=f=0,c=s.length;h<c;h++){b=s[h];var w=n[b];x[f]=d[w.source];x[f+1]=d[w.target];x[f+2]=w.weight||0;f+=r.ppe}return{nodes:m,edges:x}}function v(e,i){var n=c(e,i);t.NodeMatrix=n.nodes;t.EdgeMatrix=n.edges;r.nodesLength=t.NodeMatrix.length;r.edgesLength=t.EdgeMatrix.length}function g(){var e,t,o,c,v,g,p,_;var y,m,x,b,S,A,E,distance,w;for(o=0;o<r.nodesLength;o+=r.ppn){i[o+4]=i[o+2];i[o+5]=i[o+3];i[o+2]=0;i[o+3]=0}if(r.settings.outboundAttractionDistribution){y=0;for(o=0;o<r.nodesLength;o+=r.ppn){y+=i[o+6]}y/=r.nodesLength}if(r.settings.barnesHutOptimize){var T=Infinity,k=-Infinity,C=Infinity,I=-Infinity,M,L,F,N;a=[];for(o=0;o<r.nodesLength;o+=r.ppn){T=Math.min(T,i[o+0]);k=Math.max(k,i[o+0]);C=Math.min(C,i[o+1]);I=Math.max(I,i[o+1])}var z=k-T,P=I-C;if(z>P){C-=(z-P)/2;I=C+z}else{T-=(P-z)/2;k=T+P}a[0+0]=-1;a[0+1]=(T+k)/2;a[0+2]=(C+I)/2;a[0+3]=Math.max(k-T,I-C);a[0+4]=-1;a[0+5]=-1;a[0+6]=0;a[0+7]=0;a[0+8]=0;e=1;for(o=0;o<r.nodesLength;o+=r.ppn){t=0;F=r.MAX_SUBDIVISION_RETRIES;while(true){if(a[t+5]>=0){if(i[o+0]<a[t+1]){if(i[o+1]<a[t+2]){M=a[t+5]}else{M=a[t+5]+r.ppr}}else{if(i[o+1]<a[t+2]){M=a[t+5]+r.ppr*2}else{M=a[t+5]+r.ppr*3}}a[t+7]=(a[t+7]*a[t+6]+i[o+0]*i[o+6])/(a[t+6]+i[o+6]);a[t+8]=(a[t+8]*a[t+6]+i[o+1]*i[o+6])/(a[t+6]+i[o+6]);a[t+6]+=i[o+6];t=M;continue}else{if(a[t+0]<0){a[t+0]=o;break}else{a[t+5]=e*r.ppr;p=a[t+3]/2;_=a[t+5];a[_+0]=-1;a[_+1]=a[t+1]-p;a[_+2]=a[t+2]-p;a[_+3]=p;a[_+4]=_+r.ppr;a[_+5]=-1;a[_+6]=0;a[_+7]=0;a[_+8]=0;_+=r.ppr;a[_+0]=-1;a[_+1]=a[t+1]-p;a[_+2]=a[t+2]+p;a[_+3]=p;a[_+4]=_+r.ppr;a[_+5]=-1;a[_+6]=0;a[_+7]=0;a[_+8]=0;_+=r.ppr;a[_+0]=-1;a[_+1]=a[t+1]+p;a[_+2]=a[t+2]-p;a[_+3]=p;a[_+4]=_+r.ppr;a[_+5]=-1;a[_+6]=0;a[_+7]=0;a[_+8]=0;_+=r.ppr;a[_+0]=-1;a[_+1]=a[t+1]+p;a[_+2]=a[t+2]+p;a[_+3]=p;a[_+4]=a[t+4];a[_+5]=-1;a[_+6]=0;a[_+7]=0;a[_+8]=0;e+=4;N=t+0;if(i[a[N]+0]<a[t+1]){if(i[a[N]+1]<a[t+2]){M=a[t+5]}else{M=a[t+5]+r.ppr}}else{if(i[a[N]+1]<a[t+2]){M=a[t+5]+r.ppr*2}else{M=a[t+5]+r.ppr*3}}a[t+6]=i[a[N]+6];a[t+7]=i[a[N]+0];a[t+8]=i[a[N]+1];a[M+0]=a[t+0];a[t+0]=-1;if(i[o+0]<a[t+1]){if(i[o+1]<a[t+2]){L=a[t+5]}else{L=a[t+5]+r.ppr}}else{if(i[o+1]<a[t+2]){L=a[t+5]+r.ppr*2}else{L=a[t+5]+r.ppr*3}}if(M===L){if(F--){t=M;continue}else{F=r.MAX_SUBDIVISION_RETRIES;break}}a[L+0]=o;break}}}}}if(r.settings.barnesHutOptimize){m=r.settings.scalingRatio;for(o=0;o<r.nodesLength;o+=r.ppn){t=0;while(true){if(a[t+5]>=0){distance=Math.sqrt((i[o+0]-a[t+7])*(i[o+0]-a[t+7])+(i[o+1]-a[t+8])*(i[o+1]-a[t+8]));if(2*a[t+3]/distance<r.settings.barnesHutTheta){x=i[o+0]-a[t+7];b=i[o+1]-a[t+8];if(r.settings.adjustSizes){if(distance>0){w=m*i[o+6]*a[t+6]/distance/distance;i[o+2]+=x*w;i[o+3]+=b*w}else if(distance<0){w=-m*i[o+6]*a[t+6]/distance;i[o+2]+=x*w;i[o+3]+=b*w}}else{if(distance>0){w=m*i[o+6]*a[t+6]/distance/distance;i[o+2]+=x*w;i[o+3]+=b*w}}if(a[t+4]<0){break}t=a[t+4];continue}else{t=a[t+5];continue}}else{if(a[t+0]>=0&&a[t+0]!==o){x=i[o+0]-i[a[t+0]+0];b=i[o+1]-i[a[t+0]+1];distance=Math.sqrt(x*x+b*b);if(r.settings.adjustSizes){if(distance>0){w=m*i[o+6]*i[a[t+0]+6]/distance/distance;i[o+2]+=x*w;i[o+3]+=b*w}else if(distance<0){w=-m*i[o+6]*i[a[t+0]+6]/distance;i[o+2]+=x*w;i[o+3]+=b*w}}else{if(distance>0){w=m*i[o+6]*i[a[t+0]+6]/distance/distance;i[o+2]+=x*w;i[o+3]+=b*w}}}if(a[t+4]<0){break}t=a[t+4];continue}}}}else{m=r.settings.scalingRatio;for(c=0;c<r.nodesLength;c+=r.ppn){for(v=0;v<c;v+=r.ppn){x=i[c+0]-i[v+0];b=i[c+1]-i[v+1];if(r.settings.adjustSizes){distance=Math.sqrt(x*x+b*b)-i[c+8]-i[v+8];if(distance>0){w=m*i[c+6]*i[v+6]/distance/distance;i[c+2]+=x*w;i[c+3]+=b*w;i[v+2]+=x*w;i[v+3]+=b*w}else if(distance<0){w=100*m*i[c+6]*i[v+6];i[c+2]+=x*w;i[c+3]+=b*w;i[v+2]-=x*w;i[v+3]-=b*w}}else{distance=Math.sqrt(x*x+b*b);if(distance>0){w=m*i[c+6]*i[v+6]/distance/distance;i[c+2]+=x*w;i[c+3]+=b*w;i[v+2]-=x*w;i[v+3]-=b*w}}}}}_=r.settings.gravity/r.settings.scalingRatio;m=r.settings.scalingRatio;for(o=0;o<r.nodesLength;o+=r.ppn){w=0;x=i[o+0];b=i[o+1];distance=Math.sqrt(x*x+b*b);if(r.settings.strongGravityMode){if(distance>0){w=m*i[o+6]*_}}else{if(distance>0){w=m*i[o+6]*_/distance}}i[o+2]-=x*w;i[o+3]-=b*w}m=1*(r.settings.outboundAttractionDistribution?y:1);for(g=0;g<r.edgesLength;g+=r.ppe){c=n[g+0];v=n[g+1];p=n[g+2];E=Math.pow(p,r.settings.edgeWeightInfluence);x=i[c+0]-i[v+0];b=i[c+1]-i[v+1];if(r.settings.adjustSizes){distance=Math.sqrt(x*x+b*b)-i[c+8]-i[v+8];if(r.settings.linLogMode){if(r.settings.outboundAttractionDistribution){if(distance>0){w=-m*E*Math.log(1+distance)/distance/i[c+6]}}else{if(distance>0){w=-m*E*Math.log(1+distance)/distance}}}else{if(r.settings.outboundAttractionDistribution){if(distance>0){w=-m*E/i[c+6]}}else{if(distance>0){w=-m*E}}}}else{distance=Math.sqrt(x*x+b*b);if(r.settings.linLogMode){if(r.settings.outboundAttractionDistribution){if(distance>0){w=-m*E*Math.log(1+distance)/distance/i[c+6]}}else{if(distance>0){w=-m*E*Math.log(1+distance)/distance}}}else{if(r.settings.outboundAttractionDistribution){distance=1;w=-m*E/i[c+6]}else{distance=1;w=-m*E}}}if(distance>0){i[c+2]+=x*w;i[c+3]+=b*w;i[v+2]-=x*w;i[v+3]-=b*w}}var O,D,R,B,j=0;if(r.settings.adjustSizes){for(o=0;o<r.nodesLength;o+=r.ppn){if(!i[o+9]){O=Math.sqrt(i[o+2]*i[o+2]+i[o+3]*i[o+3]);if(O>r.maxForce){i[o+2]=i[o+2]*r.maxForce/O;i[o+3]=i[o+3]*r.maxForce/O}D=i[o+6]*Math.sqrt((i[o+4]-i[o+2])*(i[o+4]-i[o+2])+(i[o+5]-i[o+3])*(i[o+5]-i[o+3]));R=Math.sqrt((i[o+4]+i[o+2])*(i[o+4]+i[o+2])+(i[o+5]+i[o+3])*(i[o+5]+i[o+3]))/2;B=.1*Math.log(1+R)/(1+Math.sqrt(D));S=i[o+0];A=i[o+1];i[o+0]=i[o+0]+i[o+2]*(B/r.settings.slowDown);i[o+1]=i[o+1]+i[o+3]*(B/r.settings.slowDown);x=i[o+0];b=i[o+1];distance=Math.sqrt((x-S)*(x-S)+(b-A)*(b-A));j+=distance}}}else{for(o=0;o<r.nodesLength;o+=r.ppn){if(!i[o+9]){D=i[o+6]*Math.sqrt((i[o+4]-i[o+2])*(i[o+4]-i[o+2])+(i[o+5]-i[o+3])*(i[o+5]-i[o+3]));R=Math.sqrt((i[o+4]+i[o+2])*(i[o+4]+i[o+2])+(i[o+5]+i[o+3])*(i[o+5]+i[o+3]))/2;B=i[o+7]*Math.log(1+R)/(1+Math.sqrt(D));i[o+7]=Math.min(1,Math.sqrt(B*(i[o+2]*i[o+2]+i[o+3]*i[o+3])/(1+Math.sqrt(D))));S=i[o+0];A=i[o+1];i[o+0]=i[o+0]+i[o+2]*(B/r.settings.slowDown);i[o+1]=i[o+1]+i[o+3]*(B/r.settings.slowDown);x=i[o+0];b=i[o+1];distance=Math.sqrt((x-S)*(x-S)+(b-A)*(b-A));j+=distance}}}r.iterations++;if(r.settings.autoStop){r.converged=r.iterations>r.settings.maxIterations||j/r.nodesLength<r.settings.avgDistanceThreshold;if(r.converged&&r.settings.alignNodeSiblings){var U={},V={},G,W;for(g=0;g<r.edgesLength;g+=r.ppe){c=n[g+0];v=n[g+1];if(c===v){continue}U[c]=U[c]||{};U[v]=U[v]||{};U[c][v]=true;U[v][c]=true}Object.keys(U).forEach(function(e){e=~~e;W=Object.keys(U[e]);if(W.length==2){G=W[0]+";"+W[1];if(G in V){V[G].push(e)}else{G=W[1]+";"+W[0];if(!V[G]){V[G]=[~~W[1],~~W[0]]}V[G].push(e)}}});var H,X,q,Y,Z,K,Q,J,$,ee,te,re,ie,ne,ae,oe=r.settings.nodeSiblingsAngleMin;Object.keys(V).forEach(function(e){X=V[e].shift();q=V[e].shift();H=V[e].filter(function(e){return!i[e+9]});if(H.length==1){return}K=i[X+0];Q=i[X+1];J=i[q+0];$=i[q+1];Y=Object.keys(U[X]).length;Z=Object.keys(U[q]).length;ee=u(Y/(Y+Z),0,1,1/4,3/4);re=f(K,Q,J,$,ee);ie=d(K,Q,J,$);te=s(K,Q,J,$);ne=h(ie,te);ae=l(ne);if(2*oe>Math.PI){throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.")}if(oe>0){if(ae<oe||ae>Math.PI-oe&&ae<=Math.PI){ne={x:Math.cos(Math.PI-oe)*2,y:Math.sin(Math.PI-oe)*2}}else if(ae>2*Math.PI-oe||ae>=Math.PI&&ae<Math.PI+oe){ne={x:Math.cos(oe)*2,y:Math.sin(oe)*2}}}var t=0,n=1,a=1;if(H.length%2==1){a=0;t=1}for(var o=0;o<H.length;o++){i[H[o]+0]=re.x+n*ne.x*a*(t||o>=2?r.settings.nodeSiblingsScale:r.settings.nodeSiblingsScale*2/3);i[H[o]+1]=re.y+n*ne.y*a*(t||o>=2?r.settings.nodeSiblingsScale:r.settings.nodeSiblingsScale*2/3);n=-n;a+=(o+t)%2}})}}}function p(){if(r.settings.autoStop){while(!r.converged){g()}}else{var e=r.iterations===0?r.settings.startingIterations:r.iterations+r.settings.iterationsPerRender;while(r.iterations!==e){g()}}return{nodes:_(t.nodes),barycentre:t.barycentre}}function _(e){var t=Object.keys(e);var n={};for(var a=0;a<i.length;a+=r.ppn){var o=t[a/r.ppn];n[o]={id:o,x:i[a+0],y:i[a+1],pinned:i[a+9]}}return n}return p()},isRunning:function(e){return!e.W.settings.autoStop},onSync:function(e,t){var r=e.nodes;var i=e.barycentre;var n=t.graph;var a=Object.keys(r);var o=a.length;var s=0,u=0;var l,d,h,f,c,v,g,p;var _=new Array(o);var y=new Array(o);var m=new Array(o);var x=new Array(o);var b=n.getAttributes(true,["x","y"]);var S=b[0];var A=b[1];for(l=0;l<o;l++){d=a[l];h=r[d];p=parseInt(d);_[l]=p;x[l]=h.pinned;if(h.pinned){f=S.get(p);c=A.get(p)}else{f=h.x;c=h.y}y[l]=f;m[l]=c;s+=f;u+=c}v=s/o-i.x;g=u/o-i.y;for(l=0;l<o;l++){if(!x[l]){y[l]-=v;m[l]-=g}}return{indexes:_,x:y,y:m}}};Ogma.extend(function(e){e.layouts.forceLink=function(t){if(t===void 0)t={};return e.modules.layouts.start("forceLink",t)};e.modules.layouts.register("forceLink",$_)});var ey={configure:function(e,t){var r=t.graph;var i=t.camera;var n=e.sortBy;var a=e.rows;var o=e.cols;if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}function s(e){return e===undefined||typeof e==="number"&&isFinite(e)&&e>0}if(!s(a)){throw new TypeError('"rows" should be a positive integer')}if(!s(o)){throw new TypeError('"cols" should be a positive integer')}var u=e.nodes;var l=e.nodes._indexes;var d=l.length;if(a){o=Math.ceil(d/a)}else if(o){a=Math.ceil(d/o)}else{o=Math.ceil(Math.sqrt(d));a=Math.ceil(d/o)}var h,f;var c;var v=e.sortFallbackValue;if(typeof n==="string"){if(n==="radius"){c=r.getAttribute(true,"radius").getMultiple(l)}else if(n==="random"){c=new Array(d);for(h=0;h<d;h++){c[h]=Math.random()}}else{c=u.getData(n);if(v!==undefined){for(h=0;h<d;h++){if(c[h]===undefined){c[h]=v}}}}}else{c=new Array(d);for(h=0;h<d;h++){c[h]=h}}var g=[];var p=u.getAttribute("layoutable");for(h=0;h<d;++h){f=l[h];if(p[h]){g.push({id:f,attr:c[h]})}}var _=u.getBoundingBox();var y=Math.max(_.maxScaledSize,_.maxFixedSize/i.getZoom())*.65;var m=_.minX+y;var x=_.maxX-y;var b=_.minY+y;var S=_.maxY-y;if(_.width<y*o*2){m=_.cx-y*o+y;x=_.cx+y*o-y}if(_.height<y*a*2){b=_.cy-y*a+y;S=_.cy+y*a-y}return{sort:!!n,nodes:g,reverse:!!e.reverse,cols:o,rows:a,minX:m,maxX:x,minY:b,maxY:S}},update:function(e){if(e.sort){e.nodes.sort(function(e,t){var r=e.attr,i=t.attr;if(r<i){return-1}else if(r>i){return 1}else{return 0}})}if(e.reverse){e.nodes.reverse()}var t=(e.maxX-e.minX)/(e.cols-1),r=(e.maxY-e.minY)/(e.rows-1),i=0,n=0,a=e.minX,o=e.minY;if(!isFinite(t)){t=0}if(!isFinite(r)){r=0}for(var s=0;s<e.nodes.length;++s){var u=e.nodes[s];u.x=a+i*t;u.y=o+n*r;i+=1;if(i===e.cols){n+=1;i=0}}return e.nodes},onSync:function(e){var t=e.length;var r=new Uint32Array(t);var i=new Array(t);var n=new Array(t);for(var a=0;a<e.length;++a){var o=e[a];r[a]=o.id;i[a]=o.x;n[a]=o.y}return{indexes:r,x:i,y:n}}};Ogma.extend(function(e){e.layouts.grid=function(t){if(t===void 0)t={};return e.modules.layouts.start("grid",t)};e.modules.layouts.register("grid",ey)});var ty={configure:function(e,t){var r=t.graph;var i=t.data;if(e.centralNode===undefined){throw new Error('concentric layout: missing parameter "centralNode"')}else if(!(e.centralNode instanceof r.Node)){e.centralNode=r.getNode(e.centralNode)}if(!e.nodes){e.nodes=r.getNodes()}else if(!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}var n=r.getNode(e.centralNode)._index;var a=e.centralNode.getPosition();var o=a.x,s=a.y;var u=null,l,d;var h=r.getNodes(e.nodes)._indexes;var f=[];var c=h.length;var v=r.getNodeAttributesArrays(["radius"],{ids:h,destArrays:[new Array(c)]});var g=v[0];var p=e.nodes.getAttribute("layoutable");for(l=0;l<c;l++){d=h[l];if(d===n||p[l]){f.push(d)}}if(f.indexOf(n)===-1){f.push(n)}c=f.length;var _={};var y=new Array(c);for(l=0;l<c;l++){_[f[l]]=l;y[l]=l}var m=new Array(c);for(l=0;l<c;l++){var x=r._getAdjacentElements(true,[f[l]]);for(var b=0,S=x.length;b<S;b++){x[b]=_[x[b]]}m[l]=x}if(e.sortBy){if(e.sortBy==="random"){u="random"}else if(e.sortBy==="radius"){u=g.slice()}else if(e.sortBy==="degree"){u=e.nodes.getDegree()}else{u=i.getProperty(e.nodes,e.sortBy)}}return{sourceNodeIndex:f.indexOf(n),centerX:e.centerX==="number"?e.centerX:o,centerY:e.centerY==="number"?e.centerY:s,list:f,indexes:y,size:c,totalSize:c,attributes:{adjacentNodes:m,size:g},sortAttr:u,clockwise:e.clockwise===undefined?true:e.clockwise,circleHopRatio:e.circleHopRatio||5,allowOverlap:!!e.allowOverlap}},context:function(){return{dijkstra:function(e,t,r,i,n){var a=Math.pow(2,31)-1,o=new Int32Array(i),s=new Int32Array(i),u=new Int8Array(i),l,d,h;for(h=0;h<i+1;++h){o[h]=a;s[h]=-1}for(h=0;h<i;++h){l=t[h];if(l!==undefined){o[l]=a;s[l]=-1}}o[n]=0;while(true){var f=a,c=-1;for(h=0;h<r;++h){l=t[h];d=o[l];if(!u[l]&&d<f){f=d;c=l;u[l]=true}}if(c===-1){break}var v=e[c],g=v.length,p=f+1;for(h=0;h<g;++h){l=v[h];d=o[l];if(p<d){o[l]=p;s[l]=c}}}return o},determinePropertyType:function(e,t,r){for(var i=0;i<r;++i){if(typeof e[t[i]]!=="number"){return"string"}}return"number"}}},update:function(e,t){var r=e.attributes.adjacentNodes;var i=e.attributes.size;var n=e.indexes;var a=e.size;var o=e.sourceNodeIndex;var s=e.centerX;var u=e.centerY;var l=e.sortAttr;var d=new Array(e.totalSize);var h=new Array(e.totalSize);var f=t.dijkstra(r,n,e.size,e.totalSize,o);var c=0;var v={};var g;for(g=0;g<a;++g){var p=i[n[g]];if(p>c){c=p}}var _=c*e.circleHopRatio,y=0,m=0,x=Math.PI/9;for(g=0;g<a;++g){var b=n[g],distance=f[b],S=v[distance];if(!S){S=[];v[distance]=S}S.push(b)}var A=null,E=true;if(l==="random"){A=function(){return Math.random()-.5}}else if(l){var w=t.determinePropertyType(l,n,p);A=w==="number"?function(e,t){return l[e]-l[t]}:function(e,t){return l[e]<l[t]?-1:1}}else{E=false}var T=Object.keys(v).sort(function(e,t){return parseInt(e)-parseInt(t)});for(g=0;g<T.length;++g){var k=v[T[g]],C=k.length,I=m,M=Math.PI*2/C;if(g!==0&&!e.allowOverlap){var L=Math.PI*2*y,F=0,N=0;for(z=0;z<C;++z){F+=i[k[z]]}N=F*2*Math.SQRT2;if(N>L){y+=N/(2*Math.PI)-y}}if(E){k.sort(A);if(!e.clockwise){k.reverse()}}for(var z=0;z<C;++z){b=k[z];d[b]=Math.cos(I)*y+s;h[b]=Math.sin(I)*y+u;p=i[b];var P=e.allowOverlap?1:p/F*C;I+=M*P}y+=_;m+=x}return{x:d,y:h,indexes:e.list}},isRunning:function(){return false},onSync:function(e){var t=e.indexes;var r=e.x;var i=e.y;return{indexes:t,x:r,y:i}}};Ogma.extend(function(e){e.layouts.concentric=function(t){if(t===void 0)t={};return e.modules.layouts.start("concentric",t)};e.modules.layouts.register("concentric",ty)});var ry={defaultDirected:true,defaultMultigraph:true,defaultCompound:false,defaultRankDir:"TB",maxNbEdges:500,maxNbNodes:500};Ogma.extend(function(e){e.layouts.hierarchical=function(t){if(t===void 0)t={};t.useWebWorker=false;return e.modules.layouts.start("hierarchical",t)};e.modules.layouts.register("hierarchical",iy)});var iy={configure:function(e,t){if(e===void 0)e={};var r=t.graph;S("dagre",{throwOnError:true});if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&e.nodes instanceof r.NodeList){e.nodes=e.nodes.getId()}var i=to(e,ry);var n=r.getEdges();var a=r.getNodes(e.nodes);e.directed=$a(e.directed,i.defaultDirected);e.multigraph=$a(e.multigraph,i.defaultMultigraph);e.compound=$a(e.compound,i.defaultCompound);e.rankdir=$a(e.rankdir,i.defaultRankDir);if(e.nodeDistance!==undefined){e.nodesep=e.nodeDistance;delete e.nodeDistance}if(e.levelDistance!==undefined){e.ranksep=e.levelDistance;delete e.levelDistance}if(e.edgeDistance!==undefined){e.edgesep=e.edgeDistance;delete e.edgeDistance}if(["TB","BT","LR","RL"].indexOf(e.rankdir)===-1){throw new Error('defaultRankDir should be one of the "TB", "BT", "LR", "RL"')}var o=a.getId();var s=a.getAttribute("layoutable").reduce(function(e,value,t){e[o[t]]=value;return e},{});return{nodes:o,edges:n.map(function(e){return{id:e.getId(),source:e.getSource().getId(),target:e.getTarget().getId()}}),options:K(e),layoutable:s}},context:function(){},update:function(e){var t=e.nodes;var r=e.edges;var i=e.options;var n=e.layoutable;var a=S("dagre");var o=new a.graphlib.Graph({directed:i.directed,multigraph:i.multigraph,compound:i.compound});o.setGraph(i);t.forEach(function(e){if(n[e]){o.setNode(e,{})}});r.forEach(function(e){var t=e.source;var r=e.target;var i=e.id;if(o.node(t)&&o.node(r)){o.setEdge(t,r,{id:i})}});a.layout(o);var s=o.nodes();return{ids:s,positions:s.map(function(e){return o.node(e)})}},isRunning:function(){return false},onSync:function(e,t){var r=e.ids;var i=e.positions;var n=t.graph;var a=new Array(r.length);var o=new Array(r.length);var s=new Array(r.length);for(var u=0;u<r.length;++u){var l=i[u];var d=l.x;var h=l.y;a[u]=n.getNode(r[u])._index;o[u]=d;s[u]=h}return{indexes:a,x:o,y:s}}};function ny(e,t,r,i,n){return{x:e+n*(r-e),y:t+n*(i-t)}}function ay(e,t,r){var i=Infinity;var n,a;for(var o=1,s=t.length;o<s;o+=2){var u=t[o-1],l=t[o%s];var d=(u[0]+l[0])/2,h=(u[1]+l[1])/2;var f=e[0]-d,c=e[1]-h;var v=f*f+c*c;if(v<i){i=v;n=u;a=l}}return oy(n[0],n[1],a[0],a[1],r)}function oy(e,t,r,i,n){var a=(e+r)/2,o=(t+i)/2;var s=e-r,u=t-i;var l=-u,d=s;var h=Math.sqrt(l*l+d*d);l/=h;d/=h;return[a-n*l,o-n*d]}function sy(e,t){var r=t[0];var i=t[1];var n=t[2];var a=Math.abs;for(var o=0,s=e.length;o<s;o++){var u=e[o];var l=u[0];var d=u[1];var h=a(l-r),f=a(d-i);if(h+f<=n){return true}if(h>n||f>n){continue}if(h*h+f*f<=n*n){return true}}return false}function uy(e,t,r){var i=si(r.cx,r.cy,e,t,r.minX,r.minY,r.maxX,r.maxY);var n=+Infinity,a,o;for(var s=0,u=i.length;s<u;s++){var l=i[s];a=distance(e,t,l.x,l.y);if(a<n){n=a;o=l}}return o}function ly(e,t,r){var i=t.nodes;var n=t.margin;if(n===void 0)n=5;var a=t.duration;if(a===void 0)a=0;var o=i.inverse();var s=o.getPosition().map(function(e){return[e.x,e.y]});var u=r;var l=i.getBoundingBox();var d=o.getBoundingBox();var h=minDisk(u.map(function(e){return e.x}),u.map(function(e){return e.y}),i.getAttribute("radius"));var f=h[0];var c=h[1];var v=h[2]+(l.maxScaledSize+d.maxScaledSize)+n;var g=0,p=0,_;if(sy(s,[h[0],h[1],v])){if(o.size<=3){if(Rr(f,c,h[2],d.minX,d.minY,d.maxX,d.maxY)){var y=uy(f,c,d);_=distance(d.cx,d.cy,y.x,y.y);var m=ny(d.cx,d.cy,y.x,y.y,(_+v)/_);g=m.x-f;p=m.y-c}}else{var x=new Aa(s.slice()).triangulate();var convexhull=Ta(s);var b=ka(o,20,v,x,convexhull);if(b.length>0){var S=Infinity;for(var A=0,E=b.length;A<E;A++){var w=b[A];g=f-w[0];p=c-w[1];_=Math.sqrt(g*g+p*p);if(_<S){S=_;y=w}}g=y[0]-f;p=y[1]-c}else{y=ay([f,c],convexhull,v);g=y[0]-l.cx;p=y[1]-l.cy}}}if(g||p){return i.setAttributes(u.map(function(e){e.x+=g;e.y+=p;return e}),a)}else{return Promise.resolve()}}function dy(e,t){var r=U(t);r.duration=0;r.dryRun=true;return e.layouts.forceLink(r).then(function(r){return ly(e,t,r.positions.current)})}function hy(e,t){var r=t.nodes;var i=t.duration;var n=t.centralNode;var a=r;var o=a.reduce(function(e,t){e[t._index]=true;return e},{});var s=e.getNodes();if(t.focusOnGroupShape){return e.layouts.forceLink({nodes:a,duration:0}).then(function(){var t=a.concat(n);var r=t.getAttribute("layoutable");t.setAttributes({layoutable:false});return e.layouts.forceLink({nodes:e.getNodes(),duration:i}).then(function(){return t.setAttributes(r)})})}else{var u=U(t);delete u.centralNode;u.nodes=s;u.nodeMass=function(e,t){var r=o[e._index]?1:2;return(t+1)*r};return e.layouts.forceLink(u)}}Ogma.extend(function(e){e.layouts.incremental=function(t){if(t===void 0)t={};var r=t.nodes;var i=t.centralNode;if(!r){throw new Error("Incremental ForceLink layout: no nodes are selected")}if("margin"in t&&!isFinite(t.margin)){throw new Error("Incremental ForceLink layout: margin has to be a positive number")}if(i&&!i.getAttribute("layoutable")){return hy(e,t)}else{return dy(e,t)}}});var fy=function(e,t){return e-t};var cy={imports:{minHeap:minHeap,bellmanFord:bellmanFord,dijkstra:dijkstra,johnson:johnson,distance:distance,circleCircleIntersection:circleCircleIntersection,circleSortCompare:circleSortCompare,weightedStress:weightedStress,distanceStress:distanceStress,constrainedStress:constrainedStress,stressMinimizationStep:stressMinimizationStep,removeRadialOverlap:removeRadialOverlap},configure:function(e,t){if(e===void 0)e={};var r=t.graph;var i=null,n,a,o,s=-1;var u=null;if(e.centralNode!==undefined&&e.centralNode!==null){i=r.getNode(e.centralNode,true);o=i.getPosition();n=isFinite(e.centerX)?parseFloat(e.centerX):o.x;a=isFinite(e.centerY)?parseFloat(e.centerY):o.y;s=i._index}else{throw new Error('concentric layout: missing parameter "centralNode"')}if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}if(!e.nodes.includes(i)){e.nodes=e.nodes.concat(i)}var l=r.getNodes(e.nodes);var d=l._indexes;var h=l.getAttribute("layoutable");d=d.filter(function(e,t){return h[t]||e===s});d.sort(fy);var f=d.length;var c=r.getConnectedComponents(l,{internalIndexes:true});var v=py(d,c,s);c=v;var g=r._degrees(d);var p=r.getNodeAttributesArrays(["x","y","radius"],{ids:d,destArrays:[new Float32Array(f),new Float32Array(f),new Float32Array(f)]});var _=p[0];var y=p[1];var m=p[2];var x=r.getEdgeAttributesArrays(["source","target","width"]);var b=x[0];var S=x[1];var A=r.getAdjacencyList({internalIndexes:true,weight:1,nodes:e.nodes});var E=isFinite(e.radiusRatio)?parseFloat(e.radiusRatio):Math.SQRT2;var w=isFinite(e.radiusDelta)?parseFloat(e.radiusDelta):0;var T=isFinite(e.nodeGap)?parseInt(e.nodeGap):10;var k=f*(isFinite(e.repulsion)?parseFloat(e.repulsion):1);var C=isFinite(e.maxIterations)?parseInt(e.maxIterations):100;if(C<1){throw new RangeError("maxIterations must be a positive integer")}var I=isFinite(e.iterationsPerRender)?parseInt(e.iterationsPerRender):20;if(I<1){throw new RangeError("iterationsPerRender must be a positive integer")}var M=isFinite(e.epsilon)?parseFloat(e.epsilon):.001;if(M<=0){throw new RangeError("epsilon has to be a positive number")}return{centerIndex:s,centerX:n,centerY:a,list:d,components:v,X:_,Y:y,degree:g,size:f,currStress:Number.POSITIVE_INFINITY,epsilon:M,maxSteps:C,iterationsPerRender:I,attributes:{size:m,adjacency:A,weights:S.map(function(){return 1}),sources:b,targets:S},sortAttr:u,allowOverlap:!!e.allowOverlap,nodeGap:T,radiusRatio:E,radiusDelta:w,repulsion:k,randomize:"randomize"in e?!!e.randomize:true,renderSteps:!!e.renderSteps}},context:function(){return{getHighestNodeSize:function e(t,r){var i=0;for(var n=0,a=r.length;n<a;n++){var o=t[r[n]];if(o>i){i=o}}return i},grid:function e(t,r){if(r===void 0)r=8;var i=t.size;var n=new Float32Array(i);var a=new Float32Array(i);var o,s,u=this.getHighestNodeSize(t.attributes.size,t.list,i);var l=u*r;var d=Math.ceil(Math.sqrt(i));var h=Math.ceil(i/d);var f=-Math.floor((h-1)*l/2);var c=-Math.floor((d-1)*l/2);for(o=0;o<d;o++){for(s=0;s<h;s++){n[o*h+s]=f+s*l;a[o*h+s]=c+o*l}}return{x:n,y:a}},connectSubgraphs:function e(t,r,i,n,a,o){var s,u;function l(e,value){var t=new Uint32Array(e.length+1);t.set(e);t[e.length]=value;return t}var d=function(e){s=t[e];var d=0,h=0;s.forEach(function(e,t){if(a[e]>d){h=t;d=a[e]}});u=s[h];var f=r[o[u]];f.nodes=l(f.nodes,i);f.weights.push(n);f=r[i];f.nodes=l(f.nodes,u);f.weights.push(n)};for(var h=1;h<t.length;h++)d(h)},correctSubgraphsDistances:function e(t,r,i,n,a){var o=Array.prototype.reduce.call(t[i],function(e,t,r){if(r!==i&&t<n&&t>e){e=t}return e},0);var s=n-o-1;for(var u=1;u<r.length;u++){var l=r[u];for(var d=0,h=l.length;d<h;d++){var f=a[l[d]];t[i][f]-=s;t[f][i]-=s}}},establishRadii:function e(t,r,i,n,a,o,s,u){var l=Object.create(null);var d=a[r];var h=d,f=0;var c=d;for(var v in n){var g=n[v];var p=0;var _=0,y=void 0;for(var m=0,x=g.length;m<x;m++){y=a[g[m]];_=Math.max(_,y);p+=y*2+o}var b=p/(2*Math.PI)+_;var S=_+h;var A=u?f+Math.max(u,S):f*s;f=Math.max(f,b,c,A);l[v]=f;h=_}l[0]=0;l[Number.POSITIVE_INFINITY]=f;return l},initData:function e(t,r){t.step=0;t.data=r;t.totalSteps=r.totalSteps;t.currStress=Number.POSITIVE_INFINITY;t.prevStress=0;t.epsilon=t.data.epsilon;var i={},n={};t.normIndexes=r.list.reduce(function(e,a,o){e[o]=i[a]=o;n[a]=r.degree[o];if(a===r.centerIndex){t.centerIndexPos=o}return e},new Uint32Array(r.list.length));var a=t.centerIndexPos;var o=r.components[0].length;this.connectSubgraphs(r.components,r.attributes.adjacency,r.centerIndex,o,n,i);var s=johnson({sources:r.attributes.sources,targets:r.attributes.targets,weights:r.attributes.weights,indexes:r.list,adjacency:r.attributes.adjacency,undirected:true});this.correctSubgraphsDistances(s,r.components,a,o,i);t.D=s;t.rings=this.groupRings(s,a,t.normIndexes);t.radii=this.establishRadii(s,a,t.normIndexes,t.rings,r.attributes.size,r.nodeGap,r.radiusRatio,r.radiusDelta)},groupRings:function e(t,r,i){var n=t[r];var a=Object.create(null);for(var o=0,s=i.length;o<s;o++){if(o!==r){var u=n[o];a[u]=a[u]||[];a[u].push(i[o])}}return a},removeOverlaps:function e(t,r){var i=t.centerIndexPos;var n=r.attributes.size;var a=t.rings;var o=r.X[i];var s=r.Y[i];for(var u in a){var l=a[u];var d=distance(o,s,r.X[l[0]],r.Y[l[0]]);removeRadialOverlap({X:r.X,Y:r.Y,sizes:n,indexes:l,center:[o,s],R:d,gap:r.nodeGap,inPlace:true})}},easingQuadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)}}},update:function(e,t){e=e||t.data;var r=e.list;var i=e.centerIndex;var n=e.X||new Float32Array(e.size);var a=e.Y||new Float32Array(e.size);var o=null;var s;if(t.step===undefined){t.initData(t,e)}else{t.step++}var u=e.repulsion;var l=function(e){return t.radii[e]||1};if(t.step===0){if(e.randomize){s=t.grid(e);e.X=s.x;e.Y=s.y}e.spent=0}else if(!t.converged){var d=e.maxSteps;var h=e.iterationsPerRender;var f=t.step;var c=Math.min(f+h,d+1);while(f<=c||!t.converged){var v=t.easingQuadraticInOut(Math.min(f,d)/d);t.step=f++;s=stressMinimizationStep(t.D,n,a,e.size,t.centerIndexPos,u,v,t.normIndexes,l);e.X=s.X;e.Y=s.Y;t.prevStress=t.currStress;t.currStress=constrainedStress(t.D,e.X,e.Y,e.size,t.centerIndexPos,u,v,t.normIndexes,r,i);t.converged=t.converged||Math.abs(t.currStress-t.prevStress)<=t.epsilon}}if(t.converged){if(t.overlapRemoved||t.data.allowOverlap){t.done=true;o=Object.keys(t.rings).reduce(function(e,i){e[i]=t.rings[i].map(function(e){return r[e]});return e},{})}else{t.removeOverlaps(t,e,i);t.overlapRemoved=true}}return{x:e.X,y:e.Y,indexes:e.list,components:t.overlapRemoved?e.components:undefined,rings:o,centerIndex:t.centerIndexPos,cx:e.centerX,cy:e.centerY,step:t.step,renderSteps:e.renderSteps,converged:t.converged,overlapRemoved:t.overlapRemoved,stress:t.currStress,done:t.done}},isRunning:function(e){if(!e.converged){return true}else{return e.data.allowOverlap?false:!e.done}},onSync:function(e,t){if(e.renderSteps||e.done){return vy(e,t)}},onEnd:function(e,t){return vy(e,t)}};function vy(e){var t=e.x,r=e.y;var i=e.indexes.length;var n=t[e.centerIndex]-e.cx;var a=r[e.centerIndex]-e.cy;for(var o=0;o<i;o++){t[o]-=n;r[o]-=a}return{indexes:e.indexes,x:t,y:r}}function gy(e,t){var r=0,i=e.length-1,n;var a;while(r<=i){n=(r+i)/2|0;a=e[n];if(a<t){r=n+1}else if(a>t){i=n-1}else{return n}}return-1}function py(e,t,r){var i=e.slice().sort(fy),n=[];for(var a=0,o=t.length;a<o;a++){var s=[],u=t[a];var l=false;for(var d=0,h=u.length;d<h;d++){var f=u[d];var c=gy(i,f);if(c!==-1){if(f===r){l=true}s.push(f)}}if(s.length!==0){n[l?"unshift":"push"](s.sort(fy))}}return n}Ogma.extend(function(e){e.layouts.radial=function(t){if(t===void 0)t={};return e.modules.layouts.start("radial",t)};e.modules.layouts.register("radial",cy)});var _y=function e(t,r){var i=this;this._module=t;this._id=r;this._whenApplied=t.whenApplied().then(function(){return i})};_y.prototype.getName=function e(){return this._module.getName(this._id)};_y.prototype.getId=function e(){return this._id};_y.prototype.whenApplied=function e(){return this._whenApplied};_y.prototype.isEnabled=function e(){return this._module.isEnabled(this._id)};_y.prototype.enable=function e(t){return this._module.enable(this._id,t)};_y.prototype.disable=function e(t){return this._module.disable(this._id,t)};_y.prototype.toggle=function e(t){return this._module.toggle(this._id,t)};_y.prototype.getIndex=function e(){return this._module.getIndex(this._id)};_y.prototype.setIndex=function e(t){return this._module.setIndex(this._id,t)};_y.prototype.destroy=function e(t){return this._module.remove(this._id,t)};_y.prototype.refresh=function e(){return this._module.refresh(this._id)};_y.prototype.delete=function e(t){return this.destroy(t)};var yy=function e(t){var r=this;this._ogma=t;this._settings=t.modules.settings;this._dom=t.modules.dom;this._events=t.modules.events;this._graph=t.modules.graph;this._captor=t.modules.captor;this._list=[];this._currentPipeline=[];this._idCounter=0;this._mustRefresh=false;this._resolvers=[];this._safeGuard=false;this._afterCurrentUpdate=Promise.resolve();this._ogma.styles.createClass({name:pd,isBuiltin:true,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0,width:0}});this._ogma.styles.createClass({name:_d,isBuiltin:true,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}});this._nodeTransformationIdList=this._graph.createNodeAttribute({storage:16,default:0});this._edgeTransformationIdList=this._graph.createEdgeAttribute({storage:16,default:0});this._settings.register("transformations.updateOnDataChange",true);this._events.on({"addNodes addEdges removeNodes removeEdges":function(e){var t=e.virtual;if(!t){r._invalidState()}},"updateNodeData updateEdgeData":function(){if(r._settings.get("transformations.updateOnDataChange")&&!r._safeGuard){r._invalidState()}},afterNewFrame:function(){r._computeTransformations()}})};yy.prototype._invalidState=function e(){var t=this;this._afterCurrentUpdate.then(function(){if(t._list.length||t._currentPipeline.length){t._mustRefresh=true;t._dom.refresh()}})};yy.prototype._onUpdate=function e(){var t=this;return this._afterCurrentUpdate.then(function(){t._dom.refresh();return new Promise(function(e){return t._resolvers.push(e)})})};yy.prototype._resetEltTransformationIds=function e(){this._nodeTransformationIdList.reset();this._edgeTransformationIdList.reset()};yy.prototype._assignTransformationIds=function e(t){this._assignTransformationIdsToElements(true,t);this._assignTransformationIdsToElements(false,t)};yy.prototype._assignTransformationIdsToElements=function e(t,r){var i=t?this._graph.getNodes("all"):this._graph.getEdges("all");var n=this._graph.getAttribute(t,"virtual");var a=this._graph.getAttribute(t,"excluded");var o=t?this._nodeTransformationIdList:this._edgeTransformationIdList;for(var s=0,u=i._indexes;s<u.length;s+=1){var l=u[s];var d=o.get(l);if(!d){var h=a.get(l);var f=n.get(l);if(!h&&f){o.set(l,r)}}}};yy.prototype._resolveTransformations=function e(t,r,i){var n=this;if(!i){t.forEach(function(e){return e.duration=0});r.forEach(function(e){return e.duration=0})}this._resetEltTransformationIds();var a=Promise.resolve();var o=function(e){var i=t[e];if(i.context!==null){a=a.then(function(){return i.methods.undo(i)})}if(!r.some(function(e){return e.id===i.id})){a=a.then(function(){return i.methods.cleanup(i)}).then(function(){i.context=null})}};for(var s=t.length-1;s>=0;--s)o(s);var u=function(e){var t=r[e];var i=null;a=a.then(function(){return t.methods.run(t)}).then(function(e){i=e;if(t.context){return t.methods.cleanup(t)}}).then(function(){n._assignTransformationIds(t.id);t.context=i})};for(var l=0;l<r.length;++l)u(l);return a};yy.prototype._computeTransformations=function e(){var t=this;if(this._safeGuard){return}this._safeGuard=true;this._afterCurrentUpdate=Promise.resolve();if(this._mustRefresh){this._captor.setDetectionEnabled(false);var r=this._currentPipeline.filter(function(e){var t=e.enabled;return t});var i=this._list.filter(function(e){var t=e.enabled;return t});var n;var a;var o;if(r.length===i.length+1&&my(r,i,i.length)){n=[r.pop()];a=[];o=true}else if(i.length===r.length+1&&my(r,i,r.length)){n=[];a=[i.pop()];o=true}else{n=r;a=i;o=false}this._afterCurrentUpdate=this._afterCurrentUpdate.then(function(){return t._resolveTransformations(n,a,o)}).then(function(){t._captor.setDetectionEnabled(true);t._currentPipeline=t._list.map(function(e){return Object.assign({},e)});t._mustRefresh=false})}this._afterCurrentUpdate=this._afterCurrentUpdate.then(function(){return t._ogma.view.afterNextFrame()}).then(function(){t._safeGuard=false;t._resolvers.forEach(function(e){return e()});t._resolvers=[]})};yy.prototype.getList=function e(){return this._list.map(function(e){var t=e.wrapper;return t})};yy.prototype.clear=function e(){this._list=[];this._invalidState();return this._onUpdate()};yy.prototype._get=function e(t,r){var i=this;if(r===void 0)r=true;for(var n=0;n<this._list.length;++n){var a=i._list[n];if(a.id===t){a.index=n;return a}}if(r){throw new Error("calling a method on a destroyed transformation")}return null};yy.prototype.getName=function e(t){return this._get(t).methods.getName()};yy.prototype.enable=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(!e.enabled){e.enabled=true;e.duration=r;i._invalidState()}return i._onUpdate()})};yy.prototype._setRemovalDuration=function e(t,r){var i=this;for(var n=0;n<this._currentPipeline.length;++n){var a=i._currentPipeline[n];if(a.id===t){a.duration=r}}};yy.prototype.disable=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(e.enabled){e.enabled=false;i._setRemovalDuration(t,r);i._invalidState()}return i._onUpdate()})};yy.prototype.remove=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);i._list.splice(e.index,1);i._setRemovalDuration(t,r);i._invalidState();return i._onUpdate()})};yy.prototype.toggle=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(e.enabled){return i.disable(t,r)}else{return i.enable(t,r)}})};yy.prototype.setIndex=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);i._list.splice(e.index,1);i._list.splice(it(r,0,i._list.length),0,e);i._invalidState();return i._onUpdate()})};yy.prototype.getIndex=function e(t){return this._get(t).index};yy.prototype.add=function e(t,r){if(r===void 0)r={};var i=r.duration;if(i===void 0)i=0;var n=r.enabled;if(n===void 0)n=true;if(!t.cleanup){t.cleanup=function(){}}var a={ogma:this._ogma,id:++this._idCounter,methods:t,duration:i,enabled:n,context:null,wrapper:new _y(this,this._idCounter),index:-1};this._list.push(a);this._invalidState();return a.wrapper};yy.prototype.whenApplied=function e(){return this._onUpdate()};yy.prototype.refresh=function e(){this._invalidState();return this._onUpdate()};yy.prototype.isEnabled=function e(t){return this._get(t).enabled};yy.prototype._getElementTransformationId=function e(t){var r=t.isNode?this._nodeTransformationIdList:this._edgeTransformationIdList;return r.get(t._index)};yy.prototype.isElementVirtual=function e(t){return!!this._getElementTransformationId(t)};yy.prototype.getElementTransformation=function e(t){var r=this._get(this._getElementTransformationId(t),false);return r&&r.wrapper};function my(e,t,r){for(var i=0;i<r;++i){if(e[i].id!==t[i].id){return false}}return true}Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=new yy(e);e.modules.transformations=i;Object.assign(e.transformations,{getList:function e(){return i.getList()},clear:function e(){return i.clear()},afterNextUpdate:function e(){return i.whenApplied()}});t.prototype.isVirtual=function(){return i.isElementVirtual(this)};r.prototype.isVirtual=function(){return i.isElementVirtual(this)};t.prototype.getTransformation=function(){return i.getElementTransformation(this)};r.prototype.getTransformation=function(){return i.getElementTransformation(this)}});Ogma.extend(function(e){var t=new xy(e);e.modules.pathfinding=t;e.pathfinding={astar:function e(r,i,n){if(n===void 0)n={};return t.astar(r,i,n)},dijkstra:function e(r,i,n){if(n===void 0)n={};return t.dijkstra(r,i,n)},dijkstraBig:function e(r,i,n){if(n===void 0)n={};return t.dijkstraBig(r,i,n)}}});var xy=function e(t){this._graph=t.modules.graph;this._objectList=this._graph.getAttribute(true,"object")};xy.prototype.astar=function e(t,r,i){return Ty(this,t,r,to(i,by))};xy.prototype.dijkstra=function e(t,r,i){return Ty(this,t,r,to(i,Sy))};xy.prototype.dijkstraBig=function e(t,r,i){var n=dijkstra(this._graph.getAdjacencyList({directed:i.directed,ids:true,weight:1,nodes:this._graph.getNodes()}),t._index,r._index,this._graph.getNodes()._indexes,undefined,false);return n.path?new this._graph.NodeList(n.path):null};var by={pathLengthFunction:Ay,heuristicLengthFunction:Ay};var Sy={pathLengthFunction:Ey,heuristicLengthFunction:wy};function Ay(e,t){var r=e.getPosition(),i=t.getPosition();return distance(r.x,r.y,i.x,i.y)}function Ey(){return 1}function wy(){return 0}function Ty(e,t,r,i){if(i===void 0)i={};var n=e._graph.getNode(t)._index,a=e._graph.getNode(r)._index,o=i.pathLengthFunction,s=i.heuristicLengthFunction,u=i.filter,l=i.directed?"out":"both",d=e._objectList,h=d.get(n),f=d.get(a),c=null;if(n===a){c=[n]}else{var v=e._graph.getNodeMaxIndex()+1,g=new xt(Uint32Array),p=new xt(Uint32Array),_=new Int32Array(v),y=new Float32Array(v),m=new Float32Array(v);for(var x=0;x<v;++x){_[x]=-1;y[x]=Infinity;m[x]=Infinity}p.add(n);y[n]=0;m[n]=s(h,f);while(p.length!==0){var b=p.length,S=p.get(0),A=0,E=m[S];for(var w=1;w<b;++w){var T=p.get(w),k=m[T];if(k<E){E=k;S=T;A=w}}if(S===a){c=ky(_,n,a);break}var C=d.get(S);p.removeByPosition(A);g.add(S);var I=new e._graph.Node(S).getAdjacentNodes({direction:l,filter:u})._indexes;for(var M=0;M<I.length;++M){var L=I[M],F=d.get(L);if(g.has(L)){continue}var N=y[S]+o(C,F);if(!p.add(L)&&N>=y[L]){continue}_[L]=S;y[L]=N;m[L]=N+s(F,f)}}}return c?new e._graph.NodeList(c):null}function ky(e,t,r){var i=[r],n=r;while(n!==t){n=e[n];i.push(n)}i.reverse();return i}Ogma.extend(function(e){e.modules.cameraInteractions=new My(e)});var Cy=function(e){var t=e.graphWidth;var r=e.graphHeight;var i=e.viewWidth;var n=e.viewHeight;return Math.min(i/t,n/r)*.2};var Iy=function(e){var t=e.smallestNodeSize;var r=e.viewWidth;var i=e.viewHeight;if(t===Infinity){return Infinity}return Math.min(r,i)/t*.5};var My=function e(t){var r=this;this._ogma=t;this._locate=t.modules.locate;this._dom=t.modules.dom;this._camera=t.modules.camera;this._settings=t.modules.settings;this._interactions=t.modules.interactions;this._graphics=t.modules.graphics;this._settings.register("interactions.zoom.enabled",true);this._settings.register("interactions.zoom.onDoubleClick",false);this._settings.register("interactions.zoom.duration",150);this._settings.register("interactions.zoom.modifier",1.8);this._settings.register("interactions.zoom.easing","quadraticOut");this._settings.register("interactions.zoom.minValue",Cy);this._settings.register("interactions.zoom.maxValue",Iy);this._settings.register("interactions.zoom.hideNodes",false);this._settings.register("interactions.zoom.hideEdges",false);this._settings.register("interactions.zoom.hideNodeTexts",false);this._settings.register("interactions.zoom.hideEdgeTexts",false);this._settings.register("interactions.pan.enabled",true);this._settings.register("interactions.pan.hideNodes",false);this._settings.register("interactions.pan.hideEdges",false);this._settings.register("interactions.pan.hideNodeTexts",false);this._settings.register("interactions.pan.hideEdgeTexts",false);this._settings.register("interactions.rotation.enabled",true);this._settings.register("interactions.rotation.hideNodes",false);this._settings.register("interactions.rotation.hideEdges",false);this._settings.register("interactions.rotation.hideNodeTexts",false);this._settings.register("interactions.rotation.hideEdgeTexts",false);this._settings.register("interactions.gesture.enabled",true);this._settings.register("interactions.gesture.hideNodes",false);this._settings.register("interactions.gesture.hideEdges",false);this._settings.register("interactions.gesture.hideNodeTexts",false);this._settings.register("interactions.gesture.hideEdgeTexts",false);this._zoomWheelEnabled=true;this._interactions.onMouseWheel({priority:"zoom",check:function(){return r._settings.get("interactions.zoom.enabled")&&r._zoomWheelEnabled},handler:function(e){var t=e.x;var i=e.y;var n=e.delta;r._zoomWheelEnabled=false;r._dom.setTimeout(function(){return r._zoomWheelEnabled=true},50);Fy(r,n,t,i)}});this._interactions.onDoubleClick({priority:"zoom",check:function(){var e=r._settings.get("interactions.zoom.enabled");var t=r._settings.get("interactions.zoom.onDoubleClick");return e&&t},handler:function(e){var t=e.x;var i=e.y;return Fy(r,1,t,i)}});this._interactions.onDrag({priority:"panning",disableDetection:true,check:function(e){var t=e.button;var i=r._settings.get("interactions.pan.enabled");return t==="left"&&i},onStart:function(){Ly(r,"pan",true)},onProgress:function(e){var t=e.dx;var i=e.dy;r._camera.move({x:-t,y:-i})},onStop:function(){Ly(r,"pan",false)}});this._interactions.onDrag({priority:"rotation",disableDetection:true,check:function(e){var t=e.button;return t==="right"&&r._settings.get("interactions.rotation.enabled")},onStart:function(e){var t=e.x;var i=e.y;r._rotationStart={x:t,y:i};Ly(r,"rotation",true)},onProgress:function(e){var t=e.x;var i=e.y;r._rotate({x:t,y:i})},onStop:function(){Ly(r,"rotation",false)}});this._interactions.onGesture({priority:"gesture",disableDetection:true,check:function(){return r._settings.get("interactions.gesture.enabled")},onStart:function(){Ly(r,"gesture",true)},onProgress:function(e){var t=e.dx;var i=e.dy;var n=e.rotation;var a=e.scale;var o=e.x;var s=e.y;r._camera.rotate(-n);r._camera.zoomIn(a,undefined,{x:o,y:s});r._camera.move({x:-t,y:-i})},onStop:function(){Ly(r,"gesture",true)}})};My.prototype._rotate=function e(t){var r=t.x;var i=t.y;var n=this._ogma.view.getSize();var a=n.width;var o=n.height;var s=a/2;var u=o/2;var l=this._rotationStart.x-s;var d=this._rotationStart.y-u;var h=r-s;var f=i-u;var c=Math.atan2(d,l)-Math.atan2(f,h);this._rotationStart={x:r,y:i};this._camera.rotate(c)};function Ly(e,t,r){var value=!r;var i=e._settings.get("interactions."+t+".hideNodes");var n=e._settings.get("interactions."+t+".hideEdges");var a=e._settings.get("interactions."+t+".hideNodeTexts");var o=e._settings.get("interactions."+t+".hideEdgeTexts");if(i){e._ogma.styles.setNodesVisibility(value)}if(a){e._ogma.styles.setNodeTextsVisibility(value)}if(n){e._ogma.styles.setEdgesVisibility(value)}if(o){e._ogma.styles.setEdgeTextsVisibility(value)}}function Fy(e,t,r,i){var n=e._settings.get("interactions.zoom.modifier");var a=e._settings.get("interactions.zoom.duration");var o=e._settings.get("interactions.zoom.easing");var s=e._ogma.view.getZoom();var u=s*(t>0?n:1/n);var l={duration:a,easing:o};Ly(e,"zoom",true);e._camera.setZoom(u,l,{refX:r,refY:i}).then(function(){Ly(e,"zoom",false)})}var Ny={layer:xd,outline:true,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var zy={layer:xd,outline:true,color:"red",text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var Py=100;var Oy=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._settings=t.modules.settings;this._captor=t.modules.captor;this._events=t.modules.events;this._delay=Py;this._manualTriggerDetection=false;this._settings.register("cursor.node","pointer",function(value,e){if(r._hovered&&r._hovered.isNode){r._graphics.removeCursorStyle(e);r._graphics.addCursorStyle(value)}});this._settings.register("cursor.edge","pointer",function(value,e){if(r._hovered&&!r._hovered.isNode){r._graphics.removeCursorStyle(e);r._graphics.addCursorStyle(value)}});this._settings.register("nodeHover",true,function(value){if(!value&&r._hovered&&r._hovered.isNode){r._unhoverElement(r._hovered)}});this._settings.register("edgeHover",true,function(value){if(!value&&r._hovered&&!r._hovered.isNode){r._unhoverElement(r._hovered)}});this._hoverExtremityHighlightedClass=this._ogma.styles.createClass({name:dd,isBuiltin:true,nodeAttributes:Ny});this._hoverClass=this._ogma.styles.createClass({name:ld,isBuiltin:true,nodeAttributes:Ny,edgeAttributes:zy});var i=function(){r._hoverExtremityHighlightedClass.clearNodes();r._hoverClass.getEdges().getExtremities().addClass(dd)};this._ogma.events.onEdgesClassAdded(ld,i);this._ogma.events.onEdgesClassRemoved(ld,i);this._timeout=null;this._hovered=null;this._events.on({hover:function(e){var t=e.target;return r._hoverElement(t)},unhover:function(e){var t=e.target;return r._unhoverElement(t)},animate:function(e){var t=e.duration;if(t){r._manualTriggerDetection=true;r._resetHover()}},beforeNewFrame:function(){if(r._manualTriggerDetection&&!r._graphics.isAnimating()){r._manualTriggerDetection=false;r._captor.triggerDetection();var e=r._captor.getPointedElement();if(e){r._hoverElement(e)}}},mouseLeave:function(){r._resetHover()},clear:function(){r._hovered=null;if(r._timeout){r._dom.clearTimeout(r._timeout)}}})};Oy.prototype._resetHover=function e(){if(this._hovered){this._unhoverElement(this._hovered);this._captor.triggerUnhover()}if(this._timeout){this._dom.clearTimeout(this._timeout);this._timeout=null}};Oy.prototype.updateNodeAttributes=function e(t,r){this._hoverClass.update({nodeAttributes:t,fullOverwrite:r});this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};Oy.prototype.updateEdgeAttributes=function e(t,r){this._hoverClass.update({edgeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};Oy.prototype._updateExtremityHighlightLayer=function e(){var t=this._hoverClass.getDefinition().edgeAttributes;var r=t?t.layer:undefined;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:r},fullOverwrite:false})};Oy.prototype.setRate=function e(t){this._delay=t};Oy.prototype._removeTimeout=function e(){if(this._timeout){this._dom.clearTimeout(this._timeout);this._timeout=null}};Oy.prototype._isAnimating=function e(){return this._graphics.isAnimating()};Oy.prototype._hoverElement=function e(t){var r=this;var i=t.isNode?"nodeHover":"edgeHover";var n=this._settings.get(i);if(!n||this._isAnimating()){return}this._removeTimeout();this._timeout=this._dom.setTimeout(function(){if(!r._isAnimating()){r._setElementHighlight(true,t);r._hovered=t}r._timeout=null},this._delay)};Oy.prototype._unhoverElement=function e(t){this._removeTimeout();if(this._hovered===t){this._setElementHighlight(false,t);this._hovered=null}};Oy.prototype._setElementHighlight=function e(t,r){var i=this._settings.get(r.isNode?"cursor.node":"cursor.edge");if(t){this._graphics.addCursorStyle(i);r.addClass(ld)}else{this._graphics.removeCursorStyle(i);r.removeClass(ld)}if(r.isNode&&t){this._graph.getAttribute(r.isNode,"textHidden").set(r._index,false)}};Ogma.extend(function(e){e.modules.hover=new Oy(e);e.styles.setHoveredNodeAttributes=function(t,r){return e.modules.hover.updateNodeAttributes(t,r)};e.styles.setHoveredEdgeAttributes=function(t,r){return e.modules.hover.updateEdgeAttributes(t,r)}});var Dy={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2};var Ry={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2};Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new By(e);e.modules.pulses=a;t.prototype.pulse=function(e){a.pulse(this,e)};i.prototype.pulse=function(e){a.pulse(this,e)};r.prototype.pulse=function(e){a.pulse(this,e)};n.prototype.pulse=function(e){a.pulse(this,e)}});var By=function e(t){this._graph=t.modules.graph;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._events=t.modules.events;this._engine=this._graphics.getGraphicsEngine();this._block=this._engine.createBlock()};By.prototype.pulse=function e(t,r){var i=this;this._dom.setTimeout(function(){return i._doPulse(t,r)},0)};By.prototype._doPulse=function e(t,r){var i=this;var n=t.isNode;var a=to(r,n?Dy:Ry);var o=a.number;var s=a.interval;var u=0;for(var l=0;l<o;++l){i._dom.setTimeout(function(){if(n){i._singleNodePulse(t,a)}else{i._singleEdgePulse(t,a)}},u);u+=s}};By.prototype._singleNodePulse=function e(t,r){var i=this;var n=r.startRatio;var a=r.endRatio;var o=r.startColor;var s=r.endColor;var u=r.width;var l=r.duration;var d=t._indexes;var h=this._engine.getCurrentTime();var f=this._graphics.getNodeAttributes();var c=f.layer;var v=f.x;var g=f.y;var p=f.radius;var _=f.color;var y=new Array(d.length);n=Math.min(n,8);a=Math.min(a,8);for(var m=0;m<d.length;++m){var x=d[m];var b=_.get(x);var S=c.get(x);var A=v.get(x);var E=g.get(x);var w=p.get(x);var T=w*2*n;var k=w*2*a;var C=ch(S).nodeBody;var I=i._graphics.allocateGraphicsEngineBlockId();var M=i._block.reset(Zo,true,C);var L=M.nextAndReset();var F=jy(o,b);var N=jy(s,b);L.end.shape="circle";L.end.pieceId=ns;L.end.x1=A;L.end.y1=E;L.end.x2=A;L.end.y2=E;L.end.rectWidthOrSourceRadiusScaled=k;L.end.rectHeightTargetRadiusScaled=k;L.end.strokeWidthFixed=u;L.end.strokeColor=N;L.start.shape="circle";L.start.pieceId=ns;L.start.x1=A;L.start.y1=E;L.start.x2=A;L.start.y2=E;L.start.rectWidthOrSourceRadiusScaled=T;L.start.rectHeightTargetRadiusScaled=T;L.start.strokeWidthFixed=u;L.start.strokeColor=F;L.animation.duration=l;L.animation.beginTime=h;i._engine.storeBlock(I,M);y[m]=I}this._dom.setTimeout(function(){for(var e=0;e<y.length;++e){i._graphics.releaseGraphicsEngineBlockId(y[e])}},l);this._dom.refresh(h+l)};By.prototype._singleEdgePulse=function e(t,r){var i=this;var n=r.startRatio;var a=r.endRatio;var o=r.startColor;var s=r.endColor;var u=r.duration;var l=r.width;var d=t._indexes;var h=new Array(d.length);var f=this._engine.getCurrentTime();var c=this._graphics.getEdgeAttributes();var v=this._graphics.getNodeAttributes();for(var g=0;g<d.length;++g){var p=d[g];var _=c.layer.get(p);var y=ch(_).edgeBody;var m=c.source.get(p);var x=c.target.get(p);var b=c.curvature.get(p);var S=b!==0;var A=i._graphics.allocateGraphicsEngineBlockId();var E=i._block.reset(S?Qo:Zo,true,y);var w=E.nextAndReset();var T={isSelfLoop:m===x,curvature:b,sourceX:v.x.get(m),sourceY:v.y.get(m),targetX:v.x.get(x),targetY:v.y.get(x),sourceRadius:v.radius.get(m),targetRadius:v.radius.get(x),isSourceRadiusScaled:v.scalingMethod.get(m)==="scaled",isTargetRadiusScaled:v.scalingMethod.get(x)==="scaled",width:c.width.get(p),isWidthScaled:c.scalingMethod.get(p)==="scaled",strokeWidth:l};Uy(w.start,T);Uy(w.end,T);w.start.strokeColor=o;w.end.strokeColor=s;w.start.thicknessOrFontSizeScaled*=n;w.start.thicknessOrFontSizeFixed*=n;w.end.thicknessOrFontSizeScaled*=a;w.end.thicknessOrFontSizeFixed*=a;w.animation.duration=u;w.animation.beginTime=f;i._engine.storeBlock(A,E);h[g]=A}this._dom.setTimeout(function(){for(var e=0;e<h.length;++e){i._graphics.releaseGraphicsEngineBlockId(h[e])}},u);this._dom.refresh(f+u)};function jy(e,t){if(e==="inherit"){return Array.isArray(t)?t[0]:t}else{return e}}function Uy(e,t){e.pieceId=as;e.shape="line";e.x1=t.sourceX;e.y1=t.sourceY;e.x2=t.targetX;e.y2=t.targetY;e.rectWidthOrSourceRadiusScaled=t.isSourceRadiusScaled?t.sourceRadius:0;e.rectWidthOrSourceRadiusFixed=t.isSourceRadiusScaled?0:t.sourceRadius;e.rectHeightTargetRadiusScaled=t.isTargetRadiusScaled?t.targetRadius:0;e.rectHeightTargetRadiusFixed=t.isTargetRadiusScaled?0:t.targetRadius;e.thicknessOrFontSizeScaled=t.isWidthScaled?t.width:0;e.thicknessOrFontSizeFixed=t.isWidthScaled?0:t.width;e.strokeWidthFixed=t.strokeWidth;e.curvature=t.curvature;e.isSelfLoop=t.isSelfLoop}var Vy={layer:md,outline:true,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var Gy={layer:md,color:"red",outline:true,text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0},stroke:{width:2}};var Wy=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._settings=t.modules.settings;this._graph=t.modules.graph;this._keyboard=t.modules.keyboard;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._selectionExtremityHighlightedClass=this._ogma.styles.createClass({name:fd,isBuiltin:true,nodeAttributes:Vy});this._selectedClass=this._ogma.styles.createClass({name:hd,isBuiltin:true,nodeAttributes:Vy,edgeAttributes:Gy});var i=function(){r._selectionExtremityHighlightedClass.clearNodes();r._selectedClass.getEdges().getExtremities().addClass(fd)};this._ogma.events.onEdgesClassAdded(hd,i);this._ogma.events.onEdgesClassRemoved(hd,i);this._settings.register("interactions.selection.enabled",true);this._settings.register("interactions.selection.multiSelectionKey","ctrl");this._interactions.onClick({priority:"selection",check:function(e){var t=e.button;var i=r._settings.get("interactions.selection.enabled");return t==="left"&&i&&!r._graphics.isAnimating()},handler:function(e){var t=e.target;if(!t){r._selectedClass.clearNodes();r._selectedClass.clearEdges()}else{var i=r._settings.get("interactions.selection.multiSelectionKey");var n=i&&r._keyboard.isPressed(i);if(t.isNode){r._selectedClass.clearEdges()}else{r._selectedClass.clearNodes()}if(!n){var a=t.isNode?r._selectedClass.getNodes():r._selectedClass.getEdges();a.filter(function(e){return e!==t}).removeClass(hd);if(!t.hasClass(hd)){t.addClass(hd)}}else if(t.hasClass(hd)){t.removeClass(hd)}else{t.addClass(hd)}}}});this._events.on("beforeRemoveEdges",function(e){var t=e.edges;return t.setSelected(false)})};Wy.prototype.setNodeAttributes=function e(t,r){this._selectedClass.update({nodeAttributes:t,fullOverwrite:r});this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};Wy.prototype.setEdgeAttributes=function e(t,r){this._selectedClass.update({edgeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};Wy.prototype._updateExtremityHighlightLayer=function e(){var t=this._selectedClass.getDefinition().edgeAttributes;var r=t?t.layer:undefined;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:r},fullOverwrite:false})};Wy.prototype.setActive=function e(t,r){if(T(r)){var i=function(e,t){return r[t]?"toSelect":"toUnselect"};var n=i.toSelect;var a=i.toUnselect;if(n){n.addClass(hd)}if(a){n.removeClass(hd)}}else{t[r?"addClass":"removeClass"](hd)}};Wy.prototype.areActive=function e(t){return t.hasClass(hd)};Wy.prototype.getSelectedNodes=function e(){return this._selectedClass.getNodes()};Wy.prototype.getSelectedEdges=function e(){return this._selectedClass.getEdges()};Wy.prototype.getNonSelectedNodes=function e(){return this._graph.getNodes().filter(function(e){return!e.hasClass(hd)})};Wy.prototype.getNonSelectedEdges=function e(){return this._graph.getEdges().filter(function(e){return!e.hasClass(hd)})};Wy.prototype.clear=function e(){this._selectedClass.clearNodes();this._selectedClass.clearEdges()};Ogma.extend(function(e){var t=new Wy(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.selection=t;e.events.onNodesSelected=function(t){return e.events.onNodesClassAdded(hd,t)};e.events.onNodesUnselected=function(t){return e.events.onNodesClassRemoved(hd,t)};e.events.onEdgesSelected=function(t){return e.events.onEdgesClassAdded(hd,t)};e.events.onEdgesUnselected=function(t){return e.events.onEdgesClassRemoved(hd,t)};e.styles.setSelectedNodeAttributes=function(e,r){return t.setNodeAttributes(e,r)};e.styles.setSelectedEdgeAttributes=function(e,r){return t.setEdgeAttributes(e,r)};e.clearSelection=function(){return t.clear()};e.getSelectedNodes=function(){return t.getSelectedNodes()};e.getNonSelectedNodes=function(){return t.getNonSelectedNodes()};e.getSelectedEdges=function(){return t.getSelectedEdges()};e.getNonSelectedEdges=function(){return t.getNonSelectedEdges()};r.prototype.setSelected=function(e){t.setActive(this,e)};r.prototype.isSelected=function(){return t.areActive(this)};n.prototype.setSelected=function(e){t.setActive(this,e)};n.prototype.isSelected=function(){return t.areActive(this)};i.prototype.setSelected=function(e){t.setActive(this,e)};i.prototype.isSelected=function(){return t.areActive(this)};a.prototype.setSelected=function(e){t.setActive(this,e)};a.prototype.isSelected=function(){return t.areActive(this)}});Ogma.extend(function(e){e.modules.drag=new Hy(e);e.events.onNodeDragStart=function(t){e.modules.events.on("startMoveNodesByDragging",t);return e.events};e.events.onNodeDragProgress=function(t){e.modules.events.on("progressMoveNodesByDragging",t);return e.events};e.events.onNodeDragEnd=function(t){e.modules.events.on("endMoveNodesByDragging",t);return e.events}});var Hy=function e(t){var r=this;this._graph=t.modules.graph;this._camera=t.modules.camera;this._graphics=t.modules.graphics;this._selection=t.modules.selection;this._events=t.modules.events;this._settings=t.modules.settings;this._captor=t.modules.captor;t.styles.createClass({name:cd,isBuiltin:true,nodeAttributes:{layer:bd}});this._events.register(["startMoveNodesByDragging","progressMoveNodesByDragging","endMoveNodesByDragging"]);this._settings.register("interactions.drag.enabled",true);this._settings.register("interactions.drag.cursor","move");this._settings.register("interactions.drag.onBeforeDrag",null);this._settings.register("interactions.drag.applyResult",true);this._dragged=null;this._start=null;this._end=null;this._startDrag=null;t.modules.interactions.onDrag({priority:"drag",disableDetection:true,check:function(e){var t=e.target;var i=e.button;var n=i==="left";var a=r._settings.get("interactions.drag.enabled");var o=t&&t.isNode&&t.getAttribute("draggable");return n&&a&&o},onStart:function(e){var t=e.x;var i=e.y;var n=e.target;if(n.isSelected()){r._dragged=r._selection.getSelectedNodes().filter(function(e){return e.getAttribute("draggable")})}else{r._dragged=n.toList()}r._start=r._dragged.getPosition();r._end=U(r._start);r._onBeforeDrag=r._settings.get("interactions.drag.onBeforeDrag");r._startDrag=r._camera.screenToGraphCoordinates({x:t,y:i});r._dragged.addClass(cd);r._events.fire("startMoveNodesByDragging",{nodes:r._dragged});r._graphics.addCursorStyle(r._settings.get("interactions.drag.cursor"))},onProgress:function(){var e=r._captor.getCursorInformation();var t=e.x;var i=e.y;var n=r._dragged._indexes;var a=r._camera.screenToGraphCoordinates({x:t,y:i});var o=a.x-r._startDrag.x;var s=a.y-r._startDrag.y;for(var u=0;u<n.length;++u){var l=r._start[u];var d=r._end[u];d.x=l.x+o;d.y=l.y+s}if(r._onBeforeDrag){r._onBeforeDrag(r._dragged,t,i,r._end)}if(r._settings.get("interactions.drag.applyResult")){r._dragged.setAttributes(r._end,null,["x","y"])}r._events.fire("progressMoveNodesByDragging",{nodes:r._dragged,dx:o,dy:s})},onStop:function(){r._dragged.removeClass(cd);r._graphics.removeCursorStyle(r._settings.get("interactions.drag.cursor"));r._events.fire("endMoveNodesByDragging",{nodes:r._dragged,start:r._start,end:r._end});r._dragged=null;r._start=null;r._end=null}})};Ogma.extend(function(e){var t=new qy(e);e.modules.filters=t;Object.assign(e.transformations,{addNodeFilter:function e(r){return t.addNodeFilter(r)},addEdgeFilter:function e(r){return t.addEdgeFilter(r)}});Object.assign(e,{addNodeFilter:function t(r){return e.transformations.addNodeFilter(r)},addEdgeFilter:function t(r){return e.transformations.addEdgeFilter(r)},getNodeFilters:function t(){return e.transformations.getList().filter(function(e){return e.getName()==="node-filter"})},getEdgeFilters:function t(){return e.transformations.getList().filter(function(e){return e.getName()==="edge-filter"})},clearNodeFilters:function t(){return Promise.all(e.getNodeFilters().map(function(e){return e.destroy()}))},clearEdgeFilters:function t(){return Promise.all(e.getEdgeFilters().map(function(e){return e.destroy()}))}})});function Xy(e){if(typeof e!=="object"){return{criteria:e,enabled:true,duration:0}}else{return e}}var qy=function e(t){this._transformations=t.modules.transformations};qy.prototype.addNodeFilter=function e(t){var r=Xy(t);var i=r.criteria;var n=r.enabled;var a=r.duration;return this._transformations.add(new Zy(i),{enabled:n,duration:a})};qy.prototype.addEdgeFilter=function e(t){var r=Xy(t);var i=r.criteria;var n=r.enabled;var a=r.duration;return this._transformations.add(new Ky(i),{enabled:n,duration:a})};var Yy=function e(t){this._getNodesToFilter=t.getNodesToFilter;this._getEdgesToFilter=t.getEdgesToFilter};Yy.prototype.run=function e(t){var r=t.ogma;var i=t.duration;var n=this._getNodesToFilter(r);var a=this._getEdgesToFilter(r,n);return Promise.all([n.addClass(_d,i),a.addClass(_d,i)]).then(function(){n.setExcluded(true);a.setExcluded(true);return{nodes:n,edges:a}})};Yy.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.nodes;var a=i.edges;n.setExcluded(false);a.setExcluded(false);n.addClass(_d);a.addClass(_d);return Promise.all([n.removeClass(_d,r),a.removeClass(_d,r)])};var Zy=function(e){function t(t){e.call(this,{getNodesToFilter:function(e){return e.getNodes().filter(function(e){return!t(e)})},getEdgesToFilter:function(e,t){return t.getAdjacentEdges()}})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"node-filter"};return t}(Yy);var Ky=function(e){function t(t){e.call(this,{getNodesToFilter:function(e){return e.createNodeList()},getEdgesToFilter:function(e){return e.getEdges().filter(function(e){return!t(e)})}})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"edge-filter"};return t}(Yy);var Qy=function e(t){this._nodeSelector=t.nodeSelector;this._nodeGroupIdFunction=t.nodeGroupIdFunction;this._nodeGenerator=t.nodeGenerator;this._edgeSelector=t.edgeSelector;this._edgeGroupIdFunction=t.edgeGroupIdFunction;this._edgeGenerator=t.edgeGenerator;this._edgeSource=t.edgeSource;this._edgeTarget=t.edgeTarget;this._separateEdgesByDirection=t.separateEdgesByDirection;this._groupSelfLoopEdges=t.groupSelfLoopEdges;this._groupEdges=t.groupEdges};Qy.prototype._computeNodeGroupId=function e(t){return this._nodeSelector(t)?this._nodeGroupIdFunction(t):undefined};Qy.prototype._computeEdgeGroupId=function e(t){return this._edgeSelector(t)?this._edgeGroupIdFunction(t):undefined};Qy.prototype._addMetaNodes=function e(t,r){var i=this;var n=r.getId();var a=t.getNodes();var o=new yt;for(var s=0;s<a.size;++s){var u=a.get(s);var l=i._computeNodeGroupId(u);if(l!==undefined){var d=o.get(l);if(!d){d={id:l,nodes:[]};o.set(l,d)}d.nodes.push(u)}}var h=o.values();var f=h.map(function(e){var r=e.nodes;return t.getNodes(r)});var c=[];for(var v=0;v<h.length;++v){var g=h[v].id;var p=f[v];var _=i._nodeGenerator(p,g,r);if(_.id===undefined){_.id=tm(g,n)}_.position=qr(p.getPosition());c.push(_)}return t.addNodes(c.map(function(e){return{id:e.id,attributes:e.position}}),{virtual:true}).then(function(){var e=t.getNodes(c.map(function(e){return e.id}));e.replaceOriginalAttributes(c.map(function(e){return e.attributes}),["x","y"]);e.setData(null,c.map(function(e){return e.data}));t.modules.grouping.setSubElements(e,f);f.forEach(function(r,i){t.modules.grouping.setMetaElement(r,e.get(i))});return e})};Qy.prototype._addMetaEdges=function e(t,r){var i=this;var n=r.getId();var a=t.getEdges();var o=new yt;var s=t.modules.graphics.getAttributesManager().getUsedEdgeAttributes();for(var u=0;u<a.size;++u){var l=a.get(u);var d=i._computeEdgeGroupId(l);if(d!==undefined){var h=i._edgeSource(l);var f=i._edgeTarget(l);var c=i._groupEdges?$y(d,h.getId(),f.getId(),i._separateEdgesByDirection):l.getId();var v=o.get(c);if(!v){v={id:c,source:h,target:f,edges:[]};o.set(c,v)}v.edges.push(l)}}var g=o.values();var p=g.map(function(e){var r=e.edges;return t.getEdges(r)});var _=[];for(var y=0;y<g.length;++y){var m=g[y];var x=m.id;var b=p[y];var S=i._groupEdges?i._edgeGenerator(b,x,r):em(b,s);if(S.id===undefined){S.id=tm(x,n)}S.source=m.source;S.target=m.target;_.push(S)}return t.addEdges(Jy(_),{virtual:true}).then(function(){var e=t.getEdges(_.map(function(e){return e.id}));e.replaceOriginalAttributes(_.map(function(e){return e.attributes}));e.setData(null,_.map(function(e){return e.data}));t.modules.grouping.setSubElements(e,p);p.forEach(function(r,i){t.modules.grouping.setMetaElement(r,e.get(i))});return e})};function Jy(e){return e.map(function(e){var t=e.id;var r=e.source;var i=e.target;return{id:t,source:r,target:i}})}function $y(e,t,r,i){var n=t;var a=r;if(!i&&n.toString()>a.toString()){n=r;a=t}return e+"["+n+"-"+a+"]"}function em(e,t){var r=e.get(0);return{data:r.getData(),attributes:r.getAttributes(t)}}function tm(e,t){return"gen_grp_"+t+"_"+e}var rm=function(e){function t(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.groupIdFunction;if(i===void 0)i=function(){return""};var n=t.nodeGenerator;if(n===void 0)n=function(){return{}};var a=t.edgeGenerator;if(a===void 0)a=function(){return{}};var o=t.separateEdgesByDirection;if(o===void 0)o=false;var s=t.groupSelfLoopEdges;if(s===void 0)s=false;var u=t.groupEdges;if(u===void 0)u=true;var l=t.restorePositions;if(l===void 0)l=true;e.call(this,{nodeSelector:r,nodeGroupIdFunction:i,nodeGenerator:n,edgeSelector:function(e){return e.getSource().getMetaNode()||e.getTarget().getMetaNode()},edgeGroupIdFunction:function(){return""},edgeGenerator:a,edgeSource:function(e){return im(e.getSource())},edgeTarget:function(e){return im(e.getTarget())},separateEdgesByDirection:o,groupEdges:u});this._groupSelfLoopEdges=s;this._restorePositions=l}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"node-grouping"};t.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.wrapper;var o,s,u,l,d;return this._addMetaNodes(i,a).then(function(e){o=e;o.setVisible(false);return r._addMetaEdges(i,a)}).then(function(e){s=e;s.setVisible(false);u=o.getSubNodes().reduce(function(e,value){return e.concat(value)},i.createNodeList());l=s.getSubEdges().reduce(function(e,value){return e.concat(value)},i.createEdgeList());var t=i.getNodes(u.getMetaNode()).getPosition();d=u.getPosition().map(function(e,r){var i=t[r];return{x:e.x-i.x,y:e.y-i.y}});return u.setAttributes(t,n)}).then(function(){u.setVisible(false);l.setVisible(false);o.setVisible(true);s.filter(function(e){return r._groupSelfLoopEdges||e.getSource()!==e.getTarget()}).setVisible(true);return{metaNodes:o,metaEdges:s,subNodes:u,subEdges:l,offsets:d}})};t.prototype.undo=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.context;var o=a.metaNodes;var s=a.metaEdges;var u=a.subNodes;var l=a.subEdges;var d=a.offsets;var h=i.getNodes(u.getMetaNode()).getPosition();var f=h.map(function(e,t){return nm(e,d[t])});u.setVisible(true);l.setVisible(true);i.modules.grouping.setMetaElement(u,null);i.modules.grouping.setMetaElement(l,null);o.setVisible(false);s.setVisible(false);return u.setAttributes(h).then(function(){if(r._restorePositions){return u.setAttributes(f,n)}})};t.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.metaNodes;var a=i.metaEdges;var o=n.filter(function(e){return!e.isVisible()});var s=a.filter(function(e){return!e.isVisible()});return Promise.all([r.removeEdges(s,{virtual:true}),r.removeNodes(o,{virtual:true})])};return t}(Qy);function im(e){return e.getMetaNode()||e}function nm(e,t){return{x:e.x+t.x,y:e.y+t.y}}var am=function(e){function t(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.groupIdFunction;if(i===void 0)i=function(){return""};var n=t.generator;if(n===void 0)n=function(){return{}};var a=t.separateEdgesByDirection;if(a===void 0)a=false;e.call(this,{nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:r,edgeGroupIdFunction:i,edgeGenerator:n,edgeSource:function(e){return e.getSource()},edgeTarget:function(e){return e.getTarget()},separateEdgesByDirection:a,groupEdges:true})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"edge-grouping"};t.prototype.run=function e(t){var r=t.ogma;var i=t.wrapper;var n,a;return this._addMetaEdges(r,i).then(function(e){n=e;a=n.getSubEdges().reduce(function(e,value){return e.concat(value)},r.createEdgeList());a.setVisible(false);return{metaEdges:n,subEdges:a}})};t.prototype.undo=function e(t){var r=t.context;var i=r.metaEdges;var n=r.subEdges;n.setVisible(true);i.setVisible(false)};t.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.metaEdges;return r.removeEdges(n.filter(function(e){return!e.isVisible()}),{virtual:true})};return t}(Qy);Ogma.extend(function(e){var t=e.Node;var r=e.NodeList;var i=e.Edge;var n=e.EdgeList;var a=new om(e);e.modules.grouping=a;e.transformations.addNodeGrouping=function(e){return a.addNodeGrouping(e)};e.transformations.addEdgeGrouping=function(e){return a.addEdgeGrouping(e)};t.prototype.getMetaNode=function(){return this._ogma.modules.grouping.getMetaElement(this)[0]};r.prototype.getMetaNode=function(){return this._ogma.modules.grouping.getMetaElement(this)};t.prototype.getSubNodes=function(){return this._ogma.modules.grouping.getSubElements(this)[0]};r.prototype.getSubNodes=function(){return this._ogma.modules.grouping.getSubElements(this)};i.prototype.getMetaEdge=function(){return this._ogma.modules.grouping.getMetaElement(this)[0]};n.prototype.getMetaEdge=function(){return this._ogma.modules.grouping.getMetaElement(this)};i.prototype.getSubEdges=function(){return this._ogma.modules.grouping.getSubElements(this)[0]};n.prototype.getSubEdges=function(){return this._ogma.modules.grouping.getSubElements(this)}});var om=function e(t){this._ogma=t;this._graph=t.modules.graph;this._transformations=t.modules.transformations;this._subNodesList=this._graph.createNodeAttribute({storage:"any",default:null});this._subEdgesList=this._graph.createEdgeAttribute({storage:"any",default:null});this._metaNodeList=this._graph.createNodeAttribute({storage:"any",default:null});this._metaEdgeList=this._graph.createEdgeAttribute({storage:"any",default:null})};om.prototype._fetchSubEltsList=function e(t){return t.isNode?this._subNodesList:this._subEdgesList};om.prototype._fetchMetaEltList=function e(t){return t.isNode?this._metaNodeList:this._metaEdgeList};om.prototype.setSubElements=function e(t,r){this._fetchSubEltsList(t).setMultiple(t._indexes,r)};om.prototype.setMetaElement=function e(t,r){this._fetchMetaEltList(t).setMultiple(t._indexes,r)};om.prototype.getSubElements=function e(t){return this._fetchSubEltsList(t).getMultiple(t._indexes)};om.prototype.getMetaElement=function e(t){return this._fetchMetaEltList(t).getMultiple(t._indexes)};om.prototype.addNodeGrouping=function e(t){if(t===void 0)t={};return this._transformations.add(new rm(t),t)};om.prototype.addEdgeGrouping=function e(t){if(t===void 0)t={};return this._transformations.add(new am(t),t)};var sm=function e(t){this._transformations=t.modules.transformations};sm.prototype.addNodeCollapsing=function e(t){if(t===void 0)t={};return this._transformations.add(new um(t),t)};var um=function e(t){var r=t.selector;if(r===void 0)r=function(){return false};var i=t.edgeGenerator;if(i===void 0)i=function(){return{}};this._selector=r;this._edgeGenerator=i};um.prototype.getName=function e(){return"node-collapsing"};um.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=i.getNodes().filter(this._selector);var o=a.getAdjacentEdges();var s=[];for(var u=0;u<a.size;++u){var l=a.get(u);var d=l.getAdjacentNodes().filter(function(e){return!r._selector(e)});for(var h=0;h<d.size-1;++h){var f=d.get(h);var c=i.modules.graph.getEdgesBetweenTwoNodes(l,f);if(f===l){continue}for(var v=h+1;v<d.size;++v){var g=d.get(v);var p=i.modules.graph.getEdgesBetweenTwoNodes(l,g);var _=r._edgeGenerator(c,p,f,g);if(_){var y=k(_);for(var m=0;m<y.length;++m){var x=y[m];lm(i,x,m,f,g,c,p);s.push(x)}}}}}return i.addEdges(s,{virtual:true}).then(function(e){return e.addClass(pd)}).then(function(e){return Promise.all([e.removeClass(pd,n),a.addClass(pd,n),o.addClass(pd,n)])}).then(function(e){var t=e[0];a.setVisible(false);o.setVisible(false);return{virtualEdges:t,hiddenNodes:a,hiddenEdges:o}})};um.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.virtualEdges;var a=i.hiddenNodes;var o=i.hiddenEdges;a.setVisible(true);o.setVisible(true);return Promise.all([a.addClass(pd),o.addClass(pd)]).then(function(){return Promise.all([a.removeClass(pd,r),o.removeClass(pd,r),n.addClass(pd,r)])}).then(function(){n.setVisible(false)})};um.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;return r.removeEdges(i.virtualEdges.filter(function(e){return!e.isVisible()}),{virtual:true})};function lm(e,t,r,i,n,a,o){var s=null;var u=null;if(t.source!==undefined){s=e.getNode(t.source);if(s!==i&&s!==n){throw new Error(["addNodeCollapsing: edge generator produced RawEdge with invalid source ["+t.source+"]","expected to be ["+i.getId()+"] or ["+n.getId()+"]"].join("; "))}}if(t.target!==undefined){u=e.getNode(t.target);if(u!==i&&u!==n){throw new Error(["addNodeCollapsing: edge generator produced RawEdge with invalid target ["+t.target+"]","expected to be ["+i.getId()+"] or ["+n.getId()+"]"].join("; "))}}if(s&&u&&s===u){throw new Error("addNodeCollapsing: edge generator produced RawEdge with same source and target ["+s.getId()+"]")}if(s&&!u){u=s===i?n:i}else if(u&&!s){s=u===i?n:i}else if(!s&&!u){var l=true;for(var d=0;d<a.size;++d){var h=a.get(d);if(h.getSource()===i){l=false}}for(var f=0;f<o.size;++f){var c=o.get(f);if(c.getTarget()===n){l=false}}if(l){s=n;u=i}else{s=i;u=n}}t.id="_gen_"+s.getId()+"_"+u.getId()+"_"+r;t.source=s;t.target=u}Ogma.extend(function(e){e.modules.nodeCollapsing=new sm(e);Object.assign(e.transformations,{addNodeCollapsing:function t(r){return e.modules.nodeCollapsing.addNodeCollapsing(r)}})});var dm=function e(t){var r=t.nodeSelector;if(r===void 0)r=function(){return true};var i=t.edgeSelector;if(i===void 0)i=function(){return true};var n=t.nodeDataFunction;if(n===void 0)n=null;var a=t.edgeDataFunction;if(a===void 0)a=null;this._nodeSelector=r;this._edgeSelector=i;this._nodeDataFunction=n;this._edgeDataFunction=a};dm.prototype.getName=function e(){return"virtual-properties"};dm.prototype.run=function e(t){var r=t.ogma;var i={nodes:null,oldNodesData:null,edges:null,oldEdgesData:null};if(this._nodeDataFunction){i.nodes=r.getNodes().filter(this._nodeSelector);i.oldNodesData=hm(i.nodes,this._nodeDataFunction)}if(this._edgeDataFunction){i.edges=r.getEdges().filter(this._edgeSelector);i.oldEdgesData=hm(i.edges,this._edgeDataFunction)}return i};dm.prototype.undo=function e(t){var r=t.context;var i=r.nodes;var n=r.oldNodesData;var a=r.edges;var o=r.oldEdgesData;if(i){i.setData(n)}if(a){a.setData(o)}};dm.prototype.cleanup=function e(){};function hm(e,t){var r=[];for(var i=0;i<e.size;++i){var n=e.get(i);var a=n.getData();var o=t(n);var s=$(a,o);r.push(a);n.setData(s)}return r}Ogma.extend(function(e){Object.assign(e.transformations,{addVirtualProperties:function t(r){return e.modules.transformations.add(new dm(r),r)}})});var fm=function e(t){var r=t.selector;if(r===void 0)r=function(){return false};var i=t.dataFunction;if(i===void 0)i=function(){return undefined};this._selector=r;this._dataFunction=i};fm.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=i.getNodes().filter(this._selector);var o=[];var s=new yt;for(var u=0;u<a.size;++u){var l=a.get(u);var d=l.getAdjacentEdges();var h=r._dataFunction(l);for(var f=0;f<d.size;++f){var c=d.get(f);var v=c.getSource();var g=c.getTarget();if(v!==g&&h!==undefined){var p=v===l?g:v;var _=s.get(p);if(!_){_=[];s.set(p,_)}_.push(h)}o.push(c)}}var y=i.getEdges(o);var m=i.getNodes(s.keys());var x=s.values();var b=m.getData();var S=new Array(m.size);for(var A=0;A<S.length;++A){var E=x[A];var w=b[A];for(var T=0;T<E.length;++T){w=$(w,E[T])}S[A]=w}return Promise.all([a.addClass(pd,n),y.addClass(pd,n)]).then(function(){a.setVisible(false);y.setVisible(false);m.setData(S);return{hiddenNodes:a,hiddenEdges:y,nodesWithDataChange:m,oldDataList:b}})};fm.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.hiddenNodes;var a=i.hiddenEdges;var o=i.nodesWithDataChange;var s=i.oldDataList;n.setVisible(true);a.setVisible(true);n.addClass(pd);a.addClass(pd);return Promise.all([n.removeClass(pd,r),a.removeClass(pd,r)]).then(function(){o.setData(s)})};fm.prototype.cleanup=function e(){};Ogma.extend(function(e){Object.assign(e.transformations,{addNeighborMerging:function t(r){return e.modules.transformations.add(new fm(r),r)}})});var cm=function e(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.neighborIdFunction;if(i===void 0)i=function(){return null};var n=t.nodeGenerator;if(n===void 0)n=function(){return{}};var a=t.edgeGenerator;if(a===void 0)a=function(){return{}};this._generateIds=function(e){return r(e)&&i(e)};this._nodeGenerator=n;this._edgeGenerator=a};cm.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.wrapper;var o=a.getId();var s=i.getNodes();var u=new yt;for(var l=0;l<s.size;++l){var d=s.get(l);var h=vm(r._generateIds(d));if(h){for(var f=0;f<h.length;++f){var c=h[f];var v=u.get(c);if(!v){v=[];u.set(c,v)}v.push(d)}}}var g=new Array(u.size);var p=u.keys();var _=u.values().map(function(e){return i.getNodes(e)});for(var y=0;y<g.length;++y){var m=p[y];var x=_[y];var b=r._nodeGenerator(m,x);b.id="_gen_"+o+"_"+m;b.position=qr(x.getPosition());g[y]=b}var S,A;return i.addNodes(g.map(function(e){return{id:e.id,attributes:e.position}}),{virtual:true}).then(function(e){S=e;S.replaceOriginalAttributes(g.map(function(e){return e.attributes}),["x","y"]);S.setData(null,g.map(function(e){return e.data}));var t=[];for(var n=0;n<e.size;++n){var a=e.get(n);var o=_[n];for(var s=0;s<o.size;++s){var u=o.get(s);var l=r._edgeGenerator(u,a);if(!l.source&&!l.target){l.source=u;l.target=a}t.push(l)}}return i.addEdges(t,{virtual:true})}).then(function(e){A=e;S.setVisible(true);A.setVisible(true);S.addClass(pd);A.addClass(pd);return Promise.all([S.removeClass(pd,n),A.removeClass(pd,n)])}).then(function(){return{virtualNodes:S,virtualEdges:A}})};cm.prototype.undo=function e(t){var r=t.context;var i=t.duration;var n=r.virtualNodes;var a=r.virtualEdges;return Promise.all([n.addClass(pd,i),a.addClass(pd,i)]).then(function(){n.setVisible(false);a.setVisible(false)})};cm.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.virtualNodes.filter(function(e){return!e.isVisible()});var a=i.virtualEdges.filter(function(e){return!e.isVisible()});r.removeNodes(n,{virtual:true});r.removeEdges(a,{virtual:true})};function vm(value){return Array.isArray(value)?value:value?[value]:null}Ogma.extend(function(e){Object.assign(e.transformations,{addNeighborGeneration:function t(r){return e.modules.transformations.add(new cm(r),r)}})});var gm=function e(t){this._ogma=t;this._graph=t.modules.graph;this._nodeList=this._graph.getNodeAttribute("object");this._edgeList=this._graph.getEdgeAttribute("object");this._sourceList=this._graph.getEdgeAttribute("source");this._targetList=this._graph.getEdgeAttribute("target");this._excludedList=this._graph.getEdgeAttribute("excluded");this._virtualList=this._graph.getEdgeAttribute("virtual")};gm.prototype.shortestPath=function e(t){var r=this;if(t===void 0)t={};var i=t.source;var n=t.target;var a=t.directed;if(a===void 0)a=false;var o=t.filter;if(o===void 0)o="visible";var s=t.edgeCostFunction;if(s===void 0)s=function(){return 1};var u=t.heuristicFunction;if(u===void 0)u=function(){return 0};var l=this._ogma.getNode(i);var d=this._ogma.getNode(n);if(!l){throw new Error("the source is not a node")}if(!d){throw new Error("the target is not a node")}var h=l._index;var f=d._index;var c=null;if(h===f){c={nodes:l.toList(),edges:this._ogma.createEdgeList()}}else{var v=this._graph.getNodeMaxIndex()+1;var g=new Int32Array(v);var p=new Float32Array(v);var _=new Float32Array(v);var y=new Ot;var m=new Cr(_);p.fill(Infinity);_.fill(Infinity);g.fill(-1);m.add(h);p[h]=0;_[h]=u(l,d);while(!m.isEmpty()){var x=m.removeMin();if(x===f){c=r._constructPath(g,h,f);break}y.add(x);var b=r._graph.getAdjacentDirections(x);if(!b){continue}for(var S=0;S<b.length;++S){var A=b[S];var E=r._graph.getEdgeIndexesInDirection(A);var w=-1;var T=0;var k=-1;for(var C=0;C<E.length;++C){var I=E[C];var M=r._sourceList.get(I);var L=r._targetList.get(I);if(M===L){continue}if(a&&x!==M){continue}if(o==="visible"&&r._excludedList.get(I)){continue}if(o==="raw"&&r._virtualList.get(I)){continue}var F=r._edgeList.get(I);var N=s(F);if(w===-1||N<T){w=I;T=N;k=M===x?L:M}}if(k!==-1||y.has(k)){var z=p[x]+T;if(!m.has(k)||z<p[k]){var P=r._nodeList.get(x);g[k]=w;p[k]=z;_[k]=z+u(P,d);m.add(k)}}}}}return Promise.resolve(c)};gm.prototype._constructPath=function e(t,r,i){var n=this;var a=[i];var o=[];var s=i;while(s!==r){var u=t[s];var l=n._sourceList.get(u);var d=n._targetList.get(u);s=s===l?d:l;a.push(s);o.push(u)}a.reverse();o.reverse();return{nodes:new this._ogma.NodeList(a),edges:new this._ogma.EdgeList(o)}};Ogma.extend(function(e){var t=new gm(e);e.modules.algorithms=t;Object.assign(e.algorithms,{shortestPath:function e(r){return t.shortestPath(r)}})});var pm={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"};var _m={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"};Ogma.extend(function(e){var t=new mm(e);e.modules.brand=t;e.tools.brand={set:function e(r,i){return t.set(r,i)},remove:function e(){t.remove()}}});var ym={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:null};var mm=function e(t){this._dom=t.modules.dom;this._brand=null};mm.prototype.set=function e(t,r){var i=to(r,ym);var n=i.position;var a=i.horizontalMargin;var o=i.verticalMargin;var s=i.className;if(!pm[n]){n=ym.position}this.remove();var u=document.createElement("div");u.innerHTML=t;u.style.position="absolute";u.style[pm[n]]=a+"px";u.style[_m[n]]=o+"px";u.style.padding="0px 0px 0px 0px";u.style.zIndex="10";if(s){u.setAttribute("class",s)}this._brand=u;this._dom.setLayer("brand",this._brand);return u};mm.prototype.remove=function e(){this._dom.setLayer("brand",null);this._brand=null};var xm="geo.latitude";var bm="geo.longitude";var Sm={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:17,wrapCoordinates:true,tileUrlTemplate:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:undefined,backgroundColor:"silver",opacity:1,duration:0,detectRetina:false,disableNodeDragging:true,tileBuffer:1,sizeRatio:1};var Am=256;var Em=300;var wm=100;var Tm=150;var km=0;var Cm=10;function Im(e){if(e===void 0)e={};var t=e.tileUrlSubdomains;var r=e.tileUrlTemplate;var i=e.attribution;var n=e.attributionOptions;var a=e.latitudePath;var o=e.longitudePath;var s=e.sizeRatio;if(r&&typeof r!=="string"){throw new TypeError("Geo mode: tileUrlTemplate must be a URL string")}if(t&&typeof t!=="string"){throw new TypeError("Geo mode: tileUrlTemplate must be a string")}if(i&&typeof i!=="string"){throw new TypeError("Geo mode: Map attribution must be a string")}if(n&&typeof n!=="object"){throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object")}if(a&&typeof a!=="string"&&!Array.isArray(a)){throw new TypeError("Geo mode: Latitude path must be a valid property path: "+"a string or an array of strings.")}if(o&&typeof o!=="string"&&!Array.isArray(o)){throw new TypeError("Geo mode: Longitude path must be a valid property path: "+"a string or an array of strings.")}if(typeof s!=="undefined"&&(!isFinite(s)||s<=0)){throw new TypeError("Geo mode: sizeRatio must be a positive number.")}}Ogma.onDestroy(function(e){return e.modules.geo._cancelAnimationFrame()});var Mm=function e(t){var r=this;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._graph=t.modules.graph;this._data=t.modules.data;this._camera=t.modules.camera;this._events=t.modules.events;this._settingsModule=t.modules.settings;this._locate=t.modules.locate;this._brand=t.modules.brand;this._filters=t.modules.filters;this._settings=Object.assign({},Sm);this._animationFrame=null;this._screen=this._dom.getDimensions();this._tiles={};this._tileSize=Am*Ce();this._enableMapBackground=false;this._initialized=false;this._enabled=false;this._sIndex=0;this._lat=0;this._lng=0;this._zoom=1;this._zoomOffset=0;this._loadingTiles=0;this._graph.createNodeAttribute({name:"geo.prevLat",storage:"float"});this._graph.createNodeAttribute({name:"geo.prevLng",storage:"float"});this._graph.createNodeAttribute({name:xm,storage:"float"});this._graph.createNodeAttribute({name:bm,storage:"float"});this._events.register(["geoEnabled","geoDisabled","geoLoaded","geoReady"]);this._events.on({addNodes:function(e){return r._onNodesAdded(e.nodes)},setContainer:function(e){if(e&&r._enabled){r._initializeCanvas(e)}},progressMoveNodesByDragging:function(e){return r._onNodesDragged(e)},startMoveNodesByDragging:function(){return r._onNodesDragStart()},cameraMove:function(e){return r._setViewFromCamera(e)},resize:function(){return r._onResize()},viewChanged:function(){return r._onMoveend()}})};Mm.prototype._requestAnimationFrame=function e(t){var r=this;this._cancelAnimationFrame();this._animationFrame=p(function(){r._animationFrame=null;t()})};Mm.prototype._cancelAnimationFrame=function e(){if(this._animationFrame){_(this._animationFrame);this._animationFrame=null}};Mm.prototype._onMoveend=function e(){if(this._enabled&&!this._transition){var t=this._camera.zoom;if(t!==this._prevZoom){this._updateSizes()}this._prevZoom=t}};Mm.prototype._updateSizes=function e(){if(this._enabled){this._projection.updateAll()}};Mm.prototype._onResize=function e(){this._resize();this._setViewFromCamera()};Mm.prototype._resize=function e(){if(this._initialized){var t=this._screen=this._dom.getDimensions();var r=t.width;var i=t.height;this._tileSize=Am*Ce();ze(this._canvas,r,i);ze(this._rcanvas,r,i)}};Mm.prototype._setViewFromCamera=function e(){if(this._enabled){var t=this._camera;var r=Math.max(0,Math.log2(t.zoom));var i=dx(t.x,t.y);this._setView(i[0],i[1],r)}};Mm.prototype._setCameraFromView=function e(){var t=lx(this._lat,this._lng);var r=t[0];var i=t[1];var n=Math.pow(2,this._zoom);this._camera.setView({x:r,y:i,zoom:n})};Mm.prototype._readNodesCoordinates=function e(t){var r=this._graph;var i=this._settings;var n=i.longitudePath;var a=i.latitudePath;var o=i.wrapCoordinates;var s=r.getAttributes(true,[xm,bm]);var u=s[0];var l=s[1];var d=t._indexes;var h=t.getId();var f=d.length;var c=t.getData(a);var v=t.getData(n);var g,p,_,y;for(var m=0;m<f;m++){p=v[m];g=c[m];y=d[m];_=h[m];if(g!==undefined&&p!==undefined){Lm(_,p);Fm(_,g);if(o){p=p%180;g=it(+g,-tx,tx)}l.set(y,p);u.set(y,g)}}};Mm.prototype._onNodesAdded=function e(t){this._readNodesCoordinates(t);if(this._enabled){Zm(this,t)}};Mm.prototype._onNodesDragStart=function e(){if(this._enabled){this._nodeDragOffsetX=this._nodeDragOffsetY=0}};Mm.prototype._onNodesDragged=function e(t){var r=t.nodes;var i=t.dx;var n=t.dy;if(this._enabled){var a=r.getAttributes(["x","y"]);var o=r.getGeoCoordinates();var s=[];var u=this._nodeDragOffsetX,l=this._nodeDragOffsetY;for(var d=0;d<r.size;d++){var h=a[d];var f=o[d];dx(h.x+i-u,h.y+n-l,s);f.latitude=s[0];f.longitude=s[1]}this._nodeDragOffsetX=i;this._nodeDragOffsetY=n;r.setGeoCoordinates(o)}};Mm.prototype._onSettingsChanged=function e(t,r){if(this._enabled){if(t.tileUrlTemplate!==r.tileUrlTemplate){this._dom.clearTimeout(this._redrawTimer);Om(this);this._setViewFromCamera()}if(t.sizeRatio!==r.sizeRatio){this._updateSizes()}if(t.attribution!==r.attribution){this.setAttribution()}if(t.maxZoomLevel!==r.maxZoomLevel){this._settingsModule.update({minZoom:1,maxZoom:Math.pow(2,r.maxZoomLevel)})}if(t.disableNodeDragging!==r.disableNodeDragging){this._setDragging(!r.disableNodeDragging)}}if(t.wrapCoordinates!==r.wrapCoordinates){this._readNodesCoordinates(this._graph.getNodes("all"))}if(t.latitudePath!==r.latitudePath||t.longitudePath!==r.longitudePath){this._readNodesCoordinates(this._graph.getNodes("all"))}};Mm.prototype._setDragging=function e(t,r){if(r===void 0)r=false;var i=this._settingsModule;i.update({interactions:{drag:{enabled:t,applyResult:r}}})};Mm.prototype._nodeIsVisible=function e(t){var r=this._settings;var i=r.longitudePath;var n=r.latitudePath;var a=r.wrapCoordinates;var o=t.getData(i);var s=t.getData(n);if(o===undefined||s===undefined){return false}else if(a){return true}else{return Math.abs(s)<=tx&&Math.abs(o)<=180}};Mm.prototype._transformToGeoSpace=function e(t,r){var i=r.X;var n=r.Y;var a=r.indexes;var o=this._graph;var s=this._camera;var u=o.getAttributes(true,["x","y","radius"]);var l=u[0];var d=u[1];var h=u[2];var f=l.getMultiple(a);var c=d.getMultiple(a);var v=h.getMultiple(a);var g=new Mr({xValues:f,yValues:c,scaledSizeValues:v});var p=new Mr({xValues:i,yValues:n});if(f.length===0||c.length===0){g.cx=g.cy=0;g.width=g.height=0}if(!isFinite(p.width)||!isFinite(p.height)){p.cx=p.cy=0;p.width=p.height=0}var _=p.cx-g.cx;var y=p.cy-g.cy;var m=1;if(f.length>1){m=Math.max(p.width,p.height)/Math.max(g.width,g.height)*Ce()}var x=h.getMultiple(a).reduce(function(e,t){e[0]=Math.min(e[0],t*m);e[1]=Math.max(e[1],t*m);return e},[Infinity,0]);var b=x[0];var S=x[1];p.pad(S);p.minScaledSize=b;p.maxScaledSize=S;var A=this._locate.computeConfigForBounds(p);A.zoom=vx(A.zoom);var E=s.zoom/A.zoom;_+=(g.cx-s.x)*E;y+=(g.cy-s.y)*E;var w=g.cx+_;var T=g.cy+y;this._transformation=this._graphics.addAttributeLayer({name:"geo-transformation",priority:od,nodeSelector:function(e){return e.isVisible()},nodeAttributes:{radius:function(e){return e.getAttribute("radius")*E},x:function(e){return(e.getAttribute("x")+_-w)*E+w},y:function(e){return(e.getAttribute("y")+y-T)*E+T}},edgeSelector:function(e){return e.isVisible()},edgeAttributes:{width:function(e){return e.getAttribute("width")*E}}});this._scaleInfo={ratio:E,sizeRatio:m,dx:_,dy:y,tx:w,ty:T,zoom:s.zoom,x:s.x,y:s.y};this._scaleInfo.cameraConfig={zoom:s.zoom/E,x:(s.x+_-w)*E+w,y:(s.y+y-T)*E+T}};Mm.prototype._show=function e(){var t=this;var r=this._dom.getContainer();var i=this._settings.duration;if(r){if(!this._initialized){this._initializeCanvas(r)}this._dom.setLayer("geo",this._rcanvas)}this._enableTime=tr();this._enableMapBackground=false;this._filter=this._filters.addNodeFilter(function(e){return t._nodeIsVisible(e)});return this._filter.whenApplied().then(function(){var e=t._graph.getNodes("all");var r=t._graph.getEdges("all");t._graphics.hideTexts();var i=Km(t,e);t._transformToGeoSpace(e,i);t._camera.setView(t._scaleInfo.cameraConfig);return{projected:i,nodes:e,edges:r,targetZoom:t._scaleInfo.cameraConfig.zoom}}).then(function(e){var r=e.nodes;var n=e.edges;Zm(t,r);return t._graphics.animate({nodes:r,edges:n},function(){t.setProjection(true)},i)}).then(function(){t._transformation.destroy();t._transformation=null;t._scaleInfo.ratio=1;t._enableMapBackground=true;t.setAttribution();t._graphics.showTexts();var e=t._graphics.getGraphicsEngine().parseColor(t._settings.backgroundColor);e[3]=0;t._prevSettings=t._settingsModule.update({backgroundColor:br(e),minZoom:1,maxZoom:Math.pow(2,t._settings.maxZoomLevel),"interactions.rotation.enabled":false,"interactions.zoom.minValue":function(){return 0},"interactions.zoom.maxValue":function(){return Math.pow(2,t._settings.maxZoomLevel)},"interactions.zoom.onDoubleClick":true});if(t._graph.getNodes().size===0){t.setCenter(0,0)}Rm(t,t._settings.opacity,t._settings.backgroundColor)})};Mm.prototype._transformToGraphSpace=function e(t){var r=t.getAttributes(["x","y","radius"]);var i=t.getBoundingBox();var n=this._camera;var a=t.reduce(function(e,t,r){var i=t._index;return e[i]=r,e},{});this.setProjection(false);var o=t.getAttribute("x");var s=t.getAttribute("y");var u=t.getAttribute("radius");var l=new Mr({xValues:o,yValues:s,scaledSizeValues:u});var d=l.cx-i.cx;var h=l.cy-i.cy;var f=1;var c=this._locate.computeConfigForBounds(l);c.zoom=vx(c.zoom);var v=this._camera.zoom/c.zoom;d+=(i.cx-n.x)*v;h+=(i.cy-n.y)*v;var g=i.cx+d;var p=i.cy+h;this._projection=this._graphics.addAttributeLayer({name:"geo-projection-1",priority:od,nodeSelector:function(e){return e.isVisible()},nodeAttributes:{x:function(e){return(r[a[e._index]].x+d-g)*v+g},y:function(e){return(r[a[e._index]].y+h-p)*v+p}},edgeSelector:function(e){return e.isVisible()},edgeAttributes:{}});this._scaleInfo={ratio:v,sizeRatio:f,dx:d,dy:h,tx:g,ty:p,zoom:n.zoom,x:n.x,y:n.y};this._scaleInfo.cameraConfig={zoom:n.zoom/v,x:(n.x+d-g)*v+g,y:(n.y+h-p)*v+p};this._camera.setView(this._scaleInfo.cameraConfig)};Mm.prototype._hide=function e(){var t=this;var r=this._dom.getContainer();var i=this._settings.duration;var n=i/2;var a=tr();var o=function(){var e=tr();var r=(e-a)/n;if(r<1&&r>=0){Rm(t,1-r,t._prevBgColor);t._dom.afterNextFrame().then(o)}};this._dom.clearTimeout(this._redrawTimer);if(n!==0){this._dom.afterNextFrame().then(o)}else{o()}var s=this._graph.getNodes("all");var u=this._graph.getEdges("all");this._transformToGraphSpace(s,u);this._graphics.hideTexts();return this._graphics.animate({nodes:s,edges:u},function(){return t._projection.destroy()},i).then(function(){return t._filter.delete()}).then(function(){return t._dom.afterNextFrame()}).then(function(){t._projection=null;t.setAttribution(null);t._graphics.showTexts()}).then(function(){s.setAttribute("scalingMethod","scaling");u.setAttribute("scalingMethod","scaling");if(r){t._dom.setLayer("geo",null)}Om(t)}).then(function(){return t._settingsModule.update(t._prevSettings)})};Mm.prototype.setProjection=function e(t){var r=this;if(t){this._projection=this._graphics.addAttributeLayer({name:"geo-projection-2",priority:od,nodeSelector:function(e){return e.isVisible()},nodeAttributes:{scalingMethod:"fixed",radius:function(e){return e.getAttribute("radius")*r._settings.sizeRatio},x:function(e){var t=e.getData(r._settings.longitudePath);return t!==undefined?rx*(ax*(ex*t*ix)+ox):0},y:function(e){var t=e.getData(r._settings.latitudePath);var i=Math.max(Math.min(tx,t),-tx);var n=Math.sin(i*ix);return t!==undefined?rx*(sx*(ex*Math.log((1+n)/(1-n))/2)+ux):0}},edgeSelector:function(e){return e.isVisible()},edgeAttributes:{scalingMethod:"fixed",width:function(e){return e.getAttribute("width")*r._settings.sizeRatio}}})}else{this._projection.destroy()}};Mm.prototype.enable=function e(t){return this.setEnabled(true,t)};Mm.prototype.disable=function e(t){return this.setEnabled(false,t)};Mm.prototype.isEnabled=function e(){return this._enabled};Mm.prototype.toggle=function e(t){return this.setEnabled(!this._enabled,t)};Mm.prototype.setOptions=function e(t){if(t===void 0)t={};Im(t);var r=this._settings;this._settings=Object.assign({},this._settings,Sm,t);this._onSettingsChanged(r,this._settings)};Mm.prototype.setAttribution=function e(t){if(t===void 0)t=this._settings.attribution;if(!this._enabled){return}if(t===null){this._brand.remove()}if(t){this._brand.set(t,this._settings.attributionOptions)}else{this._brand.remove()}};Mm.prototype.setEnabled=function e(value,t){var r=this;if(t===void 0)t={};this.setOptions(t);if(value!==this._enabled&&!this._transition){var i=this._settingsModule;var n=this._settings;this._enabled=value;this._transition=true;if(value){this._nodeDraggingSetting=i.get("interactions.drag.enabled");this._setDragging(!n.disableNodeDragging);this._show().then(function(){r._transition=false;r._events.fire("geoEnabled");r._events.fire("geoReady")})}else{this._hide().then(function(){r._transition=false;r._events.fire("geoDisabled");r._setDragging(r._nodeDraggingSetting,true);r._cancelAnimationFrame()})}}return new Promise(function(e){if(r._transition){r._events.once(value?"geoEnabled":"geoDisabled",e)}else{e()}})};Mm.prototype.resetCoordinates=function e(){if(!this._enabled){return}var t=this._graph.getNodes();Jm(this,t,"geo.prevLat",xm);Jm(this,t,"geo.prevLng",bm)};Mm.prototype.updateCoordinates=function e(){Qm(this,this._graph.getNodes())};Mm.prototype._redrawNodes=function e(t,r){if(this._enabled){this._projection.updateAll()}return Promise.resolve(r)};Mm.prototype._setView=function e(t,r,i){if(!this._enabled){return}this._lat=t;this._lng=r;this._zoom=i;Rm(this)};Mm.prototype._initializeCanvas=function e(t){var r=this;this._rcanvas=document.createElement("canvas");this._rctx=this._rcanvas.getContext("2d");this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._rcanvas.style.position="absolute";this._rcanvas.style.zIndex=+(t.style.zIndex||0)-1;this._rcanvas.className="ogma-geo-container";this._initialized=true;this._drawFromBuffer=function(){return r._rctx.drawImage(r._canvas,0,0)};this._resize()};Mm.prototype.setView=function e(t,r,i){if(!this._enabled){throw new Error("Geo mode is not enabled")}fx(this,i);cx(t,r);this._setView(t,r,i);this._setCameraFromView()};Mm.prototype.setCenter=function e(t,r){this.setView(t,r,this._zoom)};Mm.prototype.setZoom=function e(t){this.setView(this._lat,this._lng,t)};Mm.prototype.getView=function e(){return{latitude:this._lat,longitude:this._lng,zoom:this._zoom}};Mm.prototype.getCenter=function e(){return{latitude:this._lat,longitude:this._lng}};Mm.prototype.getZoom=function e(){return this._zoom};Mm.prototype.exportBackground=function e(t,r){var i=this;r=r||this._camera.getView();return new Promise(function(e){var n=Math.log2(r.zoom);var a=dx(r.x,r.y);var o=a[0];var s=a[1];var u=r.pixelRatio||Ce();i._tileSize=Am*u;if(!Nm(i,t.getContext("2d"),t.width,t.height,n,o,s,false)){i._dom.setTimeout(function(){i.exportBackground(t,r).then(function(){i._tileSize=Am*Ce()}).then(e)},wm)}else{i._tileSize=Am*Ce();e()}})};Mm.prototype.whenReady=function e(){var t=this;return new Promise(function(e){var r=function(){return t.whenReady().then(e)};if(t.isEnabled()){if(t._transition){t._events.once("geoReady",r)}else if(!Dm(t)){t._dom.setTimeout(r,50)}else{e()}}else{t._events.once("geoEnabled",r)}})};function Lm(e,t){if(isNaN(t)){throw new TypeError("node "+e+": "+t+" is not a valid longitude")}}function Fm(e,t){if(isNaN(t)){throw new TypeError("node "+e+": "+t+" is not a valid latitude")}}function Nm(e,t,r,i,n,a,o,s){t=t||e._ctx;var u=Math.ceil(n);var l=1/Math.pow(2,u-n);var d=e._settings.tileBuffer;var h=e._tileSize*l;var f=u;var c=Ce();var v=e._camera.animationInProgress();if(e._settings.detectRetina){h/=c;f+=Math.log2(c);d*=c}r+=d*2*h;i+=d*2*h;var g=hx(a,o,f);var p=g.x|0;var _=g.y|0;var y=r/2-(g.x-p)*h;var m=i/2-(g.y-_)*h;while(y>0){y-=h;p-=1}while(m>0){m-=h;_-=1}var x=true;y-=d*h;m-=d*h;var b=[];var S,A,E,w,T;for(S=y,A=p;S<r;S+=h,++A){for(E=m,w=_;E<i;E+=h,++w){b.push([A,w,S,E])}}e._tileBounds=[p-d,_-d,A+d,w+d];var k=p+(A-p)/2;var C=_+(w-_)/2;b.sort(function(e,t){return Vr(e[0],e[1],k,C)-Vr(t[0],t[1],k,C)});for(S=0,T=b.length;S<T;S++){var I=b[S];x&=jm(e,t,I[2],I[3],f,I[0],I[1],h,s,v)}e._dom.clearTimeout(e._pruneTimer);e._pruneTimer=e._dom.setTimeout(function(){return zm(e,f)},Em);return x}function zm(e,t){var r={};var i=e._settings.tileBuffer;var n=e._tileBounds;var a,o,s,u,l,d;for(var h in e._tiles){var f=h.split("/");d=parseInt(f[0]);u=parseInt(f[1]);l=parseInt(f[2]);r[d]=r[d]||[];r[d].push([u,l])}var c=[];for(d in r){var v=parseInt(d);var g=Math.pow(2,v-t);var p=r[d];for(a=0,o=p.length;a<o;a++){s=p[a];u=s[0];l=s[1];if(u<n[0]*g-i||u>n[2]*g+i||l<n[1]*g-i||l>n[3]*g+i){c.push(qm(v,s[0],s[1]))}}}Pm(e,c);return c.length}function Pm(e,t){for(var r=0,i=t.length;r<i;r++){var n=t[r];var a=e._tiles[n];if(a){if(!a.img.complete){km--}if(a.img){Xm(a.img)}}delete e._tiles[n]}}function Om(e){Pm(e,Object.keys(e._tiles));e._tiles={}}function Dm(e){var t=Object.keys(e._tiles);for(var r=0;r<t.length;r++){var i=e._tiles[t[r]];if(i&&!i.img.complete){return false}}return true}function Rm(e,t,r){if(!e._enableMapBackground||!e._ctx){return}e._requestAnimationFrame(function(){var i=e._ctx;var n=Ce();var a=e._screen.width*n;var o=e._screen.height*n;i.fillStyle=r||e._settings.backgroundColor;i.fillRect(0,0,a,o);if(typeof t==="number"&&t!==e._opacity){e._opacity=t;e._rcanvas.style.opacity=t}if(!Nm(e,e._ctx,a,o,e._zoom,e._lat,e._lng,true)){e._dom.clearTimeout(e._redrawTimer);e._redrawTimer=e._dom.setTimeout(function(){return Rm(e,t,r)},Tm)}else{e._events.fire("geoLoaded")}e._drawFromBuffer()})}function Bm(e){return typeof e!=="number"}function jm(e,t,r,i,n,a,o,s,u,l){var d=Ym(e,n,a,o,true,l);if(Bm(d)){t.drawImage(d,r,i,s,s);return true}else if(d===Um.LOADING){if(u){var h;d=Ym(e,n-1,a/2|0,o/2|0,false,l);if(Bm(d)){h=d.naturalWidth/2;var f=a&1?h:0;var c=o&1?h:0;t.drawImage(d,f,c,h,h,r,i,s,s)}else{var v=Ym(e,n+1,a*2,o*2,false,l);var g=Ym(e,n+1,a*2+1,o*2,false,l);var p=Ym(e,n+1,a*2,o*2+1,false,l);var _=Ym(e,n+1,a*2+1,o*2+1,false,l);if(Bm(v)&&Bm(g)&&Bm(p)&&Bm(_)){h=s/2;t.drawImage(v,r,i,h,h);t.drawImage(g,r+h,i,h,h);t.drawImage(p,r,i+h,h,h);t.drawImage(_,r+h,i+h,h,h)}}}return false}else{return true}}var Um={INVALID:1,LOADING:2,MISSING:3};function Vm(e,t){var r=e._sIndex;if(t.length>0){r=(r+1)%t.length;e._sIndex=r;return r}return 0}function Gm(e,t,r,i){var n=e._settings.tileUrlSubdomains;var a=Vm(e,n);return e._settings.tileUrlTemplate.replace("{z}",i).replace("{x}",t).replace("{y}",r).replace("{s}",n.charAt(a))}function Wm(){km--;this.error=true;Xm(this)}function Hm(){km--;Xm(this)}function Xm(e){e.onload=e.onerror=null}function qm(e,t,r){return e+"/"+t+"/"+r}function Ym(e,t,r,i,n,a){var o=Math.pow(2,t)-1;if(t<0||r<0||r>o||i<0||i>o){return Um.INVALID}var s=qm(t,r,i);var u=e._tiles[s];if(!u){if(!n){return Um.MISSING}else{if(!a&&km<Cm){var l=new Image;u={img:l,err:false,loaded:false};l.setAttribute("crossOrigin","anonymous");l.onerror=Wm;l.onload=Hm;l.src=Gm(e,r,i,Math.floor(t));km++}e._tiles[s]=u;return Um.LOADING}}else if(u.img.error){return Um.MISSING}else if(!u.img.complete){return Um.LOADING}else{return u.img}}function Zm(e,t){Jm(e,t,xm,"geo.prevLat");Jm(e,t,bm,"geo.prevLng")}function Km(e,t){var r=e._graph.getAttributes(true,[xm,bm]);var i=r[0];var n=r[1];var a=new Array(2),o,s,u;var l=t._indexes;var d=i.getMultiple(l);var h=n.getMultiple(l);var f=l.length;var c=[];var v=[];var g=[];for(var p=0,_=f;p<_;++p){u=l[p];o=d[p],s=h[p];if(e._nodeIsVisible(t.get(p))){lx(o,s,a);v.push(a[0]);g.push(a[1]);c.push(u)}}return{X:v,Y:g,indexes:c}}function Qm(e,t){var r=e._graph.getAttributes(true,["x","y",xm,bm]);var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=new Array(2),u,l,d;var h=t._indexes;var f=[],c=[],v=[];for(var g=0,p=h.length;g<p;g++){d=h[g];u=a.get(d);l=o.get(d);if(l!==undefined&&u!==undefined){dx(i.get(d),n.get(d),s);v.push(d);f.push(s[0]);c.push(s[1])}}a.setMultiple(v,f);o.setMultiple(v,c)}function Jm(e,t,r,i){$m(e,true,t,r,i)}function $m(e,t,r,i,n){var a=e._graph;var o=a.getAttribute(t,i);var s=a.getAttribute(t,n);var u=r._indexes;s.setMultiple(u,o.getMultiple(u))}var ex=6378137;var tx=85.0511287798;var rx=256;var ix=Math.PI/180;var nx=180/Math.PI;var ax=.5/(Math.PI*ex),ox=.5,sx=-ax,ux=.5;function lx(e,t,r){if(r===void 0)r=[];var i=Math.max(Math.min(tx,e),-tx);var n=Math.max(Math.min(Math.sin(i*ix),.9999),-.9999);r[0]=rx*(ax*(ex*t*ix)+ox);r[1]=rx*(sx*(ex*Math.log((1+n)/(1-n))/2)+ux);return r}function dx(e,t,r){if(r===void 0)r=[];e=(e/rx-ox)/ax;t=(t/rx-ux)/sx;r[0]=(2*Math.atan(Math.exp(t/ex))-Math.PI/2)*nx;r[1]=e*nx/ex;return r}function hx(e,t,r){var i=1<<r;e=e*ix;return{x:i*((t+180)/360),y:i*(1-Math.log(Math.tan(e)+1/Math.cos(e))/Math.PI)/2}}function fx(e,t){var r=e._settings.maxZoomLevel;if(typeof t!=="number"||!(t>=0&&t<=r)){throw new Error("invalid zoom value "+t+": expected value between 0 and "+r)}}function cx(e,t){if(typeof e!=="number"){throw new Error("invalid latitude "+e+": expected number")}if(typeof t!=="number"){throw new Error("invalid longitude "+t+": expected number")}}function vx(e){return Math.pow(2,Math.floor(Math.log2(e)))}Ogma.extend(function(e){var t=new Mm(e);var r=e.modules;var i=r.graph;e.modules.geo=t;e.geo={enable:function(e){return t.enable(e)},disable:function(e){return t.disable(e)},setOptions:function(e){return t.setOptions(e)},enabled:function(){return t.isEnabled()},getCenter:function(){return t.getCenter()},getView:function(){return t.getView()},getZoom:function(){return t.getZoom()},setZoom:function(e){return t.setZoom(e)},setView:function(e,r,i){return t.setView(e,r,i)},setCenter:function(e,r){return t.setCenter(e,r)},toggle:function(e){return t.toggle(e)},resetCoordinates:function(){return t.resetCoordinates()},updateCoordinates:function(){return t.updateCoordinates()},getUnprojectedCoordinates:function(e){t.setProjection(false);var r=t._graph.getNodes(e).getAttributes(["x","y"]);t.setProjection(true);return r}};i.Node.prototype.getGeoCoordinates=function(){return{latitude:i.getAttribute(true,xm).get(this._index),longitude:i.getAttribute(true,bm).get(this._index)}};i.Node.prototype.setGeoCoordinates=function(e,t){var r=this;return this.toList().setGeoCoordinates([e],t).then(function(){return r})};i.NodeList.prototype.getGeoCoordinates=function(){var e=new Array(this._indexes.length);var t=i.getAttribute(true,xm).getMultiple(this._indexes);var r=i.getAttribute(true,bm).getMultiple(this._indexes);for(var n=0,a=this._indexes.length;n<a;n++){e[n]={latitude:t[n],longitude:r[n]}}return e};i.NodeList.prototype.setGeoCoordinates=function(r,n){var a=this;var o=this.getId();var s=this._indexes;var u=new Array(s.length);var l=new Array(s.length);var d=t.isEnabled();if(r===null){r=new Array(s.length).fill(null)}if(r.length!==s.length){throw new RangeError("You must provide coordinates for each node in the NodeList")}var h=this.isVisible();for(var f=0,c=s.length;f<c;f++){var v=r[f];var g=o[f];var p=void 0,_=void 0;var y=h[f];if(v===null||v.latitude===null&&v.longitude===null){p=_=undefined;n=0}else{p=v.latitude;_=v.longitude;Fm(g,p);Lm(g,_)}u[f]=p;l[f]=_}this.setData(t._settings.latitudePath,u);this.setData(t._settings.longitudePath,l);i.getAttribute(true,xm).setMultiple(s,u);i.getAttribute(true,bm).setMultiple(s,l);return Promise.all([t._redrawNodes(n,this),e.modules.transformations.refresh()]).then(function(){return a})};e.events.onGeoModeEnabled=function(t){e.modules.events.on("geoEnabled",t);return e.events};e.events.onGeoModeDisabled=function(t){e.modules.events.on("geoDisabled",t);return e.events};e.events.onGeoModeLoaded=function(t){e.modules.events.on("geoLoaded",t);return e.events}});var gx={strokeColor:"black",strokeWidth:5,dashed:true,cursorStyle:"cell",createNodes:true,condition:function(){return true},onNodeCreated:function(){},onEdgeCreated:function(){},onComplete:function(){}};Ogma.extend(function(e){var t=new px(e);e.modules.connectNodes=t;e.tools.connectNodes={enable:function e(r){t.enable(r);return this},disable:function e(){t.disable();return this},enabled:function e(){return t.enabled()}};e.events.onNodesConnected=function(t){e.modules.events.on("connectedNodes",t);return e.events}});var px=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._camera=t.modules.camera;this._captor=t.modules.captor;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._events=t.modules.events;this._settings=t.modules.settings;this._engine=this._graphics.getGraphicsEngine();this._block=this._engine.createBlock();this._depth=ch(0).edgeBody;this._enabled=false;this._options=null;this._blockId=null;this._startNode=null;this._startPos=null;this._endPos=null;this._cursorEnabled=false;this._events.register(["connectNodes"]);this._interaction=this._interactions.onDrag({priority:"connectNodes",check:function(e){var t=e.target;var i=e.button;if(i===void 0)i="left";return r._enabled&&i==="left"&&t&&t.isNode},onStart:function(e){var t=e.target;r._cursorEnabled=true;r._startNode=t;r._startPos=t.getPosition();r._graphics.addCursorStyle(r._options.cursorStyle);r._blockId=r._graphics.allocateGraphicsEngineBlockId()},onProgress:function(e){var t=e.x;var i=e.y;r._endPos=r._camera.screenToGraphCoordinates({x:t,y:i});r._drawLine()},onStop:function(){var e=r._options;var t=e.condition;var i=e.onNodeCreated;var n=e.onEdgeCreated;var a=e.onComplete;var o=r._captor.getPointedElement();var s=null;var u=null;r._graphics.releaseGraphicsEngineBlockId(r._blockId);if(!o&&r._options.createNodes){o=r._ogma.addNode({attributes:{x:r._endPos.x,y:r._endPos.y}});u=o;if(i){i(u)}}if(o&&(u||!t||t(o))){s=r._ogma.addEdge({source:r._startNode,target:o});if(n){n(s)}}if(a){a({source:r._startNode,target:o,edge:s})}r.disable()}});this._events.on({clear:function(){return r.disable()}})};px.prototype._drawLine=function e(){this._block.reset(Zo,false,this._depth);var t=this._block.nextAndReset();var r=t.end;r.pieceId=as;r.shape="line";r.x1=this._startPos.x;r.y1=this._startPos.y;r.x2=this._endPos.x;r.y2=this._endPos.y;r.fillColor=this._options.strokeColor;r.thicknessOrFontSizeFixed=this._options.strokeWidth;if(this._options.dashed){r.dashLength=3;r.gapLength=1}this._engine.storeBlock(this._blockId,this._block);this._dom.refresh()};px.prototype.enable=function e(t){if(this._enabled){return}this._options=to(t,gx);this._enabled=true;this._cursorEnabled=false;this._prevSettings=this._settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":false});if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorInformation())}return this};px.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._settings.update(this._prevSettings);if(this._cursorEnabled){this._graphics.removeCursorStyle(this._options.cursorStyle)}};px.prototype.enabled=function e(){return this._enabled};var _x=[{name:"color",isNode:true},{name:"shape",isNode:true},{name:"radius",isNode:true},{name:"icon.content",isNode:true},{name:"image.url",isNode:true},{name:"color",isNode:false},{name:"shape",isNode:false},{name:"width",isNode:false}];var yx=Math.PI;var mx=2*Math.PI;var xx=1.6;var bx=3;var Sx=.9;var Ax={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:function(e){return e[e.length-1]}};Ogma.extend(function(e){var t=new wx(e);e.modules.legend=t;e.tools.legend={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var Ex=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];var wx=function e(t){var r=this;this._ogma=t;this._graphics=t.modules.graphics;this._dom=t.modules.dom;this._settings=null;this._enabled=false;this._mustRefresh=false;this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._promises=[];t.modules.events.on({newFrame:function(){if(r._enabled&&r._mustRefresh){r._ctx.clearRect(0,0,r._canvas.width,r._canvas.height);r._drawOnCanvas(r._settings,r._canvas,Ce());var e=r._promises;r._promises=[];e.forEach(function(e){return e()})}},"resize reloadFonts":function(){r._mustRefresh=true}})};wx.prototype.enable=function e(t){if(!this._enabled){this._enabled=true;this._mustRefresh=true;this._settings=t;this._graphics.addCanvas(this._canvas);return this.refresh()}return Promise.resolve()};wx.prototype._afterNextUpdate=function e(){var t=this;return new Promise(function(e){return t._promises.push(e)})};wx.prototype._formatSettings=function e(t,r){var i=to(t,Ax);Ex.forEach(function(e){return i[e]*=r});return i};wx.prototype.disable=function e(){if(this._enabled){this._enabled=false;this._graphics.removeCanvas(this._canvas)}};wx.prototype.enabled=function e(){return this._enabled};wx.prototype.refresh=function e(){this._mustRefresh=true;this._dom.refresh();return this._afterNextUpdate()};wx.prototype.getCurrentOptions=function e(){return this._settings};wx.prototype._drawOnCanvas=function e(t,r,i){var n=this._formatSettings(t,i);var a=this._computeWidgetList(n);kx(n,r,a)};wx.prototype.exportOnCanvas=function e(t,r){return this._drawOnCanvas(r,t,1)};wx.prototype._computeWidgetList=function e(t){var r=this;var i=[];_x.forEach(function(e){var n=e.name;var a=e.isNode;var o=r._computeWidget(t,n,a);if(o){i.push(o)}});return i};wx.prototype._computeWidget=function e(t,r,i){var n=this._computePropertyMapping(t,r,i);if(n){if(r==="icon.content"){var a=this._getRulesForAttribute(i,"icon.font");var o=null;if(!a.length){o="Arial"}else if(typeof a[0]==="string"){o=a[0]}if(o){n.iconFont=o;return n}}else{return n}}return null};wx.prototype._computePropertyMapping=function e(t,r,i){var n=this._getRulesForAttribute(i,r);var a=n[0];var o=a&&a.mapping;var s=o&&o.getValues(i);if(o&&s){var u=o.getField();var l={};j(s,function(e,t){if(e===undefined||t==="undefined"){return}if(e in l){l[e].push(t)}else{l[e]=[t]}});if(Object.keys(l).length===0){return null}return{isNode:i,title:t.titleFunction(u),styleProperty:r,dataProperty:u,mapping:l,height:Tx(l,r,i,t)}}else{return null}};wx.prototype._getRulesForAttribute=function e(t,r){return this._ogma.modules.styleRules.getRuleList().map(function(e){var i=e.getDefinition();var n=t?i.nodeAttributes:i.edgeAttributes;return no(n,r)}).filter(function(e){return e})};function Tx(e,t,r,i){var n=i.outerMargin+Jx(i);var a=i.fontSize*xx;var o=n-i.innerMargin*.8;if(t!=="radius"&&t!=="width"){o+=Object.keys(e).length*a}else{o+=a*(r?3:2)}return o}function kx(e,t,r){var i={width:t.width,height:t.height};var n=false;if(!i.width||!i.height||!r){return false}if(e.position==="top"||e.position==="bottom"){n=Yx(i,e,r,e.position==="bottom")}else{n=Hx(i,e,r,e.position==="left")}if(n){r.forEach(function(r){return Cx(e,t,r)})}return n}function Cx(e,t,r){var i=t.getContext("2d");var n=r.x;var a=r.y;var o=r.height;var s=r.isNode;var u=r.styleProperty;var l=r.title;var d=r.mapping;var h=r.iconFont;Fx(i,e,n,a,o);Nx(i,e,l,n,a);var f=e.fontSize*xx,c=e.fontSize/2*xx*Sx,v=e.fontSize*bx,g=e.fontSize,p=Lx(e,s),_=a+Jx(e),y=n+e.innerMargin+p/2,m=n+e.innerMargin*2+p,x=B(d),b=$x(x),S=e.fontColor,A=e.shapeColor,E=Object.keys(d);if(b){E.sort(function(e,t){return ot(d[t])-ot(d[e])})}if(u!=="radius"&&u!=="width"){E.forEach(function(t){var r=d[t];if(u==="color"){if(s){Px(i,y,_,c,t)}else{Ox(i,y,_,v,g,t)}}else if(u==="shape"){if(s){jx(i,y,_,c,t,A)}else{Vx(i,y,_,v,g,t,A)}}else if(u==="icon.content"){Dx(i,y,_,t,h,c,S)}else if(u==="image.url"){Rx(i,y,_,c,t)}zx(i,e,m,_,r,b);_+=f})}else if(b){var w=eb(x),T=tb(x),k=(w+T)/2;if(w%2===0||T%2===0){k=Math.round(k)}if(s){var C=e.fontSize*.7,I=C*3,M=(C+I)/2,L=n+e.innerMargin+I,F=L+I+e.innerMargin,N=_+I*2-e.innerMargin*.5,z=e.circleStrokeWidth;Ix(i,L,N-C,C,A,z);Ix(i,L,N-M,M,A,z);Ix(i,L,N-I,I,A,z);Mx(i,e.fontFamily,e.fontSize,e.fontColor,"left");i.fillText(rb(w),F,N+C-C*2);i.fillText(rb(k),F,N+C-M*2);i.fillText(rb(T),F,N+C-I*2)}else{var P=(e.widgetWidth-2*e.innerMargin)/3,O=e.fontSize,D=_-e.innerMargin/2,R=D+O*2,j=n+e.innerMargin;i.fillStyle=A;i.fillRect(j,D-O/2,P+1,O);i.fillRect(j+P,D-O/3,P+1,O/1.5);i.fillRect(j+P*2,D-O/6,P,O/3);Mx(i,e.fontFamily,e.fontSize,e.fontColor,"center");i.fillText(rb(T),j+P*.5,R);i.fillText(rb(k),j+P*1.5,R);i.fillText(rb(w),j+P*2.5,R)}}}function Ix(e,t,r,i,n,a){e.beginPath();e.arc(t,r,i,0,mx);e.strokeStyle=n;e.lineWidth=a;e.stroke()}function Mx(e,t,r,i,n,a){if(n===void 0)n="left";if(a===void 0)a="middle";e.textAlign=n;e.textBaseline=a;e.fillStyle=i;e.font=r+'px "'+t+'"'}function Lx(e,t){return t?e.fontSize:e.fontSize*bx}function Fx(e,t,r,i,n){Gx(e,r,i,t.widgetWidth,n,t.borderRadius,t.backgroundColor,t.borderColor,t.borderWidth)}function Nx(e,t,r,i,n){Mx(e,t.fontFamily,t.titleFontSize,t.titleFontColor,t.titleTextAlign);var a=t.titleTextAlign==="center",o=t.widgetWidth-t.innerMargin*2,s=e.measureText(r).width,u=i+(a?t.widgetWidth/2:t.innerMargin),l=n+t.titleFontSize/2+t.innerMargin;if(s>o){var d=o/s,h=(r.length*d|0)-2;r=r.substr(0,h)+""}e.fillText(r,u,l)}function zx(e,t,r,i,n,a){var o;if(a){if(n.length===1){o=rb(n[0])}else{var s=ot(n),u=at(n);o=rb(s)+" - "+rb(u)}}else{o=n.join()}Mx(e,t.fontFamily,t.fontSize,t.fontColor);e.fillText(o,r,i)}function Px(e,t,r,i,n){e.beginPath();e.arc(t,r,i,0,2*yx);e.fillStyle=n;e.fill()}function Ox(e,t,r,i,n,a){e.fillStyle=a;e.fillRect(t-i/2,r-n/2,i,n)}function Dx(e,t,r,i,n,a,o){Mx(e,n,a*2,o,"center");e.fillText(i,t,r)}function Rx(e,t,r,i,n){if(!e._imgStore){e._imgStore={}}var a=e._imgStore[n];if(!a){a=new Image;a.src=n;a.onload=function(){e.drawImage(a,t-i,r-i,i*2,i*2)};e._imgStore[n]=a}else{e.drawImage(a,t-i,r-i,i*2,i*2)}}var Bx=.31;function jx(e,t,r,i,n,a){e.fillStyle=a;if(n==="circle"){Px(e,t,r,i,a)}else if(n==="square"){e.fillRect(t-i,r-i,i*2,i*2)}else if(n==="cross"){e.fillRect(t-i,r-i*Bx,i*2,i*2*Bx);e.fillRect(t-i*Bx,r-i,i*2*Bx,i*2)}else if(n==="diamond"){e.beginPath();e.moveTo(t-i,r);e.lineTo(t,r-i);e.lineTo(t+i,r);e.lineTo(t,r+i);e.fill()}else if(n==="equilateral"){e.beginPath();e.moveTo(t,r-i);e.lineTo(t+Math.cos(yx/2-mx/5)*i,r+Math.sin(-yx/2+mx/5)*i);e.lineTo(t+Math.cos(yx/2-mx/5*2)*i,r+Math.sin(-yx/2+mx/5*2)*i);e.lineTo(t+Math.cos(yx/2-mx/5*3)*i,r+Math.sin(-yx/2+mx/5*3)*i);e.lineTo(t+Math.cos(yx/2-mx/5*4)*i,r+Math.sin(-yx/2+mx/5*4)*i);e.fill()}else if(n==="star"){e.beginPath();e.moveTo(t,r-i);e.lineTo(t+Math.cos(yx/2-mx/5*2)*i,r+Math.sin(-yx/2+mx/5*2)*i);e.lineTo(t+Math.cos(yx/2-mx/5*4)*i,r+Math.sin(-yx/2+mx/5*4)*i);e.lineTo(t+Math.cos(yx/2-mx/5)*i,r+Math.sin(-yx/2+mx/5)*i);e.lineTo(t+Math.cos(yx/2-mx/5*3)*i,r+Math.sin(-yx/2+mx/5*3)*i);e.fill()}}var Ux=1/3;function Vx(e,t,r,i,n,a,o){e.fillStyle=o;if(a==="line"){e.fillRect(t-i/2,r-n/4,i,n/2)}else if(a==="arrow"){e.fillRect(t-i/2,r-n/4,i*(1-Ux),n/2);e.beginPath();e.moveTo(t+i*(1-Ux-.5),r-n/2);e.lineTo(t+i*(1-Ux-.5),r+n/2);e.lineTo(t+i/2,r);e.fill()}else if(a==="dashed"||a==="dotted"){e.beginPath();e.moveTo(t-i/2,r);e.lineTo(t+i/2,r);e.strokeStyle=o;e.lineWidth=n/2;e.setLineDash(a==="dashed"?[8,3]:[3,3]);e.stroke()}else if(a==="tapered"){e.beginPath();e.moveTo(t-i/2,r-n/2);e.lineTo(t-i/2,r+n/2);e.lineTo(t+i/2,r);e.fill()}}function Gx(e,t,r,i,n,a,o,s,u){e.setLineDash([]);e.beginPath();e.moveTo(t+a,r);e.lineTo(t+i-a,r);e.quadraticCurveTo(t+i,r,t+i,r+a);e.lineTo(t+i,r+n-a);e.quadraticCurveTo(t+i,r+n,t+i-a,r+n);e.lineTo(t+a,r+n);e.quadraticCurveTo(t,r+n,t,r+n-a);e.lineTo(t,r+a);e.quadraticCurveTo(t,r,t+a,r);e.closePath();e.fillStyle=o;e.fill();e.strokeStyle=s;e.lineWidth=u;e.stroke()}function Wx(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return e.title<=t.title?-1:1}}function Hx(e,t,r,i){var n=t.widgetWidth+t.outerMargin,a=Math.floor((e.width-t.outerMargin)/n),o=e.height,s=t.outerMargin,u=i?t.outerMargin:e.width-n,l=1;r=r.slice().sort(Wx);for(var d=0;d<r.length;++d){var h=r[d];if(s+h.height>o){if(s===t.outerMargin){return false}else{s=t.outerMargin;l+=1;if(i){u+=n}else{u-=n}}}h.x=u;h.y=s;s+=h.height}return l<=a}function Xx(e,t,r){var i=null;for(var n=0;n<t.length;++n){var a=t[n];if((a.isNode===e.isNode||t.length===1)&&(i===null||a.height<t[i].height)){i=n}}a=t[i];a.content.push(e);a.height+=e.height+r.outerMargin}function qx(e){var t=0;for(var r=1;r<e.length;++r){if(e[r].height>e[t].height){t=r}}return t}function Yx(e,t,r,i){r=r.slice();var n=t.widgetWidth+t.outerMargin,a=Math.floor((e.width-t.outerMargin)/n),o=e.height-t.outerMargin,s=new Array(Math.min(a,r.length)),u=r.length,l=0,d=0,h=0,f=0;for(var c=0;c<u;++c){var v=r[c];if(v.isNode){l+=1;d+=v.height}else{h+=1;f+=v.height}}var g=d+f,p=d/g,_=f/g,y=Math.round(p*a),m=Math.round(_*a);if(y>l){y=l}else if(m>h){y=a-h}if(a===0){return false}for(var x=0;x<s.length;++x){s[x]={content:[],height:0,isNode:x<y}}for(x=0;x<u;++x){var b=qx(r);Xx(r[b],s,t);r.splice(b,1)}if(s.every(function(e){var t=e.content;return t.length===1})){s.sort(Qx)}else{s.sort(Kx)}var S=t.outerMargin;for(x=0;x<s.length;++x){var A=s[x];if(A.height>o){return false}A.content.sort(Zx);var E=0;for(var w=0;w<A.content.length;++w){var T=A.content[w];T.x=S;T.y=i?e.height-E-T.height-t.outerMargin:E+t.outerMargin;E+=T.height+t.outerMargin}S+=n}return true}function Zx(e,t){return e.height-t.height}function Kx(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return t.height-e.height}}function Qx(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return e.content[0].title<=t.content[0].title?-1:1}}function Jx(e){return e.innerMargin+(e.titleFontSize+e.fontSize)*xx}function $x(e){if(T(e)){return e.reduce(function(e,t){return e&&$x(t)},true)}else{return e==="undefined"||!isNaN(+e)}}function eb(e){if(T(e)){return e.reduce(function(e,t){return Math.min(e,eb(t))},Infinity)}else{return isNaN(e)?Infinity:+e}}function tb(e){if(T(e)){return e.reduce(function(e,t){return Math.max(e,tb(t))},-Infinity)}else{return isNaN(e)?-Infinity:+e}}function rb(e,t){e=+e;var r=["K","M","B","T","P","E","Z","Y"];if(e>9999){var i=0;while(i<r.length&&e>999){e/=1e3;++i}return ib(e)+r[i-1]}else if(t){return Math.round(e).toString()}else if(e<10){return(Math.round(e*1e3)/1e3).toString()}else if(e<100){return(Math.round(e*100)/100).toString()}else if(e<1e3){return(Math.round(e*10)/10).toString()}else{return Math.round(e).toString()}}function ib(e){if(e<10){return Math.round(e*100)/100}else if(e<100){return Math.round(e*10)/10}else if(e<1e3){return Math.round(e)}}var nb={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:function(e){var t=e.nodes;return t.setSelected(true)}};Ogma.extend(function(e){var t=new ab(e);e.modules.lasso=t;e.tools.lasso={enable:function(e){return t.enable(e)},disable:function(){return t.disable()},enabled:function(){return t.enabled()}}});var ab=function e(t){var r=this;this._ogma=t;this._graphics=t.modules.graphics;this._graph=t.modules.graph;this._captor=t.modules.captor;this._interactions=t.modules.interactions;this._spatial=t.modules.spatial;this._options=U(nb);this._enabled=false;this._points=[];this._bbox=new Mr;this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._interaction=this._interactions.onDrag({priority:"lasso",check:function(){return r._enabled},onStart:function(e){var t=e.x;var i=e.y;r._bbox.reset();sb(r,t,i,false)},onProgress:function(e){var t=e.x;var i=e.y;return sb(r,t,i,true)},onStop:function(){var e=r._bbox;var t=e.minX;var i=e.minY;var n=e.maxX;var a=e.maxY;var o=r._spatial.queryProjected(t,i,n,a);var s=o.nodes;var u=s.filter(function(e){var t=e.getAttribute("detectable");return t&&ob(e.getPositionOnScreen(),r._points)});r._ctx.clearRect(0,0,r._canvas.width,r._canvas.height);r._points=[];r.disable();r._options.callback({nodes:u})}})};ab.prototype.enable=function e(t){if(this._enabled){return}this._enabled=true;this._captor.setDetectionEnabled(false);this._options=to(t,nb);this._graphics.addCanvas(this._canvas);Ve(this._canvas,this._options.cursorStyle);if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorPosition())}};ab.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._captor.setDetectionEnabled(true);this._graphics.removeCanvas(this._canvas)};ab.prototype.enabled=function e(){return this._enabled};function ob(e,t){return Ai(e.x,e.y,t)}function sb(e,t,r,i){var n=Ce();var a=e._ctx;var o=e._options;var s=e._points;e._bbox.addPoint(t,r);a.clearRect(0,0,e._canvas.width,e._canvas.height);s.push({x:t,y:r});if(i){var u=s[0];a.lineWidth=o.strokeWidth;a.lineJoin="bevel";a.strokeStyle=o.strokeColor;a.fillStyle=o.fillColor;a.beginPath();a.moveTo(u.x*n,u.y*n);for(var l=1;l<s.length;++l){var d=s[l];a.lineTo(d.x*n,d.y*n)}a.stroke();if(o.fillColor){a.fill()}}}var ub={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:function(e){var t=e.nodes;var r=e.edges;t.setSelected(true);r.setSelected(true)}};Ogma.extend(function(e){var t=new lb(e);e.modules.rectangleSelect=t;e.tools.rectangleSelect={enable:function(e){return t.enable(e)},disable:function(){return t.disable()},enabled:function(){return t.enabled()}}});var lb=function e(t){var r=this;this._ogma=t;this._graph=t.modules.graph;this._selection=t.modules.selection;this._camera=t.modules.camera;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._keyboard=t.modules.keyboard;this._captor=t.modules.captor;this._spatial=t.modules.spatial;this._options=U(ub);this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._enabled=false;this._start=null;this._rectangle=new Mr;this._interaction=this._interactions.onDrag({priority:"lasso",disableDetection:true,check:function(){return r._enabled},onStart:function(e){var t=e.x;var i=e.y;r._rectangle.reset();r._start={x:t,y:i};r._ctx.fillStyle=r._options.fillColor;r._ctx.strokeStyle=r._options.strokeColor;r._ctx.lineWidth=r._options.strokeWidth},onProgress:function(e){var t=e.x;var i=e.y;return r._refreshRectangle({x:t,y:i})},onStop:function(){var e=r._ogma;var t=r._captor.getCursorPosition();var i=r._formatRectangle(t);var n=r._spatial.queryProjected(i.minX,i.minY,i.maxX,i.maxY);var a=n.nodes;var o=n.edges;var s=a.filter(function(e){return e.getAttribute("detectable")&&r._camera.isNodeInRectangle(e,i)});var u=s.size?e.createEdgeList():o.filter(function(e){return e.getAttribute("detectable")&&r._camera.isEdgeInRectangle(e,i)});r._clearCanvas();r.disable();r._options.callback({nodes:s,edges:u})}})};lb.prototype.enable=function e(t){if(this._enabled){return}this._enabled=true;this._options=to(t,ub);this._graphics.addCanvas(this._canvas);Ve(this._canvas,this._options.cursorStyle);if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorPosition())}};lb.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._graphics.removeCanvas(this._canvas)};lb.prototype.enabled=function e(){return this._enabled};lb.prototype._clearCanvas=function e(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)};lb.prototype._formatRectangle=function e(t){var r=this._start.x;var i=this._start.y;var n=t.x;var a=t.y;var o=Math.abs(r-n);var s=Math.abs(i-a);var u=r<n?r:n;var l=i<a?i:a;return this._rectangle.reset().addPoint(u,l).addPoint(u+o,l+s)};lb.prototype._refreshRectangle=function e(t){var r=this._formatRectangle(t);var i=r.minX;var n=r.minY;var a=r.width;var o=r.height;var s=Ce();this._clearCanvas();this._ctx.strokeRect(i*s,n*s,a*s,o*s);if(this._options.fillColor){this._ctx.fillRect(i*s,n*s,a*s,o*s)}};var db={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1};Ogma.extend(function(e){var t=new hb(e);e.modules.resizing=t;e.tools.resize={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var hb=function e(t){var r=this;this._dom=t.modules.dom;this._interactions=t.modules.interactions;this._events=t.modules.events;this._camera=t.modules.camera;this._dom=t.modules.dom;this._spatial=t.modules.spatial;this._graphics=t.modules.graphics;this._engine=this._graphics.getGraphicsEngine();this._canvas=ke();this._init();this._interactions.onDrag({priority:"resizing",disableDetection:true,check:function(){return r._enabled&&r._pointedNode},onStart:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i;r._nodeBeingResized=r._pointedNode},onProgress:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i;r._displayHandles()},onStop:function(){r._nodesToHighlight.forEach(function(e,t){var i=r._additionalRadiuses[t]/r._camera.zoom;e.setAttributes({radius:e.getAttribute("radius")+i,x:e.getPosition().x+i,y:e.getPosition().y-i})});r._pointedNode=null;r._nodeBeingResized=null;r._displayHandles()}});this._onSelectionChange=function(){if(!r._enabled){return}r._nodesToHighlight=t.getSelectedNodes();r._displayHandles()};this._events.on({"cameraMove progressMoveNodesByDragging":function(){return r._displayHandles()},"move down":function(e){var t=e.x;var i=e.y;return r._detectBoundingBoxes(t,i)}});t.events.onNodesSelected(this._onSelectionChange);t.events.onNodesUnselected(this._onSelectionChange)};hb.prototype._init=function e(){this._enabled=false;this._nodesToHighlight=null;this._options=null;this._nodeBeingResized=null;this._pointedNode=null;this._cursorEnabled=false;this._x=0;this._y=0;this._additionalRadiuses=[]};hb.prototype._enableCursor=function e(){if(!this._cursorEnabled){this._graphics.addCursorStyle(this._options.cursor);this._cursorEnabled=true}};hb.prototype._disableCursor=function e(){if(this._cursorEnabled){this._graphics.removeCursorStyle(this._options.cursor);this._cursorEnabled=false}};hb.prototype._detectBoundingBoxes=function e(t,r){var i=this;if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight){return}var n=this._options.handleSize,a=this._options.detectionMargin;this._pointedNode=null;this._forEachNodeToHighlight(function(e,o,s){var u=o.x+s-n/2-a,l=o.x+s+n/2+a,d=o.y-s-n/2-a,h=o.y-s+n/2+a;if(t>=u&&t<=l&&r>=d&&r<=h){i._pointedNode=e}});if(this._pointedNode){this._enableCursor()}else{this._disableCursor()}};hb.prototype._forEachNodeToHighlight=function e(t){var r=this;this._nodesToHighlight.forEach(function(e){var i=e.getPositionOnScreen(),n=r._getTotalOnScreenRadius(e);t(e,i,n)})};hb.prototype._displayHandles=function e(){var t=this;if(!this._enabled||!this._nodesToHighlight){return}var r=this._canvas,i=r.getContext("2d"),n=r.width,a=r.height,o=Ce();var s=this._options;var u=s.color;var l=s.lineWidth;var d=s.handleSize;var h=0;i.clearRect(0,0,n,a);if(this._nodeBeingResized){var f=this._getTotalOnScreenRadius(this._nodeBeingResized),c=this._nodeBeingResized.getPositionOnScreen();h=Math.max(this._x-(c.x+f),-(this._y-(c.y-f)))/2}this._additionalRadiuses=[];this._forEachNodeToHighlight(function(e,r,n){var a=0;if(t._nodeBeingResized){a=h;var s=-n+e.getAttribute("innerStroke.width")+e.getAttribute("outerStroke.width")+l/2+1;if(a<s){a=s}else{a=t._snap(e,a)}t._additionalRadiuses.push(a);var f=e.getAttribute("shape"),c=t._engine.getShapePoints(f),v=r.x+a,g=r.y-a,p=n+a;t._displayNodePreview(i,o,v,g,p,c)}i.strokeStyle=u;i.fillStyle=u;i.lineWidth=l;i.strokeRect((r.x-n)*o,(r.y-n-a*2)*o,(a+n)*2*o,(a+n)*2*o);i.fillRect((r.x+n+a*2-d/2)*o,(r.y-n-a*2-d/2)*o,d*o,d*o)})};hb.prototype._displayNodePreview=function e(t,r,i,n,a,o){i*=r;n*=r;a*=r;t.beginPath();if(o.length===1){t.arc(i,n,a,0,Math.PI*2)}else{for(var s=0;s<o.length;++s){var u=o[s],l=i+u.x*a,d=n+u.y*a;if(s===0){t.moveTo(l,d)}else{t.lineTo(l,d)}}}t.fillStyle=this._options.previewColor;t.fill()};hb.prototype._getTotalOnScreenRadius=function e(t){return t.getAttribute("radius")*this._camera.zoom+t.getAttribute("innerStroke.width")+t.getAttribute("outerStroke.width")+this._options.lineWidth/2};hb.prototype._snap=function e(t,r){var i=this;var n=this._spatial.getNodesInScreenByDistance(t).filter(function(e){return!e.isSelected()}).slice(0,this._options.nbNodesToSnapTo),a=this._canvas.getContext("2d"),o=this._getTotalOnScreenRadius(t),s=o+r,u=this._options.snappingRatio,l=s/o,d=Math.round(fb(l,u)),h=Math.pow(u,d),f=o*h,c=null;n.forEach(function(e){var t=i._getTotalOnScreenRadius(e);if(Math.abs(t-s)<=Math.abs(f-s)){f=t;c=e}});if(c){a.save();a.strokeStyle=this._options.sizeIndicatorColor;a.lineWidth=this._options.sizeIndicatorThickness;var v=c.getAttribute("radius");this._displaySizeIndicator(t,f);n.filter(function(e){return e.getAttribute("radius")===v}).forEach(function(e){return i._displaySizeIndicator(e)});a.restore()}return f-o};hb.prototype._displaySizeIndicator=function e(t,r){var i=this._canvas.getContext("2d"),n=Ce(),a=t.getPositionOnScreen(),o=this._getTotalOnScreenRadius(t),s=r||o,u=r?r-o:0,l=u-this._options.sizeIndicatorOffset-(r?t.getAttribute("innerStroke.width")+t.getAttribute("outerStroke.width"):0),d=a.x-s+l|0,h=a.y-s-u|0,f=a.y+s-u|0,c=this._options.sizeIndicatorWidth;i.beginPath();i.moveTo((d-c)*n,h*n);i.lineTo((d+c)*n,h*n);i.moveTo(d*n,h*n);i.lineTo(d*n,f*n);i.moveTo((d-c)*n,f*n);i.lineTo((d+c)*n,f*n);i.stroke()};hb.prototype.enable=function e(t){if(this._enabled){return}this._options=to(t,db);this._graphics.addCanvas(this._canvas);this._enabled=true};hb.prototype.disable=function e(){if(!this._enabled){return}this._graphics.removeCanvas(this._canvas);this._disableCursor();this._init()};hb.prototype.enabled=function e(){return this._enabled};function fb(e,t){return Math.log(e)/Math.log(t)}var cb={color:"#00C3FF",radius:7,cursorOnHover:"grab",cursorOnDrag:"grabbing"};var vb=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._captor=t.modules.captor;this._graph=t.modules.graph;this._camera=t.modules.camera;this._graphics=t.modules.graphics;this._selection=t.modules.selection;this._events=t.modules.events;this._settings=t.modules.settings;this._interactions=t.modules.interactions;this._rewirableClass=t.styles.createClass({name:vd,isBuiltin:true,edgeAttributes:{layer:Sd}});this._enabled=false;this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._nodesToHighlight=null;this._movedEdges=null;this._startNode=null;this._hoverHandle=false;this._grabHandle=false;this._prevSettings=null;this._x=0;this._y=0;this._refreshHandles=function(){if(!r._enabled||r._movedEdges){return}var e=r._ogma.getSelectedEdges();r._nodesToHighlight=e.getExtremities().dedupe();r._rewirableClass.clearEdges();r._rewirableClass.add(e);mb(r)};this._events.on({cameraMove:function(){return mb(r)},move:function(){return mb(r)},progressMoveNodesByDragging:function(){return mb(r)},down:function(){if(r._hoverHandle){r._grabHandle=true}},up:function(){r._grabHandle=false}});t.events.onEdgesSelected(this._refreshHandles);t.events.onEdgesUnselected(this._refreshHandles);this._interaction=this._interactions.onDrag({priority:"rewiring",check:function(e){var t=e.target;if(!r._enabled||!t||!t.isNode||!r._hoverHandle){return false}var i=t.getAdjacentEdges().filter(function(e){return e.isSelected()});if(i.size){r._movedEdges=i;r._edgeColors=r._movedEdges.getAttribute("color");r._startNode=t;return true}else{return false}},onStart:function(){r._nodesToHighlight=r._nodesToHighlight.filter(function(e){return e!==r._startNode});_b(r,true);var e=r._options.cursorOnDrag;r._prevSettings=r._settings.update({edgeHover:false,cursor:{default:e,node:e,edge:e}})},onProgress:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i},onStop:function(){r._restoreSettings();var e=pb(r);if(e){r._movedEdges.forEach(function(t){if(t.getTarget()===r._startNode){t.setTarget(e)}else{t.setSource(e)}})}_b(r,false);r._movedEdges.setSelected(true);r._movedEdges=null;r._refreshHandles(r)}})};vb.prototype.enable=function e(t){if(this._enabled){return}this._options=to(t,cb);this._enabled=true;this._graphics.addCanvas(this._canvas);this._refreshHandles()};vb.prototype.disable=function e(){if(!this._enabled){return}this._interaction.stop();this._graphics.removeCursorStyle(this._options.cursorOnDrag);this._disableCursorOnHover();this._restoreSettings();this._graphics.removeCanvas(this._canvas);this._rewirableClass.clearEdges();this._enabled=false};vb.prototype.enabled=function e(){return this._enabled};vb.prototype._restoreSettings=function e(){if(this._prevSettings){this._settings.update(this._prevSettings);this._prevSettings=null}};vb.prototype._disableCursorOnHover=function e(){if(this._hoverHandle&&!this._grabHandle){this._hoverHandle=false;this._graphics.removeCursorStyle(this._options.cursorOnHover)}};vb.prototype._enableCursorOnHover=function e(){if(!this._hoverHandle){this._hoverHandle=true;this._graphics.addCursorStyle(this._options.cursorOnHover)}};function gb(e){if(!e._movedEdges){return}var t=e._x;var r=e._y;var i=e._ctx;var n=Ce();var a={x:t,y:r};var o=e._camera.getZoom();var s=e._movedEdges;s.forEach(function(t,r){var s=e._edgeColors[r];var u=t.getSource();var l=t.getTarget();var d=pb(e);var h=l===e._startNode?u:l;var f=t.getAttribute("width")*o;var c=h.getPositionOnScreen();var v=d?d.getPositionOnScreen():a;h.addClass(fd);i.beginPath();i.moveTo(c.x*n,c.y*n);i.lineTo(v.x*n,v.y*n);i.strokeStyle=s;i.lineWidth=f*n;i.stroke()})}function pb(e){var t=e._captor.getPointedElement();return t&&t.isNode?t:null}function _b(e,value){e._movedEdges.setExcluded(value)}function yb(e){e._canvas.getContext("2d").clearRect(0,0,e._canvas.width,e._canvas.height)}function mb(e){if(!e._enabled||!e._nodesToHighlight){return}var t=e._captor.getCursorPosition();var r=pb(e);var i=e._camera.zoom;var n=e._canvas.getContext("2d");var a=Ce();var o=e._options.color;var s=e._options.radius;var u=s*2*a;yb(e);gb(e);n.fillStyle=o;n.strokeStyle=o;var l=false;e._nodesToHighlight.forEach(function(e){var r=e.getPositionOnScreen();var o=r.x;var d=r.y;var h=e.getAttribute("radius")*(e.getAttribute("scalingMethod")==="fixed"?1:i);if(h>s){n.fillRect((o-s)*a,(d-s)*a,u,u);if(distance(o,d,t.x,t.y)<s){l=true}}});if(e._movedEdges){var d=t;if(r){d=r.getPositionOnScreen()}n.fillRect((d.x-s)*a,(d.y-s)*a,u,u)}if(l){e._enableCursorOnHover()}else{e._disableCursorOnHover()}}Ogma.extend(function(e){var t=new vb(e);e.modules.rewiring=t;e.tools.rewire={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var xb={tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:true,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:true,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}};var bb={NONE:0,CENTER:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM:5};var Sb=function e(t){this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._spatial=t.modules.spatial;this._settings=t.modules.settings;this._events=t.modules.events;this._camera=t.modules.camera;this._options=U(xb);this._enabled=false;this._canvas=ke();this._ctx=this._canvas.getContext("2d");this._ysnap=bb.NONE;this._xsnap=bb.NONE;this._node=null;this._r=0;this._viewport=null;this._horizontalGuideLine=null;this._verticalGuideLine=null;this._vguideline={start:{x:0,y:0},end:{x:0,y:0}};this._hguideline={start:{x:0,y:0},end:{x:0,y:0}};this._distanceGuidelines=[-1,-1];this._neighbourGuidelines=[]};Sb.prototype.enable=function e(t){var r=this;if(this._enabled){return}var i=this._events;this._options=to(t,xb);this._enabled=true;this._graphics.addCanvas(this._canvas);this._dragStartListener=i.on("startMoveNodesByDragging",function(e){return r._onNodeDragStart(e)});this._dragEndListener=i.on("endMoveNodesByDragging",function(e){return r._onNodeDragEnd(e)});this._settings.update({"interactions.drag.onBeforeDrag":function(e,t,i,n){return r._onBeforeDrag(t,i,n)}})};Sb.prototype.disable=function e(){if(!this._enabled){return}var t=this._events;t.removeListener(this._dragStartListener);t.removeListener(this._dragEndListener);this._graphics.removeCanvas(this._canvas);this._settings.update({"interactions.drag.onBeforeDrag":null});this._enabled=false};Sb.prototype.enabled=function e(){return this._enabled};Sb.prototype._onNodeDragStart=function e(t){var r=t.nodes;if(r.size===1){this._node=r.get(0);this._cacheViewport();this._r=this._node.getAttribute("radius")}};Sb.prototype._onBeforeDrag=function e(t,r,i){if(this._node){var n=i[0];this._scan(n);this._node.setAttributes(n)}};Sb.prototype._onNodeDragEnd=function e(){this._node=null;this._clearCanvas()};Sb.prototype._cacheViewport=function e(){var t=this._camera;var r=t.screenToGraphCoordinates({x:0,y:0});var i=t.screenToGraphCoordinates({x:t.width,y:t.height});this._viewport={xmin:r.x,ymin:r.y,xmax:i.x,ymax:i.y};this._nodes=this._spatial.getNodesByBoundingBox(r.x,r.y,i.x,i.y);var n=this._node._index;var a=this._nodes._indexes.slice();a.splice(a.indexOf(n),1);var o=this._graphics._getAttributeArray(true,"radius");var s=this._graph.getNodeAttribute("x");var u=this._graph.getNodeAttribute("y");var l=s._buffer;var d=u._buffer;var h=A(a.slice(),s);var f=A(a.slice(),u);var c={},v={};var g={},p={};var _=this._gridResolution=this._node.getAttribute("radius");for(var y=0,m=a.length;y<m;y++){var x=h[y],b=f[y];var S=l[x]/_|0,E=d[b]/_|0;if(!c[S]){c[S]=[]}if(!v[E]){v[E]=[]}c[S].push(x);v[E].push(b);g[x]=p[b]=y}this._nodesByX=h;this._nodesByY=f;this._nodesByXIndex=g;this._nodesByYIndex=p;this._xGrid=c;this._yGrid=v;this._xList=s;this._yList=u;this._X=l;this._Y=d;this._R=o};Sb.prototype._clearCanvas=function e(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)};Sb.prototype._drawLine=function e(t,r,i,n){var a=this._ctx,o=Ce(),s=this._camera.graphToScreenCoordinates(t),u=this._camera.graphToScreenCoordinates(r);a.beginPath();a.moveTo(s.x*o,s.y*o);a.lineTo(u.x*o,u.y*o);a.strokeStyle=n;a.lineWidth=i;a.stroke()};Sb.prototype._scan=function e(t){this._clearCanvas();var r=this._node._index;var i=t.x,n=t.y,a=this._r;var o=this._options;var s=this._xList;var u=this._yList;var l=this._R;var d=this._X;var h=this._Y;var f=this._camera.zoom;var c=Math.min(a,this._options.tolerance/f);var v=a*2*o.sideSnapDistanceFactor;var g=o.guidelineWidth;var p=o.guidelineColor;var _,y;var m=r;var x=r;var b,S,E,w,T,k,C;var I=false,M=false;m=Ab(this._nodesByX,d,i);x=Ab(this._nodesByY,h,n);if(Math.abs(d[m]-i)>o.centerSnapDistance){m=r}if(Math.abs(h[x]-n)>o.centerSnapDistance){x=r}this._xsnap=bb.NONE;if(m!==r){_=this._vguideline.start;y=this._vguideline.end;C=m;b=d[C];S=h[C];E=l.get(C);k=Math.abs(i-b);var L=Math.abs(i-a-(b-E));var F=Math.abs(i+a-(b+E));if(k<Math.max(a,E)){if(S<n){_.y=S-E;y.y=n+a}else{_.y=S+E;y.y=n-a}var N=Math.min(L,k,F);if(N===k){_.x=y.x=b;y.y=n;_.y=S;this._xsnap=bb.CENTER}else if(Math.abs(n-S)<E+a+v){if(N===L){_.x=y.x=b-E;this._xsnap=bb.LEFT}else{_.x=y.x=b+E;this._xsnap=bb.RIGHT}}if(N<c){I=true}}if(this._xsnap!==bb.NONE){this._drawLine(_,y,g,p)}}this._ysnap=bb.NONE;if(x!==r){_=this._hguideline.start;y=this._hguideline.end;C=x;b=d[C];S=h[C];E=l.get(C);k=Math.abs(n-S);var z=Math.abs(n-a-(S-E));var P=Math.abs(n+a-(S+E));if(k<Math.max(a,E)){if(b<i){_.x=b-E;y.x=i+a}else{_.x=b+E;y.x=i-a}var O=Math.min(z,k,P);if(O===k){_.y=y.y=S;y.x=i;_.x=b;this._ysnap=bb.CENTER}else if(Math.abs(i-b)<E+a+v){if(O===z){_.y=y.y=S-E;this._ysnap=bb.TOP}else{_.y=y.y=S+E;this._ysnap=bb.BOTTOM}}if(O<c){M=true}}if(this._ysnap!==bb.NONE){this._drawLine(_,y,g,p)}}if(o.preferredDistance.enabled){var D=o.preferredDistance.ratio;var R=Math.min(o.preferredDistance.tolerance/f,a);var B=Math.max(a,E);if(m!==r&&(this._xsnap===bb.NONE||!I)){C=m;b=d[C];S=h[C];E=l.get(C);w=Math.abs(i-b)-(a+E)*(1+D);if(w<=R&&w>=-R){var j=i<b?-1:1;_=this._vguideline.start;y=this._vguideline.end;_.x=y.x=b+j*(1+D)*(a+E);_.y=S-B;y.y=S+B;_.x=y.x=b;this._drawLine(_,y,g,p);_.y=n-B;y.y=n+B;_.x=y.x=b+j*(1+D)*(a+E);this._drawLine(_,y,g,p);this._xsnap=bb.CENTER;I=true}}else if(x!==r&&(this._ysnap===bb.NONE||!M)){C=x;b=d[C];S=h[C];E=l.get(C);T=Math.abs(n-S)-(a+E)*(1+D);if(T<=R&&T>=-R){var U=n<S?-1:1;_=this._hguideline.start;y=this._hguideline.end;_.x=b-B;y.x=b+B;_.y=y.y=S;this._drawLine(_,y,g,p);_.x=i-B;y.x=i+B;_.y=y.y=S+U*(1+D)*(a+E);this._drawLine(_,y,g,p);this._ysnap=bb.CENTER;M=true}}}if(o.neighbours.enabled){var V=this._gridResolution;var G=i/V|0,W=n/V|0;var H=this._xGrid,X=this._yGrid,q=[];var Y=[].concat(X[W-1]||q,X[W]||q,X[W+1]||q);var Z=[].concat(H[G-1]||q,H[G]||q,H[G+1]||q);var K;if(Y.length>1){A(Y,s);K=this.findNeighboursToAlign(Y,d,r,i,a,l,c);if(K){this.drawNeighbourGuidelines(K,t);I=false}}if(Z.length>1&&!K){A(Z,u);K=this.findNeighboursToAlign(Z,h,r,n,a,l,c);if(K){this.drawNeighbourGuidelines(K,t,true);M=false}}}if(I||M){this._snap(t,!I,!M)}};Sb.prototype.findNeighboursToAlign=function e(t,r,i,n,a,o,s){var u,l,d,h=false,f,c,v;var g=Math.abs;for(var p=0,_=t.length;!h&&p<_;p++){for(var y=0;!h&&y<_;y++){if(p===y){continue}var m=t[p],x=t[y];if(y<p){f=x;x=m;m=f}var b=r[m],S=r[x];var A=o.get(m),E=o.get(x);if(b+A<n-a&&S-E>n+a&&g(g(b+A-(n-a))-g(S-E-(n+a)))<=s){u=m;l=i,d=x;v=b+A+Math.abs(S-E-(b+A))/2;c=[b+A,v-a,v+a,S-E];h=true}else if(b+A<n-a&&S+E<n-a&&g(g(b+A-(S-E))-g(Math.max(b+A,S+E)-(n-a)))<=s){u=m;l=x;d=i;v=S+A+g(g(b+A-(S-E)))+a;c=[b+A,S-E,S+E,v-a];h=true}else if(b-A>n+a&&S-E>n+a&&g(g(b+A-(S-E))-g(Math.min(b-A,S-E)-(n+a)))<=s){u=i;l=m;d=x;v=b-A-g(g(b+A-(S-E)))-a;c=[v+a,b-A,b+A,S-E];h=true}}}return h?{a:u,b:l,c:d,current:i,target:v,points:c}:null};Sb.prototype.drawNeighbourGuidelines=function e(t,r,i){var n=t.a;var a=t.b;var o=t.c;var s=t.points;var u=t.target;var l={x:0,y:0};var d={x:0,y:0};var h=this._R,f=this._X,c=this._Y;var v=h.getMultiple([n,a,o]);var g=v[0];var p=v[1];var _=v[2];var y=this._options.neighbours;var m=y.offset;var x=y.lineWidth;var b=y.lineColor;var S,A;if(i){r.y=u;g=-g;p=-p;_=-_;S=d.x=l.x=Math.min(f[n]+g,f[a]+p,f[o]+_)-m;A=f}else{r.x=u;S=d.y=l.y=Math.max(c[n]+g,c[a]+p,c[o]+_)+m;A=c}var E=i?"y":"x";var w=i?"x":"y";l[E]=s[0];d[E]=s[1];this._drawLine(l,d,x,b);l[E]=s[2];d[E]=s[3];this._drawLine(l,d,x,b);l[E]=s[0];l[w]=S-m/2;d[E]=s[0];l[w]=A[n]+g;this._drawLine(l,d,x,b);l[E]=s[1];l[w]=S-m/2;d[E]=s[1];l[w]=A[a]+p;this._drawLine(l,d,x,b);l[E]=s[2];l[w]=S-m/2;d[E]=s[2];l[w]=A[a]+p;this._drawLine(l,d,x,b);l[E]=s[3];l[w]=S-m/2;d[E]=s[3];l[w]=A[o]+_;this._drawLine(l,d,x,b)};Sb.prototype._snap=function e(t,r,i){var n=this._xsnap;var a=this._ysnap;var o;if(!r&&n!==bb.NONE){o=this._vguideline.end;if(n===bb.LEFT){t.x=o.x+this._r}else if(n===bb.RIGHT){t.x=o.x-this._r}else{t.x=o.x}}if(!i&&a!==bb.NONE){o=this._hguideline.end;if(a===bb.TOP){t.y=o.y+this._r}else if(a===bb.BOTTOM){t.y=o.y-this._r}else{t.y=o.y}}};function Ab(e,t,r,i){var n=0,a=e.length-1;var o,s,u;var l=Math.abs;while(n<a){o=(n+a)/2|0;s=l(t[e[o]]-r);u=l(t[e[o+1]]-r);if(u<=s){n=o+1}else{a=o}}return i?a:e[a]}Ogma.extend(function(e){var t=new Sb(e);e.modules.snapping=t;e.tools.snapping={enable:function(e){return t.enable(e)},disable:function(){return t.disable()}}});Ogma.extend(function(e){var t=new wb(e);e.modules.tooltip=t;e.tools.tooltip={};e.tools.tooltip.onNodeHover=function(e,r){Nb(t,"hover.node",e,r)};e.tools.tooltip.onNodeClick=function(e,r){Nb(t,"click.left.node",e,r)};e.tools.tooltip.onNodeRightClick=function(e,r){Nb(t,"click.right.node",e,r)};e.tools.tooltip.onNodeDoubleClick=function(e,r){Nb(t,"doubleClick.left.node",e,r)};e.tools.tooltip.onEdgeHover=function(e,r){Nb(t,"hover.edge",e,r)};e.tools.tooltip.onEdgeClick=function(e,r){Nb(t,"click.left.edge",e,r)};e.tools.tooltip.onEdgeRightClick=function(e,r){Nb(t,"click.right.edge",e,r)};e.tools.tooltip.onEdgeDoubleClick=function(e,r){Nb(t,"doubleClick.left.edge",e,r)};e.tools.tooltip.onBackgroundClick=function(e,r){Nb(t,"click.left.background",e,r)};e.tools.tooltip.onBackgroundRightClick=function(e,r){Nb(t,"click.right.background",e,r)};e.tools.tooltip.onBackgroundDoubleClick=function(e,r){Nb(t,"doubleClick.left.background",e,r)};e.tools.tooltip.refresh=function(){return t.refresh()};e.tools.tooltip.isShown=function(){return t.isShown()};e.tools.tooltip.hide=function(){return t.hide()};e.events.onTooltipShown=function(t){e.modules.events.on("showTooltip",t);return e.events};e.events.onTooltipHidden=function(t){e.modules.events.on("hideTooltip",t);return e.events};e.tools.tooltip.show=function(e,r){return t.show(e,r)}});var Eb=["top","bottom","left","right","cssDefined"];var wb=function e(t){var r=this;this._dom=t.modules.dom;this._connectNodes=t.modules.connectNodes;this._interactions=t.modules.interactions;this._camera=t.modules.camera;this._events=t.modules.events;this._handlers={};this._currentHandlerName=null;this._tooltip=null;this._isHover=false;this._events.register(["showTooltip","hideTooltip"]);this._events.on({"up dragStart":function(){if(!r._isHover){Db(r)}},unhover:function(){if(r._isHover){Db(r)}},clear:function(){Db(r)}});this._interactions.onHover(Cb(this,"hover",true));this._interactions.onClick(Cb(this,"click"));this._interactions.onDoubleClick(Cb(this,"doubleClick"))};wb.prototype.hide=function e(){Db(this,true)};wb.prototype.isShown=function e(){return!!this._tooltip};wb.prototype.refresh=function e(){Ib(this)};wb.prototype.show=function e(t,r){if(r===void 0)r={};var i=r.position;if(i===void 0)i="top";var n=r.autoAdjust;if(n===void 0)n=true;var a=r.className;if(a===void 0)a=null;var o=r.x;if(o===void 0)o=0;var s=r.y;if(s===void 0)s=0;Ob(this,t,{position:i,autoAdjust:n,className:a},{x:o,y:s})};function Tb(e,t,r){if(e._timeout){e._dom.clearTimeout(e._timeout)}e._timeout=e._dom.setTimeout(function(){e._timeout=null;t()},r)}function kb(e,t){var r=t.button;var i=t.target;var n=[];n.push(e);if(r){n.push(r)}n.push(i?i.isNode?"node":"edge":"background");return n.join(".")}function Cb(e,t,r){if(r===void 0)r=false;return{priority:"tooltip",check:function(i){var n=kb(t,i);var a=e._handlers[n];if(r&&e._connectNodes.enabled()){return false}if(a&&a.condition(i)){return true}if(!r&&e._currentHandlerName&&!e._isHover){return!!e._tooltip}return false},handler:function i(n){var a=n.target;var o=n.x;var s=n.y;var u=e._tooltip;Db(e);if(!u){e._isHover=r;e._elt=a;e._x=o;e._y=s;e._currentHandlerName=kb(t,n);Ib(e)}}}}function Ib(e){if(!e._currentHandlerName){Db(e);return}var t=e._handlers[e._currentHandlerName];if(!t){return}var r=t.settings;var i=t.handler;var n=e._elt;if(n){var a=n.isNode?"node":"edge";if(e._currentHandlerName.indexOf(a)===-1){return}}var o=i(n);var s=o instanceof Promise?o:Promise.resolve(o);s.then(function(t){Tb(e,function(){Ob(e,t,r)},r.delay)})}var Mb={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}};var Lb={position:"top",autoAdjust:true,delay:100,className:null};var Fb={hover:{node:function(e){var t=e.target;return t&&t.isNode},edge:function(e){var t=e.target;return t&&!t.isNode}},click:{left:{node:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="left"&&!t}},right:{node:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="right"&&!t}}},doubleClick:{left:{node:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="left"&&!t}},right:{node:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="right"&&!t}}}};function Nb(e,t,r,i){var n=to(i,Lb,"position");if(Eb.indexOf(n.position)===-1){n.position="top"}e._handlers[t]={handler:r,condition:no(Fb,t),settings:n}}function zb(e){return typeof HTMLElement!=="undefined"?e instanceof HTMLElement:false}function Pb(e){return typeof document==="object"?document.createElement(e):{style:{},offsetWidth:10,offsetHeight:10}}function Ob(e,t,r,i){Db(e,false);var n=r.position;var a=r.className;var o=r.autoAdjust;var s=e._x;var u=e._y;var l=e._elt;var d=e._dom.getDimensions();var h=0;var f=0;if(i){s=i.x;u=i.y;l=null}if(typeof t==="string"){e._tooltip=Pb("div");e._tooltip.innerHTML=t}else if(zb(t)){e._tooltip=t}else{throw new Error("invalid tooltip "+t+", expected HTML string or HTML element")}e._tooltip.__isOgmaTooltip=true;if(a){e._tooltip.className+=e._tooltip.className?" "+a:a}if(n!=="cssDefined"){e._tooltip.style.position="absolute"}e._dom.setLayer("tooltip",e._tooltip);if(l&&l.isNode){var c=e._camera.graphToScreenCoordinates(l.getPosition()),v=l.getAttribute("radius")*e._camera.getZoom()+l.getAttribute("innerStroke.width")+l.getAttribute("outerStroke.width")+1;s=c.x;u=c.y;h=v;f=v}var g=e._tooltip.offsetWidth;var p=e._tooltip.offsetHeight;var _=g/2;var y=p/2;h+=_;f+=y;if(n!=="cssDefined"){var m=Mb[n],x=m.x,b=m.y;if(o){var S=s+h*m.x,A=u+f*m.y;if(S-_<0||S+_>=d.width){if(n==="left"||n==="right"){x*=-1}else{if(S-_<0){x=(_-S+1)/h}else{x=(d.width-(S+_)-1)/h}}}if(A-y<0||A+y>=d.height){if(n==="top"||n==="bottom"){b*=-1}else{if(A-y<0){b=(y-A+1)/f}else{b=(d.height-(A+y)-1)/f}}}}e._tooltip.style.left=s+h*x-_+"px";e._tooltip.style.top=u+f*b-y+"px"}e._events.fire("showTooltip",{tooltip:e._tooltip})}function Db(e,t){if(e._timeout){e._dom.clearTimeout(e._timeout);e._timeout=null}if(t){e._currentHandlerName=null}if(e._tooltip){var r=e._tooltip;e._dom.setLayer("tooltip",null);e._tooltip=null;e._events.fire("hideTooltip",{tooltip:r})}}Ogma.extend(function(e){e.debug={wait:function e(t){return new Promise(function(e){return setTimeout(e,t)})},initRandomGraph:function t(r){return e.generate.random(r).then(function(t){e.setGraph(t);e.view.locateGraph()})},initGrid:function t(r){var i=Math.ceil(Math.sqrt(r));return e.generate.grid({rows:i,columns:i}).then(function(t){e.setGraph(t);e.view.locateGraph()})},initLine:function t(r){e.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:r?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]});return e.view.locateGraph()},initSingleNode:function t(){e.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}]});return e.view.locateGraph()},initContinuousRenderLoop:function t(r){if(r===void 0)r={};var i=r.triggerKey;if(i===void 0)i="r";var n=r.start;if(n===void 0)n=true;var a=n;document.addEventListener("keydown",function(e){var t=e.key;if(t===i){a=!a;o()}});var o=function(){if(a){e.modules.dom.beforeNextFrame().then(o)}};o()},appendToBody:function t(){var r=document.createElement("div");r.style.position="absolute";r.style.top="0";r.style.left="0";r.style.bottom="0";r.style.right="0";document.body.appendChild(r);e.setContainer(r)},loadFile:function t(r){var i=r.endsWith(".gexf")?e.parse.gexfFromUrl(r):e.parse.jsonFromUrl(r);return i.then(function(t){return e.setGraph(t)}).then(function(){return e.view.locateGraph()}).then(function(){return e.view.afterNextFrame()})},enableLasso:function t(r){e.events.onDragStart(function(){if(e.keyboard.isKeyPressed("ctrl")){e.tools.lasso.enable(r)}})}}});function Rb(e,t){var r=t.styles;var i=t.nodes;var n=t.edges;var a=t.filter;var o={nodes:jb(true,e,r,i,a),edges:jb(false,e,r,n,a)};return o}var Bb={get:function(){return undefined}};function jb(e,t,r,i,n){var a=t.modules.graph;var o=i?i:n;var s=(e?a.getNodes(o):a.getEdges(o))._indexes;var u=new Array(s.length);var l=a.getNodeAttribute("id");var d=e?"radius":"width";var h=e?"shape":"shape.type";var f=a.getAttributes(e,["id","source","target","data","x","y","text.content","color",h,d]).map(function(e){return e||Bb});var c=f[0];var v=f[1];var g=f[2];var p=f[3];var _=f[4];var y=f[5];var m=f[6];var x=f[7];var b=f[8];var S=f[9];if(r==="none"){m=Bb;x=Bb;b=Bb;S=Bb}else if(r==="original"){var A=t.modules.individualAttributes.getOriginalAttributes()[e?"nodes":"edges"];m=A.text.content;x=A.color;b=H(A,h);S=A[d]}for(var E=0;E<s.length;++E){var w=s[E];var T={id:c.get(w),data:p.get(w),x:_.get(w),y:y.get(w),color:x.get(w),size:S.get(w),shape:b.get(w),text:m.get(w)};if(!e){T.source=l.get(v.get(w));T.target=l.get(g.get(w))}if(Array.isArray(T.color)){T.color=T.color[0]}u[E]=T}return u}function Ub(e,t){for(var r=0;r<t.length;++r){if(e===undefined||e===null){return undefined}e=e[t[r]]}return e}function Vb(e,t,value){for(var r=0;r<t.length-1;++r){var i=t[r],n=e[i];if(n===undefined){n={};e[i]=n}e=n}e[t[t.length-1]]=value}function Gb(e,t,r){var i=new kt,n=t?1:3,a=[];var o=function(o){var s=e[o],u=new Array(n),l=s.data;if(r){var d={};r.forEach(function(e){var t=F(e),value=Ub(l,t);Vb(d,t,value)});l=d}var h=Tt(l);u[0]=s.id;if(!t){u[1]=s.source;u[2]=s.target}for(var f=0;f<h.length;++f){var c=h[f];var v=c.path;var value=c.value;if(v.length){if(i.has(v)){u[i.get(v)]=value}else{i.set(v,n);u[n]=value;n++}}}a.push(u)};for(var s=0;s<e.length;++s)o(s);var u=[];u.push("id");if(!t){u.push("source");u.push("target")}i.keys().forEach(function(e){return u.push(e[e.length-1])});a.unshift(u);a.forEach(function(e){return e.length=n});return a}var Wb={what:undefined,dataProperties:undefined,separator:",",textSeparator:'"',download:true,filename:"graph.csv",filter:"visible",nodes:undefined,edges:undefined};Ogma.extend(function(e){e.export.csv=function(t){var r=to(t,Wb,"what");var i=r.what;var n=r.dataProperties;var a=r.nodes;var o=r.edges;var s=r.separator;var u=r.textSeparator;var l=r.download;var d=r.filename;var h=r.filter;var f=Rb(e,{styles:"none",nodes:a,edges:o,filter:h}),c=Hb(f,{what:i,separator:s,textSeparator:u,dataProperties:n});if(l){Ne(c,d,"text")}return Promise.resolve(c)}});function Hb(e,t){var r=t.what;var i=t.separator;var n=t.textSeparator;var a=t.dataProperties;var o=new RegExp(""+n,"g");function s(e){e=Xb(e);e=n+e.replace(o,"\\$&")+n;return e}if(n&&n!=='"'&&n!=="'"){throw new TypeError('Invalid argument :"textSeparator" is not single-quote or double-quote, was '+n)}if(r!=="nodes"&&r!=="edges"){throw new TypeError('missing argument: "what": should have value "nodes" or "edges"')}var u=r==="nodes",l=u?e.nodes:e.edges,d=Gb(l,u,a).map(function(e){return e.map(function(value){return s(value)})});return d.map(function(e){return e.join(i)}).join("\n")}function Xb(e){if(e instanceof Date){return e.toISOString()}else{return""+e}}var qb={creator:undefined,description:undefined,styles:"all",download:true,filename:"graph.gexf",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.gexf=function(t){if(t===void 0)t={};var r=to(t,qb);var i=r.styles;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.creator;var l=r.description;var d=r.filter;var h=Rb(e,{styles:i,nodes:n,edges:a,filter:d});var f=Yb(h,{creator:u,description:l});if(o){Ne(f,s,"text")}return Promise.resolve(f)}});function Yb(e,t){var r=new zr;var i=kr();var n;var a={};var o=0;var s={};var u=0;var l;var d;var h;var f;var c;var v;var g;var p;var _;var y;var m;var x;var b;var S;var A;var E;var w;var T;A=i.createElement("gexf");A.setAttribute("xmlns","http://www.gexf.net/1.2draft");A.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz");A.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");A.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd");A.setAttribute("version","1.2");x=i.createElement("meta");x.setAttribute("lastmodifieddate",rr());if(t.creator){g=i.createElement("creator");T=i.createTextNode(""+t.creator);g.appendChild(T);x.appendChild(g)}if(t.description){p=i.createElement("description");T=i.createTextNode(""+t.description);p.appendChild(T);x.appendChild(p)}m=i.createElement("graph");m.setAttribute("mode","static");b=i.createElement("nodes");e.nodes.forEach(function(e){S=i.createElement("node");S.setAttribute("id",e.id);if(e.text){S.setAttribute("label",e.text)}if(Qb(e.data)){n=Jb(e.data);d=i.createElement("attvalues");Object.keys(n).forEach(function(e){if(!(e in a)){a[e]={id:o,type:"integer"};o++}var t=n[e];a[e].type=Kb(t,a[e].type);h=i.createElement("attvalue");h.setAttribute("for",a[e].id);h.setAttribute("value",t);d.appendChild(h)});S.appendChild(d)}if(e.color){var t=r.parseColor(e.color);v=i.createElement("viz:color");v.setAttribute("r",Zb(t[0]));v.setAttribute("g",Zb(t[1]));v.setAttribute("b",Zb(t[2]));v.setAttribute("a",t[3]);S.appendChild(v)}E=i.createElement("viz:position");E.setAttribute("x",e.x);E.setAttribute("y",-parseInt(e.y,10));S.appendChild(E);if(e.size){w=i.createElement("viz:size");w.setAttribute("value",e.size);S.appendChild(w)}b.appendChild(S)});f=i.createElement("attributes");f.setAttribute("class","node");Object.keys(a).forEach(function(e){l=i.createElement("attribute");l.setAttribute("id",a[e].id);l.setAttribute("title",e);l.setAttribute("type",a[e].type);f.appendChild(l)});_=i.createElement("edges");e.edges.forEach(function(e){y=i.createElement("edge");y.setAttribute("id",e.id);y.setAttribute("source",e.source);y.setAttribute("target",e.target);if(e.size){y.setAttribute("weight",e.size)}if(e.text){y.setAttribute("label",e.text)}if(Qb(e.data)){n=Jb(e.data);d=i.createElement("attvalues");Object.keys(n).forEach(function(e){if(!(e in s)){s[e]={id:u,type:"integer"};u++}var t=n[e];s[e].type=Kb(t,s[e].type);h=i.createElement("attvalue");h.setAttribute("for",s[e].id);h.setAttribute("value",t);d.appendChild(h)});y.appendChild(d)}if(e.color){var t=r.parseColor(e.color);v=i.createElement("viz:color");v.setAttribute("r",Zb(t[0]));v.setAttribute("g",Zb(t[1]));v.setAttribute("b",Zb(t[2]));v.setAttribute("a",t[3]);y.appendChild(v)}if(e.size){w=i.createElement("viz:size");w.setAttribute("value",e.size);y.appendChild(w)}_.appendChild(y)});c=i.createElement("attributes");c.setAttribute("class","edge");Object.keys(s).forEach(function(e){l=i.createElement("attribute");l.setAttribute("id",s[e].id);l.setAttribute("title",e);l.setAttribute("type",s[e].type);c.appendChild(l)});m.appendChild(f);m.appendChild(c);m.appendChild(b);m.appendChild(_);A.appendChild(x);A.appendChild(m);i.appendChild(A);return'<?xml version="1.0" encoding="UTF-8"?>'+i.serialize()}function Zb(value){return Math.round(value*255)}function Kb(e,t){if(t==="integer"&&typeof e==="number"){if(e%1!==0){t="float"}}else if(typeof e!=="number"){t="string";if(typeof e==="boolean"){t="boolean"}}return t}function Qb(value){return typeof value==="object"&&value!==null&&value.constructor===Object}function Jb(e,t){if(t===void 0)t={};j(e,function(value,e){if(Qb(value)){Jb(value,t)}else{t[e]=value}});return t}var $b={graphId:"G",directedEdges:true,styles:"all",download:true,filename:"graph.graphml",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.graphml=function(t){if(t===void 0)t={};var r=to(t,$b);var i=r.styles;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.graphId;var l=r.directedEdges;var d=r.filter;var h=Rb(e,{styles:i,nodes:n,edges:a,filter:d}),f=eS(h,{graphId:u,directedEdges:l});if(o){Ne(f,s,"text")}return Promise.resolve(f)}});function eS(e,t){var r=new zr;var i=we();function n(e){return r.parseColor(e)}function a(e){return r.toHexa(e)}function o(e,t){var r=n(t);e.r=r[0];e.g=r[1];e.b=r[2]}function s(e,t,r,n,a){r=r||{};var o=i.createElement(t);for(var s in r){if(!r.hasOwnProperty(s)){continue}var value=r[s];if(value!==undefined){o.setAttribute(s,value)}}if(n!==undefined||a){if(Object.prototype.toString.call(n)==="[object Object]"){n=JSON.stringify(n)}var u=i.createTextNode(n);o.appendChild(u)}e.appendChild(o);return o}var u=["id","source","target"];var l=["size","x","y","shape","color","text"];var d={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}},h=[],f=[];function c(e,t){var r={id:e.id};l.forEach(function(i){var value=e[i];if(i==="y"&&value){value=-parseFloat(value)}if(value!==undefined){r[(t==="edge"?"edge_":"")+i]=value;if(i==="color"){o(r,value)}}});var i=e.data||{};j(i,function(value,e){if(l.indexOf(e)!==-1||u.indexOf(e)!==-1){return}if(!d[e]){d[e]={for:t,type:"string"}}else if(d[e].for!==t){d[e].for="all"}r[e]=value});if(t==="edge"){r.source=e.source;r.target=e.target;f.push(r)}else{h.push(r)}}e.nodes.forEach(function(e){c(e,"node")});e.edges.forEach(function(e){c(e,"edge")});var v=s(i,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns "+"http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});j(d,function(value,e){if(value.for==="node"||value.for==="all"){s(v,"key",{"attr.name":e,"attr.type":value.type,for:"node",id:e})}if(value.for==="edge"||value.for==="all"){s(v,"key",{"attr.name":e,"attr.type":value.type,for:"edge",id:"edge_"+e})}});s(v,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"});s(v,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});var g=s(v,"graph",{edgedefault:t.directedEdges||t.directedEdges===undefined?"directed":"undirected",id:t.graphId?t.graphId:"G","parse.nodes":e.nodes.length,"parse.edges":e.edges.length,"parse.order":"nodesfirst"});function p(e,t){var r=s(e,"data",{key:"nodegraphics"});var i=s(r,"y:ShapeNode");s(i,"y:Geometry",{x:t.x,y:t.y,width:t.size,height:t.size});s(i,"y:Fill",{color:a(t.color),transparent:false});s(i,"y:NodeLabel",null,t.text||"");s(i,"y:Shape",{type:t.shape})}function _(e,t){var r=s(e,"data",{key:"edgegraphics"});var i=s(r,"y:PolyLineEdge");s(i,"y:LineStyle",{type:t.edge_type,color:a(t.edge_color),width:t.edge_size});s(i,"y:EdgeLabel",null,t.edge_label)}h.forEach(function(e){var t=s(g,"node",{id:e.id});p(t,e);j(e,function(value,e){if(u.indexOf(e)!==-1){return}s(t,"data",{key:e},value,true)})});f.forEach(function(e){var t=s(g,"edge",{id:e.id,source:e.source,target:e.target});_(t,e);j(e,function(value,e){if(u.indexOf(e)!==-1){return}s(t,"data",{key:e},value,true)})});var y=Te(i);return'<?xml version="1.0" encoding="UTF-8"?>\n'+y}var tS={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:function(e){return e},edgeData:function(e){return e},filter:"visible",pretty:false,download:true,filename:"graph.json"};Ogma.extend(function(e){e.export.json=function(t){if(t===void 0)t={};var r=to(t,tS);var i=r.nodeAttributes;var n=r.edgeAttributes;var a=r.nodeData;var o=r.edgeData;var s=r.filter;var u=r.pretty;var l=r.download;var d=r.filename;var h={nodes:e.getNodes(typeof s==="object"?s.nodes:s).toJSON({attributes:i,data:a}),edges:e.getEdges(typeof s==="object"?s.edges:s).toJSON({attributes:n,data:o})};var f=u?JSON.stringify(h,null," "):JSON.stringify(h);if(l){Ne(f,d,"text")}return Promise.resolve(f)}});Ogma.atInit(function(e){return e.styles.createClass({name:gd,isBuiltin:true})});var rS=10;function iS(e,t){var r=e.view.get();var i=typeof t.margin==="number"?t.margin:rS;var n={pixelRatio:1,backgroundColor:r.backgroundColor};if(t.width&&t.height){n.width=t.width;n.height=t.height}else{n.width=r.width;n.height=r.height}if(t.clip){n.zoom=r.zoom;n.x=r.x;n.y=r.y}else{var a=e.getNodes(t.filter).getBoundingBox();n.x=a.cx;n.y=a.cy;n.zoom=Math.min(n.width/(a.width+i),n.height/(a.height+i))}if(e.modules.geo.isEnabled()){n.backgroundColor=null}else if(t.background!==undefined){n.backgroundColor=t.background}return n}function nS(e,t,r,i,n){if(n===void 0)n=false;r.hideImages=n;r.isBufferDisplayable=function(e){return t.texts||!nh(e)};var a={};if(t.badges===false){var o={text:null,image:null};a.badges={topLeft:o,topRight:o,bottomRight:o,bottomLeft:o}}e.styles.getClass(gd).update({nodeAttributes:a});return e.modules.graphics.export(i,r,t.filter,t)}Ogma.extend(function(e){e.export.png=function(t){return fS(e,t,"png")};e.export.jpg=function(t){return fS(e,t,"jpg")};e.export.tiff=function(t){return fS(e,t,"tiff")};e.export.gif=function(t){return fS(e,t,"gif")}});function aS(e){return{download:true,filter:"visible",filename:"graph."+e,clip:false,margin:10,width:undefined,height:undefined,background:null,badges:true,legend:undefined,texts:true,images:true,map:true,textWatermark:{content:null,fontFamily:"Arial",fontSize:48,fontStyle:null,fontColor:"red",repeat:false,angle:0,alpha:.65,space:50,x:undefined,y:undefined},imageWatermark:{url:null,width:undefined,height:undefined,repeat:false,angle:0,alpha:.65,space:50,x:undefined,y:undefined},imageCrossOrigin:undefined}}var oS={png:aS("png"),jpg:aS("jpg"),tiff:aS("tiff"),gif:aS("gif")};function sS(e){var t=e.canvas;var r=e.parameters;if(r.textWatermark.content){_S(t,r.textWatermark,cS,vS)}if(r.imageWatermark.url){return Re(r.imageWatermark.url).then(function(i){if(i){r.imageWatermark.content=i;_S(t,r.imageWatermark,pS,gS)}return e})}else{return e}}function uS(e){var t=e.ogma;var r=e.canvas;var i=e.parameters;var n=t.modules.legend;var a=i.legend;if(a===undefined){a=n.enabled()?n.getCurrentOptions():false}else if(a===true){a={}}if(a){n.exportOnCanvas(r,a)}return e}function lS(e){var t=e.canvas;var r=e.ogma;var i=e.view;if(r.modules.geo.isEnabled()){return r.modules.geo.whenReady().then(function(){return r.modules.geo.exportBackground(t,i)}).then(function(){return e})}else{return e}}function dS(e){var t=e.ogma;var r=e.parameters;var i=e.canvas;var n=e.view;var a=i.getContext("2d");return nS(t,r,n,"canvas",!r.images).then(function(i){try{i.getContext("2d").getImageData(0,0,1,1);a.drawImage(i,0,0);return e}catch(i){Ja(i);return nS(t,r,n,"canvas",true).then(function(t){a.drawImage(t,0,0);return e})}})}function hS(e){var t=e.canvas;var r=e.parameters;var i=e.type;var n=t.toDataURL("image/"+i);if(r.download){Ne(n,r.filename,"dataURL")}return n}function fS(e,t,r){t=to(t,oS[r]);if(t.background===null){t.background=e.modules.graphics.getTransparentBackgroundColor()}var i=iS(e,t);var n=ke();var a={ogma:e,parameters:t,canvas:n,view:i,type:r};n.width=i.width;n.height=i.height;return Promise.resolve(a).then(lS).then(dS).then(sS).then(uS).then(hS)}function cS(e,t,r,i){e.textAlign="center";e.textBaseline="middle";e.fillText(t,r,i)}function vS(e,t,r){return{width:e.measureText(t).width,height:r}}function gS(e,t,r,i,n){return{width:i===undefined?t.width:i,height:n===undefined?t.height:n}}function pS(e,t,r,i,n,a){e.drawImage(t,r-n/2,i-a/2,n,a)}function _S(e,t,r,i){if(!t){return}if(typeof t!=="object"){t={content:t}}else if(!t.content){return}var n=t.fontFamily;var a=t.fontSize;var o=t.fontStyle;var s=t.fontColor;var u=t.repeat;var l=t.angle;var d=t.alpha;var h=t.space;var f=t.content;var c=e.getContext("2d");var v=e.width;var g=e.height;var p=t.x===undefined?v/2:t.x;var _=t.y===undefined?g/2:t.y;var y=t.height;var m=t.width;l=l/180*Math.PI;Ye(c,n,a,o);c.fillStyle=s;c.globalAlpha=d;var x=i(c,f,a,m,y);if(!u){c.save();c.translate(p,_);c.rotate(l);r(c,f,0,0,x.width,x.height);c.restore()}else{var b=x.width+h,S=x.height+h,A=Math.sqrt(v*v+g*g);c.save();c.translate(0,0);c.rotate(l);for(var E=0;E<A;E+=b){for(var w=0;w<A;w+=S){r(c,f,E,w,x.width,x.height);if(w!==0){r(c,f,E,-w,x.width,x.height)}}}c.restore()}}Ogma.extend(function(e){e.export.svg=function(t){return mS(e,t)}});var yS={download:true,filename:"graph.svg",width:undefined,height:undefined,background:null,texts:true,images:true,badges:true,embedFonts:false,clip:false,margin:10,prefix:"ogma"};function mS(e,t){t=to(t,yS);if(t.background===null){t.background=e.modules.graphics.getTransparentBackgroundColor()}var r=iS(e,t);return nS(e,t,r,"svg",!t.images).then(function(e){e.removeAttribute("pointer-events");e.setAttribute("version","1.1");e.setAttribute("xmlns","http://www.w3.org/2000/svg");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");return e}).then(function(r){return xS(e,r,t)}).then(function(r){return SS(e,r,t)}).then(function(e){var r='<?xml version="1.0" encoding="utf-8"?>'+Te(e);if(t.download){Ne(r,t.filename)}return r})}function xS(e,t,r){var i=t.childNodes[2];var n=i.childNodes;var a={};var o=r.prefix;for(var s=0;s<n.length;s++){var u=n[s];var l=u.getAttribute(tl);a[l]=a[l]||[];a[l].push(u)}var d=Object.keys(a);var h=e.modules.graph;var f=h.getNodeAttribute("id");var c=h.getEdgeAttribute("id");var v=Oe("g",{class:o+"-edges"});var g=Oe("g",{class:o+"-nodes"});for(var p=0;p<d.length;p++){var _=d[p];var y=_.charAt(0)==="n";var m=parseInt(_.substring(1));var x=a[_];var b=Ze((y?f:c).get(m));var S=Oe("g");S.setAttribute("data-"+(y?"node":"edge")+"-id",b);S.setAttribute("class",o+"-"+(y?"node":"edge"));for(var A=0;A<x.length;A++){var E=x[A];S.appendChild(E);E.removeAttribute(tl)}(y?g:v).appendChild(S)}i.appendChild(v);i.appendChild(g);return t}function bS(e){var t=[].concat(Array.prototype.slice.call(e.getElementsByTagName("text")||[]),Array.prototype.slice.call(e.getElementsByTagName("tspan")||[]));var r=[];var i={};for(var n=0;n<t.length;n++){var a=t[n];var o=a.getAttribute("font-family");if(typeof o==="string"){var s=o.split(",");for(var u=0;u<s.length;u++){var l=s[u].replace(/['"]/g,"");if(l!==""&&!i[l]){i[l]=true;r.push(l)}}}}return{list:r,map:i}}function SS(e,t,r){var i=bS(t).map;return Ke().then(function(e){return e.filter(function(e){return i[e.name]})}).then(function(e){return Qe(e,!!r.embedFonts)}).then(function(e){if(e.length!==0){var r=Oe("style");for(var i=0;i<e.length;i++){r.appendChild(De(e[i]))}t.childNodes[0].appendChild(r)}return t})}var AS={what:undefined,dataProperties:undefined,download:true,filename:"graph.xlsx",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.xlsx=function(t){var r=to(t,AS,"what");var i=r.what;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.dataProperties;var l=r.filter;var d=Rb(e,{styles:"none",nodes:n,edges:a,filter:l}),h=ES(d,{what:i,dataProperties:u});if(o){Ne(h,s,"blob")}return Promise.resolve(h)}});function ES(e,t){var r=t.what;var i=t.dataProperties;var n=S("XLSX")||S("xlsx",{throwOnError:true}),a=new kS,o,s;if(!r){o=TS(n,Gb(e.nodes,true,i));s=TS(n,Gb(e.edges,false,i))}else{if(r==="nodes"){o=TS(n,Gb(e.nodes,true,i))}else if(r==="edges"){s=TS(n,Gb(e.edges,false,i))}else{throw new TypeError('Invalid argument: "what" is not "nodes" or "edges", was '+r)}}if(o){a.SheetNames.push("Nodes");a.Sheets.Nodes=o}if(s){a.SheetNames.push("Edges");a.Sheets.Edges=s}var u=n.write(a,{bookType:"xlsx",bookSST:false,type:"binary"});var l=Le([CS(u)]);return l}function wS(e){if(e===undefined){return""}else if(e instanceof Date){return e.toISOString()}else{return""+e}}function TS(e,t){var r={};var i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(var n=0;n!==t.length;++n){var a=t[n];for(var o=0;o!==a.length;++o){var value=a[o];if(i.s.r>n){i.s.r=n}if(i.s.c>o){i.s.c=o}if(i.e.r<n){i.e.r=n}if(i.e.c<o){i.e.c=o}var s={v:wS(value)},u=e.utils.encode_cell({c:o,r:n});r[u]=s}}if(i.s.c<1e7){r["!ref"]=e.utils.encode_range(i)}return r}function kS(){if(!(this instanceof kS)){return new kS}this.SheetNames=[];this.Sheets={}}function CS(e){var t=new ArrayBuffer(e.length);var r=new Uint8Array(t);for(var i=0;i!==e.length;++i){r[i]=e.charCodeAt(i)&255}return t}Ogma.default=Ogma;Ogma.geometry=Sa;Ogma.algorithms=Za;Ogma.utils=Pr;return Ogma});
//# sourceMappingURL=ogma.min.js.map
